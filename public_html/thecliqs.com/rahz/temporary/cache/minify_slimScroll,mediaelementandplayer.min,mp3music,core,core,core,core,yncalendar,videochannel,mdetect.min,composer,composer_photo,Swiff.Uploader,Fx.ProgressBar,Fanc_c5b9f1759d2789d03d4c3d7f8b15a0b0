/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 0.6.5
 * 
 */
(function($){jQuery.fn.extend({slimScroll:function(options){var defaults={wheelStep:20,width:'auto',height:'250px',size:'7px',color:'#000',position:'right',distance:'1px',start:'top',opacity:.4,alwaysVisible:false,disableFadeOut:false,railVisible:false,railColor:'#333',railOpacity:'0.2',railClass:'slimScrollRail',barClass:'slimScrollBar',wrapperClass:'slimScrollDiv',allowPageScroll:false,scrollPos:0,touchScrollStep:200};var o=$.extend(defaults,options);this.each(function(){var isOverPanel,isOverBar,isDragg,queueHide,touchDif,barHeight,percentScroll,lastScroll,divS='<div></div>',minBarHeight=30,releaseScroll=false;var me=$(this);if(me.parent().hasClass('slimScrollDiv'))
{if(scroll)
{bar=me.parent().find('.slimScrollBar');rail=me.parent().find('.slimScrollRail');scrollContent(me.scrollTop()+parseInt(o.scrollPos),false,true);}
return;}
var wrapper=$(divS).addClass(o.wrapperClass).css({position:'relative',overflow:'hidden',width:o.width,height:o.height});me.css({overflow:'hidden',width:o.width,height:o.height});var rail=$(divS).addClass(o.railClass).css({width:o.size,height:'100%',position:'absolute',top:0,display:(o.alwaysVisible&&o.railVisible)?'block':'none','border-radius':o.size,background:o.railColor,opacity:o.railOpacity,zIndex:90});var bar=$(divS).addClass(o.barClass).css({background:o.color,width:o.size,position:'absolute',top:0,opacity:o.opacity,display:o.alwaysVisible?'block':'none','border-radius':o.size,BorderRadius:o.size,MozBorderRadius:o.size,WebkitBorderRadius:o.size,zIndex:99});var posCss=(o.position=='right')?{right:o.distance}:{left:o.distance};rail.css(posCss);bar.css(posCss);me.wrap(wrapper);me.parent().append(bar);me.parent().append(rail);bar.draggable({axis:'y',containment:'parent',start:function(){isDragg=true;},stop:function(){isDragg=false;hideBar();},drag:function(e)
{scrollContent(0,$(this).position().top,false);}});rail.hover(function(){showBar();},function(){hideBar();});bar.hover(function(){isOverBar=true;},function(){isOverBar=false;});me.hover(function(){isOverPanel=true;showBar();hideBar();},function(){isOverPanel=false;hideBar();});me.bind('touchstart',function(e,b){if(e.originalEvent.touches.length)
{touchDif=e.originalEvent.touches[0].pageY;}});me.bind('touchmove',function(e){e.originalEvent.preventDefault();if(e.originalEvent.touches.length)
{var diff=(touchDif-e.originalEvent.touches[0].pageY)/o.touchScrollStep;scrollContent(diff,true);}});var _onWheel=function(e)
{if(!isOverPanel){return;}
var e=e||window.event;var delta=0;if(e.wheelDelta){delta=-e.wheelDelta/120;}
if(e.detail){delta=e.detail/3;}
scrollContent(delta,true);if(e.preventDefault&&!releaseScroll){e.preventDefault();}
if(!releaseScroll){e.returnValue=false;}}
function scrollContent(y,isWheel,isJump)
{var delta=y;if(isWheel)
{delta=parseInt(bar.css('top'))+y*parseInt(o.wheelStep)/100*bar.outerHeight();var maxTop=me.outerHeight()-bar.outerHeight();delta=Math.min(Math.max(delta,0),maxTop);bar.css({top:delta+'px'});}
percentScroll=parseInt(bar.css('top'))/(me.outerHeight()-bar.outerHeight());delta=percentScroll*(me[0].scrollHeight-me.outerHeight());if(isJump)
{delta=y;var offsetTop=delta/me[0].scrollHeight*me.outerHeight();bar.css({top:offsetTop+'px'});}
me.scrollTop(delta);showBar();hideBar();}
var attachWheel=function()
{if(window.addEventListener)
{this.addEventListener('DOMMouseScroll',_onWheel,false);this.addEventListener('mousewheel',_onWheel,false);}
else
{document.attachEvent("onmousewheel",_onWheel)}}
attachWheel();function getBarHeight()
{barHeight=Math.max((me.outerHeight()/me[0].scrollHeight)*me.outerHeight(),minBarHeight);bar.css({height:barHeight+'px'});}
getBarHeight();function showBar()
{getBarHeight();clearTimeout(queueHide);if(percentScroll==~~percentScroll)
{releaseScroll=o.allowPageScroll;if(lastScroll!=percentScroll)
{var msg=(~~percentScroll==0)?'top':'bottom';me.trigger('slimscroll',msg);}}
lastScroll=percentScroll;if(barHeight>=me.outerHeight()){releaseScroll=true;return;}
bar.stop(true,true).fadeIn('fast');if(o.railVisible){rail.stop(true,true).fadeIn('fast');}}
function hideBar()
{if(!o.alwaysVisible)
{queueHide=setTimeout(function(){if(!(o.disableFadeOut&&isOverPanel)&&!isOverBar&&!isDragg)
{bar.fadeOut('slow');rail.fadeOut('slow');}},1000);}}
if(o.start=='bottom')
{bar.css({top:me.outerHeight()-bar.outerHeight()});scrollContent(0,true);}
else if(typeof o.start=='object')
{scrollContent($(o.start).position().top,null,true);if(!o.alwaysVisible){bar.hide();}}
if(parseInt(o.scrollPos)==0)
{scrollContent(0,true);}});return this;}});jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll});})(jQuery);
;/*!
* MediaElement.js
* HTML5 <video> and <audio> shim and player
* http://mediaelementjs.com/
*
* Creates a JavaScript object that mimics HTML5 MediaElement API
* for browsers that don't understand HTML5 or can't play the provided codec
* Can play MP4 (H.264), Ogg, WebM, FLV, WMV, WMA, ACC, and MP3
*
* Copyright 2010-2012, John Dyer (http://j.hn)
* Dual licensed under the MIT or GPL Version 2 licenses.
*
*/
var mejs = mejs || {};
mejs.version = "2.10.0";
mejs.meIndex = 0;
mejs.plugins = {
    silverlight: [{
        version: [3, 0],
        types: ["video/mp4", "video/m4v", "video/mov", "video/wmv", "audio/wma", "audio/m4a", "audio/mp3", "audio/wav", "audio/mpeg"]
        }],
    flash: [{
        version: [9, 0, 124],
        types: ["video/mp4", "video/m4v", "video/mov", "video/flv", "video/rtmp", "video/x-flv", "audio/flv", "audio/x-flv", "audio/mp3", "audio/m4a", "audio/mpeg", "video/youtube", "video/x-youtube"]
        }],
    youtube: [{
        version: null,
        types: ["video/youtube", "video/x-youtube"]
        }],
    vimeo: [{
        version: null,
        types: ["video/vimeo", "video/x-vimeo"]
        }]
    };
mejs.Utility = {
    encodeUrl: function(a) {
        return encodeURIComponent(a)
        },
    escapeHTML: function(a) {
        return a.toString().split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")
        },
    absolutizeUrl: function(a) {
        var b = document.createElement("div");
        b.innerHTML = '<a href="' + this.escapeHTML(a) + '">x</a>';
        return b.firstChild.href
    },
    getScriptPath: function(a) {
        for (var b = 0, c, d = "", e = "", g, f = document.getElementsByTagName("script"), h = f.length, l = a.length; b < h; b++) {
            g = f[b].src;
            for (c = 0; c < l; c++) {
                e = a[c];
                if (g.indexOf(e) > -1) {
                    d = g.substring(0, g.indexOf(e));
                    break
                }
            }
            if (d !== "")
                break
        }
        return d
    },
    secondsToTimeCode: function(a, b, c, d) {
        if (typeof c == "undefined")
            c = false;
        else if (typeof d == "undefined")
            d = 25;
        var e = Math.floor(a / 3600) % 24,
        g = Math.floor(a / 60) % 60,
        f = Math.floor(a % 60);
        a = Math.floor((a % 1 * d).toFixed(3));
        return (b || e > 0 ? (e < 10 ? "0" + e: e) + ":": "") + (g < 10 ? "0" + g: g) + ":" + (f < 10 ? "0" + f: f) + (c ? ":" + (a < 10 ? "0" + a: a) : "")
        },
    timeCodeToSeconds: function(a, b, c, d) {
        if (typeof c == "undefined")
            c = false;
        else if (typeof d == "undefined")
            d = 25;
        a = a.split(":");
        b = parseInt(a[0], 10);
        var e = parseInt(a[1], 10),
        g = parseInt(a[2], 10),
        f = 0,
        h = 0;
        if (c)
            f = parseInt(a[3]) / d;
        return h = b * 3600 + e * 60 + g + f
    },
    convertSMPTEtoSeconds: function(a) {
        if (typeof a != "string")
            return false;
        a = a.replace(",", ".");
        var b = 0,
        c = a.indexOf(".") != -1 ? a.split(".")[1].length: 0,
        d = 1;
        a = a.split(":").reverse();
        for (var e = 0; e < a.length; e++) {
            d = 1;
            if (e > 0)
                d = Math.pow(60, e);
            b += Number(a[e]) * d
        }
        return Number(b.toFixed(c))
        },
    removeSwf: function(a) {
        var b = document.getElementById(a);
        if (b && b.nodeName == "OBJECT")
            if (mejs.MediaFeatures.isIE) {
            b.style.display = "none"; (function() {
                b.readyState == 4 ? mejs.Utility.removeObjectInIE(a) : setTimeout(arguments.callee, 10)
                })()
            } else
            b.parentNode.removeChild(b)
        },
    removeObjectInIE: function(a) {
        if (a = document.getElementById(a)) {
            for (var b in a)
                if (typeof a[b] == "function")
                a[b] = null;
            a.parentNode.removeChild(a)
            }
    }
};
mejs.PluginDetector = {
    hasPluginVersion: function(a, b) {
        var c = this.plugins[a];
        b[1] = b[1] || 0;
        b[2] = b[2] || 0;
        return c[0] > b[0] || c[0] == b[0] && c[1] > b[1] || c[0] == b[0] && c[1] == b[1] && c[2] >= b[2] ? true: false
    },
    nav: window.navigator,
    ua: window.navigator.userAgent.toLowerCase(),
    plugins: [],
    addPlugin: function(a, b, c, d, e) {
        this.plugins[a] = this.detectPlugin(b, c, d, e)
        },
    detectPlugin: function(a, b, c, d) {
        var e = [0, 0, 0],
        g;
        if (typeof this.nav.plugins != "undefined" && typeof this.nav.plugins[a] == "object") {
            if ((c = this.nav.plugins[a].description) && !(typeof this.nav.mimeTypes != "undefined" && this.nav.mimeTypes[b] && !this.nav.mimeTypes[b].enabledPlugin)) {
                e = c.replace(a, "").replace(/^\s+/, "").replace(/\sr/gi, ".").split(".");
                for (a = 0; a < e.length; a++)
                    e[a] = parseInt(e[a].match(/\d+/), 10)
                }
        } else if (typeof window.ActiveXObject != "undefined")
            try {
            if (g = new ActiveXObject(c))
                e = d(g)
            } catch(f) {}
        return e
    }
};
mejs.PluginDetector.addPlugin("flash", "Shockwave Flash", "application/x-shockwave-flash", "ShockwaveFlash.ShockwaveFlash", function(a) {
    var b = [];
    if (a = a.GetVariable("$version")) {
        a = a.split(" ")[1].split(",");
        b = [parseInt(a[0], 10), parseInt(a[1], 10), parseInt(a[2], 10)]
        }
    return b
});
mejs.PluginDetector.addPlugin("silverlight", "Silverlight Plug-In", "application/x-silverlight-2", "AgControl.AgControl", function(a) {
    var b = [0, 0, 0, 0],
    c = function(d, e, g, f) {
        for (; d.isVersionSupported(e[0] + "." + e[1] + "." + e[2] + "." + e[3]);)
            e[g] += f;
        e[g] -= f
    };
    c(a, b, 0, 1);
    c(a, b, 1, 1);
    c(a, b, 2, 1E4);
    c(a, b, 2, 1E3);
    c(a, b, 2, 100);
    c(a, b, 2, 10);
    c(a, b, 2, 1);
    c(a, b, 3, 1);
    return b
});
mejs.MediaFeatures = {
    init: function() {
        var a = this,
        b = document,
        c = mejs.PluginDetector.nav,
        d = mejs.PluginDetector.ua.toLowerCase(),
        e,
        g = ["source", "track", "audio", "video"];
        a.isiPad = d.match(/ipad/i) !== null;
        a.isiPhone = d.match(/iphone/i) !== null;
        a.isiOS = a.isiPhone || a.isiPad;
        a.isAndroid = d.match(/android/i) !== null;
        a.isBustedAndroid = d.match(/android 2\.[12]/) !== null;
        a.isIE = c.appName.toLowerCase().indexOf("microsoft") != -1;
        a.isChrome = d.match(/chrome/gi) !== null;
        a.isFirefox = d.match(/firefox/gi) !== null;
        a.isWebkit = d.match(/webkit/gi) !== null;
        a.isGecko = d.match(/gecko/gi) !== null && !a.isWebkit;
        a.isOpera = d.match(/opera/gi) !== null;
        a.hasTouch = "ontouchstart" in window;
        a.svg = !!document.createElementNS && !!document.createElementNS("http://www.w3.org/2000/svg", "svg").createSVGRect;
        for (c = 0; c < g.length; c++)
            e = document.createElement(g[c]);
        a.supportsMediaTag = typeof e.canPlayType !== "undefined" || a.isBustedAndroid;
        a.hasSemiNativeFullScreen = typeof e.webkitEnterFullscreen !== "undefined";
        a.hasWebkitNativeFullScreen = typeof e.webkitRequestFullScreen !== "undefined";
        a.hasMozNativeFullScreen = typeof e.mozRequestFullScreen !== "undefined";
        a.hasTrueNativeFullScreen = a.hasWebkitNativeFullScreen || a.hasMozNativeFullScreen;
        a.nativeFullScreenEnabled = a.hasTrueNativeFullScreen;
        if (a.hasMozNativeFullScreen)
            a.nativeFullScreenEnabled = e.mozFullScreenEnabled;
        if (this.isChrome)
            a.hasSemiNativeFullScreen = false;
        if (a.hasTrueNativeFullScreen) {
            a.fullScreenEventName = a.hasWebkitNativeFullScreen ? "webkitfullscreenchange": "mozfullscreenchange";
            a.isFullScreen = function() {
                if (e.mozRequestFullScreen)
                    return b.mozFullScreen;
                else if (e.webkitRequestFullScreen)
                    return b.webkitIsFullScreen
            };
            a.requestFullScreen = function(f) {
                if (a.hasWebkitNativeFullScreen)
                    f.webkitRequestFullScreen();
                else
                    a.hasMozNativeFullScreen && f.mozRequestFullScreen()
                };
            a.cancelFullScreen = function() {
                if (a.hasWebkitNativeFullScreen)
                    document.webkitCancelFullScreen();
                else
                    a.hasMozNativeFullScreen && document.mozCancelFullScreen()
                }
        }
        if (a.hasSemiNativeFullScreen && d.match(/mac os x 10_5/i)) {
            a.hasNativeFullScreen = false;
            a.hasSemiNativeFullScreen = false
        }
    }
};
mejs.MediaFeatures.init();
mejs.HtmlMediaElement = {
    pluginType: "native",
    isFullScreen: false,
    setCurrentTime: function(a) {
        this.currentTime = a
    },
    setMuted: function(a) {
        this.muted = a
    },
    setVolume: function(a) {
        this.volume = a
    },
    stop: function() {
        this.pause()
        },
    setSrc: function(a) {
        for (var b = this.getElementsByTagName("source"); b.length > 0;)
            this.removeChild(b[0]);
        if (typeof a == "string")
            this.src = a;
        else {
            var c;
            for (b = 0; b < a.length; b++) {
                c = a[b];
                if (this.canPlayType(c.type))
                    this.src = c.src
            }
        }
    },
    setVideoSize: function(a, b) {
        this.width = a;
        this.height = b
    }
};
mejs.PluginMediaElement = function(a, b, c) {
    this.id = a;
    this.pluginType = b;
    this.src = c;
    this.events = {}
};
mejs.PluginMediaElement.prototype = {
    pluginElement: null,
    pluginType: "",
    isFullScreen: false,
    playbackRate: -1,
    defaultPlaybackRate: -1,
    seekable: [],
    played: [],
    paused: true,
    ended: false,
    seeking: false,
    duration: 0,
    error: null,
    tagName: "",
    muted: false,
    volume: 1,
    currentTime: 0,
    play: function() {
        if (this.pluginApi != null) {
            this.pluginType == "youtube" ? this.pluginApi.playVideo() : this.pluginApi.playMedia();
            this.paused = false
        }
    },
    load: function() {
        if (this.pluginApi != null) {
            this.pluginType != "youtube" && this.pluginApi.loadMedia();
            this.paused = false
        }
    },
    pause: function() {
        if (this.pluginApi != null) {
            this.pluginType == "youtube" ? this.pluginApi.pauseVideo() : this.pluginApi.pauseMedia();
            this.paused = true
        }
    },
    stop: function() {
        if (this.pluginApi != null) {
            this.pluginType == "youtube" ? this.pluginApi.stopVideo() : this.pluginApi.stopMedia();
            this.paused = true
        }
    },
    canPlayType: function(a) {
        var b,
        c,
        d,
        e = mejs.plugins[this.pluginType];
        for (b = 0; b < e.length; b++) {
            d = e[b];
            if (mejs.PluginDetector.hasPluginVersion(this.pluginType, d.version))
                for (c = 0; c < d.types.length; c++)
                if (a == d.types[c])
                return true
        }
        return false
    },
    positionFullscreenButton: function(a, b, c) {
        this.pluginApi != null && this.pluginApi.positionFullscreenButton && this.pluginApi.positionFullscreenButton(a, b, c)
        },
    hideFullscreenButton: function() {
        this.pluginApi != null && this.pluginApi.hideFullscreenButton && this.pluginApi.hideFullscreenButton()
        },
    setSrc: function(a) {
        if (typeof a == "string") {
            this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(a));
            this.src = mejs.Utility.absolutizeUrl(a)
            } else {
            var b,
            c;
            for (b = 0; b < a.length; b++) {
                c = a[b];
                if (this.canPlayType(c.type)) {
                    this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(c.src));
                    this.src = mejs.Utility.absolutizeUrl(a)
                    }
            }
        }
    },
    setCurrentTime: function(a) {
        if (this.pluginApi != null) {
            this.pluginType == "youtube" ? this.pluginApi.seekTo(a) : this.pluginApi.setCurrentTime(a);
            this.currentTime = a
        }
    },
    setVolume: function(a) {
        if (this.pluginApi != null) {
            this.pluginType == "youtube" ? this.pluginApi.setVolume(a * 100) : this.pluginApi.setVolume(a);
            this.volume = a
        }
    },
    setMuted: function(a) {
        if (this.pluginApi != null) {
            if (this.pluginType == "youtube") {
                a ? this.pluginApi.mute() : this.pluginApi.unMute();
                this.muted = a;
                this.dispatchEvent("volumechange")
                } else
                this.pluginApi.setMuted(a);
            this.muted = a
        }
    },
    setVideoSize: function(a, b) {
        if (this.pluginElement.style) {
            this.pluginElement.style.width = a + "px";
            this.pluginElement.style.height = b + "px"
        }
        this.pluginApi != null && this.pluginApi.setVideoSize && this.pluginApi.setVideoSize(a, b)
        },
    setFullscreen: function(a) {
        this.pluginApi != null && this.pluginApi.setFullscreen && this.pluginApi.setFullscreen(a)
        },
    enterFullScreen: function() {
        this.pluginApi != null && this.pluginApi.setFullscreen && this.setFullscreen(true)
        },
    exitFullScreen: function() {
        this.pluginApi != null && this.pluginApi.setFullscreen && this.setFullscreen(false)
        },
    addEventListener: function(a, b) {
        this.events[a] = this.events[a] || [];
        this.events[a].push(b)
        },
    removeEventListener: function(a, b) {
        if (!a) {
            this.events = {};
            return true
        }
        var c = this.events[a];
        if (!c)
            return true;
        if (!b) {
            this.events[a] = [];
            return true
        }
        for (i = 0; i < c.length; i++)
            if (c[i] === b) {
            this.events[a].splice(i, 1);
            return true
        }
        return false
    },
    dispatchEvent: function(a) {
        var b,
        c,
        d = this.events[a];
        if (d) {
            c = Array.prototype.slice.call(arguments, 1);
            for (b = 0; b < d.length; b++)
                d[b].apply(null, c)
            }
    },
    attributes: {},
    hasAttribute: function(a) {
        return a in this.attributes
    },
    removeAttribute: function(a) {
        delete this.attributes[a]
        },
    getAttribute: function(a) {
        if (this.hasAttribute(a))
            return this.attributes[a];
        return ""
    },
    setAttribute: function(a, b) {
        this.attributes[a] = b
    },
    remove: function() {
        mejs.Utility.removeSwf(this.pluginElement.id)
        }
};
mejs.MediaPluginBridge = {
    pluginMediaElements: {},
    htmlMediaElements: {},
    registerPluginElement: function(a, b, c) {
        this.pluginMediaElements[a] = b;
        this.htmlMediaElements[a] = c
    },
    initPlugin: function(a) {
        var b = this.pluginMediaElements[a],
        c = this.htmlMediaElements[a];
        if (b) {
            switch (b.pluginType) {
            case "flash":
                b.pluginElement = b.pluginApi = document.getElementById(a);
                break;
            case "silverlight":
                b.pluginElement = document.getElementById(b.id);
                b.pluginApi = b.pluginElement.Content.MediaElementJS
            }
            b.pluginApi != null && b.success && b.success(b, c)
            }
    },
    fireEvent: function(a, b, c) {
        var d,
        e;
        a = this.pluginMediaElements[a];
        a.ended = false;
        a.paused = true;
        b = {
            type: b,
            target: a
        };
        for (d in c) {
            a[d] = c[d];
            b[d] = c[d]
            }
        e = c.bufferedTime || 0;
        b.target.buffered = b.buffered = {
            start: function() {
                return 0
            },
            end: function() {
                return e
            },
            length: 1
        };
        a.dispatchEvent(b.type, b)
        }
};
mejs.MediaElementDefaults = {
    mode: "auto",
    plugins: ["flash", "silverlight", "youtube", "vimeo"],
    enablePluginDebug: false,
    type: "",
    //pluginPath: mejs.Utility.getScriptPath(["mediaelement.js", "mediaelement.min.js", "mediaelement-and-player.js", "mediaelement-and-player.min.js"]),
    pluginPath : "application/modules/Mp3music/externals/scripts/",
    flashName: "flashmediaelement.swf",
    flashStreamer: "",
    enablePluginSmoothing: false,
    silverlightName: "silverlightmediaelement.xap",
    defaultVideoWidth: 480,
    defaultVideoHeight: 270,
    pluginWidth: -1,
    pluginHeight: -1,
    pluginVars: [],
    timerRate: 250,
    startVolume: 0.8,
    success: function() {},
    error: function() {}
};
mejs.MediaElement = function(a, b) {
    return mejs.HtmlMediaElementShim.create(a, b)
    };
mejs.HtmlMediaElementShim = {
    create: function(a, b) {
        var c = mejs.MediaElementDefaults,
        d = typeof a == "string" ? document.getElementById(a) : a,
        e = d.tagName.toLowerCase(),
        g = e === "audio" || e === "video",
        f = g ? d.getAttribute("src") : d.getAttribute("href");
        e = d.getAttribute("poster");
        var h = d.getAttribute("autoplay"),
        l = d.getAttribute("preload"),
        j = d.getAttribute("controls"),
        k;
        for (k in b)
            c[k] = b[k];
        f = typeof f == "undefined" || f === null || f == "" ? null: f;
        e = typeof e == "undefined" || e === null ? "": e;
        l = typeof l == "undefined" || l === null || l === "false" ? "none": l;
        h = !(typeof h == "undefined" || h === null || h === "false");
        j = !(typeof j == "undefined" || j === null || j === "false");
        k = this.determinePlayback(d, c, mejs.MediaFeatures.supportsMediaTag, g, f);
        k.url = k.url !== null ? mejs.Utility.absolutizeUrl(k.url) : "";
        if (k.method == "native") {
            if (mejs.MediaFeatures.isBustedAndroid) {
                d.src = k.url;
                d.addEventListener("click", function() {
                    d.play()
                    }, false)
                }
            return this.updateNative(k, c, h, l)
            } else if (k.method !== "")
            return this.createPlugin(k, c, e, h, l, j);
        else {
            this.createErrorMessage(k, c, e);
            return this
        }
    },
    determinePlayback: function(a, b, c, d, e) {
        var g = [],
        f,
        h,
        l,
        j = {
            method: "",
            url: "",
            htmlMediaElement: a,
            isVideo: a.tagName.toLowerCase() != "audio"
        },
        k;
        if (typeof b.type != "undefined" && b.type !== "")
            if (typeof b.type == "string")
            g.push({
            type: b.type,
            url: e
        });
        else
            for (f = 0; f < b.type.length; f++)
            g.push({
            type: b.type[f],
            url: e
        });
        else if (e !== null) {
            l = this.formatType(e, a.getAttribute("type"));
            g.push({
                type: l,
                url: e
            })
            } else
            for (f = 0; f < a.childNodes.length; f++) {
            h = a.childNodes[f];
            if (h.nodeType == 1 && h.tagName.toLowerCase() == "source") {
                e = h.getAttribute("src");
                l = this.formatType(e, h.getAttribute("type"));
                h = h.getAttribute("media");
                if (!h || !window.matchMedia || window.matchMedia && window.matchMedia(h).matches)
                    g.push({
                    type: l,
                    url: e
                })
                }
        }
        if (!d && g.length > 0 && g[0].url !== null && this.getTypeFromFile(g[0].url).indexOf("audio") > -1)
            j.isVideo = false;
        if (mejs.MediaFeatures.isBustedAndroid)
            a.canPlayType = function(m) {
            return m.match(/video\/(mp4|m4v)/gi) !== null ? "maybe": ""
        };
        if (c && (b.mode === "auto" || b.mode === "auto_plugin" || b.mode === "native")) {
            if (!d) {
                f = document.createElement(j.isVideo ? "video": "audio");
                a.parentNode.insertBefore(f, a);
                a.style.display = "none";
                j.htmlMediaElement = a = f
            }
            for (f = 0; f < g.length; f++)
                if (a.canPlayType(g[f].type).replace(/no/, "") !== "" || a.canPlayType(g[f].type.replace(/mp3/, "mpeg")).replace(/no/, "") !== "") {
                j.method = "native";
                j.url = g[f].url;
                break
            }
            if (j.method === "native") {
                if (j.url !== null)
                    a.src = j.url;
                if (b.mode !== "auto_plugin")
                    return j
            }
        }
        if (b.mode === "auto" || b.mode === "auto_plugin" || b.mode === "shim")
            for (f = 0; f < g.length; f++) {
            l = g[f].type;
            for (a = 0; a < b.plugins.length; a++) {
                e = b.plugins[a];
                h = mejs.plugins[e];
                for (c = 0; c < h.length; c++) {
                    k = h[c];
                    if (k.version == null || mejs.PluginDetector.hasPluginVersion(e, k.version))
                        for (d = 0; d < k.types.length; d++)
                        if (l == k.types[d]) {
                        j.method = e;
                        j.url = g[f].url;
                        return j
                    }
                }
            }
        }
        if (b.mode === "auto_plugin" && j.method === "native")
            return j;
        if (j.method === "" && g.length > 0)
            j.url = g[0].url;
        return j
    },
    formatType: function(a, b) {
        return a && !b ? this.getTypeFromFile(a) : b && ~b.indexOf(";") ? b.substr(0, b.indexOf(";")) : b
    },
    getTypeFromFile: function(a) {
        a = a.split("?")[0];
        a = a.substring(a.lastIndexOf(".") + 1);
        return (/(mp4|m4v|ogg|ogv|webm|webmv|flv|wmv|mpeg|mov)/gi.test(a) ? "video": "audio") + "/" + this.getTypeFromExtension(a)
        },
    getTypeFromExtension: function(a) {
        switch (a) {
        case "mp4":
        case "m4v":
            return "mp4";
        case "webm":
        case "webma":
        case "webmv":
            return "webm";
        case "ogg":
        case "oga":
        case "ogv":
            return "ogg";
        default:
            return a
        }
    },
    createErrorMessage: function(a, b, c) {
        var d = a.htmlMediaElement,
        e = document.createElement("div");
        e.className = "me-cannotplay";
        try {
            e.style.width = d.width + "px";
            e.style.height = d.height + "px"
        } catch(g) {}
        e.innerHTML = c !== "" ? '<a href="' + a.url + '"><img src="' + c + '" width="100%" height="100%" /></a>': '<a href="' + a.url + '"><span>' + mejs.i18n.t("Download File") + "</span></a>";
        d.parentNode.insertBefore(e, d);
        d.style.display = "none";
        b.error(d)
        },
    createPlugin: function(a, b, c, d, e, g) {
        c = a.htmlMediaElement;
        var f = 1,
        h = 1,
        l = "me_" + a.method + "_" + mejs.meIndex++,
        j = new mejs.PluginMediaElement(l, a.method, a.url),
        k = document.createElement("div"),
        m;
        j.tagName = c.tagName;
        for (m = 0; m < c.attributes.length; m++) {
            var n = c.attributes[m];
            n.specified == true && j.setAttribute(n.name, n.value)
            }
        for (m = c.parentNode; m !== null && m.tagName.toLowerCase() != "body";) {
            if (m.parentNode.tagName.toLowerCase() == "p") {
                m.parentNode.parentNode.insertBefore(m, m.parentNode);
                break
            }
            m = m.parentNode
        }
        if (a.isVideo) {
            f = b.videoWidth > 0 ? b.videoWidth: c.getAttribute("width") !== null ? c.getAttribute("width") : b.defaultVideoWidth;
            h = b.videoHeight > 0 ? b.videoHeight: c.getAttribute("height") !== null ? c.getAttribute("height") : b.defaultVideoHeight;
            f = mejs.Utility.encodeUrl(f);
            h = mejs.Utility.encodeUrl(h)
            } else if (b.enablePluginDebug) {
            f = 320;
            h = 240
        }
        j.success = b.success;
        mejs.MediaPluginBridge.registerPluginElement(l, j, c);
        k.className = "me-plugin";
        k.id = l + "_container";
        a.isVideo ? c.parentNode.insertBefore(k, c) : document.body.insertBefore(k, document.body.childNodes[0]);
        d = ["id=" + l, "isvideo=" + (a.isVideo ? "true": "false"), "autoplay=" + (d ? "true": "false"), "preload=" + e, "width=" + f, "startvolume=" + b.startVolume, "timerrate=" + b.timerRate, "flashstreamer=" + b.flashStreamer, "height=" + h];
        if (a.url !== null)
            a.method == "flash" ? d.push("file=" + mejs.Utility.encodeUrl(a.url)) : d.push("file=" + a.url);
        b.enablePluginDebug && d.push("debug=true");
        b.enablePluginSmoothing && d.push("smoothing=true");
        g && d.push("controls=true");
        if (b.pluginVars)
            d = d.concat(b.pluginVars);
        switch (a.method) {
        case "silverlight":
            k.innerHTML = '<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" id="' + l + '" name="' + l + '" width="' + f + '" height="' + h + '"><param name="initParams" value="' + d.join(",") + '" /><param name="windowless" value="true" /><param name="background" value="black" /><param name="minRuntimeVersion" value="3.0.0.0" /><param name="autoUpgrade" value="true" /><param name="source" value="' + b.pluginPath + b.silverlightName + '" /></object>';
            break;
        case "flash":
            if (mejs.MediaFeatures.isIE) {
                a = document.createElement("div");
                k.appendChild(a);
                a.outerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="' + l + '" width="' + f + '" height="' + h + '"><param name="movie" value="' + b.pluginPath + b.flashName + "?x=" + new Date + '" /><param name="flashvars" value="' + d.join("&amp;") + '" /><param name="quality" value="high" /><param name="bgcolor" value="#000000" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="true" /></object>'
            } else
                k.innerHTML = '<embed id="' + l + '" name="' + l + '" play="true" loop="false" quality="high" bgcolor="#000000" wmode="transparent" allowScriptAccess="always" allowFullScreen="true" type="application/x-shockwave-flash" pluginspage="//www.macromedia.com/go/getflashplayer" src="' + b.pluginPath + b.flashName + '" flashvars="' + d.join("&") + '" width="' + f + '" height="' + h + '"></embed>';
            break;
        case "youtube":
            b = a.url.substr(a.url.lastIndexOf("=") + 1);
            youtubeSettings = {
                container: k,
                containerId: k.id,
                pluginMediaElement: j,
                pluginId: l,
                videoId: b,
                height: h,
                width: f
            };
            mejs.PluginDetector.hasPluginVersion("flash", [10, 0, 0]) ? mejs.YouTubeApi.createFlash(youtubeSettings) : mejs.YouTubeApi.enqueueIframe(youtubeSettings);
            break;
        case "vimeo":
            j.vimeoid = a.url.substr(a.url.lastIndexOf("/") + 1);
            k.innerHTML = '<iframe src="http://player.vimeo.com/video/' + j.vimeoid + '?portrait=0&byline=0&title=0" width="' + f + '" height="' + h + '" frameborder="0"></iframe>'
        }
        c.style.display = "none";
        return j
    },
    updateNative: function(a, b) {
        var c = a.htmlMediaElement,
        d;
        for (d in mejs.HtmlMediaElement)
            c[d] = mejs.HtmlMediaElement[d];
        b.success(c, c);
        return c
    }
};
mejs.YouTubeApi = {
    isIframeStarted: false,
    isIframeLoaded: false,
    loadIframeApi: function() {
        if (!this.isIframeStarted) {
            var a = document.createElement("script");
            a.src = "http://www.youtube.com/player_api";
            var b = document.getElementsByTagName("script")[0];
            b.parentNode.insertBefore(a, b);
            this.isIframeStarted = true
        }
    },
    iframeQueue: [],
    enqueueIframe: function(a) {
        if (this.isLoaded)
            this.createIframe(a);
        else {
            this.loadIframeApi();
            this.iframeQueue.push(a)
            }
    },
    createIframe: function(a) {
        var b = a.pluginMediaElement,
        c = new YT.Player(a.containerId, {
            height: a.height,
            width: a.width,
            videoId: a.videoId,
            playerVars: {
                controls: 0
            },
            events: {
                onReady: function() {
                    a.pluginMediaElement.pluginApi = c;
                    mejs.MediaPluginBridge.initPlugin(a.pluginId);
                    setInterval(function() {
                        mejs.YouTubeApi.createEvent(c, b, "timeupdate")
                        }, 250)
                    },
                onStateChange: function(d) {
                    mejs.YouTubeApi.handleStateChange(d.data, c, b)
                    }
            }
        })
        },
    createEvent: function(a, b, c) {
        c = {
            type: c,
            target: b
        };
        if (a && a.getDuration) {
            b.currentTime = c.currentTime = a.getCurrentTime();
            b.duration = c.duration = a.getDuration();
            c.paused = b.paused;
            c.ended = b.ended;
            c.muted = a.isMuted();
            c.volume = a.getVolume() / 100;
            c.bytesTotal = a.getVideoBytesTotal();
            c.bufferedBytes = a.getVideoBytesLoaded();
            var d = c.bufferedBytes / c.bytesTotal * c.duration;
            c.target.buffered = c.buffered = {
                start: function() {
                    return 0
                },
                end: function() {
                    return d
                },
                length: 1
            }
        }
        b.dispatchEvent(c.type, c)
        },
    iFrameReady: function() {
        for (this.isIframeLoaded = this.isLoaded = true; this.iframeQueue.length > 0;)
            this.createIframe(this.iframeQueue.pop())
        },
    flashPlayers: {},
    createFlash: function(a) {
        this.flashPlayers[a.pluginId] = a;
        var b,
        c = "http://www.youtube.com/apiplayer?enablejsapi=1&amp;playerapiid=" + a.pluginId + "&amp;version=3&amp;autoplay=0&amp;controls=0&amp;modestbranding=1&loop=0";
        if (mejs.MediaFeatures.isIE) {
            b = document.createElement("div");
            a.container.appendChild(b);
            b.outerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="' + a.pluginId + '" width="' + a.width + '" height="' + a.height + '"><param name="movie" value="' + c + '" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="true" /></object>'
        } else
            a.container.innerHTML = '<object type="application/x-shockwave-flash" id="' + a.pluginId + '" data="' + c + '" width="' + a.width + '" height="' + a.height + '" style="visibility: visible; "><param name="allowScriptAccess" value="always"><param name="wmode" value="transparent"></object>'
    },
    flashReady: function(a) {
        var b = this.flashPlayers[a],
        c = document.getElementById(a),
        d = b.pluginMediaElement;
        d.pluginApi = d.pluginElement = c;
        mejs.MediaPluginBridge.initPlugin(a);
        c.cueVideoById(b.videoId);
        a = b.containerId + "_callback";
        window[a] = function(e) {
            mejs.YouTubeApi.handleStateChange(e, c, d)
            };
        c.addEventListener("onStateChange", a);
        setInterval(function() {
            mejs.YouTubeApi.createEvent(c, d, "timeupdate")
            }, 250)
        },
    handleStateChange: function(a, b, c) {
        switch (a) {
        case - 1: c.paused = true;
            c.ended = true;
            mejs.YouTubeApi.createEvent(b, c, "loadedmetadata");
            break;
        case 0:
            c.paused = false;
            c.ended = true;
            mejs.YouTubeApi.createEvent(b, c, "ended");
            break;
        case 1:
            c.paused = false;
            c.ended = false;
            mejs.YouTubeApi.createEvent(b, c, "play");
            mejs.YouTubeApi.createEvent(b, c, "playing");
            break;
        case 2:
            c.paused = true;
            c.ended = false;
            mejs.YouTubeApi.createEvent(b, c, "pause");
            break;
        case 3:
            mejs.YouTubeApi.createEvent(b, c, "progress")
            }
    }
};
function onYouTubePlayerAPIReady() {
    mejs.YouTubeApi.iFrameReady()
    }
function onYouTubePlayerReady(a) {
    mejs.YouTubeApi.flashReady(a)
    }
window.mejs = mejs;
window.MediaElement = mejs.MediaElement; (function(a, b, c) {
    var d = {
        locale: {
            strings: {}
        },
        methods: {}
    };
    d.locale.getLanguage = function() {
        return {
            language: navigator.language
        }
    };
    d.locale.INIT_LANGUAGE = d.locale.getLanguage();
    d.methods.checkPlain = function(e) {
        var g,
        f,
        h = {
            "&": "&amp;",
            '"': "&quot;",
            "<": "&lt;",
            ">": "&gt;"
        };
        e = String(e);
        for (g in h)
            if (h.hasOwnProperty(g)) {
            f = RegExp(g, "g");
            e = e.replace(f, h[g])
            }
        return e
    };
    d.methods.formatString = function(e, g) {
        for (var f in g) {
            switch (f.charAt(0)) {
            case "@":
                g[f] = d.methods.checkPlain(g[f]);
                break;
            case "!":
                break;
            default:
                g[f] = '<em class="placeholder">' + d.methods.checkPlain(g[f]) + "</em>"
            }
            e = e.replace(f, g[f])
            }
        return e
    };
    d.methods.t = function(e, g, f) {
        if (d.locale.strings && d.locale.strings[f.context] && d.locale.strings[f.context][e])
            e = d.locale.strings[f.context][e];
        if (g)
            e = d.methods.formatString(e, g);
        return e
    };
    d.t = function(e, g, f) {
        if (typeof e === "string" && e.length > 0) {
            var h = d.locale.getLanguage();
            f = f || {
                context: h.language
            };
            return d.methods.t(e, g, f)
            } else
            throw {
            name: "InvalidArgumentException",
            message: "First argument is either not a string or empty."
        };
    };
    c.i18n = d
})(jQuery, document, mejs); (function(a) {
    a.de = {
        Fullscreen: "Vollbild",
        "Go Fullscreen": "Vollbild an",
        "Turn off Fullscreen": "Vollbild aus"
    }
})(mejs.i18n.locale.strings);

/*!
 * MediaElementPlayer
 * http://mediaelementjs.com/
 *
 * Creates a controller bar for HTML5 <video> add <audio> tags
 * using jQuery and MediaElement.js (HTML5 Flash/Silverlight wrapper)
 *
 * Copyright 2010-2012, John Dyer (http://j.hn/)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 */
if (typeof jQuery != "undefined")
    mejs.$ = jQuery;
else if (typeof ender != "undefined")
    mejs.$ = ender; (function(f) {
    mejs.MepDefaults = {
        poster: "",
        defaultVideoWidth: 480,
        defaultVideoHeight: 270,
        videoWidth: -1,
        videoHeight: -1,
        defaultAudioWidth: 400,
        defaultAudioHeight: 30,
        defaultSeekBackwardInterval: function(a) {
            return a.duration * 0.05
        },
        defaultSeekForwardInterval: function(a) {
            return a.duration * 0.05
        },
        audioWidth: -1,
        audioHeight: -1,
        startVolume: 0.8,
        loop: false,
        enableAutosize: true,
        alwaysShowHours: false,
        showTimecodeFrameCount: false,
        framesPerSecond: 25,
        autosizeProgress: true,
        alwaysShowControls: false,
        iPadUseNativeControls: false,
        iPhoneUseNativeControls: false,
        AndroidUseNativeControls: false,
        features: ["playpause", "current", "progress", "duration", "tracks", "volume", "fullscreen"],
        isVideo: true,
        enableKeyboard: true,
        pauseOtherPlayers: true,
        keyActions: [{
            keys: [32, 179],
            action: function(a, b) {
                b.paused || b.ended ? b.play() : b.pause()
                }
        }, {
            keys: [38],
            action: function(a, b) {
                b.setVolume(Math.min(b.volume + 0.1, 1))
                }
        }, {
            keys: [40],
            action: function(a, b) {
                b.setVolume(Math.max(b.volume - 0.1, 0))
                }
        }, {
            keys: [37, 227],
            action: function(a, b) {
                if (!isNaN(b.duration) && b.duration > 0) {
                    if (a.isVideo) {
                        a.showControls();
                        a.startControlsTimer()
                        }
                    var c = Math.max(b.currentTime - a.options.defaultSeekBackwardInterval(b), 0);
                    b.setCurrentTime(c)
                    }
            }
        }, {
            keys: [39, 228],
            action: function(a, b) {
                if (!isNaN(b.duration) && b.duration > 0) {
                    if (a.isVideo) {
                        a.showControls();
                        a.startControlsTimer()
                        }
                    var c = Math.min(b.currentTime + a.options.defaultSeekForwardInterval(b), b.duration);
                    b.setCurrentTime(c)
                    }
            }
        }, {
            keys: [70],
            action: function(a) {
                if (typeof a.enterFullScreen != "undefined")
                    a.isFullScreen ? a.exitFullScreen() : a.enterFullScreen()
                }
        }]
        };
    mejs.mepIndex = 0;
    mejs.players = [];
    mejs.MediaElementPlayer = function(a, b) {
        if (! (this instanceof mejs.MediaElementPlayer))
            return new mejs.MediaElementPlayer(a, b);
        this.$media = this.$node = f(a);
        this.node = this.media = this.$media[0];
        if (typeof this.node.player != "undefined")
            return this.node.player;
        else
            this.node.player = this;
        if (typeof b == "undefined")
            b = this.$node.data("mejsoptions");
        this.options = f.extend({}, mejs.MepDefaults, b);
        mejs.players.push(this);
        this.init();
        return this
    };
    mejs.MediaElementPlayer.prototype = {
        hasFocus: false,
        controlsAreVisible: true,
        init: function() {
            var a = this,
            b = mejs.MediaFeatures,
            c = f.extend(true, {}, a.options, {
                success: function(d, g) {
                    a.meReady(d, g)
                    },
                error: function(d) {
                    a.handleError(d)
                    }
            }),
            e = a.media.tagName.toLowerCase();
            a.isDynamic = e !== "audio" && e !== "video";
            a.isVideo = a.isDynamic ? a.options.isVideo: e !== "audio" && a.options.isVideo;
            if (b.isiPad && a.options.iPadUseNativeControls || b.isiPhone && a.options.iPhoneUseNativeControls) {
                a.$media.attr("controls", "controls");
                if (b.isiPad && a.media.getAttribute("autoplay") !== null) {
                    a.media.load();
                    a.media.play()
                    }
            } else if (! (b.isAndroid && a.AndroidUseNativeControls)) {
                a.$media.removeAttr("controls");
                a.id = "mep_" + mejs.mepIndex++;
                a.container = f('<div id="' + a.id + '" class="mejs-container ' + (mejs.MediaFeatures.svg ? "svg": "no-svg") + '"><div class="mejs-inner"><div class="mejs-mediaelement"></div><div class="mejs-layers"></div><div class="mejs-controls"></div><div class="mejs-clear"></div></div></div>').addClass(a.$media[0].className).insertBefore(a.$media);
                a.container.addClass((b.isAndroid ? "mejs-android ": "") + (b.isiOS ? "mejs-ios ": "") + (b.isiPad ? "mejs-ipad ": "") + (b.isiPhone ? "mejs-iphone ": "") + (a.isVideo ? "mejs-video ": "mejs-audio "));
                if (b.isiOS) {
                    b = a.$media.clone();
                    a.container.find(".mejs-mediaelement").append(b);
                    a.$media.remove();
                    a.$node = a.$media = b;
                    a.node = a.media = b[0]
                    } else
                    a.container.find(".mejs-mediaelement").append(a.$media);
                a.controls = a.container.find(".mejs-controls");
                a.layers = a.container.find(".mejs-layers");
                b = a.isVideo ? "video": "audio";
                e = b.substring(0, 1).toUpperCase() + b.substring(1);
                a.width = a.options[b + "Width"] > 0 || a.options[b + "Width"].toString().indexOf("%") > -1 ? a.options[b + "Width"] : a.media.style.width !== "" && a.media.style.width !== null ? a.media.style.width: a.media.getAttribute("width") !== null ? a.$media.attr("width") : a.options["default" + e + "Width"];
                a.height = a.options[b + "Height"] > 0 || a.options[b + "Height"].toString().indexOf("%") > -1 ? a.options[b + "Height"] : a.media.style.height !== "" && a.media.style.height !== null ? a.media.style.height: a.$media[0].getAttribute("height") !== null ? a.$media.attr("height") : a.options["default" + e + "Height"];
                a.setPlayerSize(a.width, a.height);
                c.pluginWidth = a.height;
                c.pluginHeight = a.width
            }
            mejs.MediaElement(a.$media[0], c)
            },
        showControls: function(a) {
            var b = this;
            a = typeof a == "undefined" || a;
            if (!b.controlsAreVisible) {
                if (a) {
                    b.controls.css("visibility", "visible").stop(true, true).fadeIn(200, function() {
                        b.controlsAreVisible = true
                    });
                    b.container.find(".mejs-control").css("visibility", "visible").stop(true, true).fadeIn(200, function() {
                        b.controlsAreVisible = true
                    })
                    } else {
                    b.controls.css("visibility", "visible").css("display", "block");
                    b.container.find(".mejs-control").css("visibility", "visible").css("display", "block");
                    b.controlsAreVisible = true
                }
                b.setControlsSize()
                }
        },
        hideControls: function(a) {
            var b = this;
            a = typeof a == "undefined" || a;
            if (b.controlsAreVisible)
                if (a) {
                b.controls.stop(true, true).fadeOut(200, function() {
                    f(this).css("visibility", "hidden").css("display", "block");
                    b.controlsAreVisible = false
                });
                b.container.find(".mejs-control").stop(true, true).fadeOut(200, function() {
                    f(this).css("visibility", "hidden").css("display", "block")
                    })
                } else {
                b.controls.css("visibility", "hidden").css("display", "block");
                b.container.find(".mejs-control").css("visibility", "hidden").css("display", "block");
                b.controlsAreVisible = false
            }
        },
        controlsTimer: null,
        startControlsTimer: function(a) {
            var b = this;
            a = typeof a != "undefined" ? a: 1500;
            b.killControlsTimer("start");
            b.controlsTimer = setTimeout(function() {
                b.hideControls();
                b.killControlsTimer("hide")
                }, a)
            },
        killControlsTimer: function() {
            if (this.controlsTimer !== null) {
                clearTimeout(this.controlsTimer);
                delete this.controlsTimer;
                this.controlsTimer = null
            }
        },
        controlsEnabled: true,
        disableControls: function() {
            this.killControlsTimer();
            this.hideControls(false);
            this.controlsEnabled = false
        },
        enableControls: function() {
            this.showControls(false);
            this.controlsEnabled = true
        },
        meReady: function(a, b) {
            var c = this,
            e = mejs.MediaFeatures,
            d = b.getAttribute("autoplay");
            d = !(typeof d == "undefined" || d === null || d === "false");
            var g;
            if (!c.created) {
                c.created = true;
                c.media = a;
                c.domNode = b;
                if (! (e.isAndroid && c.options.AndroidUseNativeControls) && !(e.isiPad && c.options.iPadUseNativeControls) && !(e.isiPhone && c.options.iPhoneUseNativeControls)) {
                    c.buildposter(c, c.controls, c.layers, c.media);
                    c.buildkeyboard(c, c.controls, c.layers, c.media);
                    c.buildoverlays(c, c.controls, c.layers, c.media);
                    c.findTracks();
                    for (g in c.options.features) {
                        e = c.options.features[g];
                        if (c["build" + e])
                            try {
                            c["build" + e](c, c.controls, c.layers, c.media)
                            } catch(k) {}
                    }
                    c.container.trigger("controlsready");
                    c.setPlayerSize(c.width, c.height);
                    c.setControlsSize();
                    if (c.isVideo) {
                        if (mejs.MediaFeatures.hasTouch)
                            c.$media.bind("touchstart", function() {
                            if (c.controlsAreVisible)
                                c.hideControls(false);
                            else
                                c.controlsEnabled && c.showControls(false)
                            });
                        else { (c.media.pluginType == "native" ? c.$media: f(c.media.pluginElement)).click(function() {
                                a.paused ? a.play() : a.pause()
                                });
                            c.container.bind("mouseenter mouseover", function() {
                                if (c.controlsEnabled)
                                    if (!c.options.alwaysShowControls) {
                                    c.killControlsTimer("enter");
                                    c.showControls();
                                    c.startControlsTimer(2500)
                                    }
                            }).bind("mousemove", function() {
                                if (c.controlsEnabled) {
                                    c.controlsAreVisible || c.showControls();
                                    c.options.alwaysShowControls || c.startControlsTimer(2500)
                                    }
                            }).bind("mouseleave", function() {
                                c.controlsEnabled && !c.media.paused && !c.options.alwaysShowControls && c.startControlsTimer(1E3)
                                })
                            }
                        d && !c.options.alwaysShowControls && c.hideControls();
                        c.options.enableAutosize && c.media.addEventListener("loadedmetadata", function(h) {
                            if (c.options.videoHeight <= 0 && c.domNode.getAttribute("height") === null && !isNaN(h.target.videoHeight)) {
                                c.setPlayerSize(h.target.videoWidth, h.target.videoHeight);
                                c.setControlsSize();
                                c.media.setVideoSize(h.target.videoWidth, h.target.videoHeight)
                                }
                        }, false)
                        }
                    a.addEventListener("play", function() {
                        for (var h = 0, o = mejs.players.length; h < o; h++) {
                            var n = mejs.players[h];
                            n.id != c.id && c.options.pauseOtherPlayers && !n.paused && !n.ended && n.pause();
                            n.hasFocus = false
                        }
                        c.hasFocus = true
                    }, false);
                    c.media.addEventListener("ended", function() {
                        try {
                            c.media.setCurrentTime(0)
                            } catch(h) {}
                        c.media.pause();
                        c.setProgressRail && c.setProgressRail();
                        c.setCurrentRail && c.setCurrentRail();
                        if (c.options.loop)
                            c.media.play();
                        else ! c.options.alwaysShowControls && c.controlsEnabled && c.showControls()
                        }, false);
                    c.media.addEventListener("loadedmetadata", function() {
                        c.updateDuration && c.updateDuration();
                        c.updateCurrent && c.updateCurrent();
                        if (!c.isFullScreen) {
                            c.setPlayerSize(c.width, c.height);
                            c.setControlsSize()
                            }
                    }, false);
                    setTimeout(function() {
                        c.setPlayerSize(c.width, c.height);
                        c.setControlsSize()
                        }, 50);
                    f(window).resize(function() {
                        c.isFullScreen || mejs.MediaFeatures.hasTrueNativeFullScreen && document.webkitIsFullScreen || c.setPlayerSize(c.width, c.height);
                        c.setControlsSize()
                        });
                    c.media.pluginType == "youtube" && c.container.find(".mejs-overlay-play").hide()
                    }
                if (d && a.pluginType == "native") {
                    a.load();
                    a.play()
                    }
                if (c.options.success)
                    typeof c.options.success == "string" ? window[c.options.success](c.media, c.domNode, c) : c.options.success(c.media, c.domNode, c)
                }
        },
        handleError: function(a) {
            this.controls.hide();
            this.options.error && this.options.error(a)
            },
        setPlayerSize: function(a, b) {
            if (typeof a != "undefined")
                this.width = a;
            if (typeof b != "undefined")
                this.height = b;
            if (this.height.toString().indexOf("%") > 0 || this.$node.css("max-width") === "100%") {
                var c = this.isVideo ? this.media.videoWidth && this.media.videoWidth > 0 ? this.media.videoWidth: this.options.defaultVideoWidth: this.options.defaultAudioWidth,
                e = this.isVideo ? this.media.videoHeight && this.media.videoHeight > 0 ? this.media.videoHeight: this.options.defaultVideoHeight: this.options.defaultAudioHeight,
                d = this.container.parent().width();
                c = parseInt(d * e / c, 10);
                if (this.container.parent()[0].tagName.toLowerCase() === "body") {
                    d = f(window).width();
                    c = f(window).height()
                    }
                if (c != 0) {
                    this.container.width(d).height(c);
                    this.$media.width("100%").height("100%");
                    this.container.find("object, embed, iframe").width("100%").height("100%");
                    this.isVideo && this.media.setVideoSize && this.media.setVideoSize(d, c);
                    this.layers.children(".mejs-layer").width("100%").height("100%")
                    }
            } else {
                this.container.width(this.width).height(this.height);
                this.layers.children(".mejs-layer").width(this.width).height(this.height)
                }
        },
        setControlsSize: function() {
            var a = 0,
            b = 0,
            c = this.controls.find(".mejs-time-rail"),
            e = this.controls.find(".mejs-time-total");
            this.controls.find(".mejs-time-current");
            this.controls.find(".mejs-time-loaded");
            var d = c.siblings();
            if (this.options && !this.options.autosizeProgress)
                b = parseInt(c.css("width"));
            if (b === 0 || !b) {
                d.each(function() {
                    if (f(this).css("position") != "absolute")
                        a += f(this).outerWidth(true)
                    });
                b = this.controls.width() - a - (c.outerWidth(true) - c.width())
                }
            b = b - 10;
            c.width(b);
            e.width(b - (e.outerWidth(true) - e.width()));
            this.setProgressRail && this.setProgressRail();
            this.setCurrentRail && this.setCurrentRail()
            },
        buildposter: function(a, b, c, e) {
            var d = f('<div class="mejs-poster mejs-layer"></div>').appendTo(c);
            b = a.$media.attr("poster");
            if (a.options.poster !== "")
                b = a.options.poster;
            b !== "" && b != null ? this.setPoster(b) : d.hide();
            e.addEventListener("play", function() {
                d.hide()
                }, false)
            },
        setPoster: function(a) {
            var b = this.container.find(".mejs-poster"),
            c = b.find("img");
            if (c.length == 0)
                c = f('<img width="100%" height="100%" />').appendTo(b);
            c.attr("src", a)
            },
        buildoverlays: function(a, b, c, e) {
            if (a.isVideo) {
                var d = f('<div class="mejs-overlay mejs-layer"><div class="mejs-overlay-loading"><span></span></div></div>').hide().appendTo(c),
                g = f('<div class="mejs-overlay mejs-layer"><div class="mejs-overlay-error"></div></div>').hide().appendTo(c),
                k = f('<div class="mejs-overlay mejs-layer mejs-overlay-play"><div class="mejs-overlay-button"></div></div>').appendTo(c).click(function() {
                    e.paused ? e.play() : e.pause()
                    });
                e.addEventListener("play", function() {
                    k.hide();
                    d.hide();
                    b.find(".mejs-time-buffering").hide();
                    g.hide()
                    }, false);
                e.addEventListener("playing", function() {
                    k.hide();
                    d.hide();
                    b.find(".mejs-time-buffering").hide();
                    g.hide()
                    }, false);
                e.addEventListener("seeking", function() {
                    d.show();
                    b.find(".mejs-time-buffering").show()
                    }, false);
                e.addEventListener("seeked", function() {
                    d.hide();
                    b.find(".mejs-time-buffering").hide()
                    }, false);
                e.addEventListener("pause", function() {
                    mejs.MediaFeatures.isiPhone || k.show()
                    }, false);
                e.addEventListener("waiting", function() {
                    d.show();
                    b.find(".mejs-time-buffering").show()
                    }, false);
                e.addEventListener("loadeddata", function() {
                    d.show();
                    b.find(".mejs-time-buffering").show()
                    }, false);
                e.addEventListener("canplay", function() {
                    d.hide();
                    b.find(".mejs-time-buffering").hide()
                    }, false);
                e.addEventListener("error", function() {
                    d.hide();
                    b.find(".mejs-time-buffering").hide();
                    g.show();
                    g.find("mejs-overlay-error").html("Error loading this resource")
                    }, false)
                }
        },
        buildkeyboard: function(a, b, c, e) {
            f(document).keydown(function(d) {
                if (a.hasFocus && a.options.enableKeyboard)
                    for (var g = 0, k = a.options.keyActions.length; g < k; g++)
                    for (var h = a.options.keyActions[g], o = 0, n = h.keys.length; o < n; o++)
                    if (d.keyCode == h.keys[o]) {
                    d.preventDefault();
                    h.action(a, e, d.keyCode);
                    return false
                }
                return true
            });
            f(document).click(function(d) {
                if (f(d.target).closest(".mejs-container").length == 0)
                    a.hasFocus = false
            })
            },
        findTracks: function() {
            var a = this,
            b = a.$media.find("track");
            a.tracks = [];
            b.each(function(c, e) {
                e = f(e);
                a.tracks.push({
                    srclang: e.attr("srclang").toLowerCase(),
                    src: e.attr("src"),
                    kind: e.attr("kind"),
                    label: e.attr("label") || "",
                    entries: [],
                    isLoaded: false
                })
                })
            },
        changeSkin: function(a) {
            this.container[0].className = "mejs-container " + a;
            this.setPlayerSize(this.width, this.height);
            this.setControlsSize()
            },
        play: function() {
            this.media.play()
            },
        pause: function() {
            this.media.pause()
            },
        load: function() {
            this.media.load()
            },
        setMuted: function(a) {
            this.media.setMuted(a)
            },
        setCurrentTime: function(a) {
            this.media.setCurrentTime(a)
            },
        getCurrentTime: function() {
            return this.media.currentTime
        },
        setVolume: function(a) {
            this.media.setVolume(a)
            },
        getVolume: function() {
            return this.media.volume
        },
        setSrc: function(a) {
            this.media.setSrc(a)
            },
        remove: function() {
            if (this.media.pluginType === "flash")
                this.media.remove();
            else
                this.media.pluginType === "native" && this.$media.prop("controls", true);
            this.isDynamic || this.$node.insertBefore(this.container);
            this.container.remove()
            }
    };
    if (typeof jQuery != "undefined")
        jQuery.fn.mediaelementplayer = function(a) {
        return this.each(function() {
            new mejs.MediaElementPlayer(this, a)
            })
        };
    f(document).ready(function() {
        f(".mejs-player").mediaelementplayer()
        });
    window.MediaElementPlayer = mejs.MediaElementPlayer
})(mejs.$); (function(f) {
    f.extend(mejs.MepDefaults, {
        playpauseText: "Play/Pause"
    });
    f.extend(MediaElementPlayer.prototype, {
        buildplaypause: function(a, b, c, e) {
            var d = f('<div class="mejs-button mejs-playpause-button mejs-play" ><button type="button" aria-controls="' + this.id + '" title="' + this.options.playpauseText + '"></button></div>').appendTo(b).click(function(g) {
                g.preventDefault();
                e.paused ? e.play() : e.pause();
                return false
            });
            e.addEventListener("play", function() {
                d.removeClass("mejs-play").addClass("mejs-pause")
                }, false);
            e.addEventListener("playing", function() {
                d.removeClass("mejs-play").addClass("mejs-pause")
                }, false);
            e.addEventListener("pause", function() {
                d.removeClass("mejs-pause").addClass("mejs-play")
                }, false);
            e.addEventListener("paused", function() {
                d.removeClass("mejs-pause").addClass("mejs-play")
                }, false)
            }
    })
    })(mejs.$); (function(f) {
    f.extend(mejs.MepDefaults, {
        stopText: "Stop"
    });
    f.extend(MediaElementPlayer.prototype, {
        buildstop: function(a, b, c, e) {
            f('<div class="mejs-button mejs-stop-button mejs-stop"><button type="button" aria-controls="' + this.id + '" title="' + this.options.stopText + '"></button></div>').appendTo(b).click(function() {
                e.paused || e.pause();
                if (e.currentTime > 0) {
                    e.setCurrentTime(0);
                    b.find(".mejs-time-current").width("0px");
                    b.find(".mejs-time-handle").css("left", "0px");
                    b.find(".mejs-time-float-current").html(mejs.Utility.secondsToTimeCode(0));
                    b.find(".mejs-currenttime").html(mejs.Utility.secondsToTimeCode(0));
                    c.find(".mejs-poster").show()
                    }
            })
            }
    })
    })(mejs.$); (function(f) {
    f.extend(MediaElementPlayer.prototype, {
        buildprogress: function(a, b, c, e) {
            f('<div class="mejs-time-rail"><span class="mejs-time-total"><span class="mejs-time-buffering"></span><span class="mejs-time-loaded"></span><span class="mejs-time-current"></span><span class="mejs-time-handle"></span><span class="mejs-time-float"><span class="mejs-time-float-current">00:00</span><span class="mejs-time-float-corner"></span></span></span></div>').appendTo(b);
            b.find(".mejs-time-buffering").hide();
            var d = b.find(".mejs-time-total");
            c = b.find(".mejs-time-loaded");
            var g = b.find(".mejs-time-current"),
            k = b.find(".mejs-time-handle"),
            h = b.find(".mejs-time-float"),
            o = b.find(".mejs-time-float-current"),
            n = function(l) {
                l = l.pageX;
                var q = d.offset(),
                i = d.outerWidth(),
                j = 0;
                j = 0;
                var m = l - q.left;
                if (l > q.left && l <= i + q.left && e.duration) {
                    j = (l - q.left) / i;
                    j = j <= 0.02 ? 0: j * e.duration;
                    p && e.setCurrentTime(j);
                    if (!mejs.MediaFeatures.hasTouch) {
                        h.css("left", m);
                        o.html(mejs.Utility.secondsToTimeCode(j));
                        h.show()
                        }
                }
            },
            p = false;
            d.bind("mousedown", function(l) {
                if (l.which === 1) {
                    p = true;
                    n(l);
                    f(document).bind("mousemove.dur", function(q) {
                        n(q)
                        }).bind("mouseup.dur", function() {
                        p = false;
                        h.hide();
                        f(document).unbind(".dur")
                        });
                    return false
                }
            }).bind("mouseenter", function() {
                f(document).bind("mousemove.dur", function(l) {
                    n(l)
                    });
                mejs.MediaFeatures.hasTouch || h.show()
                }).bind("mouseleave", function() {
                if (!p) {
                    f(document).unbind(".dur");
                    h.hide()
                    }
            });
            e.addEventListener("progress", function(l) {
                a.setProgressRail(l);
                a.setCurrentRail(l)
                }, false);
            e.addEventListener("timeupdate", function(l) {
                a.setProgressRail(l);
                a.setCurrentRail(l)
                }, false);
            this.loaded = c;
            this.total = d;
            this.current = g;
            this.handle = k
        },
        setProgressRail: function(a) {
            var b = a != undefined ? a.target: this.media,
            c = null;
            if (b && b.buffered && b.buffered.length > 0 && b.buffered.end && b.duration)
                c = b.buffered.end(0) / b.duration;
            else if (b && b.bytesTotal != undefined && b.bytesTotal > 0 && b.bufferedBytes != undefined)
                c = b.bufferedBytes / b.bytesTotal;
            else if (a && a.lengthComputable && a.total != 0)
                c = a.loaded / a.total;
            if (c !== null) {
                c = Math.min(1, Math.max(0, c));
                this.loaded && this.total && this.loaded.width(this.total.width() * c)
                }
        },
        setCurrentRail: function() {
            if (this.media.currentTime != undefined && this.media.duration)
                if (this.total && this.handle) {
                var a = this.total.width() * this.media.currentTime / this.media.duration,
                b = a - this.handle.outerWidth(true) / 2;
                this.current.width(a);
                this.handle.css("left", b)
                }
        }
    })
    })(mejs.$); (function(f) {
    f.extend(mejs.MepDefaults, {
        duration: -1,
        timeAndDurationSeparator: " <span> | </span> "
    });
    f.extend(MediaElementPlayer.prototype, {
        buildcurrent: function(a, b, c, e) {
            f('<div class="mejs-time"><span class="mejs-currenttime">' + (a.options.alwaysShowHours ? "00:": "") + (a.options.showTimecodeFrameCount ? "00:00:00": "00:00") + "</span></div>").appendTo(b);
            this.currenttime = this.controls.find(".mejs-currenttime");
            e.addEventListener("timeupdate", function() {
                a.updateCurrent()
                }, false)
            },
        buildduration: function(a, b, c, e) {
            if (b.children().last().find(".mejs-currenttime").length > 0)
                f(this.options.timeAndDurationSeparator + '<span class="mejs-duration">' + (this.options.duration > 0 ? mejs.Utility.secondsToTimeCode(this.options.duration, this.options.alwaysShowHours || this.media.duration > 3600, this.options.showTimecodeFrameCount, this.options.framesPerSecond || 25) : (a.options.alwaysShowHours ? "00:": "") + (a.options.showTimecodeFrameCount ? "00:00:00": "00:00")) + "</span>").appendTo(b.find(".mejs-time"));
            else {
                b.find(".mejs-currenttime").parent().addClass("mejs-currenttime-container");
                f('<div class="mejs-time mejs-duration-container"><span class="mejs-duration">' + (this.options.duration > 0 ? mejs.Utility.secondsToTimeCode(this.options.duration, this.options.alwaysShowHours || this.media.duration > 3600, this.options.showTimecodeFrameCount, this.options.framesPerSecond || 25) : (a.options.alwaysShowHours ? "00:": "") + (a.options.showTimecodeFrameCount ? "00:00:00": "00:00")) + "</span></div>").appendTo(b)
                }
            this.durationD = this.controls.find(".mejs-duration");
            e.addEventListener("timeupdate", function() {
                a.updateDuration()
                }, false)
            },
        updateCurrent: function() {
            if (this.currenttime)
                this.currenttime.html(mejs.Utility.secondsToTimeCode(this.media.currentTime, this.options.alwaysShowHours || this.media.duration > 3600, this.options.showTimecodeFrameCount, this.options.framesPerSecond || 25))
            },
        updateDuration: function() {
            if (this.media.duration && this.durationD)
                this.durationD.html(mejs.Utility.secondsToTimeCode(this.media.duration, this.options.alwaysShowHours, this.options.showTimecodeFrameCount, this.options.framesPerSecond || 25))
            }
    })
    })(mejs.$); (function(f) {
    f.extend(mejs.MepDefaults, {
        muteText: "Mute Toggle",
        hideVolumeOnTouchDevices: true,
        audioVolume: "horizontal",
        videoVolume: "vertical"
    });
    f.extend(MediaElementPlayer.prototype, {
        buildvolume: function(a, b, c, e) {
            if (! (mejs.MediaFeatures.hasTouch && this.options.hideVolumeOnTouchDevices)) {
                var d = this.isVideo ? this.options.videoVolume: this.options.audioVolume,
                g = d == "horizontal" ? f('<div class="mejs-button mejs-volume-button mejs-mute"><button type="button" aria-controls="' + this.id + '" title="' + this.options.muteText + '"></button></div><div class="mejs-horizontal-volume-slider"><div class="mejs-horizontal-volume-total"></div><div class="mejs-horizontal-volume-current"></div><div class="mejs-horizontal-volume-handle"></div></div>').appendTo(b) : f('<div class="mejs-button mejs-volume-button mejs-mute"><button type="button" aria-controls="' + this.id + '" title="' + this.options.muteText + '"></button><div class="mejs-volume-slider"><div class="mejs-volume-total"></div><div class="mejs-volume-current"></div><div class="mejs-volume-handle"></div></div></div>').appendTo(b),
                k = this.container.find(".mejs-volume-slider, .mejs-horizontal-volume-slider"),
                h = this.container.find(".mejs-volume-total, .mejs-horizontal-volume-total"),
                o = this.container.find(".mejs-volume-current, .mejs-horizontal-volume-current"),
                n = this.container.find(".mejs-volume-handle, .mejs-horizontal-volume-handle"),
                p = function(j, m) {
                    if (!k.is(":visible") && typeof m == "undefined") {
                        k.show();
                        p(j, true);
                        k.hide()
                        } else {
                        j = Math.max(0, j);
                        j = Math.min(j, 1);
                        j == 0 ? g.removeClass("mejs-mute").addClass("mejs-unmute") : g.removeClass("mejs-unmute").addClass("mejs-mute");
                        if (d == "vertical") {
                            var r = h.height(),
                            s = h.position(),
                            t = r - r * j;
                            n.css("top", s.top + t - n.height() / 2);
                            o.height(r - t);
                            o.css("top", s.top + t)
                            } else {
                            r = h.width();
                            s = h.position();
                            r = r * j;
                            n.css("left", s.left + r - n.width() / 2);
                            o.width(r)
                            }
                    }
                },
                l = function(j) {
                    var m = null,
                    r = h.offset();
                    if (d == "vertical") {
                        m = h.height();
                        parseInt(h.css("top").replace(/px/, ""), 10);
                        m = (m - (j.pageY - r.top)) / m;
                        if (r.top == 0 || r.left == 0)
                            return
                    } else {
                        m = h.width();
                        m = (j.pageX - r.left) / m
                    }
                    m = Math.max(0, m);
                    m = Math.min(m, 1);
                    p(m);
                    m == 0 ? e.setMuted(true) : e.setMuted(false);
                    e.setVolume(m)
                    },
                q = false,
                i = false;
                g.hover(function() {
                    k.show();
                    i = true
                }, function() {
                    i = false; ! q && d == "vertical" && k.hide()
                    });
                k.bind("mouseover", function() {
                    i = true
                }).bind("mousedown", function(j) {
                    l(j);
                    f(document).bind("mousemove.vol", function(m) {
                        l(m)
                        }).bind("mouseup.vol", function() {
                        q = false;
                        f(document).unbind(".vol"); ! i && d == "vertical" && k.hide()
                        });
                    q = true;
                    return false
                });
                g.find("button").click(function() {
                    e.setMuted(!e.muted)
                    });
                e.addEventListener("volumechange", function() {
                    if (!q)
                        if (e.muted) {
                        p(0);
                        g.removeClass("mejs-mute").addClass("mejs-unmute")
                        } else {
                        p(e.volume);
                        g.removeClass("mejs-unmute").addClass("mejs-mute")
                        }
                }, false);
                if (this.container.is(":visible")) {
                    p(a.options.startVolume);
                    e.pluginType === "native" && e.setVolume(a.options.startVolume)
                    }
            }
        }
    })
    })(mejs.$); (function(f) {
    f.extend(mejs.MepDefaults, {
        usePluginFullScreen: true,
        newWindowCallback: function() {
            return ""
        },
        fullscreenText: mejs.i18n.t("Fullscreen")
        });
    f.extend(MediaElementPlayer.prototype, {
        isFullScreen: false,
        isNativeFullScreen: false,
        docStyleOverflow: null,
        isInIframe: false,
        buildfullscreen: function(a, b, c, e) {
            if (a.isVideo) {
                a.isInIframe = window.location != window.parent.location;
                if (mejs.MediaFeatures.hasTrueNativeFullScreen) {
                    c = null;
                    c = mejs.MediaFeatures.hasMozNativeFullScreen ? f(document) : a.container;
                    c.bind(mejs.MediaFeatures.fullScreenEventName, function() {
                        if (mejs.MediaFeatures.isFullScreen()) {
                            a.isNativeFullScreen = true;
                            a.setControlsSize()
                            } else {
                            a.isNativeFullScreen = false;
                            a.exitFullScreen()
                            }
                    })
                    }
                var d = this,
                g = f('<div class="mejs-button mejs-fullscreen-button"><button type="button" aria-controls="' + d.id + '" title="' + d.options.fullscreenText + '"></button></div>').appendTo(b);
                if (d.media.pluginType === "native" || !d.options.usePluginFullScreen && !mejs.MediaFeatures.isFirefox)
                    g.click(function() {
                    mejs.MediaFeatures.hasTrueNativeFullScreen && mejs.MediaFeatures.isFullScreen() || a.isFullScreen ? a.exitFullScreen() : a.enterFullScreen()
                    });
                else {
                    var k = null;
                    if (function() {
                        var i = document.createElement("x"),
                        j = document.documentElement,
                        m = window.getComputedStyle;
                        if (! ("pointerEvents" in i.style))
                            return false;
                        i.style.pointerEvents = "auto";
                        i.style.pointerEvents = "x";
                        j.appendChild(i);
                        m = m && m(i, "").pointerEvents === "auto";
                        j.removeChild(i);
                        return !! m
                    } () && !mejs.MediaFeatures.isOpera) {
                        var h = false,
                        o = function() {
                            if (h) {
                                n.hide();
                                p.hide();
                                l.hide();
                                g.css("pointer-events", "");
                                d.controls.css("pointer-events", "");
                                h = false
                            }
                        },
                        n = f('<div class="mejs-fullscreen-hover" />').appendTo(d.container).mouseover(o),
                        p = f('<div class="mejs-fullscreen-hover"  />').appendTo(d.container).mouseover(o),
                        l = f('<div class="mejs-fullscreen-hover"  />').appendTo(d.container).mouseover(o),
                        q = function() {
                            var i = {
                                position: "absolute",
                                top: 0,
                                left: 0
                            };
                            n.css(i);
                            p.css(i);
                            l.css(i);
                            n.width(d.container.width()).height(d.container.height() - d.controls.height());
                            i = g.offset().left - d.container.offset().left;
                            fullScreenBtnWidth = g.outerWidth(true);
                            p.width(i).height(d.controls.height()).css({
                                top: d.container.height() - d.controls.height()
                                });
                            l.width(d.container.width() - i - fullScreenBtnWidth).height(d.controls.height()).css({
                                top: d.container.height() - d.controls.height(),
                                left: i + fullScreenBtnWidth
                            })
                            };
                        f(document).resize(function() {
                            q()
                            });
                        g.mouseover(function() {
                            if (!d.isFullScreen) {
                                var i = g.offset(),
                                j = a.container.offset();
                                e.positionFullscreenButton(i.left - j.left, i.top - j.top, false);
                                g.css("pointer-events", "none");
                                d.controls.css("pointer-events", "none");
                                n.show();
                                l.show();
                                p.show();
                                q();
                                h = true
                            }
                        });
                        e.addEventListener("fullscreenchange", function() {
                            o()
                            })
                        } else
                        g.mouseover(function() {
                        if (k !== null) {
                            clearTimeout(k);
                            delete k
                        }
                        var i = g.offset(),
                        j = a.container.offset();
                        e.positionFullscreenButton(i.left - j.left, i.top - j.top, true)
                        }).mouseout(function() {
                        if (k !== null) {
                            clearTimeout(k);
                            delete k
                        }
                        k = setTimeout(function() {
                            e.hideFullscreenButton()
                            }, 1500)
                        })
                    }
                a.fullscreenBtn = g;
                f(document).bind("keydown", function(i) {
                    if ((mejs.MediaFeatures.hasTrueNativeFullScreen && mejs.MediaFeatures.isFullScreen() || d.isFullScreen) && i.keyCode == 27)
                        a.exitFullScreen()
                    })
                }
        },
        enterFullScreen: function() {
            var a = this;
            if (! (a.media.pluginType !== "native" && (mejs.MediaFeatures.isFirefox || a.options.usePluginFullScreen))) {
                docStyleOverflow = document.documentElement.style.overflow;
                document.documentElement.style.overflow = "hidden";
                normalHeight = a.container.height();
                normalWidth = a.container.width();
                if (a.media.pluginType === "native")
                    if (mejs.MediaFeatures.hasTrueNativeFullScreen) {
                    mejs.MediaFeatures.requestFullScreen(a.container[0]);
                    a.isInIframe && setTimeout(function c() {
                        if (a.isNativeFullScreen)
                            f(window).width() !== screen.width ? a.exitFullScreen() : setTimeout(c, 500)
                        }, 500)
                    } else if (mejs.MediaFeatures.hasSemiNativeFullScreen) {
                    a.media.webkitEnterFullscreen();
                    return
                }
                if (a.isInIframe) {
                    var b = a.options.newWindowCallback(this);
                    if (b !== "")
                        if (mejs.MediaFeatures.hasTrueNativeFullScreen)
                        setTimeout(function() {
                        if (!a.isNativeFullScreen) {
                            a.pause();
                            window.open(b, a.id, "top=0,left=0,width=" + screen.availWidth + ",height=" + screen.availHeight + ",resizable=yes,scrollbars=no,status=no,toolbar=no")
                            }
                    }, 250);
                    else {
                        a.pause();
                        window.open(b, a.id, "top=0,left=0,width=" + screen.availWidth + ",height=" + screen.availHeight + ",resizable=yes,scrollbars=no,status=no,toolbar=no");
                        return
                    }
                }
                a.container.addClass("mejs-container-fullscreen").width("100%").height("100%");
                setTimeout(function() {
                    a.container.css({
                        width: "100%",
                        height: "100%"
                    });
                    a.setControlsSize()
                    }, 500);
                if (a.pluginType === "native")
                    a.$media.width("100%").height("100%");
                else {
                    a.container.find("object, embed, iframe").width("100%").height("100%");
                    a.media.setVideoSize(f(window).width(), f(window).height())
                    }
                a.layers.children("div").width("100%").height("100%");
                a.fullscreenBtn && a.fullscreenBtn.removeClass("mejs-fullscreen").addClass("mejs-unfullscreen");
                a.setControlsSize();
                a.isFullScreen = true
            }
        },
        exitFullScreen: function() {
            if (this.media.pluginType !== "native" && mejs.MediaFeatures.isFirefox)
                this.media.setFullscreen(false);
            else {
                if (mejs.MediaFeatures.hasTrueNativeFullScreen && (mejs.MediaFeatures.isFullScreen() || this.isFullScreen))
                    mejs.MediaFeatures.cancelFullScreen();
                document.documentElement.style.overflow = docStyleOverflow;
                this.container.removeClass("mejs-container-fullscreen").width(normalWidth).height(normalHeight);
                if (this.pluginType === "native")
                    this.$media.width(normalWidth).height(normalHeight);
                else {
                    this.container.find("object embed").width(normalWidth).height(normalHeight);
                    this.media.setVideoSize(normalWidth, normalHeight)
                    }
                this.layers.children("div").width(normalWidth).height(normalHeight);
                this.fullscreenBtn.removeClass("mejs-unfullscreen").addClass("mejs-fullscreen");
                this.setControlsSize();
                this.isFullScreen = false
            }
        }
    })
    })(mejs.$); (function(f) {
    f.extend(mejs.MepDefaults, {
        startLanguage: "",
        tracksText: "Captions/Subtitles"
    });
    f.extend(MediaElementPlayer.prototype, {
        hasChapters: false,
        buildtracks: function(a, b, c, e) {
            if (a.isVideo)
                if (a.tracks.length != 0) {
                var d;
                a.chapters = f('<div class="mejs-chapters mejs-layer"></div>').prependTo(c).hide();
                a.captions = f('<div class="mejs-captions-layer mejs-layer"><div class="mejs-captions-position"><span class="mejs-captions-text"></span></div></div>').prependTo(c).hide();
                a.captionsText = a.captions.find(".mejs-captions-text");
                a.captionsButton = f('<div class="mejs-button mejs-captions-button"><button type="button" aria-controls="' + this.id + '" title="' + this.options.tracksText + '"></button><div class="mejs-captions-selector"><ul><li><input type="radio" name="' + a.id + '_captions" id="' + a.id + '_captions_none" value="none" checked="checked" /><label for="' + a.id + '_captions_none">None</label></li></ul></div></div>').appendTo(b).hover(function() {
                    f(this).find(".mejs-captions-selector").css("visibility", "visible")
                    }, function() {
                    f(this).find(".mejs-captions-selector").css("visibility", "hidden")
                    }).delegate("input[type=radio]", "click", function() {
                    lang = this.value;
                    if (lang == "none")
                        a.selectedTrack = null;
                    else
                        for (d = 0; d < a.tracks.length; d++)
                        if (a.tracks[d].srclang == lang) {
                        a.selectedTrack = a.tracks[d];
                        a.captions.attr("lang", a.selectedTrack.srclang);
                        a.displayCaptions();
                        break
                    }
                });
                a.options.alwaysShowControls ? a.container.find(".mejs-captions-position").addClass("mejs-captions-position-hover") : a.container.bind("mouseenter", function() {
                    a.container.find(".mejs-captions-position").addClass("mejs-captions-position-hover")
                    }).bind("mouseleave", function() {
                    e.paused || a.container.find(".mejs-captions-position").removeClass("mejs-captions-position-hover")
                    });
                a.trackToLoad = -1;
                a.selectedTrack = null;
                a.isLoadingTrack = false;
                for (d = 0; d < a.tracks.length; d++)
                    a.tracks[d].kind == "subtitles" && a.addTrackButton(a.tracks[d].srclang, a.tracks[d].label);
                a.loadNextTrack();
                e.addEventListener("timeupdate", function() {
                    a.displayCaptions()
                    }, false);
                e.addEventListener("loadedmetadata", function() {
                    a.displayChapters()
                    }, false);
                a.container.hover(function() {
                    if (a.hasChapters) {
                        a.chapters.css("visibility", "visible");
                        a.chapters.fadeIn(200).height(a.chapters.find(".mejs-chapter").outerHeight())
                        }
                }, function() {
                    a.hasChapters && !e.paused && a.chapters.fadeOut(200, function() {
                        f(this).css("visibility", "hidden");
                        f(this).css("display", "block")
                        })
                    });
                a.node.getAttribute("autoplay") !== null && a.chapters.css("visibility", "hidden")
                }
        },
        loadNextTrack: function() {
            this.trackToLoad++;
            if (this.trackToLoad < this.tracks.length) {
                this.isLoadingTrack = true;
                this.loadTrack(this.trackToLoad)
                } else
                this.isLoadingTrack = false
        },
        loadTrack: function(a) {
            var b = this,
            c = b.tracks[a];
            f.ajax({
                url: c.src,
                dataType: "text",
                success: function(e) {
                    c.entries = typeof e == "string" && /<tt\s+xml/ig.exec(e) ? mejs.TrackFormatParser.dfxp.parse(e) : mejs.TrackFormatParser.webvvt.parse(e);
                    c.isLoaded = true;
                    b.enableTrackButton(c.srclang, c.label);
                    b.loadNextTrack();
                    c.kind == "chapters" && b.media.duration > 0 && b.drawChapters(c)
                    },
                error: function() {
                    b.loadNextTrack()
                    }
            })
            },
        enableTrackButton: function(a, b) {
            if (b === "")
                b = mejs.language.codes[a] || a;
            this.captionsButton.find("input[value=" + a + "]").prop("disabled", false).siblings("label").html(b);
            this.options.startLanguage == a && f("#" + this.id + "_captions_" + a).click();
            this.adjustLanguageBox()
            },
        addTrackButton: function(a, b) {
            if (b === "")
                b = mejs.language.codes[a] || a;
            this.captionsButton.find("ul").append(f('<li><input type="radio" name="' + this.id + '_captions" id="' + this.id + "_captions_" + a + '" value="' + a + '" disabled="disabled" /><label for="' + this.id + "_captions_" + a + '">' + b + " (loading)</label></li>"));
            this.adjustLanguageBox();
            this.container.find(".mejs-captions-translations option[value=" + a + "]").remove()
            },
        adjustLanguageBox: function() {
            this.captionsButton.find(".mejs-captions-selector").height(this.captionsButton.find(".mejs-captions-selector ul").outerHeight(true) + this.captionsButton.find(".mejs-captions-translations").outerHeight(true))
            },
        displayCaptions: function() {
            if (typeof this.tracks != "undefined") {
                var a,
                b = this.selectedTrack;
                if (b != null && b.isLoaded)
                    for (a = 0; a < b.entries.times.length; a++)
                    if (this.media.currentTime >= b.entries.times[a].start && this.media.currentTime <= b.entries.times[a].stop) {
                    this.captionsText.html(b.entries.text[a]);
                    this.captions.show().height(0);
                    return
                }
                this.captions.hide()
                }
        },
        displayChapters: function() {
            var a;
            for (a = 0; a < this.tracks.length; a++)
                if (this.tracks[a].kind == "chapters" && this.tracks[a].isLoaded) {
                this.drawChapters(this.tracks[a]);
                this.hasChapters = true;
                break
            }
        },
        drawChapters: function(a) {
            var b = this,
            c,
            e,
            d = e = 0;
            b.chapters.empty();
            for (c = 0; c < a.entries.times.length; c++) {
                e = a.entries.times[c].stop - a.entries.times[c].start;
                e = Math.floor(e / b.media.duration * 100);
                if (e + d > 100 || c == a.entries.times.length - 1 && e + d < 100)
                    e = 100 - d;
                b.chapters.append(f('<div class="mejs-chapter" rel="' + a.entries.times[c].start + '" style="left: ' + d.toString() + "%;width: " + e.toString() + '%;"><div class="mejs-chapter-block' + (c == a.entries.times.length - 1 ? " mejs-chapter-block-last": "") + '"><span class="ch-title">' + a.entries.text[c] + '</span><span class="ch-time">' + mejs.Utility.secondsToTimeCode(a.entries.times[c].start) + "&ndash;" + mejs.Utility.secondsToTimeCode(a.entries.times[c].stop) + "</span></div></div>"));
                d += e
            }
            b.chapters.find("div.mejs-chapter").click(function() {
                b.media.setCurrentTime(parseFloat(f(this).attr("rel")));
                b.media.paused && b.media.play()
                });
            b.chapters.show()
            }
    });
    mejs.language = {
        codes: {
            af: "Afrikaans",
            sq: "Albanian",
            ar: "Arabic",
            be: "Belarusian",
            bg: "Bulgarian",
            ca: "Catalan",
            zh: "Chinese",
            "zh-cn": "Chinese Simplified",
            "zh-tw": "Chinese Traditional",
            hr: "Croatian",
            cs: "Czech",
            da: "Danish",
            nl: "Dutch",
            en: "English",
            et: "Estonian",
            tl: "Filipino",
            fi: "Finnish",
            fr: "French",
            gl: "Galician",
            de: "German",
            el: "Greek",
            ht: "Haitian Creole",
            iw: "Hebrew",
            hi: "Hindi",
            hu: "Hungarian",
            is: "Icelandic",
            id: "Indonesian",
            ga: "Irish",
            it: "Italian",
            ja: "Japanese",
            ko: "Korean",
            lv: "Latvian",
            lt: "Lithuanian",
            mk: "Macedonian",
            ms: "Malay",
            mt: "Maltese",
            no: "Norwegian",
            fa: "Persian",
            pl: "Polish",
            pt: "Portuguese",
            ro: "Romanian",
            ru: "Russian",
            sr: "Serbian",
            sk: "Slovak",
            sl: "Slovenian",
            es: "Spanish",
            sw: "Swahili",
            sv: "Swedish",
            tl: "Tagalog",
            th: "Thai",
            tr: "Turkish",
            uk: "Ukrainian",
            vi: "Vietnamese",
            cy: "Welsh",
            yi: "Yiddish"
        }
    };
    mejs.TrackFormatParser = {
        webvvt: {
            pattern_identifier: /^([a-zA-z]+-)?[0-9]+$/,
            pattern_timecode: /^([0-9]{2}:[0-9]{2}:[0-9]{2}([,.][0-9]{1,3})?) --\> ([0-9]{2}:[0-9]{2}:[0-9]{2}([,.][0-9]{3})?)(.*)$/,
            parse: function(a) {
                var b = 0;
                a = mejs.TrackFormatParser.split2(a, /\r?\n/);
                for (var c = {
                    text: [],
                    times: []
                    }, e, d; b < a.length; b++)
                    if (this.pattern_identifier.exec(a[b])) {
                    b++;
                    if ((e = this.pattern_timecode.exec(a[b])) && b < a.length) {
                        b++;
                        d = a[b];
                        for (b++; a[b] !== "" && b < a.length;) {
                            d = d + "\n" + a[b];
                            b++
                        }
                        d = f.trim(d).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig, "<a href='$1' target='_blank'>$1</a>");
                        c.text.push(d);
                        c.times.push({
                            start: mejs.Utility.convertSMPTEtoSeconds(e[1]) == 0 ? 0.2: mejs.Utility.convertSMPTEtoSeconds(e[1]),
                            stop: mejs.Utility.convertSMPTEtoSeconds(e[3]),
                            settings: e[5]
                            })
                        }
                }
                return c
            }
        },
        dfxp: {
            parse: function(a) {
                a = f(a).filter("tt");
                var b = 0;
                b = a.children("div").eq(0);
                var c = b.find("p");
                b = a.find("#" + b.attr("style"));
                var e,
                d;
                a = {
                    text: [],
                    times: []
                    };
                if (b.length) {
                    d = b.removeAttr("id").get(0).attributes;
                    if (d.length) {
                        e = {};
                        for (b = 0; b < d.length; b++)
                            e[d[b].name.split(":")[1]] = d[b].value
                    }
                }
                for (b = 0; b < c.length; b++) {
                    var g;
                    d = {
                        start: null,
                        stop: null,
                        style: null
                    };
                    if (c.eq(b).attr("begin"))
                        d.start = mejs.Utility.convertSMPTEtoSeconds(c.eq(b).attr("begin"));
                    if (!d.start && c.eq(b - 1).attr("end"))
                        d.start = mejs.Utility.convertSMPTEtoSeconds(c.eq(b - 1).attr("end"));
                    if (c.eq(b).attr("end"))
                        d.stop = mejs.Utility.convertSMPTEtoSeconds(c.eq(b).attr("end"));
                    if (!d.stop && c.eq(b + 1).attr("begin"))
                        d.stop = mejs.Utility.convertSMPTEtoSeconds(c.eq(b + 1).attr("begin"));
                    if (e) {
                        g = "";
                        for (var k in e)
                            g += k + ":" + e[k] + ";"
                    }
                    if (g)
                        d.style = g;
                    if (d.start == 0)
                        d.start = 0.2;
                    a.times.push(d);
                    d = f.trim(c.eq(b).html()).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig, "<a href='$1' target='_blank'>$1</a>");
                    a.text.push(d);
                    if (a.times.start == 0)
                        a.times.start = 2
                }
                return a
            }
        },
        split2: function(a, b) {
            return a.split(b)
            }
    };
    if ("x\n\ny".split(/\n/gi).length != 3)
        mejs.TrackFormatParser.split2 = function(a, b) {
        var c = [],
        e = "",
        d;
        for (d = 0; d < a.length; d++) {
            e += a.substring(d, d + 1);
            if (b.test(e)) {
                c.push(e.replace(b, ""));
                e = ""
            }
        }
        c.push(e);
        return c
    }
})(mejs.$); (function(f) {
    f.extend(mejs.MepDefaults, {
        contextMenuItems: [{
            render: function(a) {
                if (typeof a.enterFullScreen == "undefined")
                    return null;
                return a.isFullScreen ? "Turn off Fullscreen": "Go Fullscreen"
            },
            click: function(a) {
                a.isFullScreen ? a.exitFullScreen() : a.enterFullScreen()
                }
        }, {
            render: function(a) {
                return a.media.muted ? "Unmute": "Mute"
            },
            click: function(a) {
                a.media.muted ? a.setMuted(false) : a.setMuted(true)
                }
        }, {
            isSeparator: true
        }, {
            render: function() {
                return "Download Video"
            },
            click: function(a) {
                window.location.href = a.media.currentSrc
            }
        }]
        });
    f.extend(MediaElementPlayer.prototype, {
        buildcontextmenu: function(a) {
            a.contextMenu = f('<div class="mejs-contextmenu"></div>').appendTo(f("body")).hide();
            a.container.bind("contextmenu", function(b) {
                if (a.isContextMenuEnabled) {
                    b.preventDefault();
                    a.renderContextMenu(b.clientX - 1, b.clientY - 1);
                    return false
                }
            });
            a.container.bind("click", function() {
                a.contextMenu.hide()
                });
            a.contextMenu.bind("mouseleave", function() {
                a.startContextMenuTimer()
                })
            },
        isContextMenuEnabled: true,
        enableContextMenu: function() {
            this.isContextMenuEnabled = true
        },
        disableContextMenu: function() {
            this.isContextMenuEnabled = false
        },
        contextMenuTimeout: null,
        startContextMenuTimer: function() {
            var a = this;
            a.killContextMenuTimer();
            a.contextMenuTimer = setTimeout(function() {
                a.hideContextMenu();
                a.killContextMenuTimer()
                }, 750)
            },
        killContextMenuTimer: function() {
            var a = this.contextMenuTimer;
            if (a != null) {
                clearTimeout(a);
                delete a
            }
        },
        hideContextMenu: function() {
            this.contextMenu.hide()
            },
        renderContextMenu: function(a, b) {
            for (var c = this, e = "", d = c.options.contextMenuItems, g = 0, k = d.length; g < k; g++)
                if (d[g].isSeparator)
                e += '<div class="mejs-contextmenu-separator"></div>';
            else {
                var h = d[g].render(c);
                if (h != null)
                    e += '<div class="mejs-contextmenu-item" data-itemindex="' + g + '" id="element-' + Math.random() * 1E6 + '">' + h + "</div>"
            }
            c.contextMenu.empty().append(f(e)).css({
                top: b,
                left: a
            }).show();
            c.contextMenu.find(".mejs-contextmenu-item").each(function() {
                var o = f(this),
                n = parseInt(o.data("itemindex"), 10),
                p = c.options.contextMenuItems[n];
                typeof p.show != "undefined" && p.show(o, c);
                o.click(function() {
                    typeof p.click != "undefined" && p.click(c);
                    c.contextMenu.hide()
                    })
                });
            setTimeout(function() {
                c.killControlsTimer("rev3")
                }, 100)
            }
    })
    })(mejs.$);
;(function($){var SCROLL_ITEM=5;var CONTAINER_HEIGHT=205;var mp3ContainerList;function mejsPlayNext(currentPlayer,audio){var current_item='';var audio_src='';var mp3Container=$(audio).closest('.mp3music_container');var currentIndex=mp3Container.find('li').index(mp3Container.find('li.current'));if(mp3Container.find('li.current').length>0){current_item=mp3Container.find('li.current span.link');audio_src=nextSong(current_item,mp3Container).find(".link").text();}
else{current_item=mp3Container.find('.song-list li:first .link');audio_src=newPlay(current_item);}
if($(current_item.parent()).is(':last-child')){if(mp3Container.find('.mejs-loop-on').size()>0){var ul=$('.song-list');var li=ul.find('li').size();var song_title='';if(li==1){audio_src=current_item.text();if(mp3Container.find('#song-title-head').size()>0){song_title=current_item.parent().find(".song-title").text();}}
else{current_item=mp3Container.find('.song-list li:first span.link');mp3Container.find('.song-list .current').removeClass("current");mp3Container.find('.song-list li:first').addClass("current");audio_src=current_item.text();if(mp3Container.find('#song-title-head').size()>0){song_title=current_item.parent().find(".song-title").text()}}
if($('#song-title-head').size()>0){mp3Container.find('#song-title-head').text(song_title);}
currentPlayer.pause();currentPlayer.setSrc(audio_src);currentPlayer.load();if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){setTimeout(function(){currentPlayer.play()},2000);}else{currentPlayer.play();}}
else
if(mp3Container.find('.mejs-shuffle-on').size()>0){audio_src=nextSong(current_item,mp3Container).find(".link").text();currentPlayer.pause();currentPlayer.setSrc(audio_src);currentPlayer.load();if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){setTimeout(function(){currentPlayer.play()},2000);}else{currentPlayer.play();}}
else{}}
else{currentPlayer.pause();currentPlayer.setSrc(audio_src);currentPlayer.load();if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){setTimeout(function(){currentPlayer.play()},2000);}else{currentPlayer.play();}}
var newIndex=mp3Container.find('li').index(nextSong(current_item,mp3Container));var countSong=mp3Container.find('li').size();var itemHeight=mp3Container.find('li.current').outerHeight();var barPosition=parseInt(mp3Container.find('.slimScrollBar').css('top'));if(newIndex==-1)
{newIndex=0;offsets=0;}
var userScroll=Math.round(mp3Container.find('.song-list').scrollTop());var currentHeight=currentIndex*itemHeight;var offset=newIndex-currentIndex;var offsets=currentHeight-userScroll;if((newIndex>(countSong-SCROLL_ITEM))&&(currentIndex<(countSong-SCROLL_ITEM))){offset=countSong-SCROLL_ITEM-currentIndex;}
if((newIndex>(countSong-SCROLL_ITEM))&&(currentIndex>=(countSong-SCROLL_ITEM))){offset=0;offsets=0;}
if((newIndex<(countSong-SCROLL_ITEM))&&(currentIndex>(countSong-SCROLL_ITEM))){offset=newIndex-(countSong-SCROLL_ITEM);}
if((newIndex>(countSong-SCROLL_ITEM))&&(userScroll<((countSong-SCROLL_ITEM)*itemHeight)))
{offsets=(countSong-SCROLL_ITEM)*itemHeight-userScroll;}
mp3Containers=mp3ContainerList.eq((mp3ContainerList.index(mp3Container)));mp3music_scroll(mp3Containers,offset*(itemHeight)+offsets);}
MediaElementPlayer.prototype.buildshuffle=function(player,controls,layers,media){var
shuffle=$('<div class="mejs-button mejs-shuffle-button '+((player.options.shuffle)?'mejs-shuffle-on':'mejs-shuffle-off')+'">'+'<button type="button"></button>'+'</div>').appendTo(controls).click(function(){player.options.shuffle=!player.options.shuffle;if(player.options.shuffle){shuffle.removeClass('mejs-shuffle-off').addClass('mejs-shuffle-on');player.options.loop=false;$('.mejs-loop-button').removeClass('mejs-loop-on').addClass('mejs-loop-off');}
else{shuffle.removeClass('mejs-shuffle-on').addClass('mejs-shuffle-off');}});}
MediaElementPlayer.prototype.buildloop=function(player,controls,layers,media){var
loop=$('<div class="mejs-button mejs-loop-button '+((player.options.loop)?'mejs-loop-on':'mejs-loop-off')+'">'+'<button type="button"></button>'+'</div>').appendTo(controls).click(function(){player.options.loop=!player.options.loop;if(player.options.loop){loop.removeClass('mejs-loop-off').addClass('mejs-loop-on');player.options.shuffle=false;$('.mejs-shuffle-button').removeClass('mejs-shuffle-on').addClass('mejs-shuffle-off');}
else{loop.removeClass('mejs-loop-on').addClass('mejs-loop-off');}});}
MediaElementPlayer.prototype.buildprev=function(player,controls,layers,media){var mp3Container=$(controls).closest('.mp3music_container');var
prev=$('<div class="mejs-button mejs-prev-button '+((player.options.prev)?'mejs-prev-on':'mejs-prev-off')+'">'+'<button type="button"></button>'+'</div>').appendTo(controls).click(function(evt){var prevsong='';var audio_src='';var song_title='';var current_item=$('.song-list').find('li.current');if(mp3Container.find('.mejs-shuffle-on').size()>0){var ul=mp3Container.find('.song-list');var songCount=ul.find('li').size();if(songCount<=1){nextItemGet=0;}
else{while((nextItemGet=getRandomInt(0,songCount-1))==mp3Container.find('li.current').index()){}}
prevsong=mp3Container.find(".song-list li").eq(nextItemGet);mp3Container.find('li.current').removeClass('current');audio_src=prevsong.find(".link").text();if(mp3Container.find('#song-title-head').size()>0){song_title=prevsong.find(".song-title").text();}
prevsong.addClass('current');}
else{prevsong=mp3Container.find('li.current').prev();if(!prevsong.size()){return true;}
mp3Container.find('li.current').removeClass('current');audio_src=prevsong.find(".link").text();if(mp3Container.find('#song-title-head').size()>0){song_title=prevsong.find(".song-title").text()};prevsong.addClass('current');}
player.pause();player.setSrc(audio_src);player.load();if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){setTimeout(function(){player.play()},2000);}else{player.play();}
if(mp3Container.find('#song-title-head').size()>0){mp3Container.find('song-title-head').text(song_title);}});}
MediaElementPlayer.prototype.buildnext=function(player,controls,layers,media){var mp3Container=$(controls).closest('.mp3music_container');var
next=$('<div class="mejs-button mejs-next-button '+((player.options.next)?'mejs-next-on':'mejs-next-off')+'">'+'<button type="button"></button>'+'</div>').appendTo(controls).click(function(evt){var nextsong='';var audio_src='';var song_title='';var current_item=mp3Container.find('.song-list').find('li.current');if(mp3Container.find('.mejs-shuffle-on').size()>0){var ul=mp3Container.find('.song-list');var songCount=ul.find('li').size();if(songCount<=1){nextItemGet=0;}
else{while((nextItemGet=getRandomInt(0,songCount-1))==mp3Container.find('li.current').index()){}}
nextsong=mp3Container.find(".song-list li").eq(nextItemGet);mp3Container.find('li.current').removeClass('current');audio_src=nextsong.find(".link").text();if(mp3Container.find('#song-title-head').size()>0){song_title=nextsong.find(".song-title").text();}
nextsong.addClass('current');}
else if($(current_item).is(':last-child')){nextsong=mp3Container.find('.song-list li:first span.link');audio_src=nextsong.text();if(mp3Container.find('#song-title-head').size()>0){song_title=nextsong.parent().find(".song-title").text();}
mp3Container.find('li.current').removeClass('current');nextsong.parent().addClass('current');}
else{nextsong=mp3Container.find('li.current').next();if(!nextsong.size()){return true;}
mp3Container.find('li.current').removeClass('current');audio_src=nextsong.find(".link").text();if(mp3Container.find('#song-title-head').size()>0){song_title=nextsong.find(".song-title").text();}
nextsong.addClass('current');}
player.pause();player.setSrc(audio_src);player.load()
if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){setTimeout(function(){player.play()},2000);}else{player.play();}
if(mp3Container.find('#song-title-head').size()>0){mp3Container.find('#song-title-head').text(song_title);}});}
MediaElementPlayer.prototype.buildcol=function(player,controls,layers,media){var
col=$('<div class="col-vol">'+'<span></span>'+'</div>').appendTo(controls)}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function getNextSong(current_item){var nextItem='';var ul=$(current_item).closest('ul');var li=ul.find('li').size();var mp3Container=$(current_item).closest('.mp3music_container');if(mp3Container.find('.mejs-shuffle-on').length>0){var nextItemGet=getRandomInt(0,li-1);nextItem=$(".song-list li").eq(nextItemGet);}
else
if(mp3Container.find('.mejs-loop-on').length>0){if(li==1){nextItem=$(current_item);}
if($(current_item).parent().next()){nextItem=$(current_item).parent().next();}
else{nextItem=$(current_item).closest('li');}}
else{nextItem=$(current_item).parent().next();}
return nextItem;}
function nextSong(current_item,mp3Container){var SCROLL_ITEM=5;var nextItem='';var ul=$(mp3Container).find('ul');var songCount=ul.find('li').size();if(mp3Container.find('.mejs-shuffle-on').length>0){var nextItemGet=getRandomInt(0,songCount-1);nextItem=ul.find('li').eq(nextItemGet);}
else
if(mp3Container.find('.mejs-loop-on').length>0){if(songCount==1){nextItem=$(current_item);}
if($(current_item).parent().next()){nextItem=$(current_item).parent().next();}
else{nextItem=$(current_item).closest('li');}}
else{nextItem=$(current_item).parent().next();}
var audio_src=nextItem.find(".link").text();var songTitle=nextItem.find(".song-title").text();if(mp3Container.find('#song-title-head').size()>0&&songTitle!=''){mp3Container.find('#song-title-head').text(songTitle);}
nextItem.addClass('current').siblings().removeClass('current');return nextItem;}
function newPlay(current_item){var nextItem='';nextItem=getNextSong(current_item);var audio_src=nextItem.next().text();$(current_item).next().addClass('current').siblings().removeClass('current');return audio_src;}
function removeFeature(features){for(i=0;i<features.length;i++){if(i==features.indexOf('prev')||i==features.indexOf('next')){features.splice(i,1);}}
return features;}
$(document).ready(function(){mp3ContainerList=$('.mp3music_container');var fullFeature=['prev','playpause','next','progress','duration','shuffle','loop','col','volume'];var feedFeature=['prev','playpause','next','progress','duration','volume'];var profileFeature=['prev','playpause','next','progress'];if($('.yn-music').next().find("li").size()==1){fullFeature=removeFeature(fullFeature);}
$('.yn-music audio').mediaelementplayer({success:function(mediaElement,domObject){mediaElement.addEventListener('ended',function(e){mejsPlayNext(e.target,domObject);},false);mediaElement.addEventListener('loadeddata',function(e){var currentItem=$(domObject).closest('.mp3music_container').find('li.current:last');var mp3musicVote=currentItem.find(".song_vote").text();var isVote=currentItem.find('.isvote').text();changevote(mp3musicVote,isVote);_onItemChanged(currentItem.find('.song_id').text());},false);},flashName:"flashmediaelement.swf",features:fullFeature,keyActions:[],startVolume:0.8,pauseOtherPlayers:true,}).load();$('.mp3music_feed_player').each(function(index){if($(this).parent().find("li").size()==1)
{$(this).find('audio').mediaelementplayer({success:function(mediaElement,domObject)
{mediaElement.addEventListener('ended',function(e)
{mejsPlayNext(e.target,domObject);},false);mediaElement.addEventListener('loadeddata',function(e)
{var currentItem=$(domObject).closest('.mp3music_container').find('li.current');_changePlayCount(currentItem.find('.song_id').text());},false);},flashName:"flashmediaelement.swf",features:['playpause','progress','duration','volume'],keyActions:[],startVolume:0.8,pauseOtherPlayers:true});}
else
{$(this).find('audio').mediaelementplayer({success:function(mediaElement,domObject)
{mediaElement.addEventListener('ended',function(e)
{mejsPlayNext(e.target,domObject);},false);mediaElement.addEventListener('loadeddata',function(e)
{var currentItem=$(domObject).closest('.mp3music_container').find('li.current');_changePlayCount(currentItem.find('.song_id').text());},false);},flashName:"flashmediaelement.swf",features:feedFeature,keyActions:[],startVolume:0.8,pauseOtherPlayers:true});}});if($('.mp3music_share_player').next().find("li").size()==1)
{feedFeature=removeFeature(feedFeature);}
$('.mp3music_share_player audio').mediaelementplayer({success:function(mediaElement,domObject)
{mediaElement.addEventListener('ended',function(e){mejsPlayNext(e.target,domObject);},false);mediaElement.addEventListener('loadeddata',function(e){var current_item=$(domObject).closest('.mp3music_container').find('li.current');_changePlayCount(current_item.find('.song_id').text());},false);},flashName:"flashmediaelement.swf",features:feedFeature,keyActions:[],startVolume:0.8,pauseOtherPlayers:true});if($('.profile-player').next().find("li").size()==1){profileFeature=removeFeature(profileFeature);}
$('.profile-player audio').mediaelementplayer({success:function(mediaElement,domObject)
{mediaElement.addEventListener('ended',function(e){mejsPlayNext(e.target,domObject);},false);mediaElement.addEventListener('loadeddata',function(e){var current_item=$('.song-list li.current:first span.link');_changePlayCount(current_item.parent().find('.song_id').text());},false);},flashName:"flashmediaelement.swf",features:profileFeature,keyActions:[],startVolume:0.8,pauseOtherPlayers:true});$(document).on('click','.mp3music-song-title',function(){var mp3Container=$(this).closest('.mp3music_container');var strSongTitle=$(this).children('.song-title').text();var audio_src=$(this).parent().children(".link").text();$(this).parent().addClass('current').siblings().removeClass('current');mp3Container.find('#song-title-head').html(strSongTitle);var player=mp3Container.find('audio');if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){player[0].pause();player[0].setSrc(audio_src);player[0].load();setTimeout(function(){player[0].play()},2000);}else{player[0].player.pause();player[0].player.setSrc(audio_src);player[0].player.load();player[0].player.play();}});$(document).on('click','.mp3music_expand_thumb',function()
{$(this).parent().css("display","none");$(this).closest('.mp3music_wrapper').find('.younet_mp3music_feed').css({'position':'static','visibility':'visible'});var audio=$(this).closest('.mp3music_wrapper').find('audio');if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){audio[0].load();setTimeout(function(){audio[0].play()},1000);}else{if(typeof audio[0].player=='undefined'){var mp3musicWrapper=$(this).closest('.mp3music_wrapper');if(mp3musicWrapper.find("li").size()==1)
{mp3musicWrapper.find('audio').mediaelementplayer({success:function(mediaElement,domObject)
{console.log("Success");mediaElement.addEventListener('ended',function(e)
{mejsPlayNext(e.target,domObject);},false);mediaElement.addEventListener('loadeddata',function(e)
{console.log("Loaded data");var currentItem=$(domObject).closest('.mp3music_container').find('li.current');_changePlayCount(currentItem.find('.song_id').text());},false);},flashName:"flashmediaelement.swf",features:['playpause','progress','duration','volume'],keyActions:[],autoplay:true,startVolume:0.8,pauseOtherPlayers:true});}
else
{mp3musicWrapper.find('audio').mediaelementplayer({success:function(mediaElement,domObject)
{mediaElement.addEventListener('ended',function(e)
{mejsPlayNext(e.target,domObject);},false);mediaElement.addEventListener('loadeddata',function(e)
{var currentItem=$(domObject).closest('.mp3music_container').find('li.current');_changePlayCount(currentItem.find('.song_id').text());},false);},flashName:"flashmediaelement.swf",features:feedFeature,keyActions:[],startVolume:0.8,pauseOtherPlayers:true});}
audio=$(this).closest('.mp3music_wrapper').find('audio');var audio_src=$(this).closest('.mp3music_wrapper').find(".current .link").text();setTimeout(function(){audio[0].player.pause();audio[0].player.setSrc(audio_src);audio[0].player.load();audio[0].player.play();},1000);}else{audio[0].player.load();audio[0].player.play();}}});$('#mp3music_rating a').hover(function(){if($(this).not('.mp3music_rate_disable').length>=1){cindex=$('#mp3music_rating a').index($(this));++cindex;for(var i=1;i<=cindex;i++){$('#rate_'+i).addClass('mp3music_rate_hover');}}},function(){cindex=$('#mp3music_rating a').index($(this));++cindex;for(var i=1;i<=cindex;i++){$('#rate_'+i).removeClass('mp3music_rate_hover');}});$('.layout_mp3music_profile_music').css({'position':'absolute','visibility':'hidden','display':'block'});mp3music_init_scroll($(mp3ContainerList));$('.layout_mp3music_profile_music').css({'position':'static','visibility':'visible','display':'none'});});function mp3music_scroll(mp3Container,position){var height=SCROLL_ITEM*(mp3Container.find('li.current').outerHeight());height=String(height)+'px';if(mp3Container.find('.song-list li').size()>SCROLL_ITEM){mp3Container.find('.song-list').slimScroll({color:'#222',size:'10px',height:height,alwaysVisible:true,scrollPos:position,});}}
function mp3music_init_scroll(mp3ContainerList){mp3ContainerList.each(function(index){var height=SCROLL_ITEM*($(this).find('li.current').outerHeight());height=String(height)+'px';if($(this).find('.song-list li').size()>SCROLL_ITEM){$(this).find('.song-list').slimScroll({color:'#222',size:'10px',height:height,alwaysVisible:true,scrollPos:0,start:'top',});}});}
function changevote(value,isVote){for(var x=1;x<=parseInt(value);x++){$('#rate_'+x).attr('class','mp3music_rated');}
for(var x=parseInt(value)+1;x<=5;x++){$('#rate_'+x).attr('class','mp3music_unrate');}
var remainder=Math.round(value)-value;if(remainder<=0.5&&remainder!=0){var last=parseInt(value)+1;$('#rate_'+last).attr('class','rating_star_big_generic rating_star_big_half');}
if(isVote!=1){for(x=1;x<=5;x++){$('#rate_'+x).addClass('mp3music_rate_disable');}}}})(jQuery);;(function(){this.SEATips=new Class({Extends:Tips,options:{canHide:true},hide:function(element){if(!this.options.canHide)
return;if(!this.tip)
document.id(this);this.fireEvent('hide',[this.tip,element]);},position:function(event){if(!this.tip)
document.id(this);var size=window.getSize(),scroll=window.getScroll(),tip={x:this.tip.offsetWidth,y:this.tip.offsetHeight},props={x:'left',y:'top'},bounds={y:false,x2:false,y2:false,x:false},obj={};for(var z in props){obj[props[z]]=event.page[z]+this.options.offset[z];if(obj[props[z]]<0)
bounds[z]=true;if((event.page[z]-scroll[z])>size[z]-this.options.windowPadding[z]){var extra=1;if(z=='x')
extra=51;obj[props[z]]=event.page[z]-tip[z]+extra;bounds[z+'2']=true;}}
this.fireEvent('bound',bounds);this.tip.setStyles(obj);}});})();en4.seaocore={setLayoutWidth:function(elementId,width){var layoutColumn=null;if($(elementId).getParent('.layout_left')){layoutColumn=$(elementId).getParent('.layout_left');}else if($(elementId).getParent('.layout_right')){layoutColumn=$(elementId).getParent('.layout_right');}else if($(elementId).getParent('.layout_middle')){layoutColumn=$(elementId).getParent('.layout_middle');}
if(layoutColumn){layoutColumn.setStyle('width',width);}
$(elementId).destroy();}};en4.seaocore.likes={like:function(type,id,show_bottom_post,comment_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/comment/like',data:{format:'json',type:type,id:id,comment_id:0,show_bottom_post:show_bottom_post},onSuccess:function(responseJSON){if($type(responseJSON)=='object'&&$type(responseJSON.status)){if($(type+'_'+id+'like_link'))
$(type+'_'+id+'like_link').style.display="none";if($(type+'_'+id+'unlike_link'))
$(type+'_'+id+'unlike_link').style.display="inline-block";}}}),{'element':$('comments'+'_'+type+'_'+id)});},unlike:function(type,id,show_bottom_post,comment_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/comment/unlike',data:{format:'json',type:type,id:id,comment_id:comment_id,show_bottom_post:show_bottom_post},onSuccess:function(responseJSON){if($type(responseJSON)=='object'&&$type(responseJSON.status)){if($(type+'_'+id+'unlike_link'))
$(type+'_'+id+'unlike_link').style.display="none";if($(type+'_'+id+'like_link'))
$(type+'_'+id+'like_link').style.display="inline-block";}}}),{'element':$('comments'+'_'+type+'_'+id)});}};en4.seaocore.comments={loadComments:function(type,id,page,show_bottom_post){en4.core.request.send(new Request.HTML({url:en4.core.baseUrl+'seaocore/comment/list',data:{format:'html',type:type,id:id,page:page,show_bottom_post:show_bottom_post}}),{'element':$('comments'+'_'+type+'_'+id),"force":true});},attachCreateComment:function(formElement,type,id,show_bottom_post){var bind=this;if(show_bottom_post==1){formElement.addEvent((Browser.Engine.trident||Browser.Engine.webkit)?'keydown':'keypress',function(event){if(event.shift&&event.key=='enter'){}else if(event.key=='enter'){event.stop();var form_values=formElement.toQueryString();form_values+='&format=json';form_values+='&id='+formElement.identity.value;form_values+='&show_bottom_post='+show_bottom_post;formElement.style.display="none";if($("comment-form-loading-li_"+type+'_'+id))
$("comment-form-loading-li_"+type+'_'+id).style.display="block";en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/comment/create',data:form_values,type:type,id:id,show_bottom_post:show_bottom_post}),{'element':$('comments'+'_'+type+'_'+id),"force":true});}});formElement.body.addEvent('blur',function(){formElement.style.display="none";if($("comment-form-open-li_"+type+'_'+id))
$("comment-form-open-li_"+type+'_'+id).style.display="block";});}
formElement.addEvent('submit',function(event){event.stop();var form_values=formElement.toQueryString();form_values+='&format=json';form_values+='&id='+formElement.identity.value;form_values+='&show_bottom_post='+show_bottom_post;en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/comment/create',data:form_values,type:type,id:id,show_bottom_post:show_bottom_post}),{'element':$('comments'+'_'+type+'_'+id),"force":true});})},comment:function(type,id,body,show_bottom_post){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/comment/create',data:{format:'json',type:type,id:id,body:body,show_bottom_post:show_bottom_post}}),{'element':$('comments'+'_'+type+'_'+id),"force":true});},like:function(type,id,show_bottom_post,comment_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/comment/like',data:{format:'json',type:type,id:id,comment_id:comment_id,show_bottom_post:show_bottom_post},onSuccess:function(responseJSON){if($type(responseJSON)=='object'&&$type(responseJSON.status)){if($(type+'_'+id+'like_link'))
$(type+'_'+id+'like_link').style.display="none";if($(type+'_'+id+'unlike_link'))
$(type+'_'+id+'unlike_link').style.display="inline-block";}}}),{'element':$('comments'+'_'+type+'_'+id),"force":true});},unlike:function(type,id,show_bottom_post,comment_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/comment/unlike',data:{format:'json',type:type,id:id,comment_id:comment_id,show_bottom_post:show_bottom_post},onSuccess:function(responseJSON){if($type(responseJSON)=='object'&&$type(responseJSON.status)){if($(type+'_'+id+'unlike_link'))
$(type+'_'+id+'unlike_link').style.display="none";if($(type+'_'+id+'like_link'))
$(type+'_'+id+'like_link').style.display="inline-block";}}}),{'element':$('comments'+'_'+type+'_'+id),"force":true});},showLikes:function(type,id,show_bottom_post){en4.core.request.send(new Request.HTML({url:en4.core.baseUrl+'seaocore/comment/list',data:{format:'html',type:type,id:id,viewAllLikes:true,show_bottom_post:show_bottom_post}}),{'element':$('comments'+'_'+type+'_'+id),"force":true});},deleteComment:function(type,id,comment_id){if(!confirm(en4.core.language.translate('Are you sure you want to delete this?'))){return;}
(new Request.JSON({url:en4.core.baseUrl+'seaocore/comment/delete',data:{format:'json',type:type,id:id,comment_id:comment_id},onComplete:function(){if($('comment-'+comment_id)){$('comment-'+comment_id).destroy();}
try{var commentCount=$$('.comments_options span')[0];var m=commentCount.get('html').match(/\d+/);var newCount=(parseInt(m[0])!='NaN'&&parseInt(m[0])>1?parseInt(m[0])-1:0);commentCount.set('html',commentCount.get('html').replace(m[0],newCount));}catch(e){}}})).send();}};en4.seaocore.facebook={runFacebookSdk:function(){window.fbAsyncInit=function(){FB.JSON.stringify=function(value){return JSON.encode(value);};FB.init({appId:fbappid,status:true,cookie:true,xfbml:true});if(window.setFBContent){setFBContent();}};(function(){var catarea=$('global_footer');if(catarea==null){catarea=$('global_content');}
if(catarea!=null&&(typeof $('fb-root')=='undefined'||$('fb-root')==null)){var newdiv=document.createElement('div');newdiv.id='fb-root';newdiv.inject(catarea,'after');var e=document.createElement('script');e.async=true;if(typeof local_language!='undefined'&&$type(local_language)){e.src=document.location.protocol+'//connect.facebook.net/'+local_language+'/all.js';}
else{e.src=document.location.protocol+'//connect.facebook.net/en_US/all.js';}
document.getElementById('fb-root').appendChild(e);}}());}};en4.seaocore.advlightbox={createDefaultContent:function(){}}
en4.core.runonce.add(function(){var defaultlocationHref=window.location.href;var n=defaultlocationHref.indexOf('#');defaultlocationHref=defaultlocationHref.substring(0,n!=-1?n:defaultlocationHref.length);window.addEventListener("popstate",function(e){var url=window.location.href;var n=url.indexOf('#');url=url.substring(0,n!=-1?n:url.length);if(e&&e.state&&url!=defaultlocationHref){window.location.reload(true);}});});function addfriend(el,user_id){en4.core.request.send(new Request.HTML({method:'post','url':en4.core.baseUrl+'seaocore/feed/addfriendrequest','data':{format:'html','resource_id':user_id},onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){var parent=el.getParent('div');var nextSibling=el.nextSibling;el.destroy();parent.insertBefore(new Element('span',{'html':responseHTML}),nextSibling);}}),{'force':true});}
en4.seaocore.nestedcomments={loadComments:function(type,id,page,order,parent_comment_id){if($('view_more_comments_'+parent_comment_id)){$('view_more_comments_'+parent_comment_id).style.display='inline-block';$('view_more_comments_'+parent_comment_id).innerHTML='<img src="application/modules/Core/externals/images/loading.gif" alt="Loading" />';}
if($('view_previous_comments_'+parent_comment_id)){$('view_previous_comments_'+parent_comment_id).style.display='inline-block';$('view_previous_comments_'+parent_comment_id).innerHTML='<img src="application/modules/Core/externals/images/loading.gif" alt="Loading" />';}
if($('view_later_comments_'+parent_comment_id)){$('view_later_comments_'+parent_comment_id).style.display='inline-block';$('view_later_comments_'+parent_comment_id).innerHTML='<img src="application/modules/Core/externals/images/loading.gif" alt="Loading" />';}
en4.core.request.send(new Request.HTML({url:en4.core.baseUrl+'seaocore/nestedcomment/list',data:{format:'html',type:type,id:id,page:page,order:order,parent_div:1,parent_comment_id:parent_comment_id}}),{'element':$('comments'+'_'+type+'_'+id+'_'+parent_comment_id)});},loadcommentssortby:function(type,id,order,parent_comment_id){if($('sort'+'_'+type+'_'+id+'_'+parent_comment_id)){$('sort'+'_'+type+'_'+id+'_'+parent_comment_id).style.display='inline-block';$('sort'+'_'+type+'_'+id+'_'+parent_comment_id).innerHTML='<img src="application/modules/Core/externals/images/loading.gif" alt="Loading" />';}
en4.core.request.send(new Request.HTML({url:en4.core.baseUrl+'seaocore/nestedcomment/list',data:{format:'html',type:type,id:id,order:order,parent_div:1,parent_comment_id:parent_comment_id}}),{'element':$('comments'+'_'+type+'_'+id+'_'+parent_comment_id)});},attachCreateComment:function(formElement,type,id,parent_comment_id){var bind=this;formElement.addEvent('submit',function(event){event.stop();if(formElement.body.value=='')
return;if($('seaocore_comment_image_'+type+'_'+id+'_'+parent_comment_id))
$('seaocore_comment_image_'+type+'_'+id+'_'+parent_comment_id).destroy();var divEl=new Element('div',{'class':'','html':'<img src="application/modules/Core/externals/images/loading.gif" alt="Loading">','id':'seaocore_comment_image_'+type+'_'+id+'_'+parent_comment_id,'styles':{'display':'inline-block'}});divEl.inject(formElement);var form_values=formElement.toQueryString();form_values+='&format=json';form_values+='&id='+formElement.identity.value;en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/nestedcomment/create',data:form_values,type:type,id:id,onComplete:function(e){if(parent_comment_id==0)
return;try{var replyCount=$$('.seaocore_replies_options span')[0];var m=replyCount.get('html').match(/\d+/);replyCount.set('html',replyCount.get('html').replace(m[0],e.commentsCount));}catch(e){}}}),{'element':$('comments'+'_'+type+'_'+id+'_'+parent_comment_id)});})},comment:function(type,id,body,parent_comment_id){if(body=='')
return;var formElement=$('comments_form_'+type+'_'+id+'_'+parent_comment_id);if($('seaocore_comment_image_'+type+'_'+id+'_'+parent_comment_id))
$('seaocore_comment_image_'+type+'_'+id+'_'+parent_comment_id)
var divEl=new Element('div',{'class':'','html':'<img src="application/modules/Seaocore/externals/images/spinner.gif">','id':'seaocore_comment_image_'+type+'_'+id+'_'+parent_comment_id,'styles':{'display':'inline-block'}});divEl.inject(formElement);en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/nestedcomment/create',data:{format:'json',type:type,id:id,body:body},onComplete:function(e){if(parent_comment_id==0)
return;try{var replyCount=$$('.seaocore_replies_options span')[0];var m=replyCount.get('html').match(/\d+/);replyCount.set('html',replyCount.get('html').replace(m[0],e.commentsCount));}catch(e){}}}),{'element':$('comments'+'_'+type+'_'+id+'_'+parent_comment_id)});},like:function(type,id,comment_id,order,parent_comment_id,option){if($('like_comments_'+comment_id)&&(option=='child')){$('like_comments_'+comment_id).style.display='inline-block';$('like_comments_'+comment_id).innerHTML='<img src="application/modules/Core/externals/images/loading.gif" alt="Loading" />';}
if($('like_comments')&&(option=='parent')){$('like_comments').style.display='inline-block';$('like_comments').innerHTML='<img src="application/modules/Core/externals/images/loading.gif" alt="Loading" />';}
en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/nestedcomment/like',data:{format:'json',type:type,id:id,comment_id:comment_id,order:order,parent_comment_id:parent_comment_id},onComplete:function(e){if($('sitereview_most_likes_'+id)){$('sitereview_most_likes_'+id).style.display='none';}
if($('sitereview_unlikes_'+id)){$('sitereview_unlikes_'+id).style.display='block';}
if($(type+'_like_'+id))
$(type+'_like_'+id).value=1;if($(type+'_most_likes_'+id))
$(type+'_most_likes_'+id).style.display='none';if($(type+'_unlikes_'+id))
$(type+'_unlikes_'+id).style.display='inline-block';}}),{'element':$('comments'+'_'+type+'_'+id+'_'+parent_comment_id)});},unlike:function(type,id,comment_id,order,parent_comment_id,option){if($('unlike_comments_'+comment_id)&&(option=='child')){$('unlike_comments_'+comment_id).style.display='inline-block';$('unlike_comments_'+comment_id).innerHTML='<img src="application/modules/Core/externals/images/loading.gif" alt="Loading" />';}
if($('unlike_comments')&&(option=='parent')){$('unlike_comments').style.display='inline-block';$('unlike_comments').innerHTML='<img src="application/modules/Core/externals/images/loading.gif" alt="Loading" />';}
en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/nestedcomment/unlike',data:{format:'json',type:type,id:id,comment_id:comment_id,order:order,parent_comment_id:parent_comment_id},onComplete:function(e){if($('sitereview_most_likes_'+id)){$('sitereview_most_likes_'+id).style.display='block';}
if($('sitereview_unlikes_'+id)){$('sitereview_unlikes_'+id).style.display='none';}
if($(type+'_like_'+id))
$(type+'_like_'+id).value=0;if($(type+'_most_likes_'+id))
$(type+'_most_likes_'+id).style.display='inline-block';if($(type+'_unlikes_'+id))
$(type+'_unlikes_'+id).style.display='none';}}),{'element':$('comments'+'_'+type+'_'+id+'_'+parent_comment_id)});},showLikes:function(type,id,order,parent_comment_id){en4.core.request.send(new Request.HTML({url:en4.core.baseUrl+'seaocore/nestedcomment/list',data:{format:'html',type:type,id:id,viewAllLikes:true,order:order,parent_comment_id:parent_comment_id}}),{'element':$('comments'+'_'+type+'_'+id+'_'+parent_comment_id)});},deleteComment:function(type,id,comment_id,order,parent_comment_id){if(!confirm(en4.core.language.translate('Are you sure you want to delete this?'))){return;}
if($('comment-'+comment_id)){$('comment-'+comment_id).destroy();}
(new Request.JSON({url:en4.core.baseUrl+'seaocore/nestedcomment/delete',data:{format:'json',type:type,id:id,comment_id:comment_id,order:order,parent_comment_id:parent_comment_id},onComplete:function(e){try{var replyCount=$$('.seaocore_replies_options span')[0];var m=replyCount.get('html').match(/\d+/);var newCount=(parseInt(m[0])!='NaN'&&parseInt(m[0])>1?parseInt(m[0])-1:0);replyCount.set('html',replyCount.get('html').replace(m[0],e.commentsCount));}catch(e){}}})).send();}};var ScrollToTopSeao=function(topElementId,buttonId){window.addEvent('scroll',function(){var element=$(buttonId);if(element){if($(topElementId)){var elementPostionY=0;if(typeof($(topElementId).offsetParent)!='undefined'){elementPostionY=$(topElementId).offsetTop;}else{elementPostionY=$(topElementId).y;}}
if(elementPostionY+window.getSize().y<window.getScrollTop()){if(element.hasClass('Offscreen'))
element.removeClass('Offscreen');}else if(!element.hasClass('Offscreen')){element.addClass('Offscreen');}}});en4.core.runonce.add(function(){var scroll=new Fx.Scroll(document.getElement('body').get('id'),{wait:false,duration:750,offset:{'x':-200,'y':-100},transition:Fx.Transitions.Quad.easeInOut});$(buttonId).addEvent('click',function(event){event=new Event(event).stop();scroll.toElement(topElementId);});});};ActivitySEAOUpdateHandler=new Class({Implements:[Events,Options],options:{debug:true,baseUrl:'/',identity:false,delay:5000,admin:false,idleTimeout:600000,last_id:0,next_id:null,subject_guid:null,showImmediately:false},state:true,activestate:1,fresh:true,lastEventTime:false,title:document.title,initialize:function(options){this.setOptions(options);},start:function(){this.state=true;this.idleWatcher=new IdleWatcher(this,{timeout:this.options.idleTimeout});this.idleWatcher.register();this.addEvents({'onStateActive':function(){this._log('activity loop onStateActive');this.activestate=1;this.state=true;}.bind(this),'onStateIdle':function(){this._log('activity loop onStateIdle');this.activestate=0;this.state=false;}.bind(this)});this.loop();},stop:function(){this.state=false;},checkFeedUpdate:function(action_id,subject_guid){if(en4.core.request.isRequestActive())
return;function getAllElementsWithAttribute(attribute){var matchingElements=[];var values=[];var allElements=document.getElementsByTagName('*');for(var i=0;i<allElements.length;i++){if(allElements[i].getAttribute(attribute)){matchingElements.push(allElements[i]);values.push(allElements[i].getAttribute(attribute));}}
return values;}
var list=getAllElementsWithAttribute('data-activity-feed-item');this.options.last_id=Math.max.apply(Math,list);min_id=this.options.last_id+1;var req=new Request.HTML({url:en4.core.baseUrl+'widget/index/name/seaocore.feed',data:{'format':'html','minid':min_id,'feedOnly':true,'nolayout':true,'subject':this.options.subject_guid,'getUpdate':true}});en4.core.request.send(req,{'element':$('activity-feed'),'updateHtmlMode':'prepend'});req.addEvent('complete',function(){(function(){if(this.options.showImmediately&&$('feed-update').getChildren().length>0){$('feed-update').setStyle('display','none');$('feed-update').empty();this.getFeedUpdate(this.options.next_id);}}).delay(50,this);}.bind(this));if(localStorage){var pageTitle=document.title;var feed=document.getElementById('activity-feed');var items=feed.getElementsByTagName("li");var itemObject={};var c=0;for(var i=0;i<items.length;++i){if(items[i].getAttribute('data-activity-feed-item')!=null){var itemId=items[i].getAttribute('data-activity-feed-item');itemObject[c]={id:itemId,content:document.getElementById('activity-item-'+itemId).innerHTML};c++;}}
var activityFeedJSON=JSON.stringify(itemObject);localStorage.setItem(pageTitle+'-activity-feed-widget',activityFeedJSON);}
if(localStorage.getItem(pageTitle+'-activity-feed-widget')){var storedFeedJSON=localStorage.getItem(pageTitle+'-activity-feed-widget');var storedObj=eval("("+storedFeedJSON+")");}
return req;},getFeedUpdate:function(last_id){if(en4.core.request.isRequestActive())
return;var min_id=this.options.last_id+1;this.options.last_id=last_id;document.title=this.title;var req=new Request.HTML({url:en4.core.baseUrl+'widget/index/name/seaocore.feed',data:{'format':'html','minid':min_id,'feedOnly':true,'nolayout':true,'getUpdate':true,'subject':this.options.subject_guid}});en4.core.request.send(req,{'element':$('activity-feed'),'updateHtmlMode':'prepend'});return req;},loop:function(){this._log('activity update loop start');if(!this.state){this.loop.delay(this.options.delay,this);return;}
try{this.checkFeedUpdate().addEvent('complete',function(){try{this._log('activity loop req complete');this.loop.delay(this.options.delay,this);}catch(e){this.loop.delay(this.options.delay,this);this._log(e);}}.bind(this));}catch(e){this.loop.delay(this.options.delay,this);this._log(e);}
this._log('activity update loop stop');},_log:function(object){if(!this.options.debug){return;}
try{if('console'in window&&typeof(console)&&'log'in console){console.log(object);}}catch(e){}}});en4.seaocore.locationBased={startReq:function(params){window.locationsParamsSEAO={latitude:0,longitude:0};window.locationsDetactSEAO=false;params.isExucute=false;var self=this;var callBackFunction=self.sendReq;if(params.callBack){callBackFunction=params.callBack;}
if(params.detactLocation&&!window.locationsDetactSEAO&&navigator.geolocation){if(typeof(Cookie.read('seaocore_myLocationDetails'))!='undefined'&&Cookie.read('seaocore_myLocationDetails')!=""){var readLocationsDetails=JSON.parse(Cookie.read('seaocore_myLocationDetails'));}
if(typeof(readLocationsDetails)=='undefined'||readLocationsDetails==null||typeof(readLocationsDetails.latitude)=='undefined'||typeof(readLocationsDetails.longitude)=='undefined'){navigator.geolocation.getCurrentPosition(function(position){if($('region')){var regionCurrentLocation=$('region').innerHTML;$('region').innerHTML='<div class="seaocore_content_loader"></div>';}
window.locationsParamsSEAO.latitude=position.coords.latitude;window.locationsParamsSEAO.longitude=position.coords.longitude;var myLocationDetails={'latitude':position.coords.latitude,'longitude':position.coords.longitude,'location':'','locationmiles':params.locationmiles};self.setLocationCookies(myLocationDetails);self.setLocationField(position,params);params.locationSetInCookies=true;params.requestParams=$merge(params.requestParams,window.locationsParamsSEAO);params.isExucute=true;if(typeof(params.noSendReq)=='undefined'||params.noSendReq==null){callBackFunction(params);}},function(){params.isExucute=true;if(typeof(params.noSendReq)=='undefined'||params.noSendReq==null){callBackFunction(params);}});}
else{window.locationsParamsSEAO.latitude=readLocationsDetails.latitude;window.locationsParamsSEAO.longitude=readLocationsDetails.longitude;params.requestParams=$merge(params.requestParams,window.locationsParamsSEAO);params.isExucute=true;if(typeof(params.noSendReq)=='undefined'||params.noSendReq==null){callBackFunction(params);}}
window.locationsDetactSEAO=true;window.setTimeout(function(){if(params.isExucute)
return;if(typeof(params.noSendReq)=='undefined'||params.noSendReq==null){callBackFunction(params);}},3000);}else{if(params.detactLocation&&window.locationsDetactSEAO){params.requestParams=$merge(params.requestParams,window.locationsParamsSEAO);}
if(typeof(params.noSendReq)=='undefined'||params.noSendReq==null){callBackFunction(params);}}},sendReq:function(params){var self=this;var url=en4.core.baseUrl+'widget';if(params.requestUrl)
url=params.requestUrl;var request=new Request.HTML({url:url,data:$merge(params.requestParams,{format:'html',subject:en4.core.subject.guid,is_ajax_load:true}),evalScripts:true,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){if($(params.responseContainer)){$(params.responseContainer).innerHTML='';Elements.from(responseHTML).inject($(params.responseContainer));}
en4.core.runonce.trigger();Smoothbox.bind(params.responseContainer);}});request.send();},setLocationCookies:function(params,pageReload){var myLocationDetails={'latitude':params.latitude,'longitude':params.longitude,'location':params.location,'locationmiles':params.locationmiles};if(typeof(params.changeLocationWidget)!='undefined'&&params.changeLocationWidget){Cookie.write('seaocore_myLocationDetails',JSON.stringify(myLocationDetails),{duration:30,path:en4.core.baseUrl});}
else{en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'seaocore/location/get-specific-location-setting',data:{format:'json',location:params.location,updateUserLocation:params.updateUserLocation},onSuccess:function(responseJSON){if(responseJSON.saveCookies){Cookie.write('seaocore_myLocationDetails',JSON.stringify(myLocationDetails),{duration:30,path:en4.core.baseUrl});if(pageReload){window.location.reload();}}}}),{force:true});}},setLocationField:function(position,params){var self=this;if(!position.address){var mapDetect=new google.maps.Map(new Element('div'),{mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(0,0)});var service=new google.maps.places.PlacesService(mapDetect);var request={location:new google.maps.LatLng(position.coords.latitude,position.coords.longitude),radius:500};service.search(request,function(results,status){if(status=='OK'){var index=0;var radian=3.141592653589793/180;var my_distance=1000;var R=6371;for(var i=0;i<results.length;i++){var lat2=results[i].geometry.location.lat();var lon2=results[i].geometry.location.lng();var dLat=(lat2-position.coords.latitude)*radian;var dLon=(lon2-position.coords.longitude)*radian;var lat1=position.coords.latitude*radian;lat2=lat2*radian;var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.sin(dLon/2)*Math.sin(dLon/2)*Math.cos(lat1)*Math.cos(lat2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;if(d<my_distance){index=i;my_distance=d;}}
if(typeof(params.fieldName)!='undefined'&&params.fieldName!=null&&document.getElementById(params.fieldName)){document.getElementById(params.fieldName).value=(results[index].vicinity)?results[index].vicinity:'';if(typeof(params.locationmilesFieldName)!='undefined'&&params.locationmilesFieldName!=null&&document.getElementById(params.locationmilesFieldName)){document.getElementById(params.locationmilesFieldName).value=params.locationmiles;}}
var cookiesLocation=(results[index].vicinity)?results[index].vicinity:'';var myLocationDetails={'latitude':position.coords.latitude,'longitude':position.coords.longitude,'location':cookiesLocation,'locationmiles':params.locationmiles};var pageReload=0;if(typeof(params.reloadPage)!='undefined'&&params.reloadPage!=null){pageReload=1;}
self.setLocationCookies(myLocationDetails,pageReload);}})}else{var delimiter=(position.address&&position.address.street!=''&&position.address.city!='')?', ':'';var location=(position.address)?(position.address.street+delimiter+position.address.city):'';if(typeof(params.fieldName)!='undefined'&&params.fieldName!=null&&document.getElementById(params.fieldName)){document.getElementById(params.fieldName).value=location;}
var myLocationDetails={'latitude':position.coords.latitude,'longitude':position.coords.longitude,'location':location,'locationmiles':params.locationmiles};var pageReload=0;if(typeof(params.reloadPage)!='undefined'&&params.reloadPage!=null){pageReload=1;}
self.setLocationCookies(myLocationDetails,pageReload);}},};en4.seaocore.setShareButtons=function(wrapper,cont,params){if(cont.getElement('.facebook_container')){if(!document.getElementById('fb-root'))
new Element('div',{'id':'fb-root'}).inject($('global_content'),'top');(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))
return;js=d.createElement(s);js.id=id;if(typeof local_language!='undefined'&&$type(local_language)){js.src="//connect.facebook.net/"+local_language+"/all.js#xfbml=1";}
else{js.src="//connect.facebook.net/en_US/all.js#xfbml=1";}
fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));}
if(cont.getElement('.linkedin_container')){new Element('script',{'type':'IN/Share','data-counter':'top'}).inject(cont.getElement('.linkedin_container'));new Element('script',{'src':("https:"==document.location.protocol?"https://":"http://")+'platform.linkedin.com/in.js'}).inject($('global_content'),'before');}
if(cont.getElement('.twitter_container')){new Element('script',{'src':("https:"==document.location.protocol?"https://":"http://")+'platform.twitter.com/widgets.js'}).inject($('global_content'),'before');}
if(cont.getElement('.google_container')){new Element('script',{'src':'https://apis.google.com/js/plusone.js','async':true}).inject($('global_content'),'before');}
if(!params.leftValue){params.leftValue=15;}
wrapper.inject($('global_content'),'top');var top=wrapper.getStyle('top');if(!params.type){params.type='left';}
if(params.type==='left'){params.leftValue=params.leftValue+parseInt(wrapper.clientWidth);cont.setStyle('left','-'+params.leftValue+'px');$('global_content').addClass('seao_share_buttons_left_content');}else{params.leftValue=params.leftValue+parseInt($('global_content').clientWidth);cont.setStyle('left',params.leftValue+'px');$('global_content').addClass('seao_share_buttons_right_content');}
(function(){wrapper.setStyles({width:'1px',visibility:'visible'});}).delay(1500);window.addEvent('scroll',function(e){var descripY=parseInt($('global_content').getOffsets().y)-20,scrollY=$(window).getScroll().y,footerY=parseInt($('global_footer').getOffsets().y),height=parseInt(wrapper.getStyle('height')),fixedShare=wrapper.getStyle('position')==='fixed';if(scrollY<descripY&&fixedShare){wrapper.setStyles({position:'absolute',top:top});}
else if(scrollY>descripY&&(scrollY+20+height)>footerY){wrapper.setStyles({position:'absolute',top:(footerY-height-90)});}
else if(scrollY>descripY&&!fixedShare){wrapper.setStyles({position:'fixed',top:20});}});};var SmoothboxSEAO={overlay:null,wrapper:null,content:null,contentHTML:null,scrollPosition:{left:0,top:0},addScriptFiles:[],addStylesheets:[],active:false,build:function(){SmoothboxSEAO.overlay=new Element('div',{'class':'seao_smoothbox_lightbox_overlay'}).inject($('global_wrapper'));SmoothboxSEAO.wrapper=new Element('div',{'class':'seao_smoothbox_lightbox_content_wrapper'}).inject($('global_wrapper'));SmoothboxSEAO.attach();SmoothboxSEAO.hide();},attach:function(){if(!SmoothboxSEAO.wrapper)
return;SmoothboxSEAO.wrapper.removeEvents('click').addEvent('click',function(event){var el=$(event.target);if(el.hasClass('seao_smoothbox_lightbox_content')||el.getParent('.seao_smoothbox_lightbox_content'))
return;SmoothboxSEAO.close();});},bind:function(selector){var elements;if($type(selector)=='element'){elements=selector.getElements('a.seao_smoothbox');}else if($type(selector)=='string'){elements=$$(selector);}else{elements=$$("a.seao_smoothbox");}
elements.each(function(el)
{if(el.get('tag')!='a'||!SmoothboxSEAO.hasLink(el)||el.retrieve('smoothboxed',false))
{return;}
el.addEvent('click',function(event){event.stop();SmoothboxSEAO.open({class:el.get('data-SmoothboxSEAOClass'),request:{url:el.href}});});el.store('smoothboxed',true);});},hasLink:function(element){return(!element.onclick&&element.href&&!element.href.match(/^(javascript|[#])/));},open:function(params){if(!params)
return;if(!SmoothboxSEAO.wrapper){SmoothboxSEAO.build();}else{SmoothboxSEAO.wrapper.empty();}
if((typeof params)==='string'){if(params.length<4000&&(params.substring(0,1)=='/'||params.substring(0,1)=='.'||params.substring(0,4)=='http'||!params.match(/[ <>"'{}|^~\[\]`]/))){params={request:{url:params}};}else{params={element:params};}}else if($type(params)==='element'){params={element:params};}
SmoothboxSEAO.content=new Element('div',{'class':'seao_smoothbox_lightbox_content'}).inject(SmoothboxSEAO.wrapper);SmoothboxSEAO.contentHTML=new Element('div',{'class':'seao_smoothbox_lightbox_content_html'}).inject(SmoothboxSEAO.content);if(params.class)
SmoothboxSEAO.content.addClass(params.class);if(params.element&&(typeof params.element)==='string')
SmoothboxSEAO.contentHTML.innerHTML=params.element;else if(params.element)
params.element.inject(SmoothboxSEAO.contentHTML);else if(params.request&&params.request.url)
SmoothboxSEAO.sendReq(params.request);SmoothboxSEAO.show();$$(".seao_smoothbox_lightbox_close").addEvent('click',function(event){event.stopPropagation();SmoothboxSEAO.close();});SmoothboxSEAO.doAutoResize();},doAutoResize:function(){var size=Function.attempt(function(){return SmoothboxSEAO.contentHTML.getScrollSize();},function(){return SmoothboxSEAO.contentHTML.getSize();},function(){return{x:SmoothboxSEAO.contentHTML.scrollWidth,y:SmoothboxSEAO.contentHTML.scrollHeight}});var winSize=window.getSize();if(size.x>(winSize.x-30)){size.x=winSize.x-30;}
var marginTop=30;SmoothboxSEAO.content.setStyle('width',size.x);if(size.y<winSize.y){marginTop=(winSize.y-size.y)/2;}
if(marginTop>150)
marginTop=150;else if(marginTop<10)
marginTop=10;size.x=size.x+10;SmoothboxSEAO.content.setStyles({'width':size.x,'marginTop':marginTop,'marginBottom':20});},show:function(){SmoothboxSEAO.overlay.show();SmoothboxSEAO.wrapper.show();if($('arrowchat_base'))
$('arrowchat_base').style.display='none';if($('wibiyaToolbar'))
$('wibiyaToolbar').style.display='none';SmoothboxSEAO.scrollPosition.top=window.getScrollTop();SmoothboxSEAO.scrollPosition.left=window.getScrollLeft();SmoothboxSEAO.setHtmlScroll("hidden");SmoothboxSEAO.active=true;},hide:function(){SmoothboxSEAO.overlay.hide();SmoothboxSEAO.wrapper.hide();SmoothboxSEAO.active=false;},close:function(){if(!SmoothboxSEAO.active)
return;SmoothboxSEAO.hide();SmoothboxSEAO.setHtmlScroll("auto");window.scroll(SmoothboxSEAO.scrollPosition.left,SmoothboxSEAO.scrollPosition.top);if($('arrowchat_base'))
$('arrowchat_base').style.display='block';if($('wibiyaToolbar'))
$('wibiyaToolbar').style.display='block';},setHtmlScroll:function(cssCode){$$('html').setStyle('overflow',cssCode);},sendReq:function(params){var container=SmoothboxSEAO.contentHTML;container.empty();new Element('div',{'class':'seao_smoothbox_lightbox_loading'}).inject(container);if(!params.requestParams)
params.requestParams={};SmoothboxSEAO.addScriptFiles=[];SmoothboxSEAO.addStylesheets=[];var request=new Request.HTML({url:params.url,method:'get',data:$merge(params.requestParams,{format:'html',seaoSmoothbox:true}),evalScripts:true,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){var onLoadContent=function(){container.empty();Elements.from(responseHTML).inject(container);en4.core.runonce.trigger();SmoothboxSEAO.doAutoResize();Smoothbox.bind(container);SmoothboxSEAO.bind(container);if(params.callBack&&(typeof params.callBack)==='function'){params.callBack(container);}};var JSCount=SmoothboxSEAO.addScriptFiles.length;var StyleSheetCount=SmoothboxSEAO.addStylesheets.length;var totalFiles=JSCount+StyleSheetCount;var i=0,succes=0;if(succes===totalFiles)
onLoadContent();for(i;i<JSCount;i++){Asset.javascript(SmoothboxSEAO.addScriptFiles[i],{onLoad:function(){succes++;if(succes===totalFiles)
onLoadContent();}});}
SmoothboxSEAO.addScriptFiles=[];for(i=0;i<StyleSheetCount;i++){Asset.css(SmoothboxSEAO.addStylesheets[i],{onLoad:function(){succes++;if(succes===totalFiles)
onLoadContent();}});}
SmoothboxSEAO.addStylesheets=[];}});request.send();}};window.addEvent('domready',function()
{SmoothboxSEAO.bind();});window.addEvent('load',function()
{SmoothboxSEAO.bind();});en4.seaocore.covertdateDmyToMdy=function(date){starttime=date.split("/");date=starttime[1]+'/'+starttime[0]+'/'+starttime[2];return date;};en4.communityad={sendReq:function(container,content_id,isAdboardPage,requestParams){var url=en4.core.baseUrl+'widget';var params={format:'html',is_ajax_load:1,subject:en4.core.subject.guid,isAdboardPage:isAdboardPage};if(!content_id){url=en4.core.baseUrl+'widget/index/mod/communityad/name/ads';}else{params.content_id=content_id;}
if(requestParams)
params=$merge(requestParams,params);var request=new Request.HTML({url:url,method:'get',data:params,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){container.empty();Elements.from(responseHTML).inject(container);en4.core.runonce.trigger();Smoothbox.bind(container);}});request.send();}};var communityad_likeinfo=function(ad_id,resource_type,resource_id,owner_id,widgetType,core_like){var request=createLike(ad_id,resource_type,resource_id,owner_id,widgetType,core_like);request.addEvent('complete',function(responseJSON){if(responseJSON.like_id)
{$(widgetType+'_likeid_info_'+ad_id).value=responseJSON.like_id;$(resource_type+'_'+widgetType+'_most_likes_'+ad_id).style.display='none';$(resource_type+'_'+widgetType+'_unlikes_'+ad_id).style.display='block';}
else
{$(widgetType+'_likeid_info_'+ad_id).value=0;$(resource_type+'_'+widgetType+'_most_likes_'+ad_id).style.display='block';$(resource_type+'_'+widgetType+'_unlikes_'+ad_id).style.display='none';}});}
function adCancel(div_id,widgetType){$(widgetType+'_ad_cancel_'+div_id).style.display='block';$(widgetType+'_ad_'+div_id).style.display='none';}
function adUndo(div_id,widgetType){$(widgetType+'_ad_cancel_'+div_id).style.display='none';$(widgetType+'_ad_'+div_id).style.display='block';if($(widgetType+'_other_'+div_id).checked){$(widgetType+'_other_'+div_id).checked=false;$(widgetType+'_other_text_'+div_id).style.display='none';$(widgetType+'_other_text_'+div_id).value='Type your reason here...';$(widgetType+'_other_button_'+div_id).style.display='none';}}
function otherAdCannel(adRadioValue,div_id,widgetType){if(adRadioValue==4){$(widgetType+'_other_text_'+div_id).style.display='block';$(widgetType+'_other_button_'+div_id).style.display='block';}}
function adSave(adCancelReasion,adsId,divId,widgetType){var adDescription=0;if(adCancelReasion=='Other'){if($(widgetType+'_other_text_'+divId).value!='Type your reason here...'){adDescription=$(widgetType+'_other_text_'+divId).value;}}
$(widgetType+'_ad_cancel_'+divId).innerHTML='<center><img src="application/modules/Core/externals/images/loading.gif" alt=""></center>';en4.core.request.send(new Request.HTML({url:en4.core.baseUrl+'communityad/display/adsave',data:{format:'html',adCancelReasion:adCancelReasion,adDescription:adDescription,adsId:adsId}}),{'element':$(widgetType+'_ad_cancel_'+divId)})}
function createLike(ad_id,resource_type,resource_id,owner_id,widgetType,core_like)
{var like_id=$(widgetType+'_likeid_info_'+ad_id).value;var request=new Request.JSON({url:en4.core.baseUrl+'communityad/display/globallikes',data:{format:'json','ad_id':ad_id,'resource_type':resource_type,'resource_id':resource_id,'owner_id':owner_id,'like_id':like_id,'core_like':core_like}});request.send();return request;}
function locationAutoSuggest(countrycities,location_field,city_field){if(city_field&&$(city_field)){if(countrycities){var options={types:['(cities)'],componentRestrictions:{country:countrycities}};}
else{var options={types:['(cities)']};}
var autocomplete=new google.maps.places.Autocomplete($(city_field),options);}
if(location_field&&$(location_field)){if(countrycities){var options={componentRestrictions:{country:countrycities}};}
else{var options={};}
var autocomplete=new google.maps.places.Autocomplete($(location_field),options);}}
function openSmoothbox(thisobj){var Obj_Url=thisobj.href;Smoothbox.open(Obj_Url);}
function showShareLinks(val){$(document.body).addEvent('click',function(){showHideToggleShareLinks();});$$('.siteevent_share_links_toggle').addEvent('click',function(event){event.stop();$(this).getParent('.siteevent_grid_footer').getElement('.siteevent_share_links').toggle();if(typeof val=='undefined'){$(this).toggle();}else{$(this).show();}});}
function showHideToggleShareLinks(){$$('.siteevent_share_links_toggle').show();$$('.siteevent_share_links_toggle').getParent('.siteevent_grid_footer').getElement('.siteevent_share_links').hide();};function sopopup(pageURL){var w=800;var h=500;var title="socialconnectwindow";var left=(screen.width/2)-(w/2);var top=(screen.height/2)-(h/2);var newwindow=window.open(pageURL,title,'toolbar=no,location=no,directories=no,status=no,menubar=no, scrollbars=yes,resizable=yes,copyhistory=no,width='+w+',height='+h+',top='+top+',left='+left);if(window.focus){newwindow.focus();}
return newwindow;};var M2b=M2b||{};M2b.SocialConnect={popupCenter:function(pageURL,title,w,h){var left=(screen.width/2)-(w/2);var top=(screen.height/2)-(h/2);var newwindow=window.open(pageURL,title,'toolbar=no,location=no,directories=no,status=no,menubar=no, scrollbars=no,resizable=no,copyhistory=no,width='+w+',height='+h+',top='+top+',left='+left);if(window.focus){newwindow.focus();}},signon:function(url){M2b.SocialConnect.popupCenter(url,'socialconnectwindow',800,500);return false;}};;en4.yncontest={changeCategory:function(element,name,model){console.log(element);if(element!=null){element.form[name].value=element.value;var e=element.name;var prefix='id_wrapper_'+name+'_';var level=element.name.replace(name+'_','');level=parseInt(level);var ne=document.getElementById(prefix+(level+1));if(name=='location_id'){var max=3;}
else{var max=9;}
for(i=level;i<max;i++){if((document.getElementById(prefix+(i+1)))){document.getElementById(prefix+(i+1)).setStyle('display','none');}};var request=new Request({'url':en4.core.baseUrl+'contest/my-contest/change-multi-level','data':{'format':'html','id':element.value,'name':name,'level':level,'model':model},'onComplete':function(a){if(a!=''){ne.setStyle('margin-top','8px');ne.setStyle('display','block');ne.innerHTML=a;}}});request.send();}
else{}},follow:function(contest_id,user_id,text_url){var request=new Request.JSON({'format':'json','url':en4.core.baseUrl+'contest/my-contest/follow','data':{'user_id':user_id,'contestId':contest_id},'onComplete':function(response){if(response.signin==0){window.location=en4.core.baseUrl+'login/return_url/64-'+text_url;return;}
var ele_array=$$('.contest_follow_'+contest_id);var length=ele_array.length;for(i=0;i<length;i++){ele_array[i].innerHTML=response.text;if(response.follow){$(ele_array[i]).removeClass("contest_follow_follow").addClass("contest_follow_follow");}else{$(ele_array[i]).removeClass("contest_follow_unfollow").addClass("contest_follow_unfollow");}}}});request.send();},fav:function(contest_id,user_id,text_url){var request=new Request.JSON({'format':'json','url':en4.core.baseUrl+'contest/my-contest/favourite-contest','data':{'user_id':user_id,'contestId':contest_id},'onSuccess':function(response){if(response.signin==0){window.location=en4.core.baseUrl+'login/return_url/64-'+text_url;return;}
var ele_array=$$('.contest_fav_'+contest_id);var length=ele_array.length;for(i=0;i<length;i++){ele_array[i].innerHTML=response.text;if(response.favourite){$(ele_array[i]).removeClass("contest_fav_favourite").addClass("contest_fav_unfavourite");}else{$(ele_array[i]).removeClass("contest_fav_unfavourite").addClass("contest_fav_favourite");}}}});request.send();},entriesfav:function(entry_id,user_id,text_url){var request=new Request.JSON({'format':'json','url':en4.core.baseUrl+'contest/my-entries/favourite-entries','data':{'user_id':user_id,'entriesId':entry_id},'onSuccess':function(response){if(response.signin==0){window.location=en4.core.baseUrl+'login/return_url/64-'+text_url;return;}
var ele_array=$$('.entries_fav_'+entry_id);var length=ele_array.length;for(i=0;i<length;i++){ele_array[i].innerHTML=response.text;if(response.favourite){$(ele_array[i]).removeClass("entries_fav_favourite").addClass("entries_fav_unfavourite");}else{$(ele_array[i]).removeClass("entries_fav_unfavourite").addClass("entries_fav_favourite");}}}});request.send();},};en4.ynfilesharing={foldersPermissions:[],parentType:null,parentId:null,_getURI:function(action){var uri=null;url='';if(action=='delete'){url=en4.core.baseUrl+'filesharing/index/delete/parent_type/{parent_type}/parent_id/{parent_id}';}else if(action=='move'){url=en4.core.baseUrl+'filesharing/index/move/parent_type/{parent_type}/parent_id/{parent_id}';}
if(url.length>0){url=url.substitute({'parent_type':this.parentType,'parent_id':this.parentId});uri=new URI(url);}
return uri;},_handleDeleteAndMove:function(event,action){event.stop();var listFilesAndFolders=[];Array.each($$('.ynfs_browse li.ynfs_item input[type="checkbox"]'),function(item,index){if(item.checked){listFilesAndFolders.push(item);}});if(listFilesAndFolders.length>1)
{var folderIds=[];var fileIds=[];for(var i=0;i<listFilesAndFolders.length;i++){var item=listFilesAndFolders[i];if(item.get('name')=='folderIds[]'){var ck=true;var folderId=item.get('value');var folderPermissions=en4.ynfilesharing.getPermissionOfFolder(folderId);if(action=='move'){var parent=en4.ynfilesharing.getParentItem(folderId,'folder');if(!(parent.parentType==this.parentType&&parent.parentId==this.parentId)){ck=false;}}else{if(!en4.ynfilesharing.getPermissionOfFolder(folderId).contains(action)){ck=false;}}
if(ck==false){alert(en4.core.language.translate('You do not permission to %s the folder %s',action,en4.ynfilesharing.getItemName(folderId,'folder')));return;}
folderIds.push(folderId);}else{var fileId=item.get('value');if(action=='move'){var parent=en4.ynfilesharing.getParentItem(fileId,'file');if(!(parent.parentType==this.parentType&&parent.parentId==this.parentId)){alert(en4.core.language.translate('You do not permission to %s the file %s',action,en4.ynfilesharing.getItemName(fileId,'file')));return;}}
fileIds.push(fileId);}}
var uri=this._getURI(action);if(folderIds.length>0){uri.setData('folderIds',folderIds);}
if(fileIds.length>0){uri.setData('fileIds',fileIds);}
Smoothbox.open(uri.toString());}
else
{Smoothbox.open(event.target);}},_deleteFoldersAndFiles:function(event){en4.ynfilesharing._handleDeleteAndMove(event,'delete');},_moveFoldersAndFiles:function(event){en4.ynfilesharing._handleDeleteAndMove(event,'move');},setOptions:function(options){for(opt in options){if(this.hasOwnProperty(opt)){this[opt]=options[opt];}}},setFoldersPermissions:function(folderPerms){en4.ynfilesharing.foldersPermissions=folderPerms;},getPermissionOfFolder:function(folderId){return this.foldersPermissions[folderId];},getItemName:function(itemId,type){var name='';var ele;var items=$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item');for(var i=0;i<items.length;i++){if(type=='folder'){if(items[i].getProperty('folderId')==itemId){ele=items[i];}}else{if(type=='file'){if(items[i].getProperty('fileId')==itemId){ele=items[i];}}}}
var nameEle=ele.getFirst('.ynfs_name_column  > a');if(nameEle){return nameEle.get('text').trim();}},getParentItem:function(itemId,type){var items=$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item');var ele=null;for(var i=0;i<items.length;i++){if(type=='folder'){if(items[i].getProperty('folderId')==itemId){ele=items[i];break;}}else{if(items[i].getProperty('fileId')==itemId){ele=items[i];break;}}}
if(ele){return{'parentType':ele.getProperty('parentType'),'parentId':ele.getProperty('parentId')};}},showControlForFolder:function(folderId,controlColumn,parentType,parentId){var permissions=en4.ynfilesharing.getPermissionOfFolder(folderId);var editElement=null;var deleteElement=null;var moveElement=null;var shareElement=null;if(permissions==null||permissions.contains('edit')){editElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/folder/edit/'+folderId,'html':en4.core.language.translate('Edit'),'class':'buttonlink ynfs_control_edit'});if(parentType==this.parentType&&parentId==this.parentId){var moveUrl='filesharing/index/move/folder_id/{folder_id}/parent_type/{parent_type}/parent_id/{parent_id}/format/smoothbox';moveElement=new Element('a',{'href':en4.core.baseUrl+moveUrl.substitute({'parent_type':this.parentType,'parent_id':this.parentId,'folder_id':folderId}),'html':en4.core.language.translate('Move'),'class':'buttonlink ynfs_control_move'});moveElement.addEvent('click',this._moveFoldersAndFiles);}}
if(permissions==null||permissions.contains('delete')){deleteElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/folder/delete/'+folderId,'html':en4.core.language.translate('Delete'),'class':'buttonlink ynfs_control_delete'});deleteElement.addEvent('click',this._deleteFoldersAndFiles);}
if(parentType==this.parentType&&parentId==this.parentId){shareElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/index/share/folder_id/'+folderId+'/format/smoothbox','html':en4.core.language.translate('Share'),'class':'buttonlink ynfs_control_share'});shareElement.addEvent('click',function(event){event.stop();Smoothbox.open(shareElement);});}
if(shareElement!=null){shareElement.inject(controlColumn);}
if(editElement!=null){editElement.inject(controlColumn);}
if(deleteElement!=null){deleteElement.inject(controlColumn);}
if(moveElement!=null){moveElement.inject(controlColumn);}
fileSizeElement=$("ynfilesharing_filesize");if(fileSizeElement!=null)
fileSizeElement.destroy();},showControlForFile:function(currentFolderId,fileId,controlColumn,parentType,parentId){var permissions=en4.ynfilesharing.getPermissionOfFolder(currentFolderId);var editElement=null;var deleteElement=null;var moveElement=null;var fileSizeElement=null;var shareElement=null;if(permissions!=null&&permissions.contains('edit')){editElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/file/edit/'+fileId,'html':en4.core.language.translate('Edit'),'class':'buttonlink ynfs_control_edit'});editElement.addEvent('click',function(event){event.stop();Smoothbox.open(editElement);});if(parentType==this.parentType&&parentId==this.parentId){var moveUrl='filesharing/index/move/file_id/{file_id}/parent_type/{parent_type}/parent_id/{parent_id}';moveElement=new Element('a',{'href':en4.core.baseUrl+moveUrl.substitute({'parent_type':this.parentType,'parent_id':this.parentId,'file_id':fileId}),'html':en4.core.language.translate('Move'),'class':'buttonlink ynfs_control_move'});}
if(moveElement){moveElement.addEvent('click',this._moveFoldersAndFiles);}}
if(permissions!=null&&permissions.contains('delete')){deleteElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/file/delete/'+fileId,'html':en4.core.language.translate('Delete'),'class':'buttonlink ynfs_control_delete'});deleteElement.addEvent('click',en4.ynfilesharing._deleteFoldersAndFiles);}
if(parentType==this.parentType&&parentId==this.parentId){shareElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/index/share/file_id/'+fileId+'/format/smoothbox','html':en4.core.language.translate('Share'),'class':'buttonlink ynfs_control_share'});shareElement.addEvent('click',function(event){event.stop();Smoothbox.open(shareElement);});}
fileSizeElement=$("ynfilesharing_filesize");if(fileSizeElement!=null)
fileSizeElement.destroy();fileSizeElement=document.createElement('span');fileSizeElement.setAttribute('id','ynfilesharing_filesize');fileSizeElement.innerHTML=en4.ynfilesharing.formatFileSize($$("li[fileid="+fileId+"]").get('size'));if(shareElement!=null){shareElement.inject(controlColumn);}
if(editElement!=null){editElement.inject(controlColumn);}
if(deleteElement!=null){deleteElement.inject(controlColumn);}
if(moveElement!=null){moveElement.inject(controlColumn);}
if(fileSizeElement!=null){$(fileSizeElement).inject(controlColumn);}},roundNumber:function(number,digits){var multiple=Math.pow(10,digits);var rndedNum=Math.round(number*multiple)/multiple;return rndedNum;},formatFileSize:function(size){fileSize=parseInt(size);sizeKB=1024;sizeMB=1024*1024;if(fileSize>sizeKB&&fileSize<sizeMB)
return en4.ynfilesharing.roundNumber(fileSize/sizeKB,2)+en4.core.language.translate(" KB");else if(fileSize>sizeMB)
return en4.ynfilesharing.roundNumber(fileSize/sizeMB,2)+en4.core.language.translate(" MB");else
return String(fileSize)+en4.core.language.translate(" Bytes");},cancelUploadFile:function(){if(upload.inputFiles){upload.inputFiles._files.length=0;$$(".ynfs_uploadList").set('html','');$("file").value
$('uploadForm').hide();}
else
{window.location=window.location;}},showControls:function(element){element.addClass('ynfs_item_selected').removeClass('ynfs_item_hover');var controlsElement=element.getSiblings('.ynfs_browse_control')[0];controlsElement.getElements('a').destroy();controlsElement.set('styles',{'display':'block'});var titleElement=element.getSiblings('.ynfs_browse_title')[0];titleElement.set('styles',{'display':'none'});var controlColumn=controlsElement.getElement('.ynfs_control_column');var folderId=element.getProperty('folderId');if(folderId)
{var parentType=element.getProperty('parentType');var parentId=element.getProperty('parentId');en4.ynfilesharing.showControlForFolder(folderId,controlColumn,parentType,parentId);}
else
{currentFolderId=element.getProperty('currentFolerId');fileId=element.getProperty('fileId');var parentType=element.getProperty('parentType');var parentId=element.getProperty('parentId');en4.ynfilesharing.showControlForFile(currentFolderId,fileId,controlColumn,parentType,parentId);}},showHeader:function(){$(document.body).getElements('li.ynfs_browse_title').set('styles',{'display':'block'});$(document.body).getElements('li.ynfs_browse_control').set('styles',{'display':'none'});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item_selected').removeClass('ynfs_item_selected');}}
en4.core.runonce.add(function(){$(document.body).addEvent('click',function(e){var parent=e.target.getParent();if(parent&&parent.contains($('ynfs_control_browse'))){en4.ynfilesharing.showHeader();}});$$('.ynfs_checkall').addEvent('click',function(e){var checked=e.target.checked;Array.each($$('.ynfs_browse li input[type="checkbox"]'),function(item,index){item.checked=checked;var eleLi=item.getParent('li.ynfs_item');if(eleLi){if(checked){eleLi.addClass('ynfs_item_selected');}else{eleLi.removeClass('ynfs_item_selected');}}});if(checked){var selectedItems=$$('.ynfs_browse .ynfs_item.ynfs_item_selected');if(selectedItems.length>0){en4.ynfilesharing.showControls(selectedItems[0]);}}else{en4.ynfilesharing.showHeader();}});$$('.ynfs_browse li.ynfs_item input[type="checkbox"]').removeEvent('click').addEvent('click',function(e){var checked=e.target.checked;if(!checked){Array.each($$('.ynfs_checkall'),function(item,index){item.checked=false;});}else{var checkAll=true;var ckboxes=$$('.ynfs_browse li.ynfs_item input[type="checkbox"]');for(var i=0;i<ckboxes.length;i++){if(!ckboxes[i].checked){checkAll=false;break;}}
if(checkAll){Array.each($$('.ynfs_checkall'),function(item,index){item.checked=true;});}}
var eleLi=e.target.getParent('li.ynfs_item');if(!checked){eleLi.removeClass('ynfs_item_selected');var ckboxes=$$('.ynfs_browse li.ynfs_item input[type="checkbox"]');var notCheckAll=true;for(var i=0;i<ckboxes.length;i++){if(ckboxes[i].checked){notCheckAll=false;break;}}
if(notCheckAll){en4.ynfilesharing.showHeader();}}else{eleLi.addClass('ynfs_item_selected');en4.ynfilesharing.showControls(eleLi);}});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item').removeEvent('mouseenter').addEvent('mouseenter',function(event){var element=event.target;if(!element.hasClass('ynfs_item_selected')){element.addClass('ynfs_item_hover');}});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item').removeEvent('mouseleave').addEvent('mouseleave',function(event){var element=event.target;element.removeClass('ynfs_item_hover');});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item').removeEvent('click').addEvent('click',function(event){var element=event.target;if(element.get('tag')!='input'){if(element.get('tag')!='li'){element=element.getParent('li');}
Array.each(element.getSiblings(),function(item,index){if(item.getFirst('.ynfs_check_column').getFirst().checked==false){item.removeClass('ynfs_item_selected');}});en4.ynfilesharing.showControls(element);}});});;var Picker=new Class({Implements:[Options,Events],options:{pickerClass:'datepicker',inject:null,animationDuration:400,useFadeInOut:true,positionOffset:{x:0,y:0},pickerPosition:'bottom',draggable:true,showOnInit:true,columns:1,footer:false},initialize:function(options){this.setOptions(options);this.constructPicker();if(this.options.showOnInit)this.show();},constructPicker:function(){var options=this.options;var picker=this.picker=new Element('div',{'class':options.pickerClass,styles:{left:0,top:0,display:'none',opacity:0}}).inject(options.inject||document.body);picker.addClass('column_'+options.columns);if(options.useFadeInOut){picker.set('tween',{duration:options.animationDuration,link:'cancel'});}
var header=this.header=new Element('div.header').inject(picker);var title=this.title=new Element('div.title').inject(header);var titleID=this.titleID='pickertitle-'+String.uniqueID();this.titleText=new Element('div',{'role':'heading','class':'titleText','id':titleID,'aria-live':'assertive','aria-atomic':'true'}).inject(title);this.closeButton=new Element('div.closeButton[text=x][role=button]').addEvent('click',this.close.pass(false,this)).inject(header);var body=this.body=new Element('div.body').inject(picker);if(options.footer){this.footer=new Element('div.footer').inject(picker);picker.addClass('footer');}
var slider=this.slider=new Element('div.slider',{styles:{position:'absolute',top:0,left:0}}).set('tween',{duration:options.animationDuration,transition:Fx.Transitions.Quad.easeInOut}).inject(body);this.newContents=new Element('div',{styles:{position:'absolute',top:0,left:0}}).inject(slider);this.oldContents=new Element('div',{styles:{position:'absolute',top:0}}).inject(slider);this.originalColumns=options.columns;this.setColumns(options.columns);var shim=this.shim=window['IframeShim']?new IframeShim(picker):null;if(options.draggable&&typeOf(picker.makeDraggable)=='function'){this.dragger=picker.makeDraggable(shim?{onDrag:shim.position.bind(shim)}:null);picker.setStyle('cursor','move');}},open:function(noFx){if(this.opened==true)return this;this.opened=true;var picker=this.picker.setStyle('display','block').set('aria-hidden','false')
if(this.shim)this.shim.show();this.fireEvent('open');if(this.options.useFadeInOut&&!noFx){picker.fade('in').get('tween').chain(this.fireEvent.pass('show',this));}else{picker.setStyle('opacity',1);this.fireEvent('show');}
return this;},show:function(){return this.open(true);},close:function(noFx){if(this.opened==false)return this;this.opened=false;this.fireEvent('close');var self=this,picker=this.picker,hide=function(){picker.setStyle('display','none').set('aria-hidden','true');if(self.shim)self.shim.hide();self.fireEvent('hide');};if(this.options.useFadeInOut&&!noFx){picker.fade('out').get('tween').chain(hide);}else{picker.setStyle('opacity',0);hide();}
return this;},hide:function(){return this.close(true);},toggle:function(){return this[this.opened==true?'close':'open']();},destroy:function(){this.picker.destroy();if(this.shim)this.shim.destroy();},position:function(x,y){var offset=this.options.positionOffset,scroll=document.getScroll(),size=document.getSize(),pickersize=this.picker.getSize();if(typeOf(x)=='element'){var element=x,where=y||this.options.pickerPosition;var elementCoords=element.getCoordinates();x=(where=='left')?elementCoords.left-pickersize.x:(where=='bottom'||where=='top')?elementCoords.left:elementCoords.right
y=(where=='bottom')?elementCoords.bottom:(where=='top')?elementCoords.top-pickersize.y:elementCoords.top;}
x+=offset.x*((where&&where=='left')?-1:1);y+=offset.y*((where&&where=='top')?-1:1);if((x+pickersize.x)>(size.x+scroll.x))x=(size.x+scroll.x)-pickersize.x;if((y+pickersize.y)>(size.y+scroll.y))y=(size.y+scroll.y)-pickersize.y;if(x<0)x=0;if(y<0)y=0;x=x-124;this.picker.setStyles({left:x,top:y});if(this.shim)this.shim.position();return this;},setBodySize:function(){var bodysize=this.bodysize=this.body.getSize();this.slider.setStyles({width:2*bodysize.x,height:bodysize.y});this.oldContents.setStyles({left:bodysize.x,width:bodysize.x,height:bodysize.y});this.newContents.setStyles({width:bodysize.x,height:bodysize.y});},setColumnContent:function(column,content){var columnElement=this.columns[column];if(!columnElement)return this;var type=typeOf(content);if(['string','number'].contains(type))columnElement.set('text',content);else columnElement.empty().adopt(content);return this;},setColumnsContent:function(content,fx){var old=this.columns;this.columns=this.newColumns;this.newColumns=old;content.forEach(function(_content,i){this.setColumnContent(i,_content);},this);return this.setContent(null,fx);},setColumns:function(columns){var _columns=this.columns=new Elements,_newColumns=this.newColumns=new Elements;for(var i=columns;i--;){_columns.push(new Element('div.column').addClass('column_'+(columns-i)));_newColumns.push(new Element('div.column').addClass('column_'+(columns-i)));}
var oldClass='column_'+this.options.columns,newClass='column_'+columns;this.picker.removeClass(oldClass).addClass(newClass);this.options.columns=columns;return this;},setContent:function(content,fx){if(content)return this.setColumnsContent([content],fx);var old=this.oldContents;this.oldContents=this.newContents;this.newContents=old;this.newContents.empty();this.newContents.adopt(this.columns);this.setBodySize();if(fx){this.fx(fx);}else{this.slider.setStyle('left',0);this.oldContents.setStyles({left:0,opacity:0});this.newContents.setStyles({left:0,opacity:1});}
return this;},fx:function(fx){var oldContents=this.oldContents,newContents=this.newContents,slider=this.slider,bodysize=this.bodysize;if(fx=='right'){oldContents.setStyles({left:0,opacity:1});newContents.setStyles({left:bodysize.x,opacity:1});slider.setStyle('left',0).tween('left',0,-bodysize.x);}else if(fx=='left'){oldContents.setStyles({left:bodysize.x,opacity:1});newContents.setStyles({left:0,opacity:1});slider.setStyle('left',-bodysize.x).tween('left',-bodysize.x,0);}else if(fx=='fade'){slider.setStyle('left',0);oldContents.setStyle('left',0).set('tween',{duration:this.options.animationDuration/2}).tween('opacity',1,0).get('tween').chain(function(){oldContents.setStyle('left',bodysize.x);});newContents.setStyles({opacity:0,left:0}).set('tween',{duration:this.options.animationDuration}).tween('opacity',0,1);}},toElement:function(){return this.picker;},setTitle:function(content,fn){if(!fn)fn=Function.from;this.titleText.empty().adopt(Array.from(content).map(function(item,i){return typeOf(item)=='element'?item:new Element('div.column',{text:fn(item,this.options)}).addClass('column_'+(i+1));},this));return this;},setTitleEvent:function(fn){this.titleText.removeEvents('click');if(fn)this.titleText.addEvent('click',fn);this.titleText.setStyle('cursor',fn?'pointer':'');return this;}});Picker.Attach=new Class({Extends:Picker,options:{togglesOnly:true,showOnInit:false,blockKeydown:true},initialize:function(attachTo,options){this.parent(options);this.attachedEvents=[];this.attachedElements=[];this.toggles=[];this.inputs=[];var documentEvent=function(event){if(this.attachedElements.contains(event.target))return;this.close();}.bind(this);var document=this.picker.getDocument().addEvent('click',documentEvent);var preventPickerClick=function(event){event.stopPropagation();return false;};this.picker.addEvent('click',preventPickerClick);if(this.options.toggleElements)this.options.toggle=document.getElements(this.options.toggleElements);this.attach(attachTo,this.options.toggle);},attach:function(attachTo,toggle){if(typeOf(attachTo)=='string')attachTo=document.id(attachTo);if(typeOf(toggle)=='string')toggle=document.id(toggle);var elements=Array.from(attachTo),toggles=Array.from(toggle),allElements=[].append(elements).combine(toggles),self=this;var closeEvent=function(event){var stopInput=self.options.blockKeydown&&event.type=='keydown'&&!(['tab','esc'].contains(event.key)),isCloseKey=event.type=='keydown'&&(['tab','esc'].contains(event.key)),isA=event.target.get('tag')=='a';if(stopInput||isA)event.preventDefault();if(isCloseKey||isA)self.close();};var getOpenEvent=function(element){return function(event){var tag=event.target.get('tag');if(tag=='input'&&event.type=='click'&&!element.match(':focus')||(self.opened&&self.input==element))return;if(tag=='a')event.stop();self.position(element);self.open();self.fireEvent('attached',[event,element]);};};var getToggleEvent=function(open,close){return function(event){if(self.opened)close(event);else open(event);};};allElements.each(function(element){if(self.attachedElements.contains(element))return;var events={},tag=element.get('tag'),openEvent=getOpenEvent(element),toggleEvent=getToggleEvent(openEvent,closeEvent);if(tag=='input'){if(!self.options.togglesOnly||!toggles.length){events={focus:openEvent,click:openEvent,keydown:closeEvent};}
self.inputs.push(element);}else{if(toggles.contains(element)){self.toggles.push(element);events.click=toggleEvent}else{events.click=openEvent;}}
element.addEvents(events);self.attachedElements.push(element);self.attachedEvents.push(events);});return this;},detach:function(attachTo,toggle){if(typeOf(attachTo)=='string')attachTo=document.id(attachTo);if(typeOf(toggle)=='string')toggle=document.id(toggle);var elements=Array.from(attachTo),toggles=Array.from(toggle),allElements=[].append(elements).combine(toggles),self=this;if(!allElements.length)allElements=self.attachedElements;allElements.each(function(element){var i=self.attachedElements.indexOf(element);if(i<0)return;var events=self.attachedEvents[i];element.removeEvents(events);delete self.attachedEvents[i];delete self.attachedElements[i];var toggleIndex=self.toggles.indexOf(element);if(toggleIndex!=-1)delete self.toggles[toggleIndex];var inputIndex=self.inputs.indexOf(element);if(toggleIndex!=-1)delete self.inputs[inputIndex];});return this;},destroy:function(){this.detach();return this.parent();}});String.prototype.leftpad=function(padString,length){var str=this;while(str.length<length)
str=padString+str;return str;}
function getShortDateString(d){return d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate();}
(function(){this.DatePicker=Picker.Date=new Class({Extends:Picker.Attach,options:{format:'%m-%d-%Y',timePicker:false,timePickerOnly:false,timeWheelStep:1,yearPicker:true,yearsPerPage:20,fnAfterRender:false,startDay:0,rtl:(en4.orientation=='rtl'),startView:'days',openLastView:false,pickOnly:false,canAlwaysGoUp:['months','days'],updateAll:false,weeknumbers:false,months_abbr:null,days_abbr:null,years_title:function(date,options){var year=date.get('year');return year+'-'+(year+options.yearsPerPage-1);},months_title:function(date,options){return date.get('year');},days_title:function(date,options){return date.format('%b %Y');},time_title:function(date,options){return(options.pickOnly=='time')?en4.core.language.translate('select a time'):date.format('%d %B, %Y');}},initialize:function(attachTo,options){this.parent(attachTo,options);this.setOptions(options);options=this.options;this.options.days_abbr=[en4.core.language.translate('Sun'),en4.core.language.translate('Mon'),en4.core.language.translate('Tue'),en4.core.language.translate('Wed'),en4.core.language.translate('Thu'),en4.core.language.translate('Fri'),en4.core.language.translate('Sat')];['year','month','day','time'].some(function(what){if(options[what+'PickerOnly']){options.pickOnly=what;return true;}
return false;});if(options.pickOnly){options[options.pickOnly+'Picker']=true;options.startView=options.pickOnly;}
var newViews=['days','months','years'];['month','year','decades'].some(function(what,i){return(options.startView==what)&&(options.startView=newViews[i]);});options.canAlwaysGoUp=options.canAlwaysGoUp?Array.from(options.canAlwaysGoUp):[];if(options.minDate){if(!(options.minDate instanceof Date))options.minDate=Date.parse(options.minDate);options.minDate.clearTime();}
if(options.maxDate){if(!(options.maxDate instanceof Date))options.maxDate=Date.parse(options.maxDate);options.maxDate.clearTime();}
if(!options.format){options.format=(options.pickOnly!='time')?Locale.get('Date.shortDate'):'';if(options.timePicker)options.format=(options.format)+(options.format?' ':'')+Locale.get('Date.shortTime');}
this.addEvent('attached',function(event,element){if(!this.currentView||!options.openLastView)this.currentView=options.startView;this.date=limitDate(new Date(),options.minDate,options.maxDate);var tag=element.get('tag'),input;if(tag=='input')input=element;else{var index=this.toggles.indexOf(element);if(this.inputs[index])input=this.inputs[index];}
this.getInputDate(input);this.input=input;this.setColumns(this.originalColumns);}.bind(this),true);},getInputDate:function(input){this.date=new Date();if(!input)return;var date=Date.parse(input.get('value'));if(date==null||!date.isValid()){var storeDate=input.retrieve('datepicker:value');if(storeDate)date=Date.parse(storeDate);}
if(date!=null&&date.isValid())this.date=date;},constructPicker:function(){this.parent();if(!this.options.rtl){this.previous=new Element('div.previous[html=&#171;]').inject(this.header);this.next=new Element('div.next[html=&#187;]').inject(this.header);}else{this.next=new Element('div.previous[html=&#171;]').inject(this.header);this.previous=new Element('div.next[html=&#187;]').inject(this.header);}},hidePrevious:function(_next,_show){this[_next?'next':'previous'].setStyle('display',_show?'block':'none');return this;},showPrevious:function(_next){return this.hidePrevious(_next,true);},setPreviousEvent:function(fn,_next){this[_next?'next':'previous'].removeEvents('click');if(fn)this[_next?'next':'previous'].addEvent('click',fn);return this;},hideNext:function(){return this.hidePrevious(true);},showNext:function(){return this.showPrevious(true);},setNextEvent:function(fn){return this.setPreviousEvent(fn,true);},setColumns:function(columns,view,date,viewFx){var ret=this.parent(columns),method;if((view||this.currentView)&&(method='render'+(view||this.currentView).capitalize())&&this[method])this[method](date||this.date.clone(),viewFx);return ret;},renderYears:function(date,fx){var options=this.options,pages=options.columns,perPage=options.yearsPerPage,_columns=[],_dates=[];this.dateElements=[];date=date.clone().decrement('year',date.get('year')%perPage);var iterateDate=date.clone().decrement('year',Math.floor((pages-1)/2)*perPage);for(var i=pages;i--;){var _date=iterateDate.clone();_dates.push(_date);_columns.push(renderers.years(timesSelectors.years(options,_date.clone()),options,this.date.clone(),this.dateElements,function(date){if(options.pickOnly=='years')this.select(date);else this.renderMonths(date,'fade');this.date=date;}.bind(this)));iterateDate.increment('year',perPage);}
this.setColumnsContent(_columns,fx);this.setTitle(_dates,options.years_title);var limitLeft=(options.minDate&&date.get('year')<=options.minDate.get('year')),limitRight=(options.maxDate&&(date.get('year')+options.yearsPerPage)>=options.maxDate.get('year'));this[(limitLeft?'hide':'show')+'Previous']();this[(limitRight?'hide':'show')+'Next']();this.setPreviousEvent(function(){this.renderYears(date.decrement('year',perPage),'left');}.bind(this));this.setNextEvent(function(){this.renderYears(date.increment('year',perPage),'right');}.bind(this));this.setTitleEvent(null);this.currentView='years';},renderMonths:function(date,fx){var options=this.options,years=options.columns,_columns=[],_dates=[],iterateDate=date.clone().decrement('year',Math.floor((years-1)/2));this.dateElements=[];for(var i=years;i--;){var _date=iterateDate.clone();_dates.push(_date);_columns.push(renderers.months(timesSelectors.months(options,_date.clone()),options,this.date.clone(),this.dateElements,function(date){if(options.pickOnly=='months')this.select(date);else this.renderDays(date,'fade');this.date=date;}.bind(this)));iterateDate.increment('year',1);}
this.setColumnsContent(_columns,fx);this.setTitle(_dates,options.months_title);var year=date.get('year'),limitLeft=(options.minDate&&year<=options.minDate.get('year')),limitRight=(options.maxDate&&year>=options.maxDate.get('year'));this[(limitLeft?'hide':'show')+'Previous']();this[(limitRight?'hide':'show')+'Next']();this.setPreviousEvent(function(){this.renderMonths(date.decrement('year',years),'left');}.bind(this));this.setNextEvent(function(){this.renderMonths(date.increment('year',years),'right');}.bind(this));var canGoUp=options.yearPicker&&(options.pickOnly!='months'||options.canAlwaysGoUp.contains('months'));var titleEvent=(canGoUp)?function(){this.renderYears(date,'fade');}.bind(this):null;this.setTitleEvent(titleEvent);this.currentView='months';},renderDays:function(date,fx){var options=this.options,months=options.columns,_columns=[],_dates=[],iterateDate=date.clone().decrement('month',Math.floor((months-1)/2));this.dateElements=[];for(var i=months;i--;){_date=iterateDate.clone();_dates.push(_date);_columns.push(renderers.days(timesSelectors.days(options,_date.clone()),options,this.date.clone(),this.dateElements,function(date){if(options.pickOnly=='days'||!options.timePicker)this.select(date)
else this.renderTime(date,'fade');this.date=date;}.bind(this)));iterateDate.increment('month',1);}
this.setColumnsContent(_columns,fx);this.setTitle(_dates,options.days_title);var yearmonth=date.format('%Y%m').toInt(),limitLeft=(options.minDate&&yearmonth<=options.minDate.format('%Y%m')),limitRight=(options.maxDate&&yearmonth>=options.maxDate.format('%Y%m'));this[(limitLeft?'hide':'show')+'Previous']();this[(limitRight?'hide':'show')+'Next']();this.setPreviousEvent(function(){this.renderDays(date.decrement('month',months),'left');}.bind(this));this.setNextEvent(function(){this.renderDays(date.increment('month',months),'right');}.bind(this));var canGoUp=options.pickOnly!='days'||options.canAlwaysGoUp.contains('days');var titleEvent=(canGoUp)?function(){this.renderMonths(date,'fade');}.bind(this):null;this.setTitleEvent(titleEvent);this.currentView='days';if(this.options.fnAfterRender){this.options.fnAfterRender(date);}},renderTime:function(date,fx){var options=this.options;this.setTitle(date,options.time_title);var originalColumns=this.originalColumns=options.columns;this.currentView=null;if(originalColumns!=1)this.setColumns(1);this.setContent(renderers.time(options,date.clone(),function(date){this.select(date);}.bind(this)),fx);this.hidePrevious().hideNext().setPreviousEvent(null).setNextEvent(null);var canGoUp=options.pickOnly!='time'||options.canAlwaysGoUp.contains('time');var titleEvent=(canGoUp)?function(){this.setColumns(originalColumns,'days',date,'fade');}.bind(this):null;this.setTitleEvent(titleEvent);this.currentView='time';},select:function(date,all){this.date=date;var formatted=date.format(this.options.format),time=date.strftime(),inputs=(!this.options.updateAll&&!all&&this.input)?[this.input]:this.inputs;inputs.each(function(input){input.set('value',formatted).store('datepicker:value',time).fireEvent('change');},this);this.fireEvent('select',[date].concat(inputs));this.close();return this;}});var timesSelectors={years:function(options,date){var times=[];for(var i=0;i<options.yearsPerPage;i++){times.push(+date);date.increment('year',1);}
return times;},months:function(options,date){var times=[];date.set('month',0);for(var i=0;i<=11;i++){times.push(+date);date.increment('month',1);}
return times;},days:function(options,date){var times=[];date.set('date',1);while(date.get('day')!=options.startDay)date.set('date',date.get('date')-1);for(var i=0;i<42;i++){times.push(+date);date.increment('day',1);}
return times;}};var renderers={years:function(years,options,currentDate,dateElements,fn){var container=new Element('div.years'),today=new Date(),element,classes;years.each(function(_year,i){var date=new Date(_year),year=date.get('year');classes='.year.year'+i;if(year==today.get('year'))classes+='.today';if(year==currentDate.get('year'))classes+='.selected';element=new Element('div'+classes,{text:year}).inject(container);dateElements.push({element:element,time:_year});if(isUnavailable('year',date,options))element.addClass('unavailable');else element.addEvent('click',fn.pass(date));});return container;},months:function(months,options,currentDate,dateElements,fn){var today=new Date(),month=today.get('month'),thisyear=today.get('year'),selectedyear=currentDate.get('year'),container=new Element('div.months'),monthsAbbr=options.months_abbr||Locale.get('Date.months_abbr'),element,classes;months.each(function(_month,i){var date=new Date(_month),year=date.get('year');classes='.month.month'+(i+1);if(i==month&&year==thisyear)classes+='.today';if(i==currentDate.get('month')&&year==selectedyear)classes+='.selected';element=new Element('div'+classes,{text:monthsAbbr[i]}).inject(container);dateElements.push({element:element,time:_month});if(isUnavailable('month',date,options))element.addClass('unavailable');else element.addEvent('click',fn.pass(date));});return container;},days:function(days,options,currentDate,dateElements,fn){var month=new Date(days[14]).get('month'),todayString=new Date().toDateString(),currentString=currentDate.toDateString(),weeknumbers=options.weeknumbers,container=new Element('table.days'+(weeknumbers?'.weeknumbers':''),{role:'grid','aria-labelledby':this.titleID}),header=new Element('thead').inject(container),body=new Element('tbody').inject(container),titles=new Element('tr.titles').inject(header),localeDaysShort=options.days_abbr,day,classes,element,weekcontainer,dateString,where=options.rtl?'top':'bottom';if(weeknumbers)new Element('th.title.day.weeknumber',{text:Locale.get('DatePicker.week')}).inject(titles);for(day=options.startDay;day<(options.startDay+7);day++){new Element('th.title.day.day'+(day%7),{text:localeDaysShort[(day%7)],role:'columnheader'}).inject(titles,where);}
days.each(function(_date,i){var date=new Date(_date);if(i%7==0){weekcontainer=new Element('tr.week.week'+(Math.floor(i/7))).set('role','row').inject(body);if(weeknumbers)new Element('th.day.weeknumber',{text:date.get('week'),scope:'row',role:'rowheader'}).inject(weekcontainer);}
dateString=date.toDateString();classes='.day.ynevent-cal-day.day'+date.get('day');if(dateString==todayString)classes+='.today';if(date.get('month')!=month)classes+='.otherMonth';element=new Element('td'+classes,{text:date.getDate(),role:'gridcell'}).inject(weekcontainer,where);if(dateString==currentString)element.addClass('selected').set('aria-selected','true');else element.set('aria-selected','false');element.set('id','yndc-'+getShortDateString(date));dateElements.push({element:element,time:_date});if(isUnavailable('date',date,options))element.addClass('unavailable');else element.addEvent('click',fn.pass(date.clone()));});return container;},time:function(options,date,fn){var container=new Element('div.time'),initMinutes=(date.get('minutes')/options.timeWheelStep).round()*options.timeWheelStep
if(initMinutes>=60)initMinutes=0;date.set('minutes',initMinutes);var hoursInput=new Element('input.hour[type=text]',{title:Locale.get('DatePicker.use_mouse_wheel'),value:date.format('%H'),events:{click:function(event){event.target.focus();event.stop();},mousewheel:function(event){event.stop();hoursInput.focus();var value=hoursInput.get('value').toInt();value=(event.wheel>0)?((value<23)?value+1:0):((value>0)?value-1:23)
date.set('hours',value);hoursInput.set('value',date.format('%H'));}.bind(this)},maxlength:2}).inject(container);var minutesInput=new Element('input.minutes[type=text]',{title:Locale.get('DatePicker.use_mouse_wheel'),value:date.format('%M'),events:{click:function(event){event.target.focus();event.stop();},mousewheel:function(event){event.stop();minutesInput.focus();var value=minutesInput.get('value').toInt();value=(event.wheel>0)?((value<59)?(value+options.timeWheelStep):0):((value>0)?(value-options.timeWheelStep):(60-options.timeWheelStep));if(value>=60)value=0;date.set('minutes',value);minutesInput.set('value',date.format('%M'));}.bind(this)},maxlength:2}).inject(container);new Element('div.separator[text=:]').inject(container);new Element('input.ok[type=submit]',{value:Locale.get('DatePicker.time_confirm_button'),events:{click:function(event){event.stop();date.set({hours:hoursInput.get('value').toInt(),minutes:minutesInput.get('value').toInt()});fn(date.clone());}}}).inject(container);return container;}};Picker.Date.defineRenderer=function(name,fn){renderers[name]=fn;return this;};var limitDate=function(date,min,max){if(min&&date<min)return min;if(max&&date>max)return max;return date;};var isUnavailable=function(type,date,options){var minDate=options.minDate,maxDate=options.maxDate,availableDates=options.availableDates,year,month,day,ms;if(!minDate&&!maxDate&&!availableDates)return false;date.clearTime();if(type=='year'){year=date.get('year');return((minDate&&year<minDate.get('year'))||(maxDate&&year>maxDate.get('year'))||((availableDates!=null&&!options.invertAvailable)&&(availableDates[year]==null||Object.getLength(availableDates[year])==0||Object.getLength(Object.filter(availableDates[year],function(days){return(days.length>0);}))==0)));}
if(type=='month'){year=date.get('year');month=date.get('month')+1;ms=date.format('%Y%m').toInt();return((minDate&&ms<minDate.format('%Y%m').toInt())||(maxDate&&ms>maxDate.format('%Y%m').toInt())||((availableDates!=null&&!options.invertAvailable)&&(availableDates[year]==null||availableDates[year][month]==null||availableDates[year][month].length==0)));}
year=date.get('year');month=date.get('month')+1;day=date.get('date');var dateAllow=(minDate&&date<minDate)||(minDate&&date>maxDate);if(availableDates!=null){dateAllow=dateAllow||availableDates[year]==null||availableDates[year][month]==null||!availableDates[year][month].contains(day);if(options.invertAvailable)dateAllow=!dateAllow;}
return dateAllow;};})();;function ynvideochannelAddNewPlaylist(ele,guid,url){var nextEle=ele.getNext();if(nextEle.hasClass("ynvideochannel_active_add_playlist")){nextEle.removeClass("ynvideochannel_active_add_playlist");nextEle.setStyle("display","none");}else{nextEle.addClass("ynvideochannel_active_add_playlist");nextEle.setStyle("display","block");}
$$('.play_list_span').each(function(el){if(el===nextEle){}else{el.empty();el.setStyle("display","none");el.removeClass("ynvideochannel_active_add_playlist");}});var data=guid;var request=new Request.HTML({url:url,data:{subject:data,},onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){var spanEle=nextEle;spanEle.innerHTML=responseHTML;eval(responseJavaScript);var popup=spanEle.getParent('.ynvideochannel-action-pop-up');var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getHeight();if(p_height-y_position<(c_height+65)){layout_parent.addClass('popup-padding-bottom');var margin_bottom=parseInt(layout_parent.getStyle('padding-bottom').replace(/\D+/g,''));layout_parent.setStyle('padding-bottom',(margin_bottom+c_height+65+y_position-p_height)+'px');}}});request.send();}
function ynvideochannelAddToPlaylist(ele,playlistId,guild,url){var checked=ele.get('checked');var data=guild;var request=new Request.JSON({url:url,data:{subject:data,playlist_id:playlistId,checked:checked,},onSuccess:function(responseJSON){if(!responseJSON.status){ele.set('checked',!checked);}
var div=ele.getParent('.ynvideochannel-action-pop-up');var notices=div.getElement('.add-to-playlist-notices');var notice=new Element('div',{'class':'add-to-playlist-notice',text:responseJSON.message});notices.adopt(notice);notice.fade('in');(function(){notice.fade('out').get('tween').chain(function(){notice.destroy();});}).delay(2000,notice);}});request.send();}
function ynvideochannelAddToFavorite(ele,video_id,url,favtext,unfavtext){var popup=ele.getParent('.ynvideochannel-action-pop-up');var favorite=popup.getElement('.favorite-loading');if(favorite){favorite.show();}
var favorite_link=popup.getElement('.favorite_link');if(favorite_link){favorite_link.hide();}
var request=new Request.JSON({url:url,data:{id:video_id},onSuccess:function(responseJSON){if(favorite){favorite.hide();}
if(favorite_link){favorite_link.show();}
if(responseJSON.result){if(responseJSON.added==1){var html='<i class="fa fa-star"></i>'+' '+unfavtext;ele.innerHTML=html;}else{var html='<i class="fa fa-star-o"></i>'+' '+favtext;ele.innerHTML=html;}}
var notices=popup.getElement('.add-to-playlist-notices');var notice=new Element('div',{'class':'add-to-playlist-notice',text:responseJSON.message});notices.adopt(notice);notice.fade('in');(function(){notice.fade('out').get('tween').chain(function(){notice.destroy();});}).delay(2000,notice);}});request.send();}
window.addEvent('domready',function(){ynvideochannelAddToOptions();});(function($,$$){var events;var check=function(e){var target=$(e.target);var parents=target.getParents();events.each(function(item){var element=item.element;if(element!=target&&!parents.contains(element))
item.fn.call(element,e);});};Element.Events.outerClick={onAdd:function(fn){if(!events){document.addEvent('click',check);events=[];}
events.push({element:this,fn:fn});},onRemove:function(fn){events=events.filter(function(item){return item.element!=this||item.fn!=fn;},this);if(!events.length){document.removeEvent('click',check);events=null;}}};})(document.id,$$);function ynvideochannelAddToOptions(){$$('a.ynvideochannel-action-link.show-hide-btn').removeEvents('click').addEvent('click',function(){var parent=this.getParent('.action-container');var popup=parent.getElement('.ynvideochannel-action-pop-up');var parent_active=$$('.ynvideochannel_video-channel-playlist_options').length;$$('.action-container').each(function(el){el.removeClass("ynvideochannel-action-shown");});if(parent_active){this.getParents('.ynvideochannel_video-channel-playlist_options').toggleClass('ynvideochannel-addtoplaylist-active');}
var pageParent=popup.getParent('#global_content');var otherPopup=pageParent.getElement('.ynvideochannel_button_more_explain');if(otherPopup!=null){otherPopup.hide();}
$$('.ynvideochannel-action-pop-up').each(function(el){if(el!=popup)el.hide();});if(!popup.isDisplayed()){parent.addClass("ynvideochannel-action-shown");var loading=popup.getElement('.add-to-playlist-loading');if(loading){var url=loading.get('rel');loading.show();var checkbox=popup.getElement('.box-checkbox');checkbox.hide();var request=new Request.HTML({url:url,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){elements=Elements.from(responseHTML);if(elements.length>0){checkbox.empty();checkbox.adopt(elements);eval(responseJavaScript);loading.hide();checkbox.show();var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getHeight();if(p_height-y_position<(c_height+65)){layout_parent.addClass('popup-padding-bottom');var margin_bottom=parseInt(layout_parent.getStyle('padding-bottom').replace(/\D+/g,''));layout_parent.setStyle('padding-bottom',(margin_bottom+c_height+65+y_position-p_height)+'px');}}}});request.send();}
var favorite=popup.getElement('.favorite-loading');if(favorite){var url=favorite.get('rel');favorite.show();var favorite_link=popup.getElement('.favorite_link');favorite_link.hide();var request=new Request.HTML({url:url,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){elements=Elements.from(responseHTML);if(elements.length>0){favorite_link.empty();favorite_link.adopt(elements);eval(responseJavaScript);favorite.hide();favorite_link.show();}}});request.send();}}else{parent.removeClass("ynvideochannel-action-shown");}
popup.toggle();var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}
var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getHeight();if(popup.isDisplayed()){if(p_height-y_position<(c_height+1)){layout_parent.addClass('popup-padding-bottom');layout_parent.setStyle('padding-bottom',(c_height+1+y_position-p_height)+'px');}
else if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}}
else{if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}}});$$('.ynvideochannel-action-add-playlist').addEvent('outerClick',function(){var popup=this.getElement('.ynvideochannel-action-pop-up');var display_popup=popup.getStyle('display');var parent_popup_active=this.getParents('.ynvideochannel_video-channel-playlist_options');if(display_popup='block'){popup.setStyle('display','none');};if(this.hasClass('ynvideochannel-action-shown')){this.removeClass('ynvideochannel-action-shown');}
if(parent_popup_active.hasClass('ynvideochannel-addtoplaylist-active')){parent_popup_active.removeClass('ynvideochannel-addtoplaylist-active');}});$$('a.ynvideochannel-action-link.cancel').removeEvents('click').addEvent('click',function(){var parent=this.getParent('.ynvideochannel-action-pop-up');if(parent){parent.hide();var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}}});}
function ynvideochannelVideoOptions(){var parent_active=$$('.ynvideochannel_video-channel-playlist_options').length;$$('.ynvideochannel_video_options-btn').removeEvents('click').addEvent('click',function(){this.getParent('.ynvideochannel_video_options').toggleClass('explained');if(parent_active){this.getParents('.ynvideochannel_video-channel-playlist_options').toggleClass('ynvideochannel-options-active');}});$$('.ynvideochannel_video_options-btn').addEvent('outerClick',function(){var popup=this.getParent('.ynvideochannel_video_options');var parent_popup=this.getParents('.ynvideochannel_video-channel-playlist_options');if(popup.hasClass('explained')){popup.removeClass('explained');}
if(parent_popup.hasClass('ynvideochannel-options-active')){parent_popup.removeClass('ynvideochannel-options-active');}});}
function ynvideochannelChannelOptions(){$$('.ynvideochannel_channel_options-btn').removeEvents('click').addEvent('click',function(){var popup=this.getParent('.ynvideochannel_channel_options');popup.toggleClass('explained');var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getElement('.ynvideochannel_channel_options-block').getHeight();if(p_height-y_position<(c_height+60)){layout_parent.addClass('popup-padding-bottom');var margin_bottom=parseInt(layout_parent.getStyle('padding-bottom').replace(/\D+/g,''));layout_parent.setStyle('padding-bottom',(margin_bottom+c_height+80+y_position-p_height)+'px');}});$$('.ynvideochannel_channel_options').addEvent('outerClick',function(){var popup=this;if(popup.hasClass('explained')){popup.removeClass('explained');$$('.owl-next').setStyle('display','block');}})}
function ynvideochannelPlaylistOptions(){var parent_active=$$('.ynvideochannel_video-channel-playlist_options').length;$$('.ynvideochannel_video_options-btn').removeEvents('click').addEvent('click',function(){this.getParent('.ynvideochannel_video_options').toggleClass('explained');if(parent_active){this.getParents('.ynvideochannel_video-channel-playlist_options').toggleClass('ynvideochannel-options-active');}});$$('.ynvideochannel_video_options-btn').addEvent('outerClick',function(){var popup=this.getParent('.ynvideochannel_video_options');var parent_popup=this.getParents('.ynvideochannel_video-channel-playlist_options');if(popup.hasClass('explained')){popup.removeClass('explained');}
if(parent_popup.hasClass('ynvideochannel-options-active')){parent_popup.removeClass('ynvideochannel-options-active');}})}
;var isIphone=false;var isTierIphone=false;var isTierRichCss=false;var isTierGenericMobile=false;var engineWebKit="webkit";var deviceIphone="iphone";var deviceIpod="ipod";var deviceIpad="ipad";var deviceMacPpc="macintosh";var deviceAndroid="android";var deviceGoogleTV="googletv";var deviceNuvifone="nuvifone";var deviceSymbian="symbian";var deviceS60="series60";var deviceS70="series70";var deviceS80="series80";var deviceS90="series90";var deviceWinPhone7="windows phone os 7";var deviceWinMob="windows ce";var deviceWindows="windows";var deviceIeMob="iemobile";var devicePpc="ppc";var enginePie="wm5 pie";var deviceBB="blackberry";var vndRIM="vnd.rim";var deviceBBStorm="blackberry95";var deviceBBBold="blackberry97";var deviceBBTour="blackberry96";var deviceBBCurve="blackberry89";var deviceBBTorch="blackberry 98";var devicePalm="palm";var deviceWebOS="webos";var engineBlazer="blazer";var engineXiino="xiino";var deviceKindle="kindle";var vndwap="vnd.wap";var wml="wml";var deviceBrew="brew";var deviceDanger="danger";var deviceHiptop="hiptop";var devicePlaystation="playstation";var deviceNintendoDs="nitro";var deviceNintendo="nintendo";var deviceWii="wii";var deviceXbox="xbox";var deviceArchos="archos";var engineOpera="opera";var engineNetfront="netfront";var engineUpBrowser="up.browser";var engineOpenWeb="openweb";var deviceMidp="midp";var uplink="up.link";var engineTelecaQ='teleca q';var devicePda="pda";var mini="mini";var mobile="mobile";var mobi="mobi";var maemo="maemo";var maemoTablet="tablet";var linux="linux";var qtembedded="qt embedded";var mylocom2="com2";var manuSonyEricsson="sonyericsson";var manuericsson="ericsson";var manuSamsung1="sec-sgh";var manuSony="sony";var manuHtc="htc";var svcDocomo="docomo";var svcKddi="kddi";var svcVodafone="vodafone";var disUpdate="update";var uagent=navigator.userAgent.toLowerCase();function DetectIphone()
{if(uagent.search(deviceIphone)>-1)
{if(DetectIpad()||DetectIpod())
return false;else
return true;}
else
return false;}
function DetectIpod()
{if(uagent.search(deviceIpod)>-1)
return true;else
return false;}
function DetectIpad()
{if(uagent.search(deviceIpad)>-1&&DetectWebkit())
return true;else
return false;}
function DetectIphoneOrIpod()
{if(uagent.search(deviceIphone)>-1||uagent.search(deviceIpod)>-1)
return true;else
return false;}
function DetectAndroid()
{if(uagent.search(deviceAndroid)>-1)
return true;else
return false;}
function DetectAndroidWebKit()
{if(DetectAndroid()&&DetectWebkit())
return true;else
return false;}
function DetectGoogleTV()
{if(uagent.search(deviceGoogleTV)>-1)
return true;else
return false;}
function DetectWebkit()
{if(uagent.search(engineWebKit)>-1)
return true;else
return false;}
function DetectS60OssBrowser()
{if(DetectWebkit())
{if((uagent.search(deviceS60)>-1||uagent.search(deviceSymbian)>-1))
return true;else
return false;}
else
return false;}
function DetectSymbianOS()
{if(uagent.search(deviceSymbian)>-1||uagent.search(deviceS60)>-1||uagent.search(deviceS70)>-1||uagent.search(deviceS80)>-1||uagent.search(deviceS90)>-1)
return true;else
return false;}
function DetectWindowsPhone7()
{if(uagent.search(deviceWinPhone7)>-1)
return true;else
return false;}
function DetectWindowsMobile()
{if(DetectWindowsPhone7())
return false;if(uagent.search(deviceWinMob)>-1||uagent.search(deviceIeMob)>-1||uagent.search(enginePie)>-1)
return true;if((uagent.search(devicePpc)>-1)&&!(uagent.search(deviceMacPpc)>-1))
return true;if(uagent.search(manuHtc)>-1&&uagent.search(deviceWindows)>-1)
return true;else
return false;}
function DetectBlackBerry()
{if(uagent.search(deviceBB)>-1)
return true;if(uagent.search(vndRIM)>-1)
return true;else
return false;}
function DetectBlackBerryWebKit()
{if(uagent.search(deviceBB)>-1&&uagent.search(engineWebKit)>-1)
return true;else
return false;}
function DetectBlackBerryTouch()
{if((uagent.search(deviceBBStorm)>-1)||(uagent.search(deviceBBTorch)>-1))
return true;else
return false;}
function DetectBlackBerryHigh()
{if(DetectBlackBerryWebKit())
return false;if(DetectBlackBerry())
{if(DetectBlackBerryTouch()||uagent.search(deviceBBBold)>-1||uagent.search(deviceBBTour)>-1||uagent.search(deviceBBCurve)>-1)
return true;else
return false;}
else
return false;}
function DetectBlackBerryLow()
{if(DetectBlackBerry())
{if(DetectBlackBerryHigh())
return false;else
return true;}
else
return false;}
function DetectPalmOS()
{if(uagent.search(devicePalm)>-1||uagent.search(engineBlazer)>-1||uagent.search(engineXiino)>-1)
{if(DetectPalmWebOS())
return false;else
return true;}
else
return false;}
function DetectPalmWebOS()
{if(uagent.search(deviceWebOS)>-1)
return true;else
return false;}
function DetectGarminNuvifone()
{if(uagent.search(deviceNuvifone)>-1)
return true;else
return false;}
function DetectSmartphone()
{if(DetectIphoneOrIpod())
return true;if(DetectS60OssBrowser())
return true;if(DetectSymbianOS())
return true;if(DetectWindowsMobile())
return true;if(DetectWindowsPhone7())
return true;if(DetectAndroid())
return true;if(DetectBlackBerry())
return true;if(DetectPalmWebOS())
return true;if(DetectPalmOS())
return true;if(DetectGarminNuvifone())
return true;return false;};function DetectArchos()
{if(uagent.search(deviceArchos)>-1)
return true;else
return false;}
function DetectBrewDevice()
{if(uagent.search(deviceBrew)>-1)
return true;else
return false;}
function DetectDangerHiptop()
{if(uagent.search(deviceDanger)>-1||uagent.search(deviceHiptop)>-1)
return true;else
return false;}
function DetectMaemoTablet()
{if(uagent.search(maemo)>-1)
return true;if(uagent.search(maemoTablet)>-1&&uagent.search(linux)>-1)
return true;else
return false;}
function DetectSonyMylo()
{if(uagent.search(manuSony)>-1)
{if(uagent.search(qtembedded)>-1||uagent.search(mylocom2)>-1)
return true;else
return false;}
else
return false;}
function DetectOperaMobile()
{if(uagent.search(engineOpera)>-1)
{if(uagent.search(mini)>-1||uagent.search(mobi)>-1)
return true;else
return false;}
else
return false;}
function DetectSonyPlaystation()
{if(uagent.search(devicePlaystation)>-1)
return true;else
return false;};function DetectNintendo()
{if(uagent.search(deviceNintendo)>-1||uagent.search(deviceWii)>-1||uagent.search(deviceNintendoDs)>-1)
return true;else
return false;};function DetectXbox()
{if(uagent.search(deviceXbox)>-1)
return true;else
return false;};function DetectGameConsole()
{if(DetectSonyPlaystation())
return true;if(DetectNintendo())
return true;if(DetectXbox())
return true;else
return false;};function DetectKindle()
{if(uagent.search(deviceKindle)>-1)
return true;else
return false;}
function DetectMobileQuick()
{if(DetectIpad())
return false;if(DetectSmartphone())
return true;if(uagent.search(deviceMidp)>-1||DetectBrewDevice())
return true;if(DetectOperaMobile())
return true;if(uagent.search(engineNetfront)>-1)
return true;if(uagent.search(engineUpBrowser)>-1)
return true;if(uagent.search(engineOpenWeb)>-1)
return true;if(DetectDangerHiptop())
return true;if(DetectMaemoTablet())
return true;if(DetectArchos())
return true;if((uagent.search(devicePda)>-1)&&(uagent.search(disUpdate)<0))
return true;if(uagent.search(mobile)>-1)
return true;if(DetectKindle())
return true;return false;};function DetectMobileLong()
{if(DetectMobileQuick())
return true;if(DetectGameConsole())
return true;if(DetectSonyMylo())
return true;if(uagent.search(manuSamsung1)>-1||uagent.search(manuSonyEricsson)>-1||uagent.search(manuericsson)>-1)
return true;if(uagent.search(svcDocomo)>-1)
return true;if(uagent.search(svcKddi)>-1)
return true;if(uagent.search(svcVodafone)>-1)
return true;return false;};function DetectTierIphone()
{if(DetectIphoneOrIpod())
return true;if(DetectAndroid())
return true;if(DetectAndroidWebKit())
return true;if(DetectWindowsPhone7())
return true;if(DetectBlackBerryWebKit())
return true;if(DetectPalmWebOS())
return true;if(DetectGarminNuvifone())
return true;if(DetectMaemoTablet())
return true;else
return false;};function DetectTierRichCss()
{if(DetectMobileQuick())
{if(DetectTierIphone())
return false;if(DetectWebkit())
return true;if(DetectS60OssBrowser())
return true;if(DetectBlackBerryHigh())
return true;if(DetectWindowsMobile())
return true;if(uagent.search(engineTelecaQ)>-1)
return true;else
return false;}
else
return false;};function DetectTierOtherPhones()
{if(DetectMobileLong())
{if(DetectTierIphone())
return false;if(DetectTierRichCss())
return false;else
return true;}
else
return false;};
;(function(){var $='id'in document?document.id:window.$;Composer=new Class({Implements:[Events,Options],elements:{},plugins:{},options:{lang:{},overText:true,allowEmptyWithoutAttachment:false,allowEmptyWithAttachment:true,hideSubmitOnBlur:true,submitElement:false,useContentEditable:true},initialize:function(element,options){this.setOptions(options);this.elements=new Hash(this.elements);this.plugins=new Hash(this.plugins);this.elements.textarea=$(element);this.elements.textarea.store('Composer');this.attach();this.getTray();this.getMenu();this.pluginReady=false;this.getForm().addEvent('submit',function(e){if(this.pluginReady){if(!this.options.allowEmptyWithAttachment&&this.getContent()==''){e.stop();return;}}else{if(!this.options.allowEmptyWithoutAttachment&&this.getContent()==''){e.stop();return;}}
this.saveContent();}.bind(this));},getMenu:function(){if(!$type(this.elements.menu)){this.elements.menu=$try(function(){return $(this.options.menuElement);}.bind(this));if(!$type(this.elements.menu)){this.elements.menu=new Element('div',{'id':'compose-menu','class':'compose-menu'}).inject(this.getForm(),'after');}}
return this.elements.menu;},getTray:function(){if(!$type(this.elements.tray)){this.elements.tray=$try(function(){return $(this.options.trayElement);}.bind(this));if(!$type(this.elements.tray)){this.elements.tray=new Element('div',{'id':'compose-tray','class':'compose-tray','styles':{'display':'none'}}).inject(this.getForm(),'after');}}
return this.elements.tray;},getInputArea:function(){if(!$type(this.elements.inputarea)){var form=this.elements.textarea.getParent('form');this.elements.inputarea=new Element('div',{'styles':{'display':'none'}}).inject(form);}
return this.elements.inputarea;},getForm:function(){return this.elements.textarea.getParent('form');},attach:function(){var size=this.elements.textarea.getSize();this.elements.textarea.addClass('compose-textarea').setStyle('display','none');this.elements.container=new Element('div',{'id':'compose-container','class':'compose-container','styles':{}});this.elements.container.wraps(this.elements.textarea);var supportsContentEditable=this._supportsContentEditable();if(supportsContentEditable){this.elements.body=new Element('div',{'class':'compose-content','styles':{'display':'block'},'events':{'keypress':function(event){if(event.key=='a'&&event.control){if(Browser.Engine.gecko){fix_gecko_select_all_contenteditable_bug(this,event);}}}}}).inject(this.elements.textarea,'before');}else{this.elements.body=this.elements.textarea;}
var self=this;this.elements.body.addEvent('blur',function(e){var curVal;if(supportsContentEditable){curVal=this.get('html').replace(/\s/,'').replace(/<[^<>]+?>/ig,'');}else{curVal=this.get('value').replace(/\s/,'').replace(/<[^<>]+?>/ig,'')}
if(''==curVal){if(!Browser.Engine.trident){if(supportsContentEditable){this.set('html','<br />');}else{this.set('value','');}}
if(self.options.hideSubmitOnBlur){(function(){if(!self.hasActivePlugin()){self.getMenu().setStyle('display','none');}}).delay(250);}}});if(self.options.hideSubmitOnBlur){this.getMenu().setStyle('display','none');this.elements.body.addEvent('focus',function(e){self.getMenu().setStyle('display','');});}
if(supportsContentEditable){$(this.elements.body);this.elements.body.contentEditable=true;this.elements.body.designMode='On';['MouseUp','MouseDown','ContextMenu','Click','Dblclick','KeyPress','KeyUp','KeyDown'].each(function(eventName){var method=(this['editor'+eventName]||function(){}).bind(this);this.elements.body.addEvent(eventName.toLowerCase(),method);}.bind(this));this.setContent(this.elements.textarea.value);this.selection=new Composer.Selection(this.elements.body);}else{this.elements.textarea.setStyle('display','');}
if(this.options.overText&&supportsContentEditable){new Composer.OverText(this.elements.body,$merge({textOverride:this._lang('Post Something...'),poll:true,isPlainText:!supportsContentEditable,positionOptions:{position:(en4.orientation=='rtl'?'upperRight':'upperLeft'),edge:(en4.orientation=='rtl'?'upperRight':'upperLeft'),offset:{x:(en4.orientation=='rtl'?-4:4),y:2}}},this.options.overTextOptions));}
this.fireEvent('attach',this);},detach:function(){this.saveContent();this.textarea.setStyle('display','').removeClass('compose-textarea').inject(this.container,'before');this.container.dispose();this.fireEvent('detach',this);return this;},focus:function(){(function(){this.elements.body.focus();this.fireEvent('focus',this);}).bind(this).delay(10);return this;},getContent:function(){if(this._supportsContentEditable()){return this.cleanup(this.elements.body.get('html'));}else{return this.cleanup(this.elements.body.get('value'));}},setContent:function(newContent){if(this._supportsContentEditable()){if(!newContent.trim()&&!Browser.Engine.trident)newContent='<br />';this.elements.body.set('html',newContent);}else{this.elements.body.set('value',newContent);}
return this;},saveContent:function(){if(this._supportsContentEditable()){this.elements.textarea.set('value',this.getContent());}
return this;},cleanup:function(html){return html.replace(/<(br|p|div)[^<>]*?>/ig,"\r\n").replace(/<[^<>]+?>/ig,' ').replace(/(\r\n?|\n){3,}/ig,"\n\n").trim();},addPlugin:function(plugin){var key=plugin.getName();this.plugins.set(key,plugin);plugin.setComposer(this);return this;},addPlugins:function(plugins){plugins.each(function(plugin){this.addPlugin(plugin);}.bind(this));},getPlugin:function(name){return this.plugins.get(name);},activate:function(name){this.deactivate();this.getMenu().setStyle();this.plugins.get(name).activate();},deactivate:function(){this.plugins.each(function(plugin){plugin.deactivate();});this.getTray().empty();},signalPluginReady:function(state){this.pluginReady=state;},hasActivePlugin:function(){var active=false;this.plugins.each(function(plugin){active=active||plugin.active;});return active;},editorMouseUp:function(e){this.fireEvent('editorMouseUp',e);},editorMouseDown:function(e){this.fireEvent('editorMouseDown',e);},editorContextMenu:function(e){this.fireEvent('editorContextMenu',e);},editorClick:function(e){if(Browser.Engine.webkit){var el=e.target;if(el.get('tag')=='img'){this.selection.selectNode(el);}}
this.fireEvent('editorClick',e);},editorDoubleClick:function(e){this.fireEvent('editorDoubleClick',e);},editorKeyPress:function(e){this.keyListener(e);this.fireEvent('editorKeyPress',e);},editorKeyUp:function(e){this.fireEvent('editorKeyUp',e);},editorKeyDown:function(e){if(e.key=='enter'){}
this.fireEvent('editorKeyDown',e);},keyListener:function(e){},_lang:function(){try{if(arguments.length<1){return'';}
var string=arguments[0];if($type(this.options.lang)&&$type(this.options.lang[string])){string=this.options.lang[string];}
if(arguments.length<=1){return string;}
var args=new Array();for(var i=1,l=arguments.length;i<l;i++){args.push(arguments[i]);}
return string.vsprintf(args);}catch(e){alert(e);}},_supportsContentEditable:function(){if('useContentEditable'in this.options&&this.options.useContentEditable&&!en4.isMobile){return true;}else{return false;}}});Composer.Selection=new Class({initialize:function(win){this.win=win;},getSelection:function(){return window.getSelection();},getRange:function(){var s=this.getSelection();if(!s)return null;try{return s.rangeCount>0?s.getRangeAt(0):(s.createRange?s.createRange():null);}catch(e){return document.body.createTextRange();}},setRange:function(range){if(range.select){$try(function(){range.select();});}else{var s=this.getSelection();if(s.addRange){s.removeAllRanges();s.addRange(range);}}},selectNode:function(node,collapse){var r=this.getRange();var s=this.getSelection();if(r.moveToElementText){$try(function(){r.moveToElementText(node);r.select();});}else if(s.addRange){collapse?r.selectNodeContents(node):r.selectNode(node);s.removeAllRanges();s.addRange(r);}else{s.setBaseAndExtent(node,0,node,1);}
return node;},isCollapsed:function(){var r=this.getRange();if(r.item)return false;return r.boundingWidth==0||this.getSelection().isCollapsed;},collapse:function(toStart){var r=this.getRange();var s=this.getSelection();if(r.select){r.collapse(toStart);r.select();}else{toStart?s.collapseToStart():s.collapseToEnd();}},getContent:function(){var r=this.getRange();var body=new Element('body');if(this.isCollapsed())return'';if(r.cloneContents){body.appendChild(r.cloneContents());}else if($defined(r.item)||$defined(r.htmlText)){body.set('html',r.item?r.item(0).outerHTML:r.htmlText);}else{body.set('html',r.toString());}
var content=body.get('html');return content;},getText:function(){var r=this.getRange();var s=this.getSelection();return this.isCollapsed()?'':r.text||s.toString();},getNode:function(){var r=this.getRange();if(!Browser.Engine.trident){var el=null;if(r){el=r.commonAncestorContainer;if(!r.collapsed)
if(r.startContainer==r.endContainer)
if(r.startOffset-r.endOffset<2)
if(r.startContainer.hasChildNodes())
el=r.startContainer.childNodes[r.startOffset];while($type(el)!='element')el=el.parentNode;}
return $(el);}
return $(r.item?r.item(0):r.parentElement());},insertContent:function(content){var r=this.getRange();if(r.insertNode){r.deleteContents();r.insertNode(r.createContextualFragment(content));}else{(r.pasteHTML)?r.pasteHTML(content):r.item(0).outerHTML=content;}}});Composer.OverText=new Class({Extends:OverText,test:function(){if(!$type(this.options.isPlainText)||!this.options.isPlainText){return!this.element.get('html').replace(/\s+/,'').replace(/<br.*?>/,'');}else{return this.parent();}},hide:function(suppressFocus,force){if(this.text&&(this.text.isDisplayed()&&(!this.element.get('disabled')||force))){this.text.hide();this.fireEvent('textHide',[this.text,this.element]);this.pollingPaused=true;try{this.element.fireEvent('focus');this.element.focus();}catch(e){}}
return this;}})
Composer.Plugin={};Composer.Plugin.Interface=new Class({Implements:[Options,Events],name:'interface',active:false,composer:false,options:{loadingImage:en4.core.staticBaseUrl+'application/modules/Core/externals/images/loading.gif'},elements:{},persistentElements:['activator','loadingImage'],params:{},initialize:function(options){this.params=new Hash();this.elements=new Hash();this.reset();this.setOptions(options);},getName:function(){return this.name;},setComposer:function(composer){this.composer=composer;this.attach();return this;},getComposer:function(){if(!this.composer)throw"No composer defined";return this.composer;},attach:function(){this.reset();},detach:function(){this.reset();if(this.elements.activator){this.elements.activator.destroy();this.elements.erase('menu');}},reset:function(){this.elements.each(function(element,key){if($type(element)=='element'&&!this.persistentElements.contains(key)){element.destroy();this.elements.erase(key);}}.bind(this));this.params=new Hash();this.elements=new Hash();},activate:function(){if(this.active)return;this.active=true;this.reset();this.getComposer().getTray().setStyle('display','');this.getComposer().getMenu().setStyle('display','none');var submitButtonEl=$(this.getComposer().options.submitElement);if(submitButtonEl){submitButtonEl.setStyle('display','none');}
this.getComposer().getMenu().setStyle('border','none');this.getComposer().getMenu().getElements('.compose-activator').each(function(element){element.setStyle('display','none');});switch($type(this.options.loadingImage)){case'element':break;case'string':this.elements.loadingImage=new Asset.image(this.options.loadingImage,{'id':'compose-'+this.getName()+'-loading-image','class':'compose-loading-image'});break;default:this.elements.loadingImage=new Asset.image('loading.gif',{'id':'compose-'+this.getName()+'-loading-image','class':'compose-loading-image'});break;}},deactivate:function(){if(!this.active)return;this.active=false;this.reset();this.getComposer().getTray().setStyle('display','none');this.getComposer().getMenu().setStyle('display','');var submitButtonEl=$(this.getComposer().options.submitElement);if(submitButtonEl){submitButtonEl.setStyle('display','');}
this.getComposer().getMenu().getElements('.compose-activator').each(function(element){element.setStyle('display','');});this.getComposer().getMenu().set('style','');this.getComposer().signalPluginReady(false);},ready:function(){this.getComposer().signalPluginReady(true);this.getComposer().getMenu().setStyle('display','');var submitEl=$(this.getComposer().options.submitElement);if(submitEl){submitEl.setStyle('display','');}},makeActivator:function(){if(!this.elements.activator){this.elements.activator=new Element('a',{'id':'compose-'+this.getName()+'-activator','class':'compose-activator buttonlink','href':'javascript:void(0);','html':this._lang(this.options.title),'events':{'click':this.activate.bind(this)}}).inject(this.getComposer().getMenu());}},makeMenu:function(){if(!this.elements.menu){var tray=this.getComposer().getTray();this.elements.menu=new Element('div',{'id':'compose-'+this.getName()+'-menu','class':'compose-menu'}).inject(tray);this.elements.menuTitle=new Element('span',{'html':this._lang(this.options.title)+' ('}).inject(this.elements.menu);this.elements.menuClose=new Element('a',{'href':'javascript:void(0);','html':this._lang('cancel'),'events':{'click':function(e){e.stop();this.getComposer().deactivate();}.bind(this)}}).inject(this.elements.menuTitle);this.elements.menuTitle.appendText(')');}},makeBody:function(){if(!this.elements.body){var tray=this.getComposer().getTray();this.elements.body=new Element('div',{'id':'compose-'+this.getName()+'-body','class':'compose-body'}).inject(tray);}},makeLoading:function(action){if(!this.elements.loading){if(action=='empty'){this.elements.body.empty();}else if(action=='hide'){this.elements.body.getChildren().each(function(element){element.setStyle('display','none')});}else if(action=='invisible'){this.elements.body.getChildren().each(function(element){element.setStyle('height','0px').setStyle('visibility','hidden')});}
this.elements.loading=new Element('div',{'id':'compose-'+this.getName()+'-loading','class':'compose-loading'}).inject(this.elements.body);var image=this.elements.loadingImage||(new Element('img',{'id':'compose-'+this.getName()+'-loading-image','class':'compose-loading-image'}));image.inject(this.elements.loading);new Element('span',{'html':this._lang('Loading...')}).inject(this.elements.loading);}},makeError:function(message,action){if(!$type(action))action='empty';message=message||'An error has occurred';message=this._lang(message);this.elements.error=new Element('div',{'id':'compose-'+this.getName()+'-error','class':'compose-error','html':message}).inject(this.elements.body);},makeFormInputs:function(data){this.ready();this.getComposer().getInputArea().empty();data.type=this.getName();$H(data).each(function(value,key){this.setFormInputValue(key,value);}.bind(this));},setFormInputValue:function(key,value){var elName='attachmentForm'+key.capitalize();if(!this.elements.has(elName)){this.elements.set(elName,new Element('input',{'type':'hidden','name':'attachment['+key+']','value':value||''}).inject(this.getComposer().getInputArea()));}
this.elements.get(elName).value=value;},_lang:function(){try{if(arguments.length<1){return'';}
var string=arguments[0];if($type(this.options.lang)&&$type(this.options.lang[string])){string=this.options.lang[string];}
if(arguments.length<=1){return string;}
var args=new Array();for(var i=1,l=arguments.length;i<l;i++){args.push(arguments[i]);}
return string.vsprintf(args);}catch(e){alert(e);}}});})();;(function(){var $='id'in document?document.id:window.$;Composer.Plugin.Photo=new Class({Extends:Composer.Plugin.Interface,name:'photo',options:{title:'Add Photo',lang:{},requestOptions:false,fancyUploadEnabled:true,fancyUploadOptions:{}},initialize:function(options){this.elements=new Hash(this.elements);this.params=new Hash(this.params);this.parent(options);},attach:function(){this.parent();this.makeActivator();return this;},detach:function(){this.parent();return this;},activate:function(){if(this.active)return;this.parent();this.makeMenu();this.makeBody();var fullUrl=this.options.requestOptions.url;this.elements.form=new Element('form',{'id':'compose-photo-form','class':'compose-form','method':'post','action':fullUrl,'enctype':'multipart/form-data'}).inject(this.elements.body);this.elements.formInput=new Element('input',{'id':'compose-photo-form-input','class':'compose-form-input','type':'file','name':'Filedata','events':{'change':this.doRequest.bind(this)}}).inject(this.elements.form);if(this.options.fancyUploadEnabled&&this.options.fancyUploadOptions){this.elements.formFancyContainer=new Element('div',{'styles':{'display':'none','visibility':'hidden'}}).inject(this.elements.body);this.elements.formFancyFile=new Element('a',{'href':'javascript:void(0);','id':'compose-photo-form-fancy-file','class':'buttonlink','html':this._lang('Select File')}).inject(this.elements.formFancyContainer);this.elements.formFancyStatus=new Element('div',{'html':'<div style="display:none;">\n\
  <div class="demo-status-overall" id="demo-status-overall" style="display:none;">\n\
    <div class="overall-title"></div>\n\
    <img src="" class="progress overall-progress" />\n\
  </div>\n\
  <div class="demo-status-current" id="demo-status-current" style="display:none;">\n\
    <div class="current-title"></div>\n\
    <img src="" class="progress current-progress" />\n\
  </div>\n\
  <div class="current-text"></div>\n\
</div>'}).inject(this.elements.formFancyContainer);this.elements.formFancyList=new Element('div',{'styles':{'display':'none'}}).inject(this.elements.formFancyContainer);var self=this;var opts=$merge({policyFile:('https:'==document.location.protocol?'https://':'http://')
+document.location.host
+en4.core.baseUrl+'cross-domain',url:fullUrl,appendCookieData:true,multiple:false,typeFilter:{'Images (*.jpg, *.jpeg, *.gif, *.png)':'*.jpg; *.jpeg; *.gif; *.png'},target:this.elements.formFancyFile,container:self.elements.body,onLoad:function(){self.elements.formFancyContainer.setStyle('display','');self.elements.formFancyContainer.setStyle('visibility','visible');self.elements.form.destroy();this.target.addEvents({click:function(){return false;},mouseenter:function(){this.addClass('hover');},mouseleave:function(){this.removeClass('hover');this.blur();},mousedown:function(){this.focus();}});},onSelectSuccess:function(){self.makeLoading('invisible');this.start();},onFileSuccess:function(file,response){var json=new Hash(JSON.decode(response,true)||{});self.doProcessResponse(json);}},this.options.fancyUploadOptions);try{this.elements.formFancyUpload=new FancyUpload2(this.elements.formFancyStatus,this.elements.formFancyList,opts);}catch(e){}}},deactivate:function(){if(!this.active)return;this.parent();},doRequest:function(){this.elements.iframe=new IFrame({'name':'composePhotoFrame','src':'javascript:false;','styles':{'display':'none'},'events':{'load':function(){this.doProcessResponse(window._composePhotoResponse);window._composePhotoResponse=false;}.bind(this)}}).inject(this.elements.body);window._composePhotoResponse=false;this.elements.form.set('target','composePhotoFrame');this.elements.form.submit();this.elements.form.destroy();this.makeLoading();},doProcessResponse:function(responseJSON){if(($type(responseJSON)!='hash'&&$type(responseJSON)!='object')||$type(responseJSON.src)!='string'||$type(parseInt(responseJSON.photo_id))!='number'){this.elements.loading.destroy();this.elements.body.empty();if(responseJSON.error=='Invalid data'){this.makeError(this._lang('The image you tried to upload exceeds the maximum file size.'),'empty');}
else{this.makeError(this._lang('Unable to upload photo.'),'empty');}
return;}
this.params.set('rawParams',responseJSON);this.params.set('photo_id',responseJSON.photo_id);this.elements.preview=Asset.image(responseJSON.src,{'id':'compose-photo-preview-image','class':'compose-preview-image','onload':this.doImageLoaded.bind(this)});},doImageLoaded:function(){if($('compose-photo-error')){$('compose-photo-error').destroy();}
if(this.elements.loading)this.elements.loading.destroy();if(this.elements.formFancyContainer)this.elements.formFancyContainer.destroy();this.elements.preview.erase('width');this.elements.preview.erase('height');this.elements.preview.inject(this.elements.body);this.makeFormInputs();},makeFormInputs:function(){this.ready();this.parent({'photo_id':this.params.photo_id});}});})();;Swiff.Uploader=new Class({Extends:Swiff,Implements:Events,options:{path:'Swiff.Uploader.swf',target:null,zIndex:9999,height:30,width:100,callBacks:null,params:{wMode:'opaque',menu:'false',allowScriptAccess:'always'},typeFilter:null,multiple:true,queued:true,verbose:false,url:null,method:null,data:null,mergeData:true,fieldName:null,fileSizeMin:1,fileSizeMax:null,allowDuplicates:false,timeLimit:(Browser.Platform.linux)?0:30,buttonImage:null,policyFile:null,fileListMax:0,fileListSizeMax:0,instantStart:false,appendCookieData:false,fileClass:null},initialize:function(options){this.addEvent('load',this.initializeSwiff,true).addEvent('select',this.processFiles,true).addEvent('complete',this.update,true).addEvent('fileRemove',function(file){this.fileList.erase(file);}.bind(this),true);this.setOptions(options);if(this.options.callBacks){Hash.each(this.options.callBacks,function(fn,name){this.addEvent(name,fn);},this);}
this.options.callBacks={fireCallback:this.fireCallback.bind(this)};var path=this.options.path;if(!path.contains('?'))path+='?noCache='+$time();this.options.container=this.box=new Element('span',{'class':'swiff-uploader-box'}).inject($(this.options.container)||document.body);this.target=$(this.options.target);if(this.target){var scroll=window.getScroll();this.box.setStyles({position:'absolute',visibility:'visible',zIndex:this.options.zIndex,overflow:'hidden',height:1,width:1,top:scroll.y,left:scroll.x});this.parent(path,{params:{wMode:'transparent'},height:'100%',width:'100%'});this.target.addEvent('mouseenter',this.reposition.bind(this,[]));this.addEvents({buttonEnter:this.targetRelay.bind(this,['mouseenter']),buttonLeave:this.targetRelay.bind(this,['mouseleave']),buttonDown:this.targetRelay.bind(this,['mousedown']),buttonDisable:this.targetRelay.bind(this,['disable'])});this.reposition();window.addEvent('resize',this.reposition.bind(this,[]));}else{this.parent(path);}
this.inject(this.box);this.fileList=[];this.size=this.uploading=this.bytesLoaded=this.percentLoaded=0;if(Browser.Plugins.Flash.version<9){this.fireEvent('fail',['flash']);}else{this.verifyLoad.delay(1000,this);}},verifyLoad:function(){if(this.loaded)return;if(!this.object.parentNode){this.fireEvent('fail',['disabled']);}else if(this.object.style.display=='none'){this.fireEvent('fail',['hidden']);}else if(!this.object.offsetWidth){this.fireEvent('fail',['empty']);}},fireCallback:function(name,args){if(name.substr(0,4)=='file'){if(args.length>1)this.update(args[1]);var data=args[0];var file=this.findFile(data.id);this.fireEvent(name,file||data,5);if(file){var fire=name.replace(/^file([A-Z])/,function($0,$1){return $1.toLowerCase();});file.update(data).fireEvent(fire,[data],10);}}else{this.fireEvent(name,args,5);}},update:function(data){$extend(this,data);this.fireEvent('queue',[this],10);return this;},findFile:function(id){for(var i=0;i<this.fileList.length;i++){if(this.fileList[i].id==id)return this.fileList[i];}
return null;},initializeSwiff:function(){this.remote('initialize',{width:this.options.width,height:this.options.height,typeFilter:this.options.typeFilter,multiple:this.options.multiple,queued:this.options.queued,url:this.options.url,method:this.options.method,data:this.options.data,mergeData:this.options.mergeData,fieldName:this.options.fieldName,verbose:this.options.verbose,fileSizeMin:this.options.fileSizeMin,fileSizeMax:this.options.fileSizeMax,allowDuplicates:this.options.allowDuplicates,timeLimit:this.options.timeLimit,buttonImage:this.options.buttonImage,policyFile:this.options.policyFile});this.loaded=true;this.appendCookieData();},targetRelay:function(name){if(this.target)this.target.fireEvent(name);},reposition:function(coords){if($type(coords)=='array'&&coords.length==0){coords=null;}
coords=coords||((this.target&&this.target.offsetHeight)?this.target.getCoordinates():{top:window.getScrollTop(),left:0,width:40,height:40})
if('right'in coords&&(Browser.Engine.webkit||Browser.Engine.trident)&&$try(function(){return $$('html')[0].get('dir')=='rtl'})){coords.right=$$('body')[0].getComputedSize().x-coords.right;}
this.box.setStyles(coords);this.fireEvent('reposition',[coords,this.box,this.target]);},setOptions:function(options){if(options){if(options.url)options.url=Swiff.Uploader.qualifyPath(options.url);if(options.buttonImage)options.buttonImage=Swiff.Uploader.qualifyPath(options.buttonImage);this.parent(options);if(this.loaded)this.remote('setOptions',options);}
return this;},setEnabled:function(status){this.remote('setEnabled',status);},start:function(){this.fireEvent('beforeStart');this.remote('UploadStart');},stop:function(){this.fireEvent('beforeStop');this.remote('UploadStop');},remove:function(){this.fireEvent('beforeRemove');this.remote('remove');},fileStart:function(file){this.remote('fileStart',file.id);},fileStop:function(file){this.remote('fileStop',file.id);},fileRemove:function(file){this.remote('fileRemove',file.id);},fileRequeue:function(file){this.remote('fileRequeue',file.id);},appendCookieData:function(){var append=this.options.appendCookieData;if(!append)return;var hash={};document.cookie.split(/;\s*/).each(function(cookie){cookie=cookie.split('=');if(cookie.length==2){hash[decodeURIComponent(cookie[0])]=decodeURIComponent(cookie[1]);}});var data=this.options.data||{};if($type(append)=='string')data[append]=hash;else $extend(data,hash);this.setOptions({data:data});},processFiles:function(successraw,failraw,queue){var cls=this.options.fileClass||Swiff.Uploader.File;var fail=[],success=[];if(successraw){successraw.each(function(data){var ret=new cls(this,data);if(!ret.validate()){ret.remove.delay(10,ret);fail.push(ret);}else{this.size+=data.size;this.fileList.push(ret);success.push(ret);ret.render();}},this);this.fireEvent('selectSuccess',[success],10);}
if(failraw||fail.length){fail.extend((failraw)?failraw.map(function(data){return new cls(this,data);},this):[]).each(function(file){file.invalidate().render();});this.fireEvent('selectFail',[fail],10);}
this.update(queue);if(this.options.instantStart&&success.length)this.start();}});$extend(Swiff.Uploader,{STATUS_QUEUED:0,STATUS_RUNNING:1,STATUS_ERROR:2,STATUS_COMPLETE:3,STATUS_STOPPED:4,log:function(){if(window.console&&console.info)console.info.apply(console,arguments);},unitLabels:{b:[{min:1,unit:'B'},{min:1024,unit:'kB'},{min:1048576,unit:'MB'},{min:1073741824,unit:'GB'}],s:[{min:1,unit:'s'},{min:60,unit:'m'},{min:3600,unit:'h'},{min:86400,unit:'d'}]},formatUnit:function(base,type,join){var labels=Swiff.Uploader.unitLabels[(type=='bps')?'b':type];var append=(type=='bps')?'/s':'';var i,l=labels.length,value;if(base<1)return'0 '+labels[0].unit+append;if(type=='s'){var units=[];for(i=l-1;i>=0;i--){value=Math.floor(base/labels[i].min);if(value){units.push(value+' '+labels[i].unit);base-=value*labels[i].min;if(!base)break;}}
return(join===false)?units:units.join(join||', ');}
for(i=l-1;i>=0;i--){value=labels[i].min;if(base>=value)break;}
return(base/value).toFixed(1)+' '+labels[i].unit+append;}});Swiff.Uploader.qualifyPath=(function(){var anchor;return function(path){(anchor||(anchor=new Element('a'))).href=path;return anchor.href;};})();Swiff.Uploader.File=new Class({Implements:Events,initialize:function(base,data){this.base=base;this.update(data);},update:function(data){return $extend(this,data);},validate:function(){var options=this.base.options;if(options.fileListMax&&this.base.fileList.length>=options.fileListMax){this.validationError='fileListMax';return false;}
if(options.fileListSizeMax&&(this.base.size+this.size)>options.fileListSizeMax){this.validationError='fileListSizeMax';return false;}
return true;},invalidate:function(){this.invalid=true;this.base.fireEvent('fileInvalid',this,10);return this.fireEvent('invalid',this,10);},render:function(){return this;},setOptions:function(options){if(options){if(options.url)options.url=Swiff.Uploader.qualifyPath(options.url);this.base.remote('fileSetOptions',this.id,options);this.options=$merge(this.options,options);}
return this;},start:function(){this.base.fileStart(this);return this;},stop:function(){this.base.fileStop(this);return this;},remove:function(){this.base.fileRemove(this);return this;},requeue:function(){this.base.fileRequeue(this);}});;Fx.ProgressBar=new Class({Extends:Fx,options:{text:null,url:null,transition:Fx.Transitions.Circ.easeOut,fit:true,link:'cancel'},initialize:function(element,options){this.element=$(element);this.parent(options);var url=this.options.url;if(url){this.element.setStyles({'background-image':'url('+url+')','background-repeat':'no-repeat'});}
if(this.options.fit){url=url||this.element.getStyle('background-image').replace(/^url\(["']?|["']?\)$/g,'');if(url){var fill=new Image();fill.onload=function(){this.fill=fill.width;fill=fill.onload=null;this.set(this.now||0);}.bind(this);fill.src=url;if(!this.fill&&fill.width)fill.onload();}}else{this.set(0);}},start:function(to,total){return this.parent(this.now,(arguments.length==1)?to.limit(0,100):to/total*100);},set:function(to){this.now=to;var css=(this.fill)?(((this.fill/-2)+(to/100)*(this.element.width||1)||0).round()+'px'):((100-to)+'%');this.element.setStyle('backgroundPosition',css+' 0px').title=Math.round(to)+'%';var text=$(this.options.text);if(text)text.set('text',Math.round(to)+'%');return this;}});;var FancyUpload2=new Class({Extends:Swiff.Uploader,options:{queued:1,limitSize:0,limitFiles:0,validateFile:$lambda(true)},initialize:function(status,list,options){this.status=$(status);this.list=$(list);options.fileClass=options.fileClass||FancyUpload2.File;options.fileSizeMax=options.limitSize||options.fileSizeMax;options.fileListMax=options.limitFiles||options.fileListMax;this.parent(options);this.addEvents({'load':this.render,'select':this.onSelect,'cancel':this.onCancel,'start':this.onStart,'queue':this.onQueue,'complete':this.onComplete});},render:function(){this.overallTitle=this.status.getElement('.overall-title');this.currentTitle=this.status.getElement('.current-title');this.currentText=this.status.getElement('.current-text');var progress=this.status.getElement('.overall-progress');this.overallProgress=new Fx.ProgressBar(progress,{text:new Element('span',{'class':'progress-text'}).inject(progress,'after')});progress=this.status.getElement('.current-progress')
this.currentProgress=new Fx.ProgressBar(progress,{text:new Element('span',{'class':'progress-text'}).inject(progress,'after')});this.updateOverall();},onSelect:function(){this.status.removeClass('status-browsing');},onCancel:function(){this.status.removeClass('file-browsing');},onStart:function(){this.status.addClass('file-uploading');this.overallProgress.set(0);},onQueue:function(){this.updateOverall();},onComplete:function(){this.status.removeClass('file-uploading');if(this.size){this.overallProgress.start(100);}else{this.overallProgress.set(0);this.currentProgress.set(0);}},updateOverall:function(){this.overallTitle.set('html',MooTools.lang.get('FancyUpload','progressOverall').substitute({total:Swiff.Uploader.formatUnit(this.size,'b')}));if(!this.size){this.currentTitle.set('html',MooTools.lang.get('FancyUpload','currentTitle'));this.currentText.set('html','');}},upload:function(){this.start();},removeFile:function(){return this.remove();}});FancyUpload2.File=new Class({Extends:Swiff.Uploader.File,render:function(){if(this.invalid){if(this.validationError){var msg=MooTools.lang.get('FancyUpload','validationErrors')[this.validationError]||this.validationError;this.validationErrorMessage=msg.substitute({name:this.name,size:Swiff.Uploader.formatUnit(this.size,'b'),fileSizeMin:Swiff.Uploader.formatUnit(this.base.options.fileSizeMin||0,'b'),fileSizeMax:Swiff.Uploader.formatUnit(this.base.options.fileSizeMax||0,'b'),fileListMax:this.base.options.fileListMax||0,fileListSizeMax:Swiff.Uploader.formatUnit(this.base.options.fileListSizeMax||0,'b')});}
this.remove();return;}
this.addEvents({'start':this.onStart,'progress':this.onProgress,'complete':this.onComplete,'error':this.onError,'remove':this.onRemove});this.info=new Element('span',{'class':'file-info'});this.element=new Element('li',{'class':'file'}).adopt(new Element('span',{'class':'file-size','html':Swiff.Uploader.formatUnit(this.size,'b')}),new Element('a',{'class':'file-remove',href:'#',html:MooTools.lang.get('FancyUpload','remove'),title:MooTools.lang.get('FancyUpload','removeTitle'),events:{click:function(){this.remove();return false;}.bind(this)}}),new Element('span',{'class':'file-name','html':MooTools.lang.get('FancyUpload','fileName').substitute(this)}),this.info).inject(this.base.list);},validate:function(){return(this.parent()&&this.base.options.validateFile(this));},onStart:function(){this.element.addClass('file-uploading');this.base.currentProgress.cancel().set(0);this.base.currentTitle.set('html',MooTools.lang.get('FancyUpload','currentFile').substitute(this));},onProgress:function(){this.base.overallProgress.start(this.base.percentLoaded);this.base.currentText.set('html',MooTools.lang.get('FancyUpload','currentProgress').substitute({rate:(this.progress.rate)?Swiff.Uploader.formatUnit(this.progress.rate,'bps'):'- B',bytesLoaded:Swiff.Uploader.formatUnit(this.progress.bytesLoaded,'b'),timeRemaining:(this.progress.timeRemaining)?Swiff.Uploader.formatUnit(this.progress.timeRemaining,'s'):'-'}));this.base.currentProgress.start(this.progress.percentLoaded);},onComplete:function(){this.element.removeClass('file-uploading');this.base.currentText.set('html','Upload completed');this.base.currentProgress.start(100);if(this.response.error){var msg=MooTools.lang.get('FancyUpload','errors')[this.response.error]||'{error} #{code}';this.errorMessage=msg.substitute($extend({name:this.name,size:Swiff.Uploader.formatUnit(this.size,'b')},this.response));var args=[this,this.errorMessage,this.response];this.fireEvent('error',args).base.fireEvent('fileError',args);}else{this.base.fireEvent('fileSuccess',[this,this.response.text||'']);}},onError:function(){this.element.addClass('file-failed');var error=MooTools.lang.get('FancyUpload','fileError').substitute(this);this.info.set('html','<strong>'+error+':</strong> '+this.errorMessage);},onRemove:function(){this.element.getElements('a').setStyle('visibility','hidden');this.element.fade('out').retrieve('tween').chain(Element.destroy.bind(Element,this.element));}});(function(){var phrases={'progressOverall':'Overall Progress ({total})','currentTitle':'File Progress','currentFile':'Uploading "{name}"','currentProgress':'Upload: {bytesLoaded} with {rate}, {timeRemaining} remaining.','fileName':'{name}','remove':'Remove','removeTitle':'Click to remove this entry.','fileError':'Upload failed','validationErrors':{'duplicate':'{name} already added.','sizeLimitMin':'{name} ({size}) is too small, the minimal file size is {fileSizeMin}.','sizeLimitMax':'{name} ({size}) is too big, the maximal file size is {fileSizeMax}.','fileListMax':'{name} could not be added, amount of {fileListMax} files exceeded.','fileListSizeMax':'{name} ({size}) is too big, overall filesize of {fileListSizeMax} exceeded.'},'errors':{'httpStatus':'Server returned HTTP-Status <code>#{code}</code>','securityError':'Security error occurred ({text})','ioError':'Error caused a send or load operation to fail ({text})'}};if(('en4'in window)&&$type(en4)&&$type(en4.core.language)){$H(phrases).each(function(value,key){if($type(value)=='string'){phrases[key]=en4.core.language.translate(value);}else if($type(value)=='object'){$H(value).each(function(pvalue,pkey){if($type(value)=='string'){phrases[key][pkey]=en4.core.language.translate(pvalue);}});}});}
if(MooTools.lang){MooTools.lang.set('en-US','FancyUpload',phrases);}else{MooTools.lang={data:{'FancyUpload':phrases},get:function(from,key){return this.data[from][key];},set:function(locale,from,data){data[from]=data;}};}})();;(function(){var $='id'in document?document.id:window.$;Composer.Plugin.Link=new Class({Extends:Composer.Plugin.Interface,name:'link',options:{title:'Add Link',lang:{},requestOptions:{},imageMaxAspect:(10/3),imageMinAspect:(3/10),imageMinSize:48,imageMaxSize:5000,imageMinPixels:2304,imageMaxPixels:1000000,imageTimeout:5000,monitorDelay:600,debug:false},initialize:function(options){this.params=new Hash(this.params);this.parent(options);},attach:function(){this.parent();this.makeActivator();this.monitorLastContent='';this.monitorLastMatch='';this.monitorLastKeyPress=$time();this.getComposer().addEvent('editorKeyPress',function(){this.monitorLastKeyPress=$time();}.bind(this));return this;},detach:function(){this.parent();if(this.interval)$clear(this.interval);return this;},activate:function(){if(this.active)return;this.parent();this.makeMenu();this.makeBody();this.elements.formInput=new Element('input',{'id':'compose-link-form-input','class':'compose-form-input','type':'text'}).inject(this.elements.body);this.elements.formSubmit=new Element('button',{'id':'compose-link-form-submit','class':'compose-form-submit','html':this._lang('Attach'),'events':{'click':function(e){e.stop();this.doAttach();}.bind(this)}}).inject(this.elements.body);this.elements.formInput.focus();},deactivate:function(){if(!this.active)return;this.parent();this.request=false;},poll:function(){if(this.getComposer().hasActivePlugin())return;if($time()<this.monitorLastKeyPress+this.options.monitorDelay)return;var content=this.getComposer().getContent();if(content==this.monitorLastContent)return;this.monitorLastContent=content;var m=content.match(/http:\/\/([-\w\.]+)+(:\d+)?(\/([-#:\w/_\.]*(\?\S+)?)?)?/);if($type(m)&&$type(m[0])&&this.monitorLastMatch!=m[0])
{this.monitorLastMatch=m[0];this.activate();this.elements.formInput.value=this.monitorLastMatch;this.doAttach();}},doAttach:function(){var val=this.elements.formInput.value;if(!val){return;}
if(!val.match(/^[a-zA-Z]{1,5}:\/\//))
{val='http://'+val;}
this.params.set('uri',val)
if(val==''){e.stop();return;}
var options=$merge({'data':{'format':'json','uri':val},'onComplete':this.doProcessResponse.bind(this)},this.options.requestOptions);this.makeLoading('empty');this.request=new Request.JSON(options);this.request.send();},doProcessResponse:function(responseJSON,responseText){if($type(responseJSON)!='object'){responseJSON={'status':false};}
this.params.set('uri',responseJSON.url);var uristr=responseJSON.url;if(uristr.substr(0,23)=='https://docs.google.com'){var title=uristr;var description='Google Document';}else{var title=responseJSON.title||responseJSON.url;var description=responseJSON.description||responseJSON.title||responseJSON.url;}
var images=responseJSON.images||[];this.params.set('title',title);this.params.set('description',description);this.params.set('images',images);this.params.set('loadedImages',[]);this.params.set('thumb','');if(images.length>0){this.doLoadImages();}else{this.doShowPreview();}},doLoadImages:function(){var interval=(function(){if(this.options.debug){console.log('Timeout reached');}
this.doShowPreview();}).delay(this.options.imageTimeout,this);this.params.loadedImages=[];this.params.set('assets',new Asset.images(this.params.get('images'),{'properties':{'class':'compose-link-image'},'onProgress':function(counter,index){this.params.loadedImages[index]=this.params.images[index];if(this.options.debug){console.log('Loaded - ',this.params.images[index]);}}.bind(this),'onError':function(counter,index){delete this.params.images[index];}.bind(this),'onComplete':function(){$clear(interval);this.doShowPreview();}.bind(this)}));},doShowPreview:function(){var self=this;this.elements.body.empty();this.makeFormInputs();if(this.params.loadedImages.length>0){var tmp=new Array();this.elements.previewImages=new Element('div',{'id':'compose-link-preview-images','class':'compose-preview-images'}).inject(this.elements.body);this.params.assets.each(function(element,index){if(!$type(this.params.loadedImages[index]))return;element.addClass('compose-preview-image-invisible').inject(this.elements.previewImages);if(!this.checkImageValid(element)){delete this.params.images[index];delete this.params.loadedImages[index];element.destroy();}else{element.removeClass('compose-preview-image-invisible').addClass('compose-preview-image-hidden');tmp.push(this.params.loadedImages[index]);element.erase('height');element.erase('width');}}.bind(this));this.params.loadedImages=tmp;if(this.params.loadedImages.length<=0){this.elements.previewImages.destroy();}}
this.elements.previewInfo=new Element('div',{'id':'compose-link-preview-info','class':'compose-preview-info'}).inject(this.elements.body);this.elements.previewTitle=new Element('div',{'id':'compose-link-preview-title','class':'compose-preview-title'}).inject(this.elements.previewInfo);this.elements.previewTitleLink=new Element('a',{'href':this.params.uri,'html':this.params.title,'events':{'click':function(e){e.stop();self.handleEditTitle(this);}}}).inject(this.elements.previewTitle);this.elements.previewDescription=new Element('div',{'id':'compose-link-preview-description','class':'compose-preview-description','html':this.params.description,'events':{'click':function(e){e.stop();self.handleEditDescription(this);}}}).inject(this.elements.previewInfo);if(this.params.loadedImages.length>0){this.elements.previewOptions=new Element('div',{'id':'compose-link-preview-options','class':'compose-preview-options'}).inject(this.elements.previewInfo);if(this.params.loadedImages.length>1){this.elements.previewChoose=new Element('div',{'id':'compose-link-preview-options-choose','class':'compose-preview-options-choose','html':'<span>'+this._lang('Choose Image:')+'</span>'}).inject(this.elements.previewOptions);this.elements.previewPrevious=new Element('a',{'id':'compose-link-preview-options-previous','class':'compose-preview-options-previous','href':'javascript:void(0);','html':'&#171; '+this._lang('Last'),'events':{'click':this.doSelectImagePrevious.bind(this)}}).inject(this.elements.previewChoose);this.elements.previewCount=new Element('span',{'id':'compose-link-preview-options-count','class':'compose-preview-options-count'}).inject(this.elements.previewChoose);this.elements.previewPrevious=new Element('a',{'id':'compose-link-preview-options-next','class':'compose-preview-options-next','href':'javascript:void(0);','html':this._lang('Next')+' &#187;','events':{'click':this.doSelectImageNext.bind(this)}}).inject(this.elements.previewChoose);}
this.elements.previewNoImage=new Element('div',{'id':'compose-link-preview-options-none','class':'compose-preview-options-none'}).inject(this.elements.previewOptions);this.elements.previewNoImageInput=new Element('input',{'id':'compose-link-preview-options-none-input','class':'compose-preview-options-none-input','type':'checkbox','events':{'click':this.doToggleNoImage.bind(this)}}).inject(this.elements.previewNoImage);this.elements.previewNoImageLabel=new Element('label',{'for':'compose-link-preview-options-none-input','html':this._lang('Don\'t show an image'),'events':{}}).inject(this.elements.previewNoImage);this.setImageThumb(this.elements.previewImages.getChildren()[0]);}},checkImageValid:function(element){var size=element.getSize();var sizeAlt={x:element.get('width'),y:element.get('height')};var width=sizeAlt.x||size.x;var height=sizeAlt.y||size.y;var pixels=width*height;var aspect=width/height;if(this.options.debug){console.log(element.get('src'),sizeAlt,size,width,height,pixels,aspect);}
if(aspect>this.options.imageMaxAspect){if(this.options.debug){console.log('Aspect greater than max - ',element.get('src'),aspect,this.options.imageMaxAspect);}
return false;}else if(aspect<this.options.imageMinAspect){if(this.options.debug){console.log('Aspect less than min - ',element.get('src'),aspect,this.options.imageMinAspect);}
return false;}
if(width<this.options.imageMinSize){if(this.options.debug){console.log('Width less than min - ',element.get('src'),width,this.options.imageMinSize);}
return false;}else if(height<this.options.imageMinSize){if(this.options.debug){console.log('Height less than min - ',element.get('src'),height,this.options.imageMinSize);}
return false;}
if(width>this.options.imageMaxSize){if(this.options.debug){console.log('Width greater than max - ',element.get('src'),width,this.options.imageMaxSize);}
return false;}else if(height>this.options.imageMaxSize){if(this.options.debug){console.log('Height greater than max - ',element.get('src'),height,this.options.imageMaxSize);}
return false;}
if(pixels<this.options.imageMinPixels){if(this.options.debug){console.log('Pixel count less than min - ',element.get('src'),pixels,this.options.imageMinPixels);}
return false;}else if(pixels>this.options.imageMaxPixels){if(this.options.debug){console.log('Pixel count greater than max - ',element.get('src'),pixels,this.options.imageMaxPixels);}
return false;}
return true;},doSelectImagePrevious:function(){if(this.elements.imageThumb&&this.elements.imageThumb.getPrevious()){this.setImageThumb(this.elements.imageThumb.getPrevious());}},doSelectImageNext:function(){if(this.elements.imageThumb&&this.elements.imageThumb.getNext()){this.setImageThumb(this.elements.imageThumb.getNext());}},doToggleNoImage:function(){if(!$type(this.params.thumb)){this.params.thumb=this.elements.imageThumb.src;this.setFormInputValue('thumb',this.params.thumb);this.elements.previewImages.setStyle('display','');if(this.elements.previewChoose)this.elements.previewChoose.setStyle('display','');}else{delete this.params.thumb;this.setFormInputValue('thumb','');this.elements.previewImages.setStyle('display','none');if(this.elements.previewChoose)this.elements.previewChoose.setStyle('display','none');}},setImageThumb:function(element){if(this.elements.imageThumb){this.elements.imageThumb.addClass('compose-preview-image-hidden');}
if(element){element.removeClass('compose-preview-image-hidden');this.elements.imageThumb=element;this.params.thumb=element.src;this.setFormInputValue('thumb',element.src);if(this.elements.previewCount){var index=this.params.loadedImages.indexOf(element.src);if(index<0){index=0;}
this.elements.previewCount.set('html',' | '+this._lang('%d of %d',index+1,this.params.loadedImages.length)+' | ');}}else{this.elements.imageThumb=false;delete this.params.thumb;}},makeFormInputs:function(){this.ready();this.parent({'uri':this.params.uri,'title':this.params.title,'description':this.params.description,'thumb':this.params.thumb});},handleEditTitle:function(element){element.setStyle('display','none');var input=new Element('input',{'type':'text','value':element.get('text').trim(),'events':{'blur':function(){if(input.value.trim()!=''){this.params.title=input.value;element.set('text',this.params.title);this.setFormInputValue('title',this.params.title);}
element.setStyle('display','');input.destroy();}.bind(this)}}).inject(element,'after');input.focus();},handleEditDescription:function(element){element.setStyle('display','none');var input=new Element('textarea',{'html':element.get('text').trim(),'events':{'blur':function(){if(input.value.trim()!=''){this.params.description=input.value;element.set('text',this.params.description);this.setFormInputValue('description',this.params.description);}
element.setStyle('display','');input.destroy();}.bind(this)}}).inject(element,'after');input.focus();}});})();;var Observer=new Class({Implements:[Options,Events],options:{periodical:false,delay:1000},initialize:function(el,onFired,options){this.element=$(el)||$$(el);this.addEvent('onFired',onFired);this.setOptions(options);this.bound=this.changed.bind(this);this.resume();},changed:function(){var value=this.element.get('value');if($equals(this.value,value))return;this.clear();this.value=value;this.timeout=this.onFired.delay(this.options.delay,this);},setValue:function(value){this.value=value;this.element.set('value',value);return this.clear();},onFired:function(){this.fireEvent('onFired',[this.value,this.element]);},clear:function(){$clear(this.timeout||null);return this;},pause:function(){if(this.timer)$clear(this.timer);else this.element.removeEvent('keyup',this.bound);return this.clear();},resume:function(){this.value=this.element.get('value');if(this.options.periodical)this.timer=this.changed.periodical(this.options.periodical,this);else this.element.addEvent('keyup',this.bound);return this;}});var $equals=function(obj1,obj2){return(obj1==obj2||JSON.encode(obj1)==JSON.encode(obj2));};;var Autocompleter=new Class({Implements:[Options,Events],options:{minLength:1,markQuery:true,width:'inherit',maxChoices:10,injectChoice:null,customChoices:null,emptyChoices:null,visibleChoices:true,className:'autocompleter-choices',zIndex:42,delay:1,observerOptions:{},fxOptions:{},autoSubmit:false,overflow:false,overflowMargin:25,selectFirst:true,filter:null,filterCase:false,filterSubset:false,forceSelect:false,selectMode:true,choicesMatch:null,multiple:false,separator:', ',separatorSplit:/\s*[,;]\s*/,autoTrim:false,allowDupes:false,cache:true,relative:true,tokenFormat:'object',tokenIdKey:'id',tokenValueKey:'label',prefetchOnInit:false,alwaysOpen:false,ignoreKeys:false,ignoreOverlayFix:false},initialize:function(element,options){this.element=$(element);this.setOptions(options);this.build();this.observer=new Observer(this.element,this.prefetch.bind(this),$merge({'delay':this.options.delay},this.options.observerOptions));this.queryValue=null;if(this.options.filter)this.filter=this.options.filter.bind(this);var mode=this.options.selectMode;this.typeAhead=(mode=='type-ahead');this.selectMode=(mode===true)?'selection':mode;this.cached=[];if(this.options.prefetchOnInit)this.prefetch.delay(this.options.delay+50,this);},build:function(){if($(this.options.customChoices)){this.choices=this.options.customChoices;}else{this.choices=new Element('ul',{'class':this.options.className,'styles':{'zIndex':this.options.zIndex}}).inject(document.body);this.relative=false;if(this.options.relative){this.choices.inject(this.element,'after');this.relative=this.element.getOffsetParent();}
if(!this.options.ignoreOverlayFix)this.fix=new OverlayFix(this.choices);}
if(!this.options.separator.test(this.options.separatorSplit)){this.options.separatorSplit=this.options.separator;}
if(!this.options.alwaysOpen){this.fx=(!this.options.fxOptions)?null:new Fx.Tween(this.choices,$merge({'property':'opacity','link':'cancel','duration':200},this.options.fxOptions)).addEvent('onStart',Chain.prototype.clearChain).set(0);}
this.element.setProperty('autocomplete','off').addEvent((Browser.Engine.trident||Browser.Engine.webkit)?'keydown':'keypress',this.onCommand.bind(this)).addEvent('click',this.onCommand.bind(this,[false]));if(!this.options.alwaysOpen){this.element.addEvent('focus',this.toggleFocus.create({bind:this,arguments:true,delay:100})).addEvent('blur',this.toggleFocus.create({bind:this,arguments:false,delay:100}));}},destroy:function(){if(this.fix)this.fix.destroy();this.choices=this.selected=this.choices.destroy();},toggleFocus:function(state){this.focussed=state;if(!state)this.hideChoices(true);this.fireEvent((state)?'onFocus':'onBlur',[this.element]);},onCommand:function(e){if(!e&&this.focussed)return this.prefetch();if(e&&e.key&&!e.shift&&!this.options.ignoreKeys){switch(e.key){case'enter':e.stop();if(!this.selected){if(!this.options.customChoices){this.element.value='';}
return true;}
if(this.selected&&this.visible){this.choiceSelect(this.selected);return!!(this.options.autoSubmit);}
break;case'up':case'down':var value=this.element.value;if(!this.prefetch()&&this.queryValue!==null){var up=(e.key=='up');this.choiceOver((this.selected||this.choices)[(this.selected)?((up)?'getPrevious':'getNext'):((up)?'getLast':'getFirst')](this.options.choicesMatch),true);this.element.value=value;}
return false;case'esc':this.hideChoices(true);if(!this.options.customChoices)this.element.value='';break;case'tab':if(this.selected&&this.visible){this.choiceSelect(this.selected);return!!(this.options.autoSubmit);}else{this.hideChoices(true);if(!this.options.customChoices)this.element.value='';break;}}}
this.fireEvent('onCommand',e);return true;},setSelection:function(finish){var tokenInfo=this.selected.retrieve('autocompleteChoice');var input=(this.options.tokenFormat=='object'?tokenInfo[this.options.tokenValueKey]:tokenInfo);var value=input;var start=this.queryValue.length,end=input.length;if((input.substr(0,start)||'').toLowerCase()!=(this.queryValue||'').toLowerCase())start=0;if(this.options.multiple){var split=this.options.separatorSplit;value=this.element.value;start+=this.queryIndex;end+=this.queryIndex;var old=value.substr(this.queryIndex).split(split,1)[0];value=value.substr(0,this.queryIndex)+input+value.substr(this.queryIndex+old.length);if(finish){var tokens=value.split(this.options.separatorSplit).filter(function(entry){return this.test(entry);},/[^\s,]+/);if(!this.options.allowDupes)tokens=[].combine(tokens);var sep=this.options.separator;value=tokens.join(sep)+sep;end=value.length;}}
if(this.options.autocompleteType=='tag')this.observer.setValue(value);this.opted=value;if(finish||this.selectMode=='pick')start=end;$try(function(){this.element.selectRange(start,end)}.bind(this));this.fireEvent('onSelection',[this.element,this.selected,value,input]);},showChoices:function(){var match=this.options.choicesMatch,first=this.choices.getFirst(match);this.selected=this.selectedValue=null;if(this.fix){var pos=this.element.getCoordinates(this.relative),width=this.options.width||'auto';this.choices.setStyles({'width':(width===true||width=='inherit')?pos.width:width});}
if(!first)return;if(!this.visible){this.visible=true;this.choices.setStyle('display','');if(this.fx)this.fx.start(1);this.fireEvent('onShow',[this.element,this.choices]);}
if(this.options.selectFirst||this.typeAhead||first.inputValue==this.queryValue)this.choiceOver(first,this.typeAhead);var items=this.choices.getChildren(match),max=this.options.maxChoices;var styles={'overflowY':'hidden','height':''};this.overflown=false;if(items.length>max){var item=items[max-1];styles.overflowY='scroll';styles.height=item.getCoordinates(this.choices).bottom;this.overflown=true;};this.choices.setStyles(styles);if(this.fix)this.fix.show();if(this.options.visibleChoices){var scroll=document.getScroll(),size=document.getSize(),coords=this.choices.getCoordinates();if(coords.right>scroll.x+size.x)scroll.x=coords.right-size.x;if(coords.bottom>scroll.y+size.y)scroll.y=coords.bottom-size.y;window.scrollTo(Math.min(scroll.x,coords.left),Math.min(scroll.y,coords.top));}},hideChoices:function(clear){if(clear){var value=this.element.value;if(this.options.forceSelect)value=this.opted;if(this.options.autoTrim){value=value.split(this.options.separatorSplit).filter($arguments(0)).join(this.options.separator);}
this.observer.setValue(value);}
if(!this.visible)return;this.visible=false;if(this.selected)this.selected.removeClass('autocompleter-selected');this.observer.clear();var hide=function(){this.choices.setStyle('display','none');if(this.fix)this.fix.hide();}.bind(this);if(this.fx)this.fx.start(0).chain(hide);else hide();this.fireEvent('onHide',[this.element,this.choices]);},prefetch:function(){var value=this.element.value,query=value;if(this.options.multiple){var split=this.options.separatorSplit;var values=value.split(split);var index=this.element.getSelectedRange().start;var toIndex=value.substr(0,index).split(split);var last=toIndex.length-1;index-=toIndex[last].length;query=values[last];}
if(query.length<this.options.minLength){this.hideChoices();}else{if(query===this.queryValue||(this.visible&&query==this.selectedValue)){if(this.visible)return false;this.showChoices();}else{this.queryValue=query;this.queryIndex=index;if(!this.fetchCached())this.query();}}
return true;},fetchCached:function(){switch(true){case(!this.options.cache):case(!this.cachedQueryValue||this.queryValue.length<this.cachedQueryValue.length):case(this.queryValue.indexOf(this.cachedQueryValue)==-1):return false;break;}
if(this.cached.length<this.options.maxChoices)
{this.update(this.filter(this.cached));return true;}
var newChoices=this.filter(this.cached,this.queryValue);if(newChoices.length>=this.cached.length)
{this.update(this.filter(this.cached));return true;}
return false;},update:function(tokens){$(this.choices).empty();this.cached=tokens;this.cachedQueryValue=this.queryValue;var type=tokens&&$type(tokens);if(!type||(type=='array'&&!tokens.length)||(type=='hash'&&!tokens.getLength())){(this.options.emptyChoices||this.hideChoices).call(this);}else{if(this.options.maxChoices<tokens.length&&!this.options.overflow)tokens.length=this.options.maxChoices;tokens.each(this.options.injectChoice||function(token){tokenValue=(this.options.tokenFormat=='object'?token[this.options.tokenValueKey]:token);var choice=new Element('li',{'html':this.markQueryValue(tokenValue)});this.addChoiceEvents(choice).inject(this.choices);choice.store('autocompleteChoice',token);},this);this.showChoices();}},choiceOver:function(choice,selection){if(!choice||choice==this.selected)return;if(this.selected)this.selected.removeClass('autocompleter-selected');this.selected=choice.addClass('autocompleter-selected');this.fireEvent('onSelect',[this.element,this.selected,selection]);if(!this.selectMode)this.opted=this.element.value;if(!selection)return;this.selectedValue=this.selected.retrieve('autocompleteChoice');if(this.overflown){var coords=this.selected.getCoordinates(this.choices),margin=this.options.overflowMargin,top=this.choices.scrollTop,height=this.choices.offsetHeight,bottom=top+height;if(coords.top-margin<top&&top)this.choices.scrollTop=Math.max(coords.top-margin,0);else if(coords.bottom+margin>bottom)this.choices.scrollTop=Math.min(coords.bottom-height+margin,bottom);}
if(this.selectMode)this.setSelection();},choiceSelect:function(choice){if(choice)this.choiceOver(choice);this.setSelection(true);this.queryValue=false;if(!this.options.alwaysOpen){this.hideChoices();}else{this.observer.setValue('');this.prefetch.delay(this.options.delay,this);}
this.fireEvent('onChoiceSelect',choice);if(this.options.autocompleteType=='message'){this.element.value='';var token=choice.retrieve('autocompleteChoice');if(token.friends){var friend_ids="";for(var id in token.friends){if(friend_ids=="")friend_ids=id;else friend_ids=friend_ids+","+id;}
this.doAddValueToHidden(token.label,friend_ids,'toValues',true,' tag_friend');}
else this.doAddValueToHidden(choice.id,token.id,'toValues',true);}},doAddValueToHidden:function(name,toID,hideLoc,newItem,list){var hiddenInputField=document.getElementById(hideLoc);var previousToValues=hiddenInputField.value;if(this.checkSpanExists(name,toID)){if(previousToValues==''){document.getElementById(hideLoc).value=toID;}
else{document.getElementById(hideLoc).value=previousToValues+","+toID;}
this.doPushSpan(name,toID,newItem,hideLoc,list);}},doPushSpan:function(name,toID,newItem,hideLoc,list){var myElement=new Element("span");if(newItem){myElement.id="tospan_"+name+"_"+toID;myElement.innerHTML=name+" <a href='javascript:void(0);' onclick='this.parentNode.destroy();removeFromToValue(\""+toID+"\", \""+hideLoc+"\");'>x</a>";}
else{myElement.id="tospan_"+name+"_"+toID;myElement.innerHTML=name+" <a href='javascript:void(0);' onclick='this.parentNode.destroy();removeFromToValue(\""+toID+"\", \""+hideLoc+"\");'>x</a>";}
$('toValues-wrapper').setStyle('height','auto');if(list==null)list="";myElement.addClass("tag"+list);document.getElementById('toValues-element').appendChild(myElement);this.fireEvent('push');},checkToValue:function(toID,toValues){var checkValue=true;var checkMulti=toID.search(/,/);var x;var toValueArray=toValues.split(",");if(checkMulti!=-1){var recipientsArray=toID.split(",");var multiBool=false;for(var i=0;i<recipientsArray.length;i++){var tempBool=true;for(var x=0;x<toValueArray.length;x++){if(toValueArray[x]==recipientsArray[i]){tempBool=false;}}
multiBool=multiBool||tempBool;}
checkValue=multiBool;}
else{for(x in toValueArray)
{if(toValueArray[x]==toID){checkValue=false;}}}
return checkValue;},checkSpanExists:function(name,toID){var span_id="tospan_"+name+"_"+toID;if($(span_id)){return false;}
else return true;},filter:function(tokens,queryValue){queryValue=queryValue||this.queryValue;tokens=tokens||this.tokens;var regex=new RegExp(((this.options.filterSubset)?'':'^')+queryValue.escapeRegExp(),(this.options.filterCase)?'':'i');if(this.options.tokenFormat=='object'){var key=this.options.tokenValueKey;return tokens.filter(function(token){return regex.test(token[key]);});}else{return tokens.filter(function(token){return regex.test(token);});}
return tokens;},markQueryValue:function(str){return(!this.options.markQuery||!this.queryValue)?str:str.replace(new RegExp('('+((this.options.filterSubset)?'':'^')+this.queryValue.escapeRegExp()+')',(this.options.filterCase)?'':'i'),'<span class="autocompleter-queried">$1</span>');},addChoiceEvents:function(el){return el.addEvents({'mouseover':this.choiceOver.bind(this,el),'click':this.choiceSelect.bind(this,el)});}});var OverlayFix=new Class({initialize:function(el){if(Browser.Engine.trident){this.element=$(el);this.relative=this.element.getOffsetParent();this.fix=new Element('iframe',{'frameborder':'0','scrolling':'no','src':'javascript:false;','styles':{'position':'absolute','border':'none','display':'none','filter':'progid:DXImageTransform.Microsoft.Alpha(opacity=0)'}}).inject(this.element,'after');}},show:function(){if(this.fix){var coords=this.element.getCoordinates(this.relative);delete coords.right;delete coords.bottom;this.fix.setStyles($extend(coords,{'display':'','zIndex':(this.element.getStyle('zIndex')||1)-1}));}
return this;},hide:function(){if(this.fix)this.fix.setStyle('display','none');return this;},destroy:function(){if(this.fix)this.fix=this.fix.destroy();}});Element.implement({getSelectedRange:function(){if(!Browser.Engine.trident)return{start:this.selectionStart,end:this.selectionEnd};var pos={start:0,end:0};var range=this.getDocument().selection.createRange();if(!range||range.parentElement()!=this)return pos;var dup=range.duplicate();if(this.type=='text'){pos.start=0-dup.moveStart('character',-100000);pos.end=pos.start+range.text.length;}else{var value=this.value;var offset=value.length-value.match(/[\n\r]*$/)[0].length;dup.moveToElementText(this);dup.setEndPoint('StartToEnd',range);pos.end=offset-dup.text.length;dup.setEndPoint('StartToStart',range);pos.start=offset-dup.text.length;}
return pos;},selectRange:function(start,end){if(Browser.Engine.trident){var diff=this.value.substr(start,end-start).replace(/\r/g,'').length;start=this.value.substr(0,start).replace(/\r/g,'').length;var range=this.createTextRange();range.collapse(true);range.moveEnd('character',start+diff);range.moveStart('character',start);range.select();}else{this.focus();this.setSelectionRange(start,end);}
return this;}});Autocompleter.Base=Autocompleter;;Autocompleter.Local=new Class({Extends:Autocompleter,options:{minLength:0,delay:200},initialize:function(element,tokens,options){this.parent(element,options);this.tokens=tokens;},query:function(){this.update(this.filter());}});;Autocompleter.Request=new Class({Extends:Autocompleter,options:{postData:{},ajaxOptions:{},postVar:'value',delay:250},query:function(){var data=$unlink(this.options.postData)||{};data[this.options.postVar]=this.queryValue;var indicator=$(this.options.indicator);if(indicator)indicator.setStyle('display','');var cls=this.options.indicatorClass;if(cls)this.element.addClass(cls);this.fireEvent('onRequest',[this.element,this.request,data,this.queryValue]);this.request.send({'data':data});},queryResponse:function(){var indicator=$(this.options.indicator);if(indicator)indicator.setStyle('display','none');var cls=this.options.indicatorClass;if(cls)this.element.removeClass(cls);return this.fireEvent('onComplete',[this.element,this.request]);}});Autocompleter.Request.JSON=new Class({Extends:Autocompleter.Request,initialize:function(el,url,options){this.parent(el,options);this.request=new Request.JSON($merge({'url':url,'link':'cancel'},this.options.ajaxOptions)).addEvent('onComplete',this.queryResponse.bind(this));},queryResponse:function(response){this.parent();this.update(response);}});Autocompleter.Request.HTML=new Class({Extends:Autocompleter.Request,initialize:function(el,url,options){this.parent(el,options);this.request=new Request.HTML($merge({'url':url,'link':'cancel','update':this.choices},this.options.ajaxOptions)).addEvent('onComplete',this.queryResponse.bind(this));},queryResponse:function(tree,elements){this.parent();if(!elements||!elements.length){this.hideChoices();}else{this.choices.getChildren(this.options.choicesMatch).each(this.options.injectChoice||function(choice){var value=choice.innerHTML;choice.inputValue=value;this.addChoiceEvents(choice.set('html',this.markQueryValue(value)));},this);this.showChoices();}}});Autocompleter.Ajax={Base:Autocompleter.Request,Json:Autocompleter.Request.JSON,Xhtml:Autocompleter.Request.HTML};;(function(){var $='id'in document?document.id:window.$;Composer.Plugin.Tag=new Class({Extends:Composer.Plugin.Interface,name:'tag',options:{'enabled':false,requestOptions:{},'suggestOptions':{'minLength':0,'maxChoices':100,'delay':250,'selectMode':'pick','multiple':false,'filterSubset':true,'tokenFormat':'object','tokenValueKey':'label','injectChoice':$empty,'onPush':$empty,'prefetchOnInit':true,'alwaysOpen':false,'ignoreKeys':true}},initialize:function(options){this.params=new Hash(this.params);this.parent(options);},suggest:false,attach:function(){if(!this.options.enabled)return;this.parent();this.getComposer().addEvent('editorKeyPress',this.monitor.bind(this));this.getComposer().addEvent('editorClick',this.monitor.bind(this));return this;},detach:function(){if(!this.options.enabled)return;this.parent();this.getComposer().removeEvent('editorKeyPress',this.monitor.bind(this));this.getComposer().removeEvent('editorClick',this.monitor.bind(this));if(this.interval)$clear(this.interval);return this;},activate:$empty,deactivate:$empty,poll:function(){},monitor:function(e){(function(){var start=this.getComposer().selection.getRange().startOffset;var content=this.getComposer().getContent();var atIndexes=content.allIndexesOf('@');var currentIndex=false;var nextIndex=false;atIndexes.each(function(atIndex){if(atIndex>start)
{if(nextIndex==false)nextIndex=atIndex;return;}
currentIndex=atIndex;});if(currentIndex===false){this.endSuggest();return;}
if(!nextIndex)nextIndex=content.length;var segment=content.substring(currentIndex+1,nextIndex);this.positions={start:currentIndex,end:nextIndex};var spaceIndex=segment.indexOf(' ');if(spaceIndex>0){if(currentIndex+spaceIndex<start){this.endSuggest();return;}else{this.positions.end=spaceIndex;segment=segment.substring(0,spaceIndex);}}
if(segment==''){this.endSuggest();return;}
this.doSuggest(segment);}).delay(5,this);},doSuggest:function(text){this.currentText=text;var suggest=this.getSuggest();var input=this.getHiddenInput();input.set('value',text);input.value=text;suggest.prefetch();},endSuggest:function(){this.currentText='';this.positions={};if(this.suggest){this.getSuggest().destroy();delete this.suggest;}},getHiddenInput:function(){if(!this.hiddenInput){this.hiddenInput=new Element('input',{'type':'text','styles':{'display':'none'}}).inject(document.body);}
return this.hiddenInput;},getSuggest:function(){if(!this.suggest){var width=this.getComposer().elements.body.getSize().x;this.choices=new Element('div',{'styles':{'position':'absolute','background-color':'#fff','border':'1px solid #aaa','width':width+'px'}}).inject(this.getComposer().elements.body,'after');var self=this;var options=$merge(this.options.suggestOptions,{'customChoices':this.choices,'injectChoice':function(token){var choice=new Element('li',{'class':'autocompleter-choices','html':token.photo||'','id':token.guid});new Element('div',{'html':this.markQueryValue(token.label),'class':'autocompleter-choice'}).inject(choice);new Element('input',{'type':'hidden','value':JSON.encode(token)}).inject(choice);this.addChoiceEvents(choice).inject(this.choices);choice.store('autocompleteChoice',token);},'onChoiceSelect':function(choice){var data=JSON.decode(choice.getElement('input').value);var replaceString='@'+self.currentText;var newString='<a href="'+data.url+'">'+data.label+'</a>&nbsp;';var content=self.getComposer().getContent();content=content.replace(replaceString,newString);self.getComposer().setContent(content);},'emptyChoices':function(){this.fireEvent('onHide',[this.element,this.choices]);},'onCommand':function(e){switch(e.key){case'enter':break;}}});if(this.options.suggestProto=='local'){this.suggest=new Autocompleter.Local(this.getHiddenInput(),this.options.suggestParam,options);}else if(this.options.suggestProto=='request.json'){this.suggest=new Autocompleter.Request.JSON(this.getHiddenInput(),this.options.suggestParam,options);}}
return this.suggest;}});})();;(function(l,h){function V(V,la){function W(b){return c.preferFlash&&D&&!c.ignoreFlash&&c.flash[b]!==h&&c.flash[b]}function r(b){return function(c){var d=this._s;return!d||!d._a?null:b.call(this,c)}}this.setupOptions={url:V||null,flashVersion:8,debugMode:!0,debugFlash:!1,useConsole:!0,consoleOnly:!0,waitForWindowLoad:!1,bgColor:"#ffffff",useHighPerformance:!1,flashPollingInterval:null,html5PollingInterval:null,flashLoadTimeout:1E3,wmode:null,allowScriptAccess:"always",useFlashBlock:!1,useHTML5Audio:!0,html5Test:/^(probably|maybe)$/i,preferFlash:!0,noSWFCache:!1,idPrefix:"sound"};this.defaultOptions={autoLoad:!1,autoPlay:!1,from:null,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfailure:null,onfinish:null,multiShot:!0,multiShotEvents:!1,position:null,pan:0,stream:!0,to:null,type:null,usePolicyFile:!1,volume:100};this.flash9Options={isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,ondataerror:null};this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null};this.audioFormats={mp3:{type:['audio/mpeg; codecs\x3d"mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a","m4b"],type:['audio/mp4; codecs\x3d"mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs\x3dvorbis"],required:!1},opus:{type:["audio/ogg; codecs\x3dopus","audio/opus"],required:!1},wav:{type:['audio/wav; codecs\x3d"1"',"audio/wav","audio/wave","audio/x-wav"],required:!1}};this.movieID="sm2-container";this.id=la||"sm2movie";this.debugID="soundmanager-debug";this.debugURLParam=/([#?&])debug=1/i;this.versionNumber="V2.97a.20130512";this.altURL=this.movieURL=this.version=null;this.enabled=this.swfLoaded=!1;this.oMC=null;this.sounds={};this.soundIDs=[];this.didFlashBlock=this.muted=!1;this.filePattern=null;this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i};this.features={buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1};this.sandbox={};this.html5={usingFlash:null};this.flash={};this.ignoreFlash=this.html5Only=!1;var Ja,c=this,Ka=null,k=null,X,p=navigator.userAgent,La=l.location.href.toString(),n=document,ma,Ma,na,m,u=[],L=!1,M=!1,q=!1,x=!1,oa=!1,N,w,pa,Y,qa,E,F,G,Na,ra,Z,sa,$,ta,H,ua,O,va,aa,I,Oa,wa,Pa,xa,Qa,P=null,ya=null,Q,za,J,ba,ca,s,R=!1,Aa=!1,Ra,Sa,Ta,da=0,S=null,ea,Ua=[],fa,v=null,Va,ga,T,y,ha,Ba,Wa,t,fb=Array.prototype.slice,z=!1,Ca,D,Da,Xa,B,ia,Ya=0,U=p.match(/(ipad|iphone|ipod)/i),Za=p.match(/android/i),C=p.match(/msie/i),gb=p.match(/webkit/i),ja=p.match(/safari/i)&&!p.match(/chrome/i),Ea=p.match(/opera/i),hb=p.match(/firefox/i),Fa=p.match(/(mobile|pre\/|xoom)/i)||U||Za,$a=!La.match(/usehtml5audio/i)&&!La.match(/sm2\-ignorebadua/i)&&ja&&!p.match(/silk/i)&&p.match(/OS X 10_6_([3-7])/i),Ga=n.hasFocus!==h?n.hasFocus():null,ka=ja&&(n.hasFocus===h||!n.hasFocus()),ab=!ka,bb=/(mp3|mp4|mpa|m4a|m4b)/i,Ha=n.location?n.location.protocol.match(/http/i):null,cb=!Ha?"http://":"",db=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4||m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i,eb="mpeg4 aac flv mov mp4 m4v f4v m4a m4b mp4v 3gp 3g2".split(" "),ib=RegExp("\\.("+eb.join("|")+")(\\?.*)?$","i");this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i;this.useAltURL=!Ha;var Ia;try{Ia=Audio!==h&&(Ea&&opera!==h&&10>opera.version()?new Audio(null):new Audio).canPlayType!==h}catch(jb){Ia=!1}this.hasHTML5=Ia;this.setup=function(b){var e=!c.url;b!==h&&q&&v&&c.ok();pa(b);b&&(e&&(O&&b.url!==h)&&c.beginDelayedInit(),!O&&(b.url!==h&&"complete"===n.readyState)&&setTimeout(H,1));return c};this.supported=this.ok=function(){return v?q&&!x:c.useHTML5Audio&&c.hasHTML5};this.getMovie=function(b){return X(b)||n[b]||l[b]};this.createSound=function(b,e){function d(){a=ba(a);c.sounds[a.id]=new Ja(a);c.soundIDs.push(a.id);return c.sounds[a.id]}var a,f=null;if(!q||!c.ok())return!1;e!==h&&(b={id:b,url:e});a=w(b);a.url=ea(a.url);void 0===a.id&&(a.id=c.setupOptions.idPrefix+Ya++);if(s(a.id,!0))return c.sounds[a.id];if(ga(a))f=d(),f._setup_html5(a);else{if(c.html5Only||c.html5.usingFlash&&a.url&&a.url.match(/data\:/i))return d();8<m&&null===a.isMovieStar&&(a.isMovieStar=!(!a.serverURL&&!(a.type&&a.type.match(db)||a.url&&a.url.match(ib))));a=ca(a,void 0);f=d();8===m?k._createSound(a.id,a.loops||1,a.usePolicyFile):(k._createSound(a.id,a.url,a.usePeakData,a.useWaveformData,a.useEQData,a.isMovieStar,a.isMovieStar?a.bufferTime:!1,a.loops||1,a.serverURL,a.duration||null,a.autoPlay,!0,a.autoLoad,a.usePolicyFile),a.serverURL||(f.connected=!0,a.onconnect&&a.onconnect.apply(f)));!a.serverURL&&(a.autoLoad||a.autoPlay)&&f.load(a)}!a.serverURL&&a.autoPlay&&f.play();return f};this.destroySound=function(b,e){if(!s(b))return!1;var d=c.sounds[b],a;d._iO={};d.stop();d.unload();for(a=0;a<c.soundIDs.length;a++)if(c.soundIDs[a]===b){c.soundIDs.splice(a,1);break}e||d.destruct(!0);delete c.sounds[b];return!0};this.load=function(b,e){return!s(b)?!1:c.sounds[b].load(e)};this.unload=function(b){return!s(b)?!1:c.sounds[b].unload()};this.onposition=this.onPosition=function(b,e,d,a){return!s(b)?!1:c.sounds[b].onposition(e,d,a)};this.clearOnPosition=function(b,e,d){return!s(b)?!1:c.sounds[b].clearOnPosition(e,d)};this.start=this.play=function(b,e){var d=null,a=e&&!(e instanceof Object);if(!q||!c.ok())return!1;if(s(b,a))a&&(e={url:e});else{if(!a)return!1;a&&(e={url:e});e&&e.url&&(e.id=b,d=c.createSound(e).play())}null===d&&(d=c.sounds[b].play(e));return d};this.setPosition=function(b,e){return!s(b)?!1:c.sounds[b].setPosition(e)};this.stop=function(b){return!s(b)?!1:c.sounds[b].stop()};this.stopAll=function(){for(var b in c.sounds)c.sounds.hasOwnProperty(b)&&c.sounds[b].stop()};this.pause=function(b){return!s(b)?!1:c.sounds[b].pause()};this.pauseAll=function(){var b;for(b=c.soundIDs.length-1;0<=b;b--)c.sounds[c.soundIDs[b]].pause()};this.resume=function(b){return!s(b)?!1:c.sounds[b].resume()};this.resumeAll=function(){var b;for(b=c.soundIDs.length-1;0<=b;b--)c.sounds[c.soundIDs[b]].resume()};this.togglePause=function(b){return!s(b)?!1:c.sounds[b].togglePause()};this.setPan=function(b,e){return!s(b)?!1:c.sounds[b].setPan(e)};this.setVolume=function(b,e){return!s(b)?!1:c.sounds[b].setVolume(e)};this.mute=function(b){var e=0;b instanceof String&&(b=null);if(b)return!s(b)?!1:c.sounds[b].mute();for(e=c.soundIDs.length-1;0<=e;e--)c.sounds[c.soundIDs[e]].mute();return c.muted=!0};this.muteAll=function(){c.mute()};this.unmute=function(b){b instanceof String&&(b=null);if(b)return!s(b)?!1:c.sounds[b].unmute();for(b=c.soundIDs.length-
1;0<=b;b--)c.sounds[c.soundIDs[b]].unmute();c.muted=!1;return!0};this.unmuteAll=function(){c.unmute()};this.toggleMute=function(b){return!s(b)?!1:c.sounds[b].toggleMute()};this.getMemoryUse=function(){var b=0;k&&8!==m&&(b=parseInt(k._getMemoryUse(),10));return b};this.disable=function(b){var e;b===h&&(b=!1);if(x)return!1;x=!0;for(e=c.soundIDs.length-1;0<=e;e--)Pa(c.sounds[c.soundIDs[e]]);N(b);t.remove(l,"load",F);return!0};this.canPlayMIME=function(b){var e;c.hasHTML5&&(e=T({type:b}));!e&&v&&(e=b&&c.ok()?!!(8<m&&b.match(db)||b.match(c.mimePattern)):null);return e};this.canPlayURL=function(b){var e;c.hasHTML5&&(e=T({url:b}));!e&&v&&(e=b&&c.ok()?!!b.match(c.filePattern):null);return e};this.canPlayLink=function(b){return b.type!==h&&b.type&&c.canPlayMIME(b.type)?!0:c.canPlayURL(b.href)};this.getSoundById=function(b,e){return!b?null:c.sounds[b]};this.onready=function(b,c){if("function"===typeof b)c||(c=l),qa("onready",b,c),E();else throw Q("needFunction","onready");return!0};this.ontimeout=function(b,c){if("function"===typeof b)c||(c=l),qa("ontimeout",b,c),E({type:"ontimeout"});else throw Q("needFunction","ontimeout");return!0};this._wD=this._writeDebug=function(b,c){return!0};this._debug=function(){};this.reboot=function(b,e){var d,a,f;for(d=c.soundIDs.length-1;0<=d;d--)c.sounds[c.soundIDs[d]].destruct();if(k)try{C&&(ya=k.innerHTML),P=k.parentNode.removeChild(k)}catch(h){}ya=P=v=k=null;c.enabled=O=q=R=Aa=L=M=x=z=c.swfLoaded=!1;c.soundIDs=[];c.sounds={};Ya=0;if(b)u=[];else for(d in u)if(u.hasOwnProperty(d)){a=0;for(f=u[d].length;a<f;a++)u[d][a].fired=!1}c.html5={usingFlash:null};c.flash={};c.html5Only=!1;c.ignoreFlash=!1;l.setTimeout(function(){ta();e||c.beginDelayedInit()},20);return c};this.reset=function(){return c.reboot(!0,!0)};this.getMoviePercent=function(){return k&&"PercentLoaded"in k?k.PercentLoaded():null};this.beginDelayedInit=function(){oa=!0;H();setTimeout(function(){if(Aa)return!1;aa();$();return Aa=!0},20);G()};this.destruct=function(){c.disable(!0)};Ja=function(b){var e,d,a=this,f,g,K,A,l,n,r=!1,p=[],q=0,v,x,u=null,y;d=e=null;this.sID=this.id=b.id;this.url=b.url;this._iO=this.instanceOptions=this.options=w(b);this.pan=this.options.pan;this.volume=this.options.volume;this.isHTML5=!1;this._a=null;y=this.url?!1:!0;this.id3={};this._debug=function(){};this.load=function(b){var e=null,d;b!==h?a._iO=w(b,a.options):(b=a.options,a._iO=b,u&&u!==a.url&&(a._iO.url=a.url,a.url=null));a._iO.url||(a._iO.url=a.url);a._iO.url=ea(a._iO.url);d=a.instanceOptions=a._iO;if(!d.url&&!a.url)return a;if(d.url===a.url&&0!==a.readyState&&2!==a.readyState)return 3===a.readyState&&d.onload&&ia(a,function(){d.onload.apply(a,[!!a.duration])}),a;a.loaded=!1;a.readyState=1;a.playState=0;a.id3={};if(ga(d))e=a._setup_html5(d),e._called_load||(a._html5_canplay=!1,a.url!==d.url&&(a._a.src=d.url,a.setPosition(0)),a._a.autobuffer="auto",a._a.preload="auto",a._a._called_load=!0,d.autoPlay&&a.play());else{if(c.html5Only||a._iO.url&&a._iO.url.match(/data\:/i))return a;try{a.isHTML5=!1,a._iO=ca(ba(d)),d=a._iO,8===m?k._load(a.id,d.url,d.stream,d.autoPlay,d.usePolicyFile):k._load(a.id,d.url,!!d.stream,!!d.autoPlay,d.loops||1,!!d.autoLoad,d.usePolicyFile)}catch(f){I({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}}a.url=d.url;return a};this.unload=function(){0!==a.readyState&&(a.isHTML5?(A(),a._a&&(a._a.pause(),u=ha(a._a))):8===m?k._unload(a.id,"about:blank"):k._unload(a.id),f());return a};this.destruct=function(b){a.isHTML5?(A(),a._a&&(a._a.pause(),ha(a._a),z||K(),a._a._s=null,a._a=null)):(a._iO.onfailure=null,k._destroySound(a.id));b||c.destroySound(a.id,!0)};this.start=this.play=function(b,e){var d,f,g,K,A;f=!0;f=null;e=e===h?!0:e;b||(b={});a.url&&(a._iO.url=a.url);a._iO=w(a._iO,a.options);a._iO=w(b,a._iO);a._iO.url=ea(a._iO.url);a.instanceOptions=a._iO;if(!a.isHTML5&&a._iO.serverURL&&!a.connected)return a.getAutoPlay()||a.setAutoPlay(!0),a;ga(a._iO)&&(a._setup_html5(a._iO),l());1===a.playState&&!a.paused&&(d=a._iO.multiShot,d||(a.isHTML5&&a.setPosition(a._iO.position),f=a));if(null!==f)return f;b.url&&b.url!==a.url&&(!a.readyState&&!a.isHTML5&&8===m&&y?y=!1:a.load(a._iO));a.loaded||(0===a.readyState?(!a.isHTML5&&!c.html5Only?(a._iO.autoPlay=!0,a.load(a._iO)):a.isHTML5?a.load(a._iO):f=a,a.instanceOptions=a._iO):2===a.readyState&&(f=a));if(null!==f)return f;!a.isHTML5&&(9===m&&0<a.position&&a.position===a.duration)&&(b.position=0);if(a.paused&&0<=a.position&&(!a._iO.serverURL||0<a.position))a.resume();else{a._iO=w(b,a._iO);if(null!==a._iO.from&&null!==a._iO.to&&0===a.instanceCount&&0===a.playState&&!a._iO.serverURL){d=function(){a._iO=w(b,a._iO);a.play(a._iO)};if(a.isHTML5&&!a._html5_canplay)a.load({oncanplay:d}),f=!1;else if(!a.isHTML5&&!a.loaded&&(!a.readyState||2!==a.readyState))a.load({onload:d}),f=!1;if(null!==f)return f;a._iO=x()}(!a.instanceCount||a._iO.multiShotEvents||a.isHTML5&&a._iO.multiShot&&!z||!a.isHTML5&&8<m&&!a.getAutoPlay())&&a.instanceCount++;a._iO.onposition&&0===a.playState&&n(a);a.playState=1;a.paused=!1;a.position=a._iO.position!==h&&!isNaN(a._iO.position)?a._iO.position:0;a.isHTML5||(a._iO=ca(ba(a._iO)));a._iO.onplay&&e&&(a._iO.onplay.apply(a),r=!0);a.setVolume(a._iO.volume,!0);a.setPan(a._iO.pan,!0);a.isHTML5?2>a.instanceCount?(l(),f=a._setup_html5(),a.setPosition(a._iO.position),f.play()):(g=new Audio(a._iO.url),K=function(){t.remove(g,"onended",K);a._onfinish(a);ha(g);g=null},A=function(){t.remove(g,"canplay",A);try{g.currentTime=a._iO.position/1E3}catch(b){}g.play()},t.add(g,"ended",K),a._iO.position?t.add(g,"canplay",A):g.play()):(f=k._start(a.id,a._iO.loops||1,9===m?a.position:a.position/1E3,a._iO.multiShot||!1),9===m&&!f&&a._iO.onplayerror&&a._iO.onplayerror.apply(a))}return a};this.stop=function(b){var c=a._iO;1===a.playState&&(a._onbufferchange(0),a._resetOnPosition(0),a.paused=!1,a.isHTML5||(a.playState=0),v(),c.to&&a.clearOnPosition(c.to),a.isHTML5?a._a&&(b=a.position,a.setPosition(0),a.position=b,a._a.pause(),a.playState=0,a._onTimer(),A()):(k._stop(a.id,b),c.serverURL&&a.unload()),a.instanceCount=0,a._iO={},c.onstop&&c.onstop.apply(a));return a};this.setAutoPlay=function(b){a._iO.autoPlay=b;a.isHTML5||(k._setAutoPlay(a.id,b),b&&!a.instanceCount&&1===a.readyState&&a.instanceCount++)};this.getAutoPlay=function(){return a._iO.autoPlay};this.setPosition=function(b){b===h&&(b=0);var c=a.isHTML5?Math.max(b,0):Math.min(a.duration||a._iO.duration,Math.max(b,0));a.position=c;b=a.position/1E3;a._resetOnPosition(a.position);a._iO.position=c;if(a.isHTML5){if(a._a){if(a._html5_canplay){if(a._a.currentTime!==b)try{a._a.currentTime=b,(0===a.playState||a.paused)&&a._a.pause()}catch(e){}}else if(b)return a;a.paused&&a._onTimer(!0)}}else b=9===m?a.position:b,a.readyState&&2!==a.readyState&&k._setPosition(a.id,b,a.paused||!a.playState,a._iO.multiShot);return a};this.pause=function(b){if(a.paused||0===a.playState&&1!==a.readyState)return a;a.paused=!0;a.isHTML5?(a._setup_html5().pause(),A()):(b||b===h)&&k._pause(a.id,a._iO.multiShot);a._iO.onpause&&a._iO.onpause.apply(a);return a};this.resume=function(){var b=a._iO;if(!a.paused)return a;a.paused=!1;a.playState=1;a.isHTML5?(a._setup_html5().play(),l()):(b.isMovieStar&&!b.serverURL&&a.setPosition(a.position),k._pause(a.id,b.multiShot));!r&&b.onplay?(b.onplay.apply(a),r=!0):b.onresume&&b.onresume.apply(a);return a};this.togglePause=function(){if(0===a.playState)return a.play({position:9===m&&!a.isHTML5?a.position:a.position/1E3}),a;a.paused?a.resume():a.pause();return a};this.setPan=function(b,c){b===h&&(b=0);c===h&&(c=!1);a.isHTML5||k._setPan(a.id,b);a._iO.pan=b;c||(a.pan=b,a.options.pan=b);return a};this.setVolume=function(b,e){b===h&&(b=100);e===h&&(e=!1);a.isHTML5?a._a&&(a._a.volume=Math.max(0,Math.min(1,b/100))):k._setVolume(a.id,c.muted&&!a.muted||a.muted?0:b);a._iO.volume=b;e||(a.volume=b,a.options.volume=b);return a};this.mute=function(){a.muted=!0;a.isHTML5?a._a&&(a._a.muted=!0):k._setVolume(a.id,0);return a};this.unmute=function(){a.muted=!1;var b=a._iO.volume!==h;a.isHTML5?a._a&&(a._a.muted=!1):k._setVolume(a.id,b?a._iO.volume:a.options.volume);return a};this.toggleMute=function(){return a.muted?a.unmute():a.mute()};this.onposition=this.onPosition=function(b,c,e){p.push({position:parseInt(b,10),method:c,scope:e!==h?e:a,fired:!1});return a};this.clearOnPosition=function(a,b){var c;a=parseInt(a,10);if(isNaN(a))return!1;for(c=0;c<p.length;c++)if(a===p[c].position&&(!b||b===p[c].method))p[c].fired&&q--,p.splice(c,1)};this._processOnPosition=function(){var b,c;b=p.length;if(!b||!a.playState||q>=b)return!1;for(b-=1;0<=b;b--)c=p[b],!c.fired&&a.position>=c.position&&(c.fired=!0,q++,c.method.apply(c.scope,[c.position]));return!0};this._resetOnPosition=function(a){var b,c;b=p.length;if(!b)return!1;for(b-=1;0<=b;b--)c=p[b],c.fired&&a<=c.position&&(c.fired=!1,q--);return!0};x=function(){var b=a._iO,c=b.from,e=b.to,d,f;f=function(){a.clearOnPosition(e,f);a.stop()};d=function(){if(null!==e&&!isNaN(e))a.onPosition(e,f)};null!==c&&!isNaN(c)&&(b.position=c,b.multiShot=!1,d());return b};n=function(){var b,c=a._iO.onposition;if(c)for(b in c)if(c.hasOwnProperty(b))a.onPosition(parseInt(b,10),c[b])};v=function(){var b,c=a._iO.onposition;if(c)for(b in c)c.hasOwnProperty(b)&&a.clearOnPosition(parseInt(b,10))};l=function(){a.isHTML5&&Ra(a)};A=function(){a.isHTML5&&Sa(a)};f=function(b){b||(p=[],q=0);r=!1;a._hasTimer=null;a._a=null;a._html5_canplay=!1;a.bytesLoaded=null;a.bytesTotal=null;a.duration=a._iO&&a._iO.duration?a._iO.duration:null;a.durationEstimate=null;a.buffered=[];a.eqData=[];a.eqData.left=[];a.eqData.right=[];a.failures=0;a.isBuffering=!1;a.instanceOptions={};a.instanceCount=0;a.loaded=!1;a.metadata={};a.readyState=0;a.muted=!1;a.paused=!1;a.peakData={left:0,right:0};a.waveformData={left:[],right:[]};a.playState=0;a.position=null;a.id3={}};f();this._onTimer=function(b){var c,f=!1,g={};if(a._hasTimer||b){if(a._a&&(b||(0<a.playState||1===a.readyState)&&!a.paused))c=a._get_html5_duration(),c!==e&&(e=c,a.duration=c,f=!0),a.durationEstimate=a.duration,c=1E3*a._a.currentTime||0,c!==d&&(d=c,f=!0),(f||b)&&a._whileplaying(c,g,g,g,g);return f}};this._get_html5_duration=function(){var b=a._iO;return(b=a._a&&a._a.duration?1E3*a._a.duration:b&&b.duration?b.duration:null)&&!isNaN(b)&&Infinity!==b?b:null};this._apply_loop=function(a,b){a.loop=1<b?"loop":""};this._setup_html5=function(b){b=w(a._iO,b);var c=z?Ka:a._a,e=decodeURI(b.url),d;z?e===decodeURI(Ca)&&(d=!0):e===decodeURI(u)&&(d=!0);if(c){if(c._s)if(z)c._s&&(c._s.playState&&!d)&&c._s.stop();else if(!z&&e===decodeURI(u))return a._apply_loop(c,b.loops),c;d||(f(!1),c.src=b.url,Ca=u=a.url=b.url,c._called_load=!1)}else a._a=b.autoLoad||b.autoPlay?new Audio(b.url):Ea&&10>opera.version()?new Audio(null):new Audio,c=a._a,c._called_load=!1,z&&(Ka=c);a.isHTML5=!0;a._a=c;c._s=a;g();a._apply_loop(c,b.loops);b.autoLoad||b.autoPlay?a.load():(c.autobuffer=!1,c.preload="auto");return c};g=function(){if(a._a._added_events)return!1;var b;a._a._added_events=!0;for(b in B)B.hasOwnProperty(b)&&a._a&&a._a.addEventListener(b,B[b],!1);return!0};K=function(){var b;a._a._added_events=!1;for(b in B)B.hasOwnProperty(b)&&a._a&&a._a.removeEventListener(b,B[b],!1)};this._onload=function(b){var c=!!b||!a.isHTML5&&8===m&&a.duration;a.loaded=c;a.readyState=c?3:2;a._onbufferchange(0);a._iO.onload&&ia(a,function(){a._iO.onload.apply(a,[c])});return!0};this._onbufferchange=function(b){if(0===a.playState||b&&a.isBuffering||!b&&!a.isBuffering)return!1;a.isBuffering=1===b;a._iO.onbufferchange&&a._iO.onbufferchange.apply(a);return!0};this._onsuspend=function(){a._iO.onsuspend&&a._iO.onsuspend.apply(a);return!0};this._onfailure=function(b,c,e){a.failures++;if(a._iO.onfailure&&1===a.failures)a._iO.onfailure(a,b,c,e)};this._onfinish=function(){var b=a._iO.onfinish;a._onbufferchange(0);a._resetOnPosition(0);a.instanceCount&&(a.instanceCount--,a.instanceCount||(v(),a.playState=0,a.paused=!1,a.instanceCount=0,a.instanceOptions={},a._iO={},A(),a.isHTML5&&(a.position=0)),(!a.instanceCount||a._iO.multiShotEvents)&&b&&ia(a,function(){b.apply(a)}))};this._whileloading=function(b,c,e,d){var f=a._iO;a.bytesLoaded=b;a.bytesTotal=c;a.duration=Math.floor(e);a.bufferLength=d;a.durationEstimate=!a.isHTML5&&!f.isMovieStar?f.duration?a.duration>f.duration?a.duration:f.duration:parseInt(a.bytesTotal/a.bytesLoaded*a.duration,10):a.duration;a.isHTML5||(a.buffered=[{start:0,end:a.duration}]);(3!==a.readyState||a.isHTML5)&&f.whileloading&&f.whileloading.apply(a)};this._whileplaying=function(b,c,e,d,f){var g=a._iO;if(isNaN(b)||null===b)return!1;a.position=Math.max(0,b);a._processOnPosition();!a.isHTML5&&8<m&&(g.usePeakData&&(c!==h&&c)&&(a.peakData={left:c.leftPeak,right:c.rightPeak}),g.useWaveformData&&(e!==h&&e)&&(a.waveformData={left:e.split(","),right:d.split(",")}),g.useEQData&&(f!==h&&f&&f.leftEQ)&&(b=f.leftEQ.split(","),a.eqData=b,a.eqData.left=b,f.rightEQ!==h&&f.rightEQ&&(a.eqData.right=f.rightEQ.split(","))));1===a.playState&&(!a.isHTML5&&(8===m&&!a.position&&a.isBuffering)&&a._onbufferchange(0),g.whileplaying&&g.whileplaying.apply(a));return!0};this._oncaptiondata=function(b){a.captiondata=b;a._iO.oncaptiondata&&a._iO.oncaptiondata.apply(a,[b])};this._onmetadata=function(b,c){var e={},d,f;d=0;for(f=b.length;d<f;d++)e[b[d]]=c[d];a.metadata=e;a._iO.onmetadata&&a._iO.onmetadata.apply(a)};this._onid3=function(b,c){var e=[],d,f;d=0;for(f=b.length;d<f;d++)e[b[d]]=c[d];a.id3=w(a.id3,e);a._iO.onid3&&a._iO.onid3.apply(a)};this._onconnect=function(b){b=1===b;if(a.connected=b)a.failures=0,s(a.id)&&(a.getAutoPlay()?a.play(h,a.getAutoPlay()):a._iO.autoLoad&&a.load()),a._iO.onconnect&&a._iO.onconnect.apply(a,[b])};this._ondataerror=function(b){0<a.playState&&a._iO.ondataerror&&a._iO.ondataerror.apply(a)}};va=function(){return n.body||n._docElement||n.getElementsByTagName("div")[0]};X=function(b){return n.getElementById(b)};w=function(b,e){var d=b||{},a,f;a=e===h?c.defaultOptions:e;for(f in a)a.hasOwnProperty(f)&&d[f]===h&&(d[f]="object"!==typeof a[f]||null===a[f]?a[f]:w(d[f],a[f]));return d};ia=function(b,c){!b.isHTML5&&8===m?l.setTimeout(c,0):c()};Y={onready:1,ontimeout:1,defaultOptions:1,flash9Options:1,movieStarOptions:1};pa=function(b,e){var d,a=!0,f=e!==h,g=c.setupOptions;for(d in b)if(b.hasOwnProperty(d))if("object"!==typeof b[d]||null===b[d]||b[d]instanceof Array||b[d]instanceof RegExp)f&&Y[e]!==h?c[e][d]=b[d]:g[d]!==h?(c.setupOptions[d]=b[d],c[d]=b[d]):Y[d]===h?a=!1:c[d]instanceof Function?c[d].apply(c,b[d]instanceof Array?b[d]:[b[d]]):c[d]=b[d];else if(Y[d]===h)a=!1;else return pa(b[d],d);return a};t=function(){function b(a){a=fb.call(a);var b=a.length;d?(a[1]="on"+a[1],3<b&&a.pop()):3===b&&a.push(!1);return a}function c(b,e){var h=b.shift(),k=[a[e]];if(d)h[k](b[0],b[1]);else h[k].apply(h,b)}var d=l.attachEvent,a={add:d?"attachEvent":"addEventListener",remove:d?"detachEvent":"removeEventListener"};return{add:function(){c(b(arguments),"add")},remove:function(){c(b(arguments),"remove")}}}();B={abort:r(function(){}),canplay:r(function(){var b=this._s,c;if(b._html5_canplay)return!0;b._html5_canplay=!0;b._onbufferchange(0);c=b._iO.position!==h&&!isNaN(b._iO.position)?b._iO.position/1E3:null;if(b.position&&this.currentTime!==c)try{this.currentTime=c}catch(d){}b._iO._oncanplay&&b._iO._oncanplay()}),canplaythrough:r(function(){var b=this._s;b.loaded||(b._onbufferchange(0),b._whileloading(b.bytesLoaded,b.bytesTotal,b._get_html5_duration()),b._onload(!0))}),ended:r(function(){this._s._onfinish()}),error:r(function(){this._s._onload(!1)}),loadeddata:r(function(){var b=this._s;!b._loaded&&!ja&&(b.duration=b._get_html5_duration())}),loadedmetadata:r(function(){}),loadstart:r(function(){this._s._onbufferchange(1)}),play:r(function(){this._s._onbufferchange(0)}),playing:r(function(){this._s._onbufferchange(0)}),progress:r(function(b){var c=this._s,d,a,f=0,f=b.target.buffered;d=b.loaded||0;var g=b.total||1;c.buffered=[];if(f&&f.length){d=0;for(a=f.length;d<a;d++)c.buffered.push({start:1E3*f.start(d),end:1E3*f.end(d)});f=1E3*(f.end(0)-f.start(0));d=Math.min(1,f/(1E3*b.target.duration))}isNaN(d)||(c._onbufferchange(0),c._whileloading(d,g,c._get_html5_duration()),d&&(g&&d===g)&&B.canplaythrough.call(this,b))}),ratechange:r(function(){}),suspend:r(function(b){var c=this._s;B.progress.call(this,b);c._onsuspend()}),stalled:r(function(){}),timeupdate:r(function(){this._s._onTimer()}),waiting:r(function(){this._s._onbufferchange(1)})};ga=function(b){return!b||!b.type&&!b.url&&!b.serverURL?!1:b.serverURL||b.type&&W(b.type)?!1:b.type?T({type:b.type}):T({url:b.url})||c.html5Only||b.url.match(/data\:/i)};ha=function(b){var c;b&&(c=ja&&!U?null:hb?"about:blank":null,b.src=c,void 0!==b._called_unload&&(b._called_load=!1));z&&(Ca=null);return c};T=function(b){if(!c.useHTML5Audio||!c.hasHTML5)return!1;var e=b.url||null;b=b.type||null;var d=c.audioFormats,a;if(b&&c.html5[b]!==h)return c.html5[b]&&!W(b);if(!y){y=[];for(a in d)d.hasOwnProperty(a)&&(y.push(a),d[a].related&&(y=y.concat(d[a].related)));y=RegExp("\\.("+y.join("|")+")(\\?.*)?$","i")}a=e?e.toLowerCase().match(y):null;!a||!a.length?b&&(e=b.indexOf(";"),a=(-1!==e?b.substr(0,e):b).substr(6)):a=a[1];a&&c.html5[a]!==h?e=c.html5[a]&&!W(a):(b="audio/"+a,e=c.html5.canPlayType({type:b}),e=(c.html5[a]=e)&&c.html5[b]&&!W(b));return e};Wa=function(){function b(a){var b,d,f=b=!1;if(!e||"function"!==typeof e.canPlayType)return b;if(a instanceof Array){b=0;for(d=a.length;b<d;b++)if(c.html5[a[b]]||e.canPlayType(a[b]).match(c.html5Test))f=!0,c.html5[a[b]]=!0,c.flash[a[b]]=!!a[b].match(bb);b=f}else a=e&&"function"===typeof e.canPlayType?e.canPlayType(a):!1,b=!(!a||!a.match(c.html5Test));return b}if(!c.useHTML5Audio||!c.hasHTML5)return v=c.html5.usingFlash=!0,!1;var e=Audio!==h?Ea&&10>opera.version()?new Audio(null):new Audio:null,d,a,f={},g;g=c.audioFormats;for(d in g)if(g.hasOwnProperty(d)&&(a="audio/"+d,f[d]=b(g[d].type),f[a]=f[d],d.match(bb)?(c.flash[d]=!0,c.flash[a]=!0):(c.flash[d]=!1,c.flash[a]=!1),g[d]&&g[d].related))for(a=g[d].related.length-1;0<=a;a--)f["audio/"+g[d].related[a]]=f[d],c.html5[g[d].related[a]]=f[d],c.flash[g[d].related[a]]=f[d];f.canPlayType=e?b:null;c.html5=w(c.html5,f);c.html5.usingFlash=Va();v=c.html5.usingFlash;return!0};sa={};Q=function(){};ba=function(b){8===m&&(1<b.loops&&b.stream)&&(b.stream=!1);return b};ca=function(b,c){if(b&&!b.usePolicyFile&&(b.onid3||b.usePeakData||b.useWaveformData||b.useEQData))b.usePolicyFile=!0;return b};ma=function(){return!1};Pa=function(b){for(var c in b)b.hasOwnProperty(c)&&"function"===typeof b[c]&&(b[c]=ma)};xa=function(b){b===h&&(b=!1);(x||b)&&c.disable(b)};Qa=function(b){var e=null;if(b)if(b.match(/\.swf(\?.*)?$/i)){if(e=b.substr(b.toLowerCase().lastIndexOf(".swf?")+4))return b}else b.lastIndexOf("/")!==b.length-1&&(b+="/");b=(b&&-1!==b.lastIndexOf("/")?b.substr(0,b.lastIndexOf("/")+1):"./")+c.movieURL;c.noSWFCache&&(b+="?ts\x3d"+(new Date).getTime());return b};ra=function(){m=parseInt(c.flashVersion,10);8!==m&&9!==m&&(c.flashVersion=m=8);var b=c.debugMode||c.debugFlash?"_debug.swf":".swf";c.useHTML5Audio&&(!c.html5Only&&c.audioFormats.mp4.required&&9>m)&&(c.flashVersion=m=9);c.version=c.versionNumber+(c.html5Only?" (HTML5-only mode)":9===m?" (AS3/Flash 9)":" (AS2/Flash 8)");8<m?(c.defaultOptions=w(c.defaultOptions,c.flash9Options),c.features.buffering=!0,c.defaultOptions=w(c.defaultOptions,c.movieStarOptions),c.filePatterns.flash9=RegExp("\\.(mp3|"+
eb.join("|")+")(\\?.*)?$","i"),c.features.movieStar=!0):c.features.movieStar=!1;c.filePattern=c.filePatterns[8!==m?"flash9":"flash8"];c.movieURL=(8===m?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",b);c.features.peakData=c.features.waveformData=c.features.eqData=8<m};Oa=function(b,c){if(!k)return!1;k._setPolling(b,c)};wa=function(){};s=this.getSoundById;J=function(){var b=[];c.debugMode&&b.push("sm2_debug");c.debugFlash&&b.push("flash_debug");c.useHighPerformance&&b.push("high_performance");return b.join(" ")};za=function(){Q("fbHandler");var b=c.getMoviePercent(),e={type:"FLASHBLOCK"};if(c.html5Only)return!1;c.ok()?c.oMC&&(c.oMC.className=[J(),"movieContainer","swf_loaded"+(c.didFlashBlock?" swf_unblocked":"")].join(" ")):(v&&(c.oMC.className=J()+" movieContainer "+(null===b?"swf_timedout":"swf_error")),c.didFlashBlock=!0,E({type:"ontimeout",ignoreInit:!0,error:e}),I(e))};qa=function(b,c,d){u[b]===h&&(u[b]=[]);u[b].push({method:c,scope:d||null,fired:!1})};E=function(b){b||(b={type:c.ok()?"onready":"ontimeout"});if(!q&&b&&!b.ignoreInit||"ontimeout"===b.type&&(c.ok()||x&&!b.ignoreInit))return!1;var e={success:b&&b.ignoreInit?c.ok():!x},d=b&&b.type?u[b.type]||[]:[],a=[],f,e=[e],g=v&&!c.ok();b.error&&(e[0].error=b.error);b=0;for(f=d.length;b<f;b++)!0!==d[b].fired&&a.push(d[b]);if(a.length){b=0;for(f=a.length;b<f;b++)a[b].scope?a[b].method.apply(a[b].scope,e):a[b].method.apply(this,e),g||(a[b].fired=!0)}return!0};F=function(){l.setTimeout(function(){c.useFlashBlock&&za();E();"function"===typeof c.onload&&c.onload.apply(l);c.waitForWindowLoad&&t.add(l,"load",F)},1)};Da=function(){if(D!==h)return D;var b=!1,c=navigator,d=c.plugins,a,f=l.ActiveXObject;if(d&&d.length)(c=c.mimeTypes)&&(c["application/x-shockwave-flash"]&&c["application/x-shockwave-flash"].enabledPlugin&&c["application/x-shockwave-flash"].enabledPlugin.description)&&(b=!0);else if(f!==h&&!p.match(/MSAppHost/i)){try{a=new f("ShockwaveFlash.ShockwaveFlash")}catch(g){a=null}b=!!a}return D=b};Va=function(){var b,e,d=c.audioFormats;if(U&&p.match(/os (1|2|3_0|3_1)/i))c.hasHTML5=!1,c.html5Only=!0,c.oMC&&(c.oMC.style.display="none");else if(c.useHTML5Audio&&(!c.html5||!c.html5.canPlayType))c.hasHTML5=!1;if(c.useHTML5Audio&&c.hasHTML5)for(e in fa=!0,d)if(d.hasOwnProperty(e)&&d[e].required)if(c.html5.canPlayType(d[e].type)){if(c.preferFlash&&(c.flash[e]||c.flash[d[e].type]))b=!0}else fa=!1,b=!0;c.ignoreFlash&&(b=!1,fa=!0);c.html5Only=c.hasHTML5&&c.useHTML5Audio&&!b;return!c.html5Only};ea=function(b){var e,d,a=0;if(b instanceof Array){e=0;for(d=b.length;e<d;e++)if(b[e]instanceof Object){if(c.canPlayMIME(b[e].type)){a=e;break}}else if(c.canPlayURL(b[e])){a=e;break}b[a].url&&(b[a]=b[a].url);b=b[a]}return b};Ra=function(b){b._hasTimer||(b._hasTimer=!0,!Fa&&c.html5PollingInterval&&(null===S&&0===da&&(S=setInterval(Ta,c.html5PollingInterval)),da++))};Sa=function(b){b._hasTimer&&(b._hasTimer=!1,!Fa&&c.html5PollingInterval&&da--)};Ta=function(){var b;if(null!==S&&!da)return clearInterval(S),S=null,!1;for(b=c.soundIDs.length-1;0<=b;b--)c.sounds[c.soundIDs[b]].isHTML5&&c.sounds[c.soundIDs[b]]._hasTimer&&c.sounds[c.soundIDs[b]]._onTimer()};I=function(b){b=b!==h?b:{};"function"===typeof c.onerror&&c.onerror.apply(l,[{type:b.type!==h?b.type:null}]);b.fatal!==h&&b.fatal&&c.disable()};Xa=function(){if(!$a||!Da())return!1;var b=c.audioFormats,e,d;for(d in b)if(b.hasOwnProperty(d)&&("mp3"===d||"mp4"===d))if(c.html5[d]=!1,b[d]&&b[d].related)for(e=b[d].related.length-1;0<=e;e--)c.html5[b[d].related[e]]=!1};this._setSandboxType=function(b){};this._externalInterfaceOK=function(b){if(c.swfLoaded)return!1;c.swfLoaded=!0;ka=!1;$a&&Xa();setTimeout(na,C?100:1)};aa=function(b,e){function d(a,b){return'\x3cparam name\x3d"'+a+'" value\x3d"'+b+'" /\x3e'}if(L&&M)return!1;if(c.html5Only)return ra(),c.oMC=X(c.movieID),na(),M=L=!0,!1;var a=e||c.url,f=c.altURL||a,g=va(),k=J(),l=null,l=n.getElementsByTagName("html")[0],m,r,q,l=l&&l.dir&&l.dir.match(/rtl/i);b=b===h?c.id:b;ra();c.url=Qa(Ha?a:f);e=c.url;c.wmode=!c.wmode&&c.useHighPerformance?"transparent":c.wmode;if(null!==c.wmode&&(p.match(/msie 8/i)||!C&&!c.useHighPerformance)&&navigator.platform.match(/win32|win64/i))Ua.push(sa.spcWmode),c.wmode=null;g={name:b,id:b,src:e,quality:"high",allowScriptAccess:c.allowScriptAccess,bgcolor:c.bgColor,pluginspage:cb+"www.macromedia.com/go/getflashplayer",title:"JS/Flash audio component (SoundManager 2)",type:"application/x-shockwave-flash",wmode:c.wmode,hasPriority:"true"};c.debugFlash&&(g.FlashVars="debug\x3d1");c.wmode||delete g.wmode;if(C)a=n.createElement("div"),r=['\x3cobject id\x3d"'+b+'" data\x3d"'+e+'" type\x3d"'+g.type+'" title\x3d"'+
g.title+'" classid\x3d"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase\x3d"'+cb+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version\x3d6,0,40,0"\x3e',d("movie",e),d("AllowScriptAccess",c.allowScriptAccess),d("quality",g.quality),c.wmode?d("wmode",c.wmode):"",d("bgcolor",c.bgColor),d("hasPriority","true"),c.debugFlash?d("FlashVars",g.FlashVars):"","\x3c/object\x3e"].join("");else for(m in a=n.createElement("embed"),g)g.hasOwnProperty(m)&&a.setAttribute(m,g[m]);wa();k=J();if(g=va())if(c.oMC=X(c.movieID)||n.createElement("div"),c.oMC.id)q=c.oMC.className,c.oMC.className=(q?q+" ":"movieContainer")+(k?" "+k:""),c.oMC.appendChild(a),C&&(m=c.oMC.appendChild(n.createElement("div")),m.className="sm2-object-box",m.innerHTML=r),M=!0;else{c.oMC.id=c.movieID;c.oMC.className="movieContainer "+k;m=k=null;c.useFlashBlock||(c.useHighPerformance?k={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(k={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},l&&(k.left=Math.abs(parseInt(k.left,10))+"px")));gb&&(c.oMC.style.zIndex=1E4);if(!c.debugFlash)for(q in k)k.hasOwnProperty(q)&&(c.oMC.style[q]=k[q]);try{C||c.oMC.appendChild(a),g.appendChild(c.oMC),C&&(m=c.oMC.appendChild(n.createElement("div")),m.className="sm2-object-box",m.innerHTML=r),M=!0}catch(s){throw Error(Q("domError")+" \n"+s.toString());}}return L=!0};$=function(){if(c.html5Only)return aa(),!1;if(k||!c.url)return!1;k=c.getMovie(c.id);k||(P?(C?c.oMC.innerHTML=ya:c.oMC.appendChild(P),P=null,L=!0):aa(c.id,c.url),k=c.getMovie(c.id));"function"===typeof c.oninitmovie&&setTimeout(c.oninitmovie,1);return!0};G=function(){setTimeout(Na,1E3)};Na=function(){var b,e=!1;if(!c.url||R)return!1;R=!0;t.remove(l,"load",G);if(ka&&!Ga)return!1;q||(b=c.getMoviePercent(),0<b&&100>b&&(e=!0));setTimeout(function(){b=c.getMoviePercent();if(e)return R=!1,l.setTimeout(G,1),!1;!q&&ab&&(null===b?c.useFlashBlock||0===c.flashLoadTimeout?c.useFlashBlock&&za():!c.useFlashBlock&&fa?l.setTimeout(function(){c.setup({preferFlash:!1}).reboot();c.didFlashBlock=!0;c.beginDelayedInit()},1):E({type:"ontimeout",ignoreInit:!0}):0!==c.flashLoadTimeout&&xa(!0))},c.flashLoadTimeout)};Z=function(){if(Ga||!ka)return t.remove(l,"focus",Z),!0;Ga=ab=!0;R=!1;G();t.remove(l,"focus",Z);return!0};N=function(b){if(q)return!1;if(c.html5Only)return q=!0,F(),!0;var e=!0,d;if(!c.useFlashBlock||!c.flashLoadTimeout||c.getMoviePercent())q=!0,x&&(d={type:!D&&v?"NO_FLASH":"INIT_TIMEOUT"});if(x||b)c.useFlashBlock&&c.oMC&&(c.oMC.className=J()+" "+(null===c.getMoviePercent()?"swf_timedout":"swf_error")),E({type:"ontimeout",error:d,ignoreInit:!0}),I(d),e=!1;x||(c.waitForWindowLoad&&!oa?t.add(l,"load",F):F());return e};Ma=function(){var b,e=c.setupOptions;for(b in e)e.hasOwnProperty(b)&&(c[b]===h?c[b]=e[b]:c[b]!==e[b]&&(c.setupOptions[b]=c[b]))};na=function(){if(q)return!1;if(c.html5Only)return q||(t.remove(l,"load",c.beginDelayedInit),c.enabled=!0,N()),!0;$();try{k._externalInterfaceTest(!1),Oa(!0,c.flashPollingInterval||(c.useHighPerformance?10:50)),c.debugMode||k._disableDebug(),c.enabled=!0,c.html5Only||t.add(l,"unload",ma)}catch(b){return I({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),xa(!0),N(),!1}N();t.remove(l,"load",c.beginDelayedInit);return!0};H=function(){if(O)return!1;O=!0;Ma();wa();!D&&c.hasHTML5&&c.setup({useHTML5Audio:!0,preferFlash:!1});Wa();!D&&v&&(Ua.push(sa.needFlash),c.setup({flashLoadTimeout:1}));n.removeEventListener&&n.removeEventListener("DOMContentLoaded",H,!1);$();return!0};Ba=function(){"complete"===n.readyState&&(H(),n.detachEvent("onreadystatechange",Ba));return!0};ua=function(){oa=!0;t.remove(l,"load",ua)};ta=function(){if(Fa&&(c.setupOptions.useHTML5Audio=!0,c.setupOptions.preferFlash=!1,U||Za&&!p.match(/android\s2\.3/i)))U&&(c.ignoreFlash=!0),z=!0};ta();Da();t.add(l,"focus",Z);t.add(l,"load",G);t.add(l,"load",ua);n.addEventListener?n.addEventListener("DOMContentLoaded",H,!1):n.attachEvent?n.attachEvent("onreadystatechange",Ba):I({type:"NO_DOM2_EVENTS",fatal:!0})}var la=null;if(void 0===l.SM2_DEFER||!SM2_DEFER)la=new V;l.SoundManager=V;l.soundManager=la})(window);;(function(){var $='id'in document?document.id:window.$;if(!('en4'in window)){en4={};}
if(!('music'in en4)){en4.music={};}
en4.core.runonce.add(function(){new Element('div',{'id':'pause_preloader','class':'music_player_button_pause','style':'position: absolute; top: -9999px; left: -9999px;'}).inject(document.body).destroy();$$('a.music_add_to_playlist').addEvent('click',function(){$('song_id').value=this.id.substring(5);Smoothbox.open($('music_add_to_playlist'),{mode:'Inline'});var pl=$$('#TB_ajaxContent > div')[0];pl.show();});$$('a.music_set_profile_playlist').addEvent('click',function(){var url_part=this.href.split('/');var playlist_id=0;$each(url_part,function(val,i){if(val=='playlist_id')
playlist_id=url_part[i+1];});new Request.JSON({method:'post',url:this.href,noCache:true,data:{'playlist_id':playlist_id,'format':'json'},onSuccess:function(json){var link=$$('#music_playlist_item_'+json.playlist_id+' a.music_set_profile_playlist')[0];if(json&&json.success){$$('a.music_set_profile_playlist').set('text',en4.core.language.translate('Play on my Profile')).addClass('icon_music_playonprofile').removeClass('icon_music_disableonprofile');if(json.enabled&&link){link.set('text',en4.core.language.translate('Disable Profile Playlist')).addClass('icon_music_disableonprofile').removeClass('icon_music_playonprofile');}}}}).send();return false;});en4.music.player.enablePlayers();});en4.music.player={playlists:[],mute:(Cookie.read('en4_music_mute')==1?true:false),volume:(Cookie.read('en4_music_volume')?Cookie.read('en4_music_volume'):85),getSoundManager:function(){if(!('soundManager'in en4.music)&&'soundManager'in window){en4.music.soundManager=soundManager;}
return en4.music.soundManager;},getPlaylists:function(){return this.playlists;},getVolume:function(){if(this.mute){return 0;}else{return this.volume;}},setVolume:function(volume){if(0==volume){this.mute=true;}else{this.mute=false;this.volume=volume;}
this._writeCookies();this._updatePlaylists();},toggleMute:function(flag){if($type(flag)){this.mute=(true==flag);}else{this.mute=!this.mute;}
this._writeCookies();this._updatePlaylists();},enablePlayers:function(){var players=$$('.music_player_wrapper');en4.music.player.getSoundManager();players.each(function(el){var matches=el.get('id').match(/music_player_([\w\d]+)/i);if(matches&&matches.length>=2&&!el.hasClass('music_player_active')){el.addClass('music_player_active');en4.music.player.createPlayer(matches[1]);}});},createPlayer:function(id){var par=$('music_player_'+id);var el=par.getElement('div.music_player');en4.music.player.getSoundManager().onready(function(){if(!par.getElement('div.playlist_short_player')){if(!el.hasClass('playlist_player_loaded')){var playlist=new en4.music.playlistAbstract(el);en4.music.player.playlists.push(playlist);el.addClass('playlist_player_loaded');}}else{par.getElement('div.music_player:not(div.playlist_short_player)').hide();par.getElement('div.playlist_short_player').addEvent('click',function(){var par=$('music_player_'+id);var el=par.getElement('div.music_player');el.show();par.getElement('div.playlist_short_player').hide();if(!el.hasClass('playlist_player_loaded')){var playlist=new en4.music.playlistAbstract(el);en4.music.player.playlists.push(playlist);playlist.play();el.addClass('playlist_player_loaded');}});}});return this;},_writeCookies:function(){var tmpUri=new URI($$('head base[href]')[0]);Cookie.write('en4_music_volume',this.volume,{duration:7,path:tmpUri.get('directory'),domain:tmpUri.get('domain')});Cookie.write('en4_music_mute',(this.mute?1:0),{duration:7,path:tmpUri.get('directory'),domain:tmpUri.get('domain')});},_updatePlaylists:function(){this.playlists.each(function(playlist){playlist._updateScrub();playlist._updateVolume();});}};en4.music.playlistAbstract=new Class({Implements:[Options,Events],options:{mode:'linear',repeat:false,sliderWidth:385,containerWidth:115},container:false,songs:[],tallied:{},slider:null,sound:null,selected:0,container:null,slider_volume:null,slider_w_Volume:100,_isAttached:false,initialize:function(el,options){this.setOptions(options);this.container=$(el);this.container.getElement('div.music_player_scrub_downloaded').hide();this.songs=this.container.getElements('a.music_player_tracks_url');this._attachEvents();this._attachScrub();this._attachScrubVolume();this._isAttached=true;this._updateVolume();if(this.songs.length){if(this.songs[0]){this.setTitle(this.songs[0].getParent().get('title'));}}},getSoundManager:function(){return en4.music.player.getSoundManager();},play:function(index){if(!$type(index)){index=this.selected;}
if(index>=this.songs.length||index<0||!$type(this.songs[index])){index=0;}
var soundId=this._getSoundId(index);if(this.sound&&this.sound.sID==soundId&&this.sound.playState){this.sound.togglePause();return this;}
this.getSoundManager().stopAll();this.selected=index;this.setTitle(this.songs[index].getParent().get('title'));this.sound=this.create(index);if(this.sound){this.sound.setPosition(0);this.sound.play();}
return this;},create:function(index){if(index>=this.songs.length||index<0||!$type(this.songs[index])){return false;}
var soundId=this._getSoundId(index);if(this.getSoundManager().getSoundById(soundId)){return this.getSoundManager().getSoundById(soundId);}
var url_song="";if(unescape(this.songs[index].id)=="")
url_song=this.songs[index].href;else
url_song=unescape(this.songs[index].id);var soundOptions={id:soundId,url:url_song,autoload:true,useVideo:false,volume:en4.music.player.getVolume(),onload:function(){this.fireEvent('soundmanager_onload');}.bind(this),whileloading:function(){this.fireEvent('soundmanager_whileloading');}.bind(this),whileplaying:function(){this.fireEvent('soundmanager_whileplaying');}.bind(this),onplay:function(){this.fireEvent('soundmanager_onplay');}.bind(this),onresume:function(){this.fireEvent('soundmanager_onresume');}.bind(this),onpause:function(){this.fireEvent('soundmanager_onpause');}.bind(this),onstop:function(){this.fireEvent('soundmanager_onstop');}.bind(this),onfinish:function(){this.fireEvent('soundmanager_onfinish');}.bind(this),onbeforefinish:function(index){this.fireEvent('soundmanager_onbeforefinish',[index]);}.bind(this)};if(soundId.replace(/\?[^?]+?$/,'').match(/\.(mp3)$/)){this.getSoundManager().createSound(soundOptions);}else{this.getSoundManager().createSound(soundOptions);}
this._updateVolume();return this.getSoundManager().getSoundById(soundId);},logPlay:function(){var song_id=this.songs[this.selected].rel;var playlist_id=this.container.getElement('ul.music_player_tracks').className.split('_');playlist_id=playlist_id[playlist_id.length-1];this.songs.each(function(song,index){if(index==this.selected){song.getParent('li').addClass('song_playing');}else{song.getParent('li').removeClass('song_playing');}}.bind(this));if(!this.tallied[song_id]){this.tallied[song_id]=true;new Request.JSON({url:en4.core.baseUrl+'mp3music/album/song-play-tally',noCache:true,data:{format:'json',song_id:song_id,playlist_id:playlist_id},onSuccess:function(responseJSON){if(responseJSON&&$type(responseJSON)=='object'&&'song'in responseJSON&&'play_count'in responseJSON.song){this.songs[this.selected].getParent('li').getElement('.music_player_tracks_plays span').set('text',responseJSON.play_count);}}.bind(this)}).send();}},seekTo:function(pos){if(!this.sound){return;}
var ms_total=this.sound.durationEstimate;var ms_dest=Math.round(ms_total*(pos/this.options.sliderWidth));var diff=Math.abs(ms_dest-this.sound.position);if(this.slider.element.hasClass('mousedown')||diff>2000){this.sound.setPosition(ms_dest);}},playNext:function(){if(this.songs[this.selected+1]){this.play(this.selected+1);}else if(this.options.repeat){this.play(0);}else{this.slider.set(0);}},playPrev:function(){if(this.songs.length==1){this.seekTo(0);}else if(this.selected==0&&this.options.repeat){this.play(this.songs.length-1);}else if(this.selected==0){this.seekTo(0);}else if(this.selected>0){this.play(this.selected-1);}},launch:function(){var href=this.container.getElement('a.music_player_button_launch').href;window.open(href,'player','status=0,'+'toolbar=0,'+'location=0,'+'menubar=0,'+'directories=0,'+'scrollbars=0,'+'resizable=0,'+'height=500,'+'width=600');},setVolume:function(volume){en4.music.player.setVolume(volume);this._updateVolume();},toggleMute:function(flag){en4.music.player.toggleMute(flag);this._updateVolume();},getDuration:function(){this.container.getElement('div.music_player_time_total').get('text');},getElapsed:function(){this.container.getElement('div.music_player_time_elapsed').get('text');},getTitle:function(){this.container.getElement('div.music_player_trackname').get('text');},setTitle:function(sText){this.container.getElement('div.music_player_trackname').set('text',sText);},setDownloaded:function(pl){var self=pl;if(self.sound){var percent=100;if(self.sound.isBuffering)
percent=(self.sound.position/self.sound.durationEstimate)*100;self.getElement('div.music_player_scrub_downloaded').setStyle('width',percent);}},_getSoundId:function(index){if(!$type(this.songs[index])){return false;}
var url_song="";if(unescape(this.songs[index].id)=="")
url_song=this.songs[index].href;else
url_song=unescape(this.songs[index].id);return'_song_'+
this.container.getParent('.music_player_wrapper').id+'_'+
url_song;},_attachEvents:function(){if(this._isAttached){return;}
this.container.getElement('.music_player_button_play').addEvent('click',function(event){this.play();event.stop();return false;}.bind(this));this.container.getElement('.music_player_button_prev').addEvent('click',function(event){this.playPrev();event.stop();return false;}.bind(this));this.container.getElement('.music_player_button_next').addEvent('click',function(event){this.playNext();event.stop();return false;}.bind(this));this.container.getElement('.music_player_controls_volume_toggle').addEvent('click',function(event){en4.music.player.toggleMute();this._updateVolume();event.stop();return false;}.bind(this));this.container.getElements('ul.music_player_tracks li').addEvent('click',function(event){var el;if(!event||!('target'in event)||!(el=$(event.target))||el.hasClass('smoothbox')){return true;}
if(el.get('tag').toLowerCase()!='li'){el=el.getParent('li');}
if(this.getSoundManager().supported()){this.play(el.getAllPrevious().length);if($type(event)){event.stop();}
return false;}else{return true;}}.bind(this));this.addEvents({soundmanager_onload:this._updateDuration.bind(this),soundmanager_whileloading:this._updateDuration.bind(this),soundmanager_whileplaying:this._updateScrub.bind(this),soundmanager_onplay:function(){this.container.getElement('.music_player_button_play').addClass('music_player_button_pause');this.logPlay(this);}.bind(this),soundmanager_onresume:function(){this.container.getElement('.music_player_button_play').addClass('music_player_button_pause');}.bind(this),soundmanager_onpause:function(){this.container.getElement('.music_player_button_play').removeClass('music_player_button_pause');}.bind(this),soundmanager_onstop:function(){this.container.getElement('.music_player_button_play').removeClass('music_player_button_pause');this.slider.set(0);if(this.sound){this.container.getElement('div.music_player_time_elapsed').set('text','0:00');}}.bind(this),soundmanager_onfinish:function(){this.container.getElement('.music_player_button_play').removeClass('music_player_button_pause');this.playNext();}.bind(this),soundmanager_onbeforefinish:function(song_id){var nextsong=this.create(song_id+1);nextsong.load();}.bind(this)});},_attachScrubVolume:function(){var scrubBarVolume=this.container.getElement('div.music_player_scrub_volume');if(scrubBarVolume)
{scrubBarVolume.setStyle('width',this.slider_w_Volume);scrubBarVolume.addEvent('mousedown',function(){this.addClass('mousedown');});scrubBarVolume.addEvent('mouseup',function(){this.removeClass('mousedown');});this.slider_volume=new Slider(this.container.getElement('div.music_player_scrub_volume'),this.container.getElement('div.music_player_scrub_cursor_volume'),{snap:false,offset:0,range:[0,this.slider_w_Volume],wheel:true,steps:this.slider_w_Volume,initialStep:this.slider_w_Volume,onComplete:function(step){en4.music.player.setVolume(step);this._updateVolume;}});}},_attachScrub:function(){if(this._isAttached){return;}
var scrubBar=this.container.getElement('div.music_player_scrub');var chrome=this.container.getElement('.music_player_top').measure(function(){return this.getDimensions();});var img=this.container.getElement('.music_player_art').measure(function(){return this.getDimensions();});if(this.container.getElement('.music_player_art').isDisplayed()){this.options.sliderWidth=chrome.width-img.width;}else{this.options.sliderWidth=chrome.width;}
scrubBar.setStyle('width',this.options.sliderWidth+'px');scrubBar.addEvent('mousedown',function(){this.addClass('mousedown');});scrubBar.addEvent('mouseup',function(){this.removeClass('mousedown');});this.slider=new Slider(this.container.getElement('div.music_player_scrub'),this.container.getElement('div.music_player_scrub_cursor'),{snap:false,offset:0,range:[0,this.options.sliderWidth],wheel:true,steps:this.options.sliderWidth,initialStep:0,onComplete:this.seekTo.bind(this)});},_updateDuration:function(){if(!this.sound){return;}
var ms=this.sound.durationEstimate;var d=new Date(ms);var hms=d.getMinutes().toString()+':'+(d.getSeconds().toString().length==1?'0':'')+d.getSeconds().toString();this.container.getElement('div.music_player_time_total').set('text',hms);},_updateScrub:function(){if(!this.sound){return;}
var ms=this.sound.position;var d=new Date(ms);var hms=d.getMinutes().toString()+':'+(d.getSeconds().toString().length==1?'0':'')+d.getSeconds().toString();this.container.getElement('div.music_player_time_elapsed').set('text',hms);if(!this.slider.element.hasClass('mousedown')){var percent=(this.sound.position/this.sound.durationEstimate)*100;var steps=Math.round(percent*(this.options.sliderWidth/100));this.slider.set(steps);}},_updateVolume:function(){var mute=en4.music.player.mute;var volume=en4.music.player.getVolume();var muteButton=this.container.getElement('.music_player_controls_volume_toggle');var volumeElements=this.container.getElements('.music_player_controls_volume_bar');if(mute){if(this.sound){this.sound.mute();}
muteButton.addClass('music_player_controls_volume_toggle_mute');volumeElements.each(function(el){el.hide();});}
else{if(this.sound){this.sound.unmute();this.sound.setVolume(volume);}
muteButton.removeClass('music_player_controls_volume_toggle_mute');volumeElements.each(function(el){el.show();var bar=el.getChildren()[0];var level=bar.get('class').split('_');level=level[level.length-1];if((level*20)<=volume){el.addClass('music_player_controls_volume_enabled');}else{el.removeClass('music_player_controls_volume_enabled');}});}}});})();;Composer.Plugin.Mp3music=new Class({Extends:Composer.Plugin.Interface,name:'mp3music',options:{title:'Add Mp3 Music',lang:{},requestOptions:false,fancyUploadEnabled:true,fancyUploadOptions:{}},initialize:function(options){this.elements=new Hash(this.elements);this.params=new Hash(this.params);this.parent(options);},attach:function(){this.parent();this.makeActivator();return this;},detach:function(){this.parent();return this;},activate:function(){if(this.active)return;this.parent();this.makeMenu();this.makeBody();var fullUrl=this.options.requestOptions.url;this.elements.form=new Element('form',{'id':'compose-music-form','class':'compose-form','method':'post','action':fullUrl,'enctype':'multipart/form-data'}).inject(this.elements.body);this.elements.formInput=new Element('input',{'id':'compose-music-form-input','class':'compose-form-input','type':'file','name':'Filedata','events':{'change':this.doRequest.bind(this)}}).inject(this.elements.form);if(this.options.fancyUploadEnabled&&this.options.fancyUploadOptions){this.elements.formFancyContainer=new Element('div',{'styles':{'visibility':'hidden'}}).inject(this.elements.body);this.elements.formFancyFile=new Element('a',{'href':'javascript:void(0);','id':'compose-music-form-fancy-file','class':'buttonlink','html':this._lang('Select File')}).inject(this.elements.formFancyContainer);this.elements.formFancyStatus=new Element('div',{'html':'<div style="display:none;">\n\
  <div class="demo-status-overall" id="demo-status-overall" style="display:none;">\n\
    <div class="overall-title"></div>\n\
    <img src="" class="progress overall-progress" />\n\
  </div>\n\
  <div class="demo-status-current" id="demo-status-current" style="display:none;">\n\
    <div class="current-title"></div>\n\
    <img src="" class="progress current-progress" />\n\
  </div>\n\
  <div class="current-text"></div>\n\
</div>'}).inject(this.elements.formFancyContainer);this.elements.formFancyList=new Element('div',{'styles':{'display':'none'}}).inject(this.elements.formFancyContainer);var self=this;var opts=$merge({url:fullUrl,appendCookieData:true,multiple:false,typeFilter:{'Mp3 Music (*.mp3)':'*.mp3'},target:this.elements.formFancyFile,container:self.elements.body,onLoad:function(){self.elements.formFancyContainer.setStyle('display','');self.elements.formFancyContainer.setStyle('visibility','visible');self.elements.form.destroy();this.target.addEvents({click:function(){return false;},mouseenter:function(){this.addClass('hover');},mouseleave:function(){this.removeClass('hover');this.blur();},mousedown:function(){this.focus();}});},onSelectSuccess:function(){self.makeLoading('invisible');this.start();},onFileSuccess:function(file,response){var json=new Hash(JSON.decode(response,true)||{});self.doProcessResponse(json);}},this.options.fancyUploadOptions);try{this.elements.formFancyUpload=new FancyUpload2(this.elements.formFancyStatus,this.elements.formFancyList,opts);}catch(e){}}},deactivate:function(){if(this.params.song_id)
new Request.JSON({url:en4.core.basePath+'/mp3music/album/remove-song-album',data:{format:'json',song_id:this.params.song_id}});if(!this.active)return;this.parent();},doRequest:function(){this.elements.iframe=new IFrame({'name':'composeMusicFrame','src':'javascript:false;','styles':{'display':'none'},'events':{'load':function(){this.doProcessResponse(window._composeMusicResponse);window._composeMusicResponse=false;}.bind(this)}}).inject(this.elements.body);window._composeMusicResponse=false;this.elements.form.set('target','composeMusicFrame');this.elements.form.submit();this.elements.form.destroy();this.makeLoading();},makeLoading:function(action){if(!this.elements.loading){if(action=='empty'){this.elements.body.empty();}else if(action=='hide'){this.elements.body.getChildren().each(function(element){element.setStyle('display','none')});}else if(action=='invisible'){this.elements.body.getChildren().each(function(element){element.setStyle('height','0px').setStyle('visibility','hidden')});}
this.elements.loading=new Element('div',{'id':'compose-'+this.getName()+'-loading','class':'compose-loading'}).inject(this.elements.body);var image=this.elements.loadingImage||(new Element('img',{'id':'compose-'+this.getName()+'-loading-image','class':'compose-loading-image'}));image.inject(this.elements.loading);new Element('span',{'html':this._lang('Loading song, please wait...')}).inject(this.elements.loading);}},doProcessResponse:function(responseJSON){if(($type(responseJSON)!='object'&&$type(responseJSON)!='hash')){if(this.elements.loading)
this.elements.loading.destroy();this.makeError(this._lang('Unable to upload music. Please click cancel and try again'),'empty');return;}
if($type(parseInt(responseJSON.song_id))!='number'){if(this.elements.loading)
this.elements.loading.destroy();this.makeError(this._lang('Song got lost in the mail. Please click cancel and try again'),'empty');return;}
this.params.set('rawParams',responseJSON);this.params.set('song_id',responseJSON.song_id);this.params.set('song_title',responseJSON.song_title);this.params.set('song_url',responseJSON.song_url);this.elements.preview=new Element('a',{'href':responseJSON.song_url,'text':responseJSON.song_title,'class':'compose-music-link','onclick':"$(this).toggleClass('compose-music-link-playing');$(this).toggleClass('compose-music-link');var song = (responseJSON.song_url.match(/\.mp3$/) ? soundManager.createSound({id:'s'+"+responseJSON.song_id+",url:'"+responseJSON.song_url+"'}) : soundManager.createVideo({id:'s'+"+responseJSON.song_id+",url:'"+responseJSON.song_url+"'}));song.togglePause();return false;"});this.elements.preview.set('text',responseJSON.song_title);this.doSongLoaded();},doSongLoaded:function(){if(this.elements.loading)
this.elements.loading.destroy();if(this.elements.formFancyContainer)
this.elements.formFancyContainer.destroy();this.elements.preview.inject(this.elements.body);this.makeFormInputs();},makeFormInputs:function(){this.ready();this.parent({'song_id':this.params.song_id});}});(function(){var $='id'in document?document.id:window.$;Composer.Plugin.Video=new Class({Extends:Composer.Plugin.Interface,name:'video',options:{title:'Add Video',lang:{},requestOptions:{},imageMaxAspect:(10/3),imageMinAspect:(3/10),imageMinSize:48,imageMaxSize:5000,imageMinPixels:2304,imageMaxPixels:1000000,imageTimeout:5000,monitorDelay:250},initialize:function(options){this.elements=new Hash(this.elements);this.params=new Hash(this.params);this.parent(options);},attach:function(){this.parent();this.makeActivator();return this;},detach:function(){this.parent();return this;},activate:function(){if(this.active)return;this.parent();this.makeMenu();this.makeBody();this.elements.formInput=new Element('select',{'id':'compose-video-form-type','class':'compose-form-input','option':'test','events':{'change':this.updateVideoFields.bind(this)}}).inject(this.elements.body);var options=0;$('compose-video-form-type').options[options++]=new Option(this._lang('Choose Source'),'0');if(this.options.youtubeEnabled==1){$('compose-video-form-type').options[options++]=new Option(this._lang('YouTube'),'1');}
$('compose-video-form-type').options[options++]=new Option(this._lang('Vimeo'),'2');this.elements.formInput=new Element('input',{'id':'compose-video-form-input','class':'compose-form-input','type':'text','style':'display:none;'}).inject(this.elements.body);if(DetectMobileQuick()||DetectIpad()){if(this.options.allowed==1&&this.options.type!='message'){$('compose-video-form-type').options[options++]=new Option(this._lang('My Device'),'3');}
this.elements.previewDescription=new Element('div',{'id':'compose-video-upload','class':'compose-video-upload','html':this._lang('To upload a video from your device, please use our full uploader.'),'style':'display:none;'}).inject(this.elements.body);}
else{if(this.options.allowed==1&&this.options.type!='message'){$('compose-video-form-type').options[options++]=new Option(this._lang('My Computer'),'3');}
this.elements.previewDescription=new Element('div',{'id':'compose-video-upload','class':'compose-video-upload','html':this._lang('To upload a video from your computer, please use our full uploader.'),'style':'display:none;'}).inject(this.elements.body);}
this.elements.formSubmit=new Element('button',{'id':'compose-video-form-submit','class':'compose-form-submit','style':'display:none;','html':this._lang('Attach'),'events':{'click':function(e){e.stop();this.doAttach();}.bind(this)}}).inject(this.elements.body);this.elements.formInput.focus();},deactivate:function(){if(this.params.video_id)
new Request.JSON({url:en4.core.basePath+'video/index/delete',data:{format:'json',video_id:this.params.video_id}}).send();if(!this.active)return;this.parent();},doAttach:function(e){var val=this.elements.formInput.value;if(!val)
{return;}
if(!val.match(/^[a-zA-Z]{1,5}:\/\//))
{val='http://'+val;}
this.params.set('uri',val)
if(val==''){e.stop();return;}
var video_element=document.getElementById("compose-video-form-type");var type=video_element.value;var options=$merge({'data':{'format':'json','uri':val,'type':type},'onComplete':this.doProcessResponse.bind(this)},this.options.requestOptions);this.makeLoading('empty');this.request=new Request.JSON(options);this.request.send();},doProcessResponse:function(responseJSON,responseText){if(($type(responseJSON)!='hash'&&$type(responseJSON)!='object')||$type(responseJSON.src)!='string'||$type(parseInt(responseJSON.video_id))!='number'){if(this.elements.loading)this.elements.loading.destroy();this.makeError(responseJSON.message);this.elements.ignoreValidation=new Element('a',{'href':this.params.uri,'html':this.params.title,'events':{'click':function(e){e.stop();self.doAttach(this);}}}).inject(this.elements.previewTitle);return;}
var title=responseJSON.title||this.params.get('uri').replace('http://','');this.params.set('title',responseJSON.title);this.params.set('description',responseJSON.description);this.params.set('photo_id',responseJSON.photo_id);this.params.set('video_id',responseJSON.video_id);this.elements.preview=Asset.image(responseJSON.src,{'id':'compose-video-preview-image','class':'compose-preview-image','onload':this.doImageLoaded.bind(this)});},doImageLoaded:function(){var self=this;if(this.elements.loading)this.elements.loading.destroy();this.elements.preview.erase('width');this.elements.preview.erase('height');this.elements.preview.inject(this.elements.body);this.elements.previewInfo=new Element('div',{'id':'compose-video-preview-info','class':'compose-preview-info'}).inject(this.elements.body);this.elements.previewTitle=new Element('div',{'id':'compose-video-preview-title','class':'compose-preview-title'}).inject(this.elements.previewInfo);this.elements.previewTitleLink=new Element('a',{'href':this.params.uri,'html':this.params.title,'events':{'click':function(e){e.stop();self.handleEditTitle(this);}}}).inject(this.elements.previewTitle);this.elements.previewDescription=new Element('div',{'id':'compose-video-preview-description','class':'compose-preview-description','html':this.params.description,'events':{'click':function(e){e.stop();self.handleEditDescription(this);}}}).inject(this.elements.previewInfo);this.makeFormInputs();},makeFormInputs:function(){this.ready();this.parent({'photo_id':this.params.photo_id,'video_id':this.params.video_id,'title':this.params.title,'description':this.params.description});},updateVideoFields:function(element){var video_element=document.getElementById("compose-video-form-type");var url_element=document.getElementById("compose-video-form-input");var post_element=document.getElementById("compose-video-form-submit");var upload_element=document.getElementById("compose-video-upload");$('compose-video-form-input').value="";if(video_element.value==0)
{upload_element.style.display="none";post_element.style.display="none";url_element.style.display="none";}
if(video_element.value==1||video_element.value==2)
{upload_element.style.display="none";post_element.style.display="block";url_element.style.display="block";url_element.focus();}
if(video_element.value==3)
{upload_element.style.display="block";post_element.style.display="none";url_element.style.display="none";}},handleEditTitle:function(element){element.setStyle('display','none');var input=new Element('input',{'type':'text','value':htmlspecialchars_decode(element.get('html').trim()),'events':{'blur':function(){if(input.value.trim()!=''){this.params.title=input.value;element.set('html',this.params.title);this.setFormInputValue('title',this.params.title);}
element.setStyle('display','');input.destroy();}.bind(this)}}).inject(element,'after');input.focus();},handleEditDescription:function(element){element.setStyle('display','none');var input=new Element('textarea',{'html':htmlspecialchars_decode(element.get('html').trim()),'events':{'blur':function(){if(input.value.trim()!=''){this.params.description=input.value;element.set('html',this.params.description);this.setFormInputValue('description',this.params.description);}
else{this.params.description='';element.set('html','');this.setFormInputValue('description','');}
element.setStyle('display','');input.destroy();}.bind(this)}}).inject(element,'after');input.focus();}});})();
;/*
 * flowplayer.js The Flowplayer API
 *
 * Copyright 2009-2011 Flowplayer Oy
 *
 * This file is part of Flowplayer.
 *
 * Flowplayer is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Flowplayer is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Flowplayer.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
!function(){function h(p){console.log("$f.fireEvent",[].slice.call(p))}function l(r){if(!r||typeof r!="object"){return r}var p=new r.constructor();for(var q in r){if(r.hasOwnProperty(q)){p[q]=l(r[q])}}return p}function n(u,r){if(!u){return}var p,q=0,s=u.length;if(s===undefined){for(p in u){if(r.call(u[p],p,u[p])===false){break}}}else{for(var t=u[0];q<s&&r.call(t,q,t)!==false;t=u[++q]){}}return u}function c(p){return document.getElementById(p)}function j(r,q,p){if(typeof q!="object"){return r}if(r&&q){n(q,function(s,t){if(!p||typeof t!="function"){r[s]=t}})}return r}function o(t){var r=t.indexOf(".");if(r!=-1){var q=t.slice(0,r)||"*";var p=t.slice(r+1,t.length);var s=[];n(document.getElementsByTagName(q),function(){if(this.className&&this.className.indexOf(p)!=-1){s.push(this)}});return s}}function g(p){p=p||window.event;if(p.preventDefault){p.stopPropagation();p.preventDefault()}else{p.returnValue=false;p.cancelBubble=true}return false}function k(r,p,q){r[p]=r[p]||[];r[p].push(q)}function e(p){return p.replace(/&amp;/g,"%26").replace(/&/g,"%26").replace(/=/g,"%3D")}function f(){return"_"+(""+Math.random()).slice(2,10)}var i=function(u,s,t){var r=this,q={},v={};r.index=s;if(typeof u=="string"){u={url:u}}j(this,u,true);n(("Begin*,Start,Pause*,Resume*,Seek*,Stop*,Finish*,LastSecond,Update,BufferFull,BufferEmpty,BufferStop").split(","),function(){var w="on"+this;if(w.indexOf("*")!=-1){w=w.slice(0,w.length-1);var x="onBefore"+w.slice(2);r[x]=function(y){k(v,x,y);return r}}r[w]=function(y){k(v,w,y);return r};if(s==-1){if(r[x]){t[x]=r[x]}if(r[w]){t[w]=r[w]}}});j(this,{onCuepoint:function(y,x){if(arguments.length==1){q.embedded=[null,y];return r}if(typeof y=="number"){y=[y]}var w=f();q[w]=[y,x];if(t.isLoaded()){t._api().fp_addCuepoints(y,s,w)}return r},update:function(x){j(r,x);if(t.isLoaded()){t._api().fp_updateClip(x,s)}var w=t.getConfig();var y=(s==-1)?w.clip:w.playlist[s];j(y,x,true)},_fireEvent:function(w,z,x,B){if(w=="onLoad"){n(q,function(C,D){if(D[0]){t._api().fp_addCuepoints(D[0],s,C)}});return false}B=B||r;if(w=="onCuepoint"){var A=q[z];if(A){return A[1].call(t,B,x)}}if(z&&"onBeforeBegin,onMetaData,onMetaDataChange,onStart,onUpdate,onResume".indexOf(w)!=-1){j(B,z);if(z.metaData){if(!B.duration){B.duration=z.metaData.duration}else{B.fullDuration=z.metaData.duration}}}var y=true;n(v[w],function(){y=this.call(t,B,z,x)});return y}});if(u.onCuepoint){var p=u.onCuepoint;r.onCuepoint.apply(r,typeof p=="function"?[p]:p);delete u.onCuepoint}n(u,function(w,x){if(typeof x=="function"){k(v,w,x);delete u[w]}});if(s==-1){t.onCuepoint=this.onCuepoint}};var m=function(q,s,r,u){var p=this,t={},v=false;if(u){j(t,u)}n(s,function(w,x){if(typeof x=="function"){t[w]=x;delete s[w]}});j(this,{animate:function(z,A,y){if(!z){return p}if(typeof A=="function"){y=A;A=500}if(typeof z=="string"){var x=z;z={};z[x]=A;A=500}if(y){var w=f();t[w]=y}if(A===undefined){A=500}s=r._api().fp_animate(q,z,A,w);return p},css:function(x,y){if(y!==undefined){var w={};w[x]=y;x=w}s=r._api().fp_css(q,x);j(p,s);return p},show:function(){this.display="block";r._api().fp_showPlugin(q);return p},hide:function(){this.display="none";r._api().fp_hidePlugin(q);return p},toggle:function(){this.display=r._api().fp_togglePlugin(q);return p},fadeTo:function(z,y,x){if(typeof y=="function"){x=y;y=500}if(x){var w=f();t[w]=x}this.display=r._api().fp_fadeTo(q,z,y,w);this.opacity=z;return p},fadeIn:function(x,w){return p.fadeTo(1,x,w)},fadeOut:function(x,w){return p.fadeTo(0,x,w)},getName:function(){return q},getPlayer:function(){return r},_fireEvent:function(x,w,y){if(x=="onUpdate"){var A=r._api().fp_getPlugin(q);if(!A){return}j(p,A);delete p.methods;if(!v){n(A.methods,function(){var C=""+this;p[C]=function(){var D=[].slice.call(arguments);var E=r._api().fp_invoke(q,C,D);return E==="undefined"||E===undefined?p:E}});v=true}}var B=t[x];if(B){var z=B.apply(p,w);if(x.slice(0,1)=="_"){delete t[x]}return z}return p}})};function b(r,H,u){var x=this,w=null,E=false,v,t,G=[],z={},y={},F,s,q,D,p,B;j(x,{id:function(){return F},isLoaded:function(){return(w!==null&&w.fp_play!==undefined&&!E)},getParent:function(){return r},hide:function(I){if(I){r.style.height="0px"}if(x.isLoaded()){w.style.height="0px"}return x},show:function(){r.style.height=B+"px";if(x.isLoaded()){w.style.height=p+"px"}return x},isHidden:function(){return x.isLoaded()&&parseInt(w.style.height,10)===0},load:function(K){if(!x.isLoaded()&&x._fireEvent("onBeforeLoad")!==false){var I=function(){if(v&&!flashembed.isSupported(H.version)){r.innerHTML=""}if(K){K.cached=true;k(y,"onLoad",K)}flashembed(r,H,{config:u})};var J=0;n(a,function(){this.unload(function(L){if(++J==a.length){I()}})})}return x},unload:function(K){if(v.replace(/\s/g,"")!==""){if(x._fireEvent("onBeforeUnload")===false){if(K){K(false)}return x}E=true;try{if(w){if(w.fp_isFullscreen()){w.fp_toggleFullscreen()}w.fp_close();x._fireEvent("onUnload")}}catch(I){}var J=function(){w=null;r.innerHTML=v;E=false;if(K){K(true)}};if(/WebKit/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)){setTimeout(J,0)}else{J()}}else{if(K){K(false)}}return x},getClip:function(I){if(I===undefined){I=D}return G[I]},getCommonClip:function(){return t},getPlaylist:function(){return G},getPlugin:function(I){var K=z[I];if(!K&&x.isLoaded()){var J=x._api().fp_getPlugin(I);if(J){K=new m(I,J,x);z[I]=K}}return K},getScreen:function(){return x.getPlugin("screen")},getControls:function(){return x.getPlugin("controls")._fireEvent("onUpdate")},getLogo:function(){try{return x.getPlugin("logo")._fireEvent("onUpdate")}catch(I){}},getPlay:function(){return x.getPlugin("play")._fireEvent("onUpdate")},getConfig:function(I){return I?l(u):u},getFlashParams:function(){return H},loadPlugin:function(L,K,N,M){if(typeof N=="function"){M=N;N={}}var J=M?f():"_";x._api().fp_loadPlugin(L,K,N,J);var I={};I[J]=M;var O=new m(L,null,x,I);z[L]=O;return O},getState:function(){return x.isLoaded()?w.fp_getState():-1},play:function(J,I){var K=function(){if(J!==undefined){x._api().fp_play(J,I)}else{x._api().fp_play()}};if(x.isLoaded()){K()}else{if(E){setTimeout(function(){x.play(J,I)},50)}else{x.load(function(){K()})}}return x},getVersion:function(){var J="flowplayer.js @VERSION";if(x.isLoaded()){var I=w.fp_getVersion();I.push(J);return I}return J},_api:function(){if(!x.isLoaded()){throw"Flowplayer "+x.id()+" not loaded when calling an API method"}return w},setClip:function(I){n(I,function(J,K){if(typeof K=="function"){k(y,J,K);delete I[J]}else{if(J=="onCuepoint"){$f(r).getCommonClip().onCuepoint(I[J][0],I[J][1])}}});x.setPlaylist([I]);return x},getIndex:function(){return q},bufferAnimate:function(I){w.fp_bufferAnimate(I===undefined||I);return x},_swfHeight:function(){return w.clientHeight}});n(("Click*,Load*,Unload*,Keypress*,Volume*,Mute*,Unmute*,PlaylistReplace,ClipAdd,Fullscreen*,FullscreenExit,Error,MouseOver,MouseOut").split(","),function(){var I="on"+this;if(I.indexOf("*")!=-1){I=I.slice(0,I.length-1);var J="onBefore"+I.slice(2);x[J]=function(K){k(y,J,K);return x}}x[I]=function(K){k(y,I,K);return x}});n(("pause,resume,mute,unmute,stop,toggle,seek,getStatus,getVolume,setVolume,getTime,isPaused,isPlaying,startBuffering,stopBuffering,isFullscreen,toggleFullscreen,reset,close,setPlaylist,addClip,playFeed,setKeyboardShortcutsEnabled,isKeyboardShortcutsEnabled").split(","),function(){var I=this;x[I]=function(K,J){if(!x.isLoaded()){return x}var L=null;if(K!==undefined&&J!==undefined){L=w["fp_"+I](K,J)}else{L=(K===undefined)?w["fp_"+I]():w["fp_"+I](K)}return L==="undefined"||L===undefined?x:L}});x._fireEvent=function(R){if(typeof R=="string"){R=[R]}var S=R[0],P=R[1],N=R[2],M=R[3],L=0;if(u.debug){h(R)}if(!x.isLoaded()&&S=="onLoad"&&P=="player"){w=w||c(s);p=x._swfHeight();n(G,function(){this._fireEvent("onLoad")});n(z,function(T,U){U._fireEvent("onUpdate")});t._fireEvent("onLoad")}if(S=="onLoad"&&P!="player"){return}if(S=="onError"){if(typeof P=="string"||(typeof P=="number"&&typeof N=="number")){P=N;N=M}}if(S=="onContextMenu"){n(u.contextMenu[P],function(T,U){U.call(x)});return}if(S=="onPluginEvent"||S=="onBeforePluginEvent"){var I=P.name||P;var J=z[I];if(J){J._fireEvent("onUpdate",P);return J._fireEvent(N,R.slice(3))}return}if(S=="onPlaylistReplace"){G=[];var O=0;n(P,function(){G.push(new i(this,O++,x))})}if(S=="onClipAdd"){if(P.isInStream){return}P=new i(P,N,x);G.splice(N,0,P);for(L=N+1;L<G.length;L++){G[L].index++}}var Q=true;if(typeof P=="number"&&P<G.length){D=P;var K=G[P];if(K){Q=K._fireEvent(S,N,M)}if(!K||Q!==false){Q=t._fireEvent(S,N,M,K)}}n(y[S],function(){Q=this.call(x,P,N);if(this.cached){y[S].splice(L,1)}if(Q===false){return false}L++});return Q};function C(){if($f(r)){$f(r).getParent().innerHTML="";q=$f(r).getIndex();a[q]=x}else{a.push(x);q=a.length-1}B=parseInt(r.style.height,10)||r.clientHeight;F=r.id||"fp"+f();s=H.id||F+"_api";H.id=s;v=r.innerHTML;if(typeof u=="string"){u={clip:{url:u}}}u.playerId=F;u.clip=u.clip||{};if(r.getAttribute("href",2)&&!u.clip.url){u.clip.url=r.getAttribute("href",2)}if(u.clip.url){u.clip.url=e(u.clip.url)}t=new i(u.clip,-1,x);u.playlist=u.playlist||[u.clip];var J=0;n(u.playlist,function(){var M=this;if(typeof M=="object"&&M.length){M={url:""+M}}if(M.url){M.url=e(M.url)}n(u.clip,function(N,O){if(O!==undefined&&M[N]===undefined&&typeof O!="function"){M[N]=O}});u.playlist[J]=M;M=new i(M,J,x);G.push(M);J++});n(u,function(M,N){if(typeof N=="function"){if(t[M]){t[M](N)}else{k(y,M,N)}delete u[M]}});n(u.plugins,function(M,N){if(N){z[M]=new m(M,N,x)}});if(!u.plugins||u.plugins.controls===undefined){z.controls=new m("controls",null,x)}z.canvas=new m("canvas",null,x);v=r.innerHTML;function L(M){if(/iPad|iPhone|iPod/i.test(navigator.userAgent)&&!/.flv$/i.test(G[0].url)&&!K()){return true}if(!x.isLoaded()&&x._fireEvent("onBeforeClick")!==false){x.load()}return g(M)}function K(){return x.hasiPadSupport&&x.hasiPadSupport()}function I(){if(v.replace(/\s/g,"")!==""){if(r.addEventListener){r.addEventListener("click",L,false)}else{if(r.attachEvent){r.attachEvent("onclick",L)}}}else{if(r.addEventListener&&!K()){r.addEventListener("click",g,false)}x.load()}}setTimeout(I,0)}if(typeof r=="string"){var A=c(r);if(!A){throw"Flowplayer cannot access element: "+r}r=A;C()}else{C()}}var a=[];function d(p){this.length=p.length;this.each=function(r){n(p,r)};this.size=function(){return p.length};var q=this;for(name in b.prototype){q[name]=function(){var r=arguments;q.each(function(){this[name].apply(this,r)})}}}window.flowplayer=window.$f=function(){var q=null;var p=arguments[0];if(!arguments.length){n(a,function(){if(this.isLoaded()){q=this;return false}});return q||a[0]}if(arguments.length==1){if(typeof p=="number"){return a[p]}else{if(p=="*"){return new d(a)}n(a,function(){if(this.id()==p.id||this.id()==p||this.getParent()==p){q=this;return false}});return q}}if(arguments.length>1){var u=arguments[1],r=(arguments.length==3)?arguments[2]:{};if(typeof u=="string"){u={src:u}}u=j({bgcolor:"#000000",version:[10,1],expressInstall:"http://releases.flowplayer.org/swf/expressinstall.swf",cachebusting:false},u);if(typeof p=="string"){if(p.indexOf(".")!=-1){var t=[];n(o(p),function(){t.push(new b(this,l(u),l(r)))});return new d(t)}else{var s=c(p);return new b(s!==null?s:l(p),l(u),l(r))}}else{if(p){return new b(p,l(u),l(r))}}}return null};j(window.$f,{fireEvent:function(){var q=[].slice.call(arguments);var r=$f(q[0]);return r?r._fireEvent(q.slice(1)):null},addPlugin:function(p,q){b.prototype[p]=q;return $f},each:n,extend:j});if(typeof jQuery=="function"){jQuery.fn.flowplayer=function(r,q){if(!arguments.length||typeof arguments[0]=="number"){var p=[];this.each(function(){var s=$f(this);if(s){p.push(s)}});return arguments.length?p[arguments[0]]:new d(p)}return this.each(function(){$f(this,l(r),q?l(q):{})})}}}();!function(){var h=document.all,j="http://get.adobe.com/flashplayer",c=typeof jQuery=="function",e=/(\d+)[^\d]+(\d+)[^\d]*(\d*)/,b={width:"100%",height:"100%",id:"_"+(""+Math.random()).slice(9),allowfullscreen:true,allowscriptaccess:"always",quality:"high",version:[3,0],onFail:null,expressInstall:null,w3c:false,cachebusting:false};if(window.attachEvent){window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){}})}function i(m,l){if(l){for(var f in l){if(l.hasOwnProperty(f)){m[f]=l[f]}}}return m}function a(f,n){var m=[];for(var l in f){if(f.hasOwnProperty(l)){m[l]=n(f[l])}}return m}window.flashembed=function(f,m,l){if(typeof f=="string"){f=document.getElementById(f.replace("#",""))}if(!f){return}if(typeof m=="string"){m={src:m}}return new d(f,i(i({},b),m),l)};var g=i(window.flashembed,{conf:b,getVersion:function(){var m,f,o;try{o=navigator.plugins["Shockwave Flash"];if(o[0].enabledPlugin!=null){f=o.description.slice(16)}}catch(p){try{m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");f=m&&m.GetVariable("$version")}catch(n){try{m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");f=m&&m.GetVariable("$version")}catch(l){}}}f=e.exec(f);return f?[1*f[1],1*f[(f[1]*1>9?2:3)]*1]:[0,0]},asString:function(l){if(l===null||l===undefined){return null}var f=typeof l;if(f=="object"&&l.push){f="array"}switch(f){case"string":l=l.replace(new RegExp('(["\\\\])',"g"),"\\$1");l=l.replace(/^\s?(\d+\.?\d*)%/,"$1pct");return'"'+l+'"';case"array":return"["+a(l,function(o){return g.asString(o)}).join(",")+"]";case"function":return'"function()"';case"object":var m=[];for(var n in l){if(l.hasOwnProperty(n)){m.push('"'+n+'":'+g.asString(l[n]))}}return"{"+m.join(",")+"}"}return String(l).replace(/\s/g," ").replace(/\'/g,'"')},getHTML:function(o,l){o=i({},o);var n='<object width="'+o.width+'" height="'+o.height+'" id="'+o.id+'" name="'+o.id+'"';if(o.cachebusting){o.src+=((o.src.indexOf("?")!=-1?"&":"?")+Math.random())}if(o.w3c||!h){n+=' data="'+o.src+'" type="application/x-shockwave-flash"'}else{n+=' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'}n+=">";if(o.w3c||h){n+='<param name="movie" value="'+o.src+'" />'}o.width=o.height=o.id=o.w3c=o.src=null;o.onFail=o.version=o.expressInstall=null;for(var m in o){if(o[m]){n+='<param name="'+m+'" value="'+o[m]+'" />'}}var p="";if(l){for(var f in l){if(l[f]){var q=l[f];p+=f+"="+(/function|object/.test(typeof q)?g.asString(q):q)+"&"}}p=p.slice(0,-1);n+='<param name="flashvars" value=\''+p+"' />"}n+="</object>";return n},isSupported:function(f){return k[0]>f[0]||k[0]==f[0]&&k[1]>=f[1]}});var k=g.getVersion();function d(f,n,m){if(g.isSupported(n.version)){f.innerHTML=g.getHTML(n,m)}else{if(n.expressInstall&&g.isSupported([6,65])){f.innerHTML=g.getHTML(i(n,{src:n.expressInstall}),{MMredirectURL:encodeURIComponent(location.href),MMplayerType:"PlugIn",MMdoctitle:document.title})}else{if(!f.innerHTML.replace(/\s/g,"")){f.innerHTML="<h2>Flash version "+n.version+" or greater is required</h2><h3>"+(k[0]>0?"Your version is "+k:"You have no flash plugin installed")+"</h3>"+(f.tagName=="A"?"<p>Click here to download latest version</p>":"<p>Download latest version from <a href='"+j+"'>here</a></p>");if(f.tagName=="A"||f.tagName=="DIV"){f.onclick=function(){location.href=j}}}if(n.onFail){var l=n.onFail.call(this);if(typeof l=="string"){f.innerHTML=l}}}}if(h){window[n.id]=document.getElementById(n.id)}i(this,{getRoot:function(){return f},getOptions:function(){return n},getConf:function(){return m},getApi:function(){return f.firstChild}})}if(c){jQuery.tools=jQuery.tools||{version:"@VERSION"};jQuery.tools.flashembed={conf:b};jQuery.fn.flashembed=function(l,f){return this.each(function(){$(this).data("flashembed",flashembed(this,l,f))})}}}();
;!function(){function e(e){console.log("$f.fireEvent",[].slice.call(e))}function t(e){if(!e||"object"!=typeof e)return e;var n=new e.constructor;for(var r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function n(e,t){if(e){var n,r=0,i=e.length;if(void 0===i){for(n in e)if(t.call(e[n],n,e[n])===!1)break}else for(var o=e[0];i>r&&t.call(o,r,o)!==!1;o=e[++r]);return e}}function r(e){return document.getElementById(e)}function i(e,t,r){return"object"!=typeof t?e:(e&&t&&n(t,function(t,n){r&&"function"==typeof n||(e[t]=n)}),e)}function o(e){var t=e.indexOf(".");if(-1!=t){var r=e.slice(0,t)||"*",i=e.slice(t+1,e.length),o=[];return n(document.getElementsByTagName(r),function(){this.className&&-1!=this.className.indexOf(i)&&o.push(this)}),o}}function a(e){return e=e||window.event,e.preventDefault?(e.stopPropagation(),e.preventDefault()):(e.returnValue=!1,e.cancelBubble=!0),!1}function u(e,t,n){e[t]=e[t]||[],e[t].push(n)}function l(){return"_"+(""+Math.random()).slice(2,10)}function s(o,s,f){function g(){function e(e){var t=S.hasiPadSupport&&S.hasiPadSupport();return!/iPad|iPhone|iPod/i.test(navigator.userAgent)||/.flv$/i.test(C[0].url)||t?(S.isLoaded()||S._fireEvent("onBeforeClick")===!1||S.load(),a(e)):!0}function t(){""!==h.replace(/\s/g,"")?o.addEventListener?o.addEventListener("click",e,!1):o.attachEvent&&o.attachEvent("onclick",e):(o.addEventListener&&o.addEventListener("click",a,!1),S.load())}$f(o)?($f(o).getParent().innerHTML="",w=$f(o).getIndex(),p[w]=S):(p.push(S),w=p.length-1),E=parseInt(o.style.height,10)||o.clientHeight,y=o.id||"fp"+l(),m=s.id||y+"_api",s.id=m,f.playerId=y,"string"==typeof f&&(f={clip:{url:f}}),"string"==typeof f.clip&&(f.clip={url:f.clip}),f.clip=f.clip||{},o.getAttribute("href",2)&&!f.clip.url&&(f.clip.url=o.getAttribute("href",2)),v=new c(f.clip,-1,S),f.playlist=f.playlist||[f.clip];var r=0;n(f.playlist,function(){var e=this;"object"==typeof e&&e.length&&(e={url:""+e}),n(f.clip,function(t,n){void 0!==n&&void 0===e[t]&&"function"!=typeof n&&(e[t]=n)}),f.playlist[r]=e,e=new c(e,r,S),C.push(e),r++}),n(f,function(e,t){"function"==typeof t&&(v[e]?v[e](t):u(x,e,t),delete f[e])}),n(f.plugins,function(e,t){t&&(k[e]=new d(e,t,S))}),f.plugins&&void 0!==f.plugins.controls||(k.controls=new d("controls",null,S)),k.canvas=new d("canvas",null,S),h=o.innerHTML,setTimeout(t,0)}var h,v,y,m,w,b,_,E,S=this,L=null,P=!1,C=[],k={},x={};if(i(S,{id:function(){return y},isLoaded:function(){return null!==L&&void 0!==L.fp_play&&!P},getParent:function(){return o},hide:function(e){return e&&(o.style.height="0px"),S.isLoaded()&&(L.style.height="0px"),S},show:function(){return o.style.height=E+"px",S.isLoaded()&&(L.style.height=_+"px"),S},isHidden:function(){return S.isLoaded()&&0===parseInt(L.style.height,10)},load:function(e){if(!S.isLoaded()&&S._fireEvent("onBeforeLoad")!==!1){var t=function(){h=o.innerHTML,h&&!flashembed.isSupported(s.version)&&(o.innerHTML=""),e&&(e.cached=!0,u(x,"onLoad",e)),flashembed(o,s,{config:f})},r=0;n(p,function(){this.unload(function(){++r==p.length&&t()})})}return S},unload:function(e){if(this.isFullscreen()&&/WebKit/i.test(navigator.userAgent))return e&&e(!1),S;if(""!==h.replace(/\s/g,"")){if(S._fireEvent("onBeforeUnload")===!1)return e&&e(!1),S;P=!0;try{L&&(L.fp_close(),S._fireEvent("onUnload"))}catch(t){}var n=function(){L=null,o.innerHTML=h,P=!1,e&&e(!0)};setTimeout(n,50)}else e&&e(!1);return S},getClip:function(e){return void 0===e&&(e=b),C[e]},getCommonClip:function(){return v},getPlaylist:function(){return C},getPlugin:function(e){var t=k[e];if(!t&&S.isLoaded()){var n=S._api().fp_getPlugin(e);n&&(t=new d(e,n,S),k[e]=t)}return t},getScreen:function(){return S.getPlugin("screen")},getControls:function(){return S.getPlugin("controls")._fireEvent("onUpdate")},getLogo:function(){try{return S.getPlugin("logo")._fireEvent("onUpdate")}catch(e){}},getPlay:function(){return S.getPlugin("play")._fireEvent("onUpdate")},getConfig:function(e){return e?t(f):f},getFlashParams:function(){return s},loadPlugin:function(e,t,n,r){"function"==typeof n&&(r=n,n={});var i=r?l():"_";S._api().fp_loadPlugin(e,t,n,i);var o={};o[i]=r;var a=new d(e,null,S,o);return k[e]=a,a},getState:function(){return S.isLoaded()?L.fp_getState():-1},play:function(e,t){var n=function(){void 0!==e?S._api().fp_play(e,t):S._api().fp_play()};return S.isLoaded()?n():P?setTimeout(function(){S.play(e,t)},50):S.load(function(){n()}),S},getVersion:function(){var e="flowplayer.js 3.2.6";if(S.isLoaded()){var t=L.fp_getVersion();return t.push(e),t}return e},_api:function(){if(!S.isLoaded())throw"Flowplayer "+S.id()+" not loaded when calling an API method";return L},setClip:function(e){return S.setPlaylist([e]),S},getIndex:function(){return w},_swfHeight:function(){return L.clientHeight}}),n("Click*,Load*,Unload*,Keypress*,Volume*,Mute*,Unmute*,PlaylistReplace,ClipAdd,Fullscreen*,FullscreenExit,Error,MouseOver,MouseOut".split(","),function(){var e="on"+this;if(-1!=e.indexOf("*")){e=e.slice(0,e.length-1);var t="onBefore"+e.slice(2);S[t]=function(e){return u(x,t,e),S}}S[e]=function(t){return u(x,e,t),S}}),n("pause,resume,mute,unmute,stop,toggle,seek,getStatus,getVolume,setVolume,getTime,isPaused,isPlaying,startBuffering,stopBuffering,isFullscreen,toggleFullscreen,reset,close,setPlaylist,addClip,playFeed,setKeyboardShortcutsEnabled,isKeyboardShortcutsEnabled".split(","),function(){var e=this;S[e]=function(t,n){if(!S.isLoaded())return S;var r=null;return r=void 0!==t&&void 0!==n?L["fp_"+e](t,n):void 0===t?L["fp_"+e]():L["fp_"+e](t),"undefined"===r||void 0===r?S:r}}),S._fireEvent=function(t){"string"==typeof t&&(t=[t]);var i=t[0],o=t[1],a=t[2],u=t[3],l=0;if(f.debug&&e(t),S.isLoaded()||"onLoad"!=i||"player"!=o||(L=L||r(m),_=S._swfHeight(),n(C,function(){this._fireEvent("onLoad")}),n(k,function(e,t){t._fireEvent("onUpdate")}),v._fireEvent("onLoad")),"onLoad"!=i||"player"==o){if("onError"==i&&("string"==typeof o||"number"==typeof o&&"number"==typeof a)&&(o=a,a=u),"onContextMenu"==i)return void n(f.contextMenu[o],function(e,t){t.call(S)});if("onPluginEvent"!=i&&"onBeforePluginEvent"!=i){if("onPlaylistReplace"==i){C=[];var s=0;n(o,function(){C.push(new c(this,s++,S))})}if("onClipAdd"==i){if(o.isInStream)return;for(o=new c(o,a,S),C.splice(a,0,o),l=a+1;l<C.length;l++)C[l].index++}var d=!0;if("number"==typeof o&&o<C.length){b=o;var p=C[o];p&&(d=p._fireEvent(i,a,u)),p&&d===!1||(d=v._fireEvent(i,a,u,p))}return n(x[i],function(){return d=this.call(S,o,a),this.cached&&x[i].splice(l,1),d===!1?!1:void l++}),d}var g=o.name||o,h=k[g];if(h)return h._fireEvent("onUpdate",o),h._fireEvent(a,t.slice(3))}},"string"==typeof o){var T=r(o);if(!T)throw"Flowplayer cannot access element: "+o;o=T,g()}else g()}function f(e){this.length=e.length,this.each=function(t){n(e,t)},this.size=function(){return e.length}}var c=function(e,t,r){var o=this,a={},s={};if(o.index=t,"string"==typeof e&&(e={url:e}),i(this,e,!0),n("Begin*,Start,Pause*,Resume*,Seek*,Stop*,Finish*,LastSecond,Update,BufferFull,BufferEmpty,BufferStop".split(","),function(){var e="on"+this;if(-1!=e.indexOf("*")){e=e.slice(0,e.length-1);var n="onBefore"+e.slice(2);o[n]=function(e){return u(s,n,e),o}}o[e]=function(t){return u(s,e,t),o},-1==t&&(o[n]&&(r[n]=o[n]),o[e]&&(r[e]=o[e]))}),i(this,{onCuepoint:function(e,n){if(1==arguments.length)return a.embedded=[null,e],o;"number"==typeof e&&(e=[e]);var i=l();return a[i]=[e,n],r.isLoaded()&&r._api().fp_addCuepoints(e,t,i),o},update:function(e){i(o,e),r.isLoaded()&&r._api().fp_updateClip(e,t);var n=r.getConfig(),a=-1==t?n.clip:n.playlist[t];i(a,e,!0)},_fireEvent:function(e,u,l,f){if("onLoad"==e)return n(a,function(e,n){n[0]&&r._api().fp_addCuepoints(n[0],t,e)}),!1;if(f=f||o,"onCuepoint"==e){var c=a[u];if(c)return c[1].call(r,f,l)}u&&-1!="onBeforeBegin,onMetaData,onStart,onUpdate,onResume".indexOf(e)&&(i(f,u),u.metaData&&(f.duration?f.fullDuration=u.metaData.duration:f.duration=u.metaData.duration));var d=!0;return n(s[e],function(){d=this.call(r,f,u,l)}),d}}),e.onCuepoint){var f=e.onCuepoint;o.onCuepoint.apply(o,"function"==typeof f?[f]:f),delete e.onCuepoint}n(e,function(t,n){"function"==typeof n&&(u(s,t,n),delete e[t])}),-1==t&&(r.onCuepoint=this.onCuepoint)},d=function(e,t,r,o){var a=this,u={},s=!1;o&&i(u,o),n(t,function(e,n){"function"==typeof n&&(u[e]=n,delete t[e])}),i(this,{animate:function(n,i,o){if(!n)return a;if("function"==typeof i&&(o=i,i=500),"string"==typeof n){var s=n;n={},n[s]=i,i=500}if(o){var f=l();u[f]=o}return void 0===i&&(i=500),t=r._api().fp_animate(e,n,i,f),a},css:function(n,o){if(void 0!==o){var u={};u[n]=o,n=u}return t=r._api().fp_css(e,n),i(a,t),a},show:function(){return this.display="block",r._api().fp_showPlugin(e),a},hide:function(){return this.display="none",r._api().fp_hidePlugin(e),a},toggle:function(){return this.display=r._api().fp_togglePlugin(e),a},fadeTo:function(t,n,i){if("function"==typeof n&&(i=n,n=500),i){var o=l();u[o]=i}return this.display=r._api().fp_fadeTo(e,t,n,o),this.opacity=t,a},fadeIn:function(e,t){return a.fadeTo(1,e,t)},fadeOut:function(e,t){return a.fadeTo(0,e,t)},getName:function(){return e},getPlayer:function(){return r},_fireEvent:function(t,o){if("onUpdate"==t){var l=r._api().fp_getPlugin(e);if(!l)return;i(a,l),delete a.methods,s||(n(l.methods,function(){var t=""+this;a[t]=function(){var n=[].slice.call(arguments),i=r._api().fp_invoke(e,t,n);return"undefined"===i||void 0===i?a:i}}),s=!0)}var f=u[t];if(f){var c=f.apply(a,o);return"_"==t.slice(0,1)&&delete u[t],c}return a}})},p=[];window.flowplayer=window.$f=function(){var e=null,a=arguments[0];if(!arguments.length)return n(p,function(){return this.isLoaded()?(e=this,!1):void 0}),e||p[0];if(1==arguments.length)return"number"==typeof a?p[a]:"*"==a?new f(p):(n(p,function(){return this.id()==a.id||this.id()==a||this.getParent()==a?(e=this,!1):void 0}),e);if(arguments.length>1){var u=arguments[1],l=3==arguments.length?arguments[2]:{};if("string"==typeof u&&(u={src:u}),u=i({bgcolor:"#000000",version:[9,0],expressInstall:"http://static.flowplayer.org/swf/expressinstall.swf",cachebusting:!1},u),"string"==typeof a){if(-1!=a.indexOf(".")){var c=[];return n(o(a),function(){c.push(new s(this,t(u),t(l)))}),new f(c)}var d=r(a);return new s(null!==d?d:a,u,l)}if(a)return new s(a,u,l)}return null},i(window.$f,{fireEvent:function(){var e=[].slice.call(arguments),t=$f(e[0]);return t?t._fireEvent(e.slice(1)):null},addPlugin:function(e,t){return s.prototype[e]=t,$f},each:n,extend:i}),"function"==typeof jQuery&&(jQuery.fn.flowplayer=function(e,n){if(!arguments.length||"number"==typeof arguments[0]){var r=[];return this.each(function(){var e=$f(this);e&&r.push(e)}),arguments.length?r[arguments[0]]:new f(r)}return this.each(function(){$f(this,t(e),n?t(n):{})})})}(),function(){function e(){if(s.done)return!1;var e=document;if(e&&e.getElementsByTagName&&e.getElementById&&e.body){clearInterval(s.timer),s.timer=null;for(var t=0;t<s.ready.length;t++)s.ready[t].call();s.ready=null,s.done=!0}}function t(e,t){if(t)for(key in t)t.hasOwnProperty(key)&&(e[key]=t[key]);return e}function n(e){switch(r(e)){case"string":return e=e.replace(new RegExp('(["\\\\])',"g"),"\\$1"),e=e.replace(/^\s?(\d+)%/,"$1pct"),'"'+e+'"';case"array":return"["+i(e,function(e){return n(e)}).join(",")+"]";case"function":return'"function()"';case"object":var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push('"'+o+'":'+n(e[o]));return"{"+t.join(",")+"}"}return String(e).replace(/\s/g," ").replace(/\'/g,'"')}function r(e){if(null===e||void 0===e)return!1;var t=typeof e;return"object"==t&&e.push?"array":t}function i(e,t){var n=[];for(var r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function o(e,r){var i=t({},e),o=document.all,a='<object width="'+i.width+'" height="'+i.height+'"';o&&!i.id&&(i.id="_"+(""+Math.random()).substring(9)),i.id&&(a+=' id="'+i.id+'"'),i.cachebusting&&(i.src+=(-1!=i.src.indexOf("?")?"&":"?")+Math.random()),a+=i.w3c||!o?' data="'+i.src+'" type="application/x-shockwave-flash"':' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"',a+=">",(i.w3c||o)&&(a+='<param name="movie" value="'+i.src+'" />'),i.width=i.height=i.id=i.w3c=i.src=null;for(var u in i)null!==i[u]&&(a+='<param name="'+u+'" value="'+i[u]+'" />');var l="";if(r){for(var s in r)null!==r[s]&&(l+=s+"="+("object"==typeof r[s]?n(r[s]):r[s])+"&");l=l.substring(0,l.length-1),a+='<param name="flashvars" value=\''+l+"' />"}return a+="</object>"}function a(e,n,r){var i=flashembed.getVersion();t(this,{getContainer:function(){return e},getConf:function(){return n},getVersion:function(){return i},getFlashvars:function(){return r},getApi:function(){return e.firstChild},getHTML:function(){return o(n,r)}});var a=n.version,u=n.expressInstall,l=!a||flashembed.isSupported(a);if(l?(n.onFail=n.version=n.expressInstall=null,e.innerHTML=o(n,r)):a&&u&&flashembed.isSupported([6,65])?(t(n,{src:u}),r={MMredirectURL:location.href,MMplayerType:"PlugIn",MMdoctitle:document.title},e.innerHTML=o(n,r)):""!==e.innerHTML.replace(/\s/g,"")||(e.innerHTML="<h2>Flash version "+a+" or greater is required</h2><h3>"+(i[0]>0?"Your version is "+i:"You have no flash plugin installed")+"</h3>"+("A"==e.tagName?"<p>Click here to download latest version</p>":"<p>Download latest version from <a href='http://www.adobe.com/go/getflashplayer'>here</a></p>"),"A"==e.tagName&&(e.onclick=function(){location.href="http://www.adobe.com/go/getflashplayer"})),!l&&n.onFail){var s=n.onFail.call(this);"string"==typeof s&&(e.innerHTML=s)}document.all&&(window[n.id]=document.getElementById(n.id))}var u="function"==typeof jQuery,l={width:"100%",height:"100%",allowfullscreen:!0,allowscriptaccess:"always",quality:"high",version:null,onFail:null,expressInstall:null,w3c:!1,cachebusting:!1};u&&(jQuery.tools=jQuery.tools||{},jQuery.tools.flashembed={version:"1.0.4",conf:l});var s=u?jQuery:function(t){return s.done?t():void(s.timer?s.ready.push(t):(s.ready=[t],s.timer=setInterval(e,13)))};window.attachEvent&&window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=function(){},__flash_savedUnloadHandler=function(){}}),window.flashembed=function(e,n,r){if("string"==typeof e){var i=document.getElementById(e);if(!i)return void s(function(){flashembed(e,n,r)});e=i}if(e){"string"==typeof n&&(n={src:n});var o=t({},l);return t(o,n),new a(e,o,r)}},t(window.flashembed,{getVersion:function(){var e=[0,0];if(navigator.plugins&&"object"==typeof navigator.plugins["Shockwave Flash"]){var t=navigator.plugins["Shockwave Flash"].description;if("undefined"!=typeof t){t=t.replace(/^.*\s+(\S+\s+\S+$)/,"$1");var n=parseInt(t.replace(/^(.*)\..*$/,"$1"),10),r=/r/.test(t)?parseInt(t.replace(/^.*r(.*)$/,"$1"),10):0;e=[n,r]}}else if(window.ActiveXObject){try{var i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(o){try{i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),e=[6,0],i.AllowScriptAccess="always"}catch(a){if(6==e[0])return e}try{i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(u){}}"object"==typeof i&&(t=i.GetVariable("$version"),"undefined"!=typeof t&&(t=t.replace(/^\S+\s+(.*)$/,"$1").split(","),e=[parseInt(t[0],10),parseInt(t[2],10)]))}return e},isSupported:function(e){var t=flashembed.getVersion(),n=t[0]>e[0]||t[0]==e[0]&&t[1]>=e[1];return n},domReady:s,asString:n,getHTML:o}),u&&(jQuery.fn.flashembed=function(e,t){var n=null;return this.each(function(){n=flashembed(this,e,t)}),e.api===!1?this:n})}(),function(){function e(){if(!u&&(u=!0,l)){for(var e=0;e<l.length;e++)l[e].call(window,[]);l=[]}}function t(e){var t=window.onload;window.onload="function"!=typeof window.onload?e:function(){t&&t(),e()}}function n(){if(!a){if(a=!0,document.addEventListener&&!o.opera&&document.addEventListener("DOMContentLoaded",e,!1),o.msie&&window==top&&function(){if(!u){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}(),o.opera&&document.addEventListener("DOMContentLoaded",function(){if(!u){for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].disabled)return void setTimeout(arguments.callee,0);e()}},!1),o.safari){var n;!function(){if(!u){if("loaded"!=document.readyState&&"complete"!=document.readyState)return void setTimeout(arguments.callee,0);if(void 0===n){for(var t=document.getElementsByTagName("link"),r=0;r<t.length;r++)"stylesheet"==t[r].getAttribute("rel")&&n++;var i=document.getElementsByTagName("style");n+=i.length}return document.styleSheets.length!=n?void setTimeout(arguments.callee,0):void e()}}()}t(e)}}var r=window.DomReady={},i=navigator.userAgent.toLowerCase(),o={version:(i.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(i),opera:/opera/.test(i),msie:/msie/.test(i)&&!/opera/.test(i),mozilla:/mozilla/.test(i)&&!/(compatible|webkit)/.test(i)},a=!1,u=!1,l=[];r.ready=function(e){n(),u?e.call(window,[]):l.push(function(){return e.call(window,[])})},n()}(),function(e,t){"use strict";function n(e,t){return e.canPlayType(t)||g&&t.search("mp4")>-1}function r(e){for(var r=t.getElementsByTagName(e),o=[],u=0;u<r.length;u++)o.push(r[u]);for(u=0;u<o.length;u++){var l=o[u],s=!0;if(l.canPlayType)if(l.src)n(l,a(e,l.src))&&(s=!1);else for(var f=l.getElementsByTagName("source"),c=0;c<f.length;c++){var d=f[c];if(n(l,a(e,d.src,d.type))){s=!1;break}}s||i.forceFallback(e,l)?i.createFallback(e,l):g&&l.addEventListener("click",function(){this.play()},!1)}}function i(){r("video"),r("audio")}function o(e){return e.split("/").slice(0,-1).join("/")+"/"}function a(e,t,n){if(n)return n;var r=/\.([a-z1-9]+)(\?|#|\s|$)/i.exec(t);if(r){var i=C[e][r[1]];if(i)return i}return L[e]}function u(e,t){var n=e.getAttribute(t);return!!n||"string"==typeof n}function l(e){var n=t.createElement("a");return n.href=e,n.href}function s(n,r,i){var o=n.getAttribute(r);if(o)return o+"px";var a;if(n.currentStyle)a=n.currentStyle[r];else{if(!e.getComputedStyle)return i;a=t.defaultView.getComputedStyle(n,null).getPropertyValue(r)}return"auto"==a?i:a}function f(e){return e.match(/\s*([\w-]+\/[\w-]+)(;|\s|$)/)[1]}function c(e,t){return f(e)==f(t)}var d="video",p="audio";t.createElement(d).canPlayType||(t.createElement(p),t.createElement("source"));var g=null!==e.navigator.userAgent.toLowerCase().match(/android 2\.[12]/),h=null!==e.navigator.userAgent.toLowerCase().match(/opera/);i.forceFallback=function(){return!1};var v=function(){for(var e=t.getElementsByTagName("script"),n=0;n<e.length;n++){var r=e[n];if(r.src.match(/html5media(\.min|)\.js/))return o(r.src)}return""}();i.flowplayerSwf=v+"flowplayer.swf",i.flowplayerAudioSwf=v+"flowplayer.audio.swf",i.flowplayerControlsSwf=v+"flowplayer.controls.swf",i.expressInstallSwf=v+"expressInstall.swf";var y='video/ogg; codecs="theora, vorbis"',m='video/mp4; codecs="avc1.42E01E, mp4a.40.2"',w='audio/ogg; codecs="vorbis"',b="video/webm;",_="audio/x-m4a;",E="audio/mpeg;",S='audio/wav; codecs="1"',L={video:m,audio:E},P=[m,_,E],C={video:{ogg:y,ogv:y,avi:m,mp4:m,mkv:m,h264:m,264:m,avc:m,m4v:m,"3gp":m,"3gpp":m,"3g2":m,mpg:m,mpeg:m,webm:b},audio:{ogg:w,oga:w,aac:_,m4a:_,mp3:E,wav:S}};i.configureFlowplayer=function(e,t){return t},i.createFallback=function(e,n){var r=u(n,"controls"),o=n.getAttribute("poster")||"",f=n.getAttribute("src")||"";if(!f)for(var p=n.getElementsByTagName("source"),g=0;g<p.length;g++){var v=p[g],y=v.getAttribute("src");if(y)for(var m=0;m<P.length;m++){var w=P[m];if(c(w,a(e,y,v.getAttribute("type")))){f=y;break}}if(f)break}if(f){var b=t.createElement("span");b.id=n.id,b.style.cssText=n.style.cssText,b.className=n.className,b.title=n.title,b.style.display="block",b.style.width=s(n,"width","300px"),b.style.height="audio"==e?"26px":s(n,"height","200px"),n.parentNode.replaceChild(b,n);var _=(n.getAttribute("preload")||"").toLowerCase(),E=[];o&&E.push({url:l(o)}),f&&E.push({url:l(f),autoPlay:u(n,"autoplay"),autoBuffering:u(n,"autobuffer")||u(n,"preload")&&(""===_||"auto"==_),onBeforeFinish:function(){return!u(n,"loop")}});var S={controls:r&&{url:l(i.flowplayerControlsSwf),opacity:.8,backgroundColor:"#181818",backgroundGradient:"none",fullscreen:e==d,autoHide:e==d&&{fullscreenOnly:!1,enabled:!0,hideStyle:"fade",mouseOutDelay:0}||{enabled:!1}}||null};h&&S.controls&&(S.controls.autoHide.enabled=!1),"audio"==e&&(S.audio={url:l(i.flowplayerAudioSwf)},r||(S.controls={url:l(i.flowplayerControlsSwf),display:"none"},b.style.height=0),E[E.length-1].autoBuffering=!1);var L={play:null,playlist:E,clip:{scaling:"fit",fadeInSpeed:0,fadeOutSpeed:0},canvas:{backgroundGradient:"none",backgroundColor:"#000000"},plugins:S};L=i.configureFlowplayer(n,L),flowplayer(b,{src:l(i.flowplayerSwf),expressInstall:l(i.expressInstallSwf),wmode:"opaque"},L)}},DomReady.ready(i),e.html5media=i}(this,document);
;// Minified by http://closure-compiler.appspot.com/home
var PhotoViewer={is_setup:!1,c:null,is_viewer:!1,last_scroll_top:0,timeout:null,total_count:0,photos:{},album_title:"",album_href:"",owner_title:"",owner_href:"",slideshow_is_stop:!0,slideshow_is_pause:!1,scale:1,move:{top:0,left:0},comments:{},options:{album_id:0,photo_id:0,isPage:0,slideshow_time:3E3,min_scale:1,max_scale:3,scale_step:10},open:function(a){var b=this;this.options.album_id=a.album_id;this.options.photo_id=a.photo_id;this.options.isPage=a.isPage;this.setup();b.last_scroll_top=j(window).scrollTop(); this.viewer();this.reset();b.viewer().addClass("active");setTimeout(function(){j(window).scrollTop(0);j("html").addClass("hideScroll");b.resize();b.loadPhoto()},10);this.old_comments_block=j(".layout_core_comments");this.setIdPrefix(this.old_comments_block)},hide:function(){this.viewer().hasClass("fullmode")?this.fullHide():(this.viewer().removeClass("active"),j("html").removeClass("hideScroll"),j(window).scrollTop(this.last_scroll_top),this.removeIdPrefix(this.old_comments_block))},resize:function(){var a= j(window).width(),b=j(window).height();this.viewer().hasClass("fullmode")?(j("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b),j("#wpPhotoViewer").find(".wpPhoto").css("width",a),j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right",0)):(a-=50,b-=50,j("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b-70),j("#wpPhotoViewer").find(".wpPhoto").css("width",a-400),j("#wpPhotoViewer").find(".wpComments").css("width",400),j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right", 390));j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("line-height",b+"px");0<this.viewer().find(".photos").width()-100*this.total_count?this.viewer().find(".wpPhotoList").addClass("one_col"):this.viewer().find(".wpPhotoList").removeClass("one_col");this.hideOptions()},loadPhoto:function(){var a=this;j.ajax({url:en4.core.baseUrl+"photoviewer",data:{format:"json",photo_id:this.options.photo_id,isPage:this.options.isPage},success:function(b){if(b&&b.photos){a.total_count=b.count;a.album_title=b.album_title; a.album_href=b.album_href;a.owner_title=b.owner_title;a.owner_href=b.owner_href;a.photos={};var d=0,c="";j(b.photos).each(function(b,f){c+='<a href="javascript:void(0);" class="wpPhotoItem" onclick="PhotoViewer.view('+f.photo_id+');" id="wp_'+f.photo_id+'"><img id="fullphoto_'+f.photo_id+'" src="'+f.thumb+'" alt=""/></a>';a.photos[f.photo_id]=f;0==b&&(d=f.photo_id);f.active&&(d=f.photo_id)});a.viewer().find(".wpPhotoList").find(".photos").html(c);a.viewer().find(".wpPhotoList").find(".photos").find("img").load(function(){j(this).addClass("loaded")}); a.viewer().find(".wpPhotoList").find(".count").html(a.total_count);1<a.total_count&&a.viewer().find(".allPhotos").show();a.viewer().find(".goSlideshow").show();a.view(d);a._checkPagination();a.resize()}}})},view:function(a){if(this.photos[a]){var b=this.photos[a];this.viewer().find(".wpPhotoItem").removeClass("active");this.viewer().find("#wp_"+a).addClass("active");var d=this.viewer().find("#wp_"+a).prevAll().length+1,c=this.viewer().find(".wpPhotoContent");c.find(".active").removeClass("active").removeClass("fade"); var e=c.find("#thephoto_"+a);e.length?(e.addClass("active"),setTimeout(function(){e.addClass("fade")},10)):(c.append(j('<div class="thephoto" id="thephoto_'+a+'"><div class="moveElement"><div id="imgPlace_'+a+'"><img src="'+b.src+'" alt=""/></div><span class="photo_options"><a href="javascript:void(0);" class="openfull icon-resize-full" onclick="PhotoViewer.fullOpen();"></a><a href="javascript:void(0);" class="hidefull icon-resize-small" onclick="PhotoViewer.fullHide();"></a></span></div></div>')), e=j("#thephoto_"+a),clearTimeout(this.photo),this.photo=setTimeout(function(){e.addClass("active");setTimeout(function(){e.addClass("fade")},10)},10));this.resize();this.viewer().find(".wpPhotoOptions").find(".info").show();b=this.viewer().find(".wpPhotoOptions").find(".album_info");b.find(".album_title").html('<a href="'+this.album_href+'">'+this.album_title+"</a>");b.find(".album_owner").html(' - <a href="'+this.owner_href+'">'+this.owner_title+"</a>");this.viewer().find(".wpPhotoOptions").find(".count").find(".total").html(this.total_count); this.viewer().find(".wpPhotoOptions").find(".count").find(".current").html(d);this.loadComments(a);this._checkPagination()}},_checkPagination:function(){var a=this.viewer().find(".wpNext"),b=this.viewer().find(".wpPrev");if(2>this.total_count)a.hide(),b.hide();else{var d=this.viewer().find(".wpPhotoItem.active");d.prev().length?b.show():b.hide();d.next().length?a.show():a.hide()}},next:function(a){var b=this.viewer().find(".wpPhotoItem.active");b.next().length?b.next().click():a?a():this.showList(); this._checkPagination()},prev:function(){var a=this.viewer().find(".wpPhotoItem.active");a.prev().length?a.prev().click():this.showList();this._checkPagination()},toggleList:function(){this.viewer().find(".wpPhotoList").hasClass("active")?this.hideList():this.showList()},showList:function(){!(2>this.total_count)&&!this.viewer().hasClass("fullmode")&&(this.viewer().find(".photos").jScrollPane(),this.viewer().find(".wpPhotoList").addClass("active"),this.showOver())},isListActive:function(){return this.viewer().find(".wpPhotoList").hasClass("active")}, hideList:function(){this.viewer().find(".wpPhotoList").removeClass("active");this.hideOver()},loadComments:function(a){var b=this;j("#photo_comment_"+a).length?(b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide()),b.removeIdPrefix(j("#photo_comment_"+a).show())):(this.comment_request&&this.comment_request.abort(),b.showLoading(),this.comment_request=j.ajax({url:en4.core.baseUrl+"photoviewer/index/comments",data:{format:"html",photo_id:a,isPage:this.options.isPage},success:function(d){b.hideLoading(); b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide());var c=j("<div />").attr({id:"photo_comment_"+a,"class":"photo_comment"});c.html(d);b.viewer().find(".wpCommentsContent").append(c);en4.core.runonce.trigger();Smoothbox.bind($("photo_comment_"+a))}}))},setIdPrefix:function(a){a.find("*[id]").not(".iswphprefix").each(function(a,d){j(d).attr("id","wphPrefix"+(1E3*Math.random()).toInt()+"wphEnd"+j(d).attr("id"));j(d).addClass("iswphprefix")})},removeIdPrefix:function(a){a.find(".iswphprefix").each(function(a, d){var c=j(d).attr("id"),e=c.indexOf("wphEnd");-1!==e&&(c=c.substr(e+6),j(d).attr("id",c),j(d).removeClass("iswphprefix"))})},onError:function(a){alert(a)},setup:function(){var a=this;if(!this.is_setup){this.is_setup=!0;j(window).resize(function(){a.resize()});var b="keypress";if(Browser.Engine.trident||Browser.Engine.webkit)b="keydown";j(document).bind(b,function(b){var c=j(b.target).prop("tagName").toLowerCase();"textarea"==c||"input"==c||"select"==c||a.isListActive()||(37==b.keyCode?a.prev():39== b.keyCode?a.next():0!=b.keyCode&&(27==b.keyCode?a.viewer().hasClass("fullmode")?a.fullHide():a.hide():109==b.keyCode||38==b.keyCode?a.zoom(2):(107==b.keyCode||40==b.keyCode)&&a.zoom(-2)))});this.viewer().find(".wpPhoto").mousewheel(function(b){if(!a.viewer().hasClass("tagging_process")){b=b.originalEvent;var c=0;b.wheelDelta&&(c=b.wheelDelta/120);b.detail&&(c=-b.detail/3);a.zoom(c)}});this.viewer().click(function(b){!j(b.target).closest(".external-options").length&&(!j(b.target).hasClass("actions")&& !j(b.target).parent().hasClass("actions"))&&a.hideOptions()});document.addEventListener&&(document.addEventListener("fullscreenchange",function(){},!1),document.addEventListener("mozfullscreenchange",function(){a.fullToggle(document.mozFullScreen)},!1),document.addEventListener("webkitfullscreenchange",function(){a.fullToggle(document.webkitIsFullScreen)},!1))}},fullToggle:function(a){a?this.fullOpen():this.fullHide()},zoom:function(a){if(!this.isListActive())if(a/=this.options.scale_step,this.scale+= a,this.scale<this.options.min_scale)this.viewer().removeClass("zooming"),this.scale-=a;else if(this.scale>this.options.max_scale)this.scale-=a;else if(this.viewer().addClass("zooming"),j("#wpPhotoViewer").find(".wpPhoto").find(".active").css("-moz-transform","scale("+this.scale+")").css("-webkit-transform","scale("+this.scale+")").css("transform","scale("+this.scale+")"),a=this.getInternetExplorerVersion(),7==a||8==a)a=j("#wpPhotoViewer").find(".wpPhoto").find(".active").find("img"),a.data("original-width")|| (a.data("original-width",a.width()),a.data("original-height",a.height())),a.css("width",a.data("original-width")*this.scale).css("height",a.data("original-height")*this.scale)},getInternetExplorerVersion:function(){var a=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1));return a},noZoom:function(a){a?this.viewer().addClass("nozoom"):this.viewer().removeClass("nozoom")},fullOpen:function(){var a=this.viewer(); a.addClass("fullmode");this.resize();a=a[0];a.requestFullScreen&&a.requestFullScreen();a.webkitRequestFullScreen&&a.webkitRequestFullScreen();a.mozRequestFullScreen&&a.mozRequestFullScreen();a.requestFullscreen&&a.requestFullscreen()},fullHide:function(){this.viewer().removeClass("fullmode");this.resize();this.stopSlideshow();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide();document.cancelFullScreen&&document.cancelFullScreen();document.webkitCancelFullScreen&& document.webkitCancelFullScreen();document.mozCancelFullScreen&&document.mozCancelFullScreen();document.exitFullscreen&&document.exitFullscreen()},viewer:function(){var a=this;if(this.is_viewer)return this.c;this.is_viewer=!0;var b=j("<div />");b.attr({id:"wpPhotoViewer","class":"wpPhotoViewer"});b.html(this.getHtmlContent());b.appendTo(j("body"));var d=this.getInternetExplorerVersion();-1!==d&&(b.addClass("wpIe"),b.addClass("wpIe"+d));clearTimeout(a.mouseTimer);b.mouseover(function(){clearTimeout(a.mouseTimer); a.mouseTimer=setTimeout(function(){a.viewer().addClass("mouseActive");clearTimeout(a.mouseTimerOut);a.mouseTimerOut=setTimeout(function(){a.viewer().removeClass("mouseActive")},2E3)},10)});var c=b.find(".wpPhotoContent");c.unbind("mousemove").mousemove(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed&&(clearInterval(a.moving_timer),a.moving_timer=setTimeout(function(){var c=a.move.startClientX-b.clientX,d=a.move.startClientY-b.clientY;a.move.startClientX=b.clientX;a.move.startClientY= b.clientY;a.photoMove(c,d)},1)),!1});c.unbind("mousedown").mousedown(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!0,a.move.startClientX=b.clientX,a.move.startClientY=b.clientY,c.addClass("moving"),!1});c.unbind("mouseup").mouseup(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!1,c.removeClass("moving"),!1});c.unbind("mouseout").mouseout(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!1,c.removeClass("moving"), !1});return this.c=b},photoMove:function(a,b){var d=j("#thephoto_"+this.getActiveId());this.move.top+=1.5*-b;this.move.left+=1.5*-a;d.css("margin-top",this.move.top);d.css("margin-left",this.move.left)},showOver:function(){var a=this;this.viewer().find(".wpOver").show();clearTimeout(this.timeout);this.timeout=setTimeout(function(){a.viewer().find(".wpOver").addClass("active")},100)},hideOver:function(){var a=this;a.viewer().find(".wpOver").removeClass("active");clearTimeout(this.timeout);this.timeout= setTimeout(function(){a.viewer().find(".wpOver").hide()},500)},slideshow:function(){this.fullOpen();this.startSlideshow()},slideshowClose:function(){this.stopSlideshow();this.fullHide();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide()},startSlideshow:function(){var a=this;this.stopSlideshow();this.slideshow_is_pause=this.slideshow_is_stop=!1;this.viewer().addClass("slideshow_process");this.slideshow_timer=setInterval(function(){a.slideshow_is_pause||a.next(function(){a.stopSlideshow()})}, this.options.slideshow_time);this._checkStatusSlideShow()},stopSlideshow:function(){clearInterval(this.slideshow_timer);this.slideshow_is_stop=!0;this._checkStatusSlideShow()},repeatSlideshow:function(){this.viewer().find(".photos").find("a:first").click();this.startSlideshow();this._checkStatusSlideShow()},_checkStatusSlideShow:function(){this.slideshow_is_pause?(this.viewer().find(".wpSlidStart").show(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").hide()):this.slideshow_is_stop? (this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").show()):(this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").show(),this.viewer().find(".wpSlidRepeat").hide())},pauseSlideshow:function(){this.slideshow_is_pause=!0;this._checkStatusSlideShow()},hideOptions:function(){j("#photo_comment_"+this.getActiveId()).find(".external-options").hide()},toggleOptions:function(){var a=j("#photo_comment_"+this.getActiveId()).find(".external-options"); a.toggle();var b=this.viewer().find(".actions").offset();a.css("top",32).css("left",b.left)},getActiveId:function(){var a=this.viewer().find(".photos").find(".active");if(a.length)return a.attr("id").substr(3)},getActive:function(){return this.photos[this.getActiveId()]},getHtmlContent:function(){return'<div class="wpContainer"><a href="javascript:void(0);" class="wpPrev icon-angle-left" onclick="PhotoViewer.prev();" style="display: none;"></a><a href="javascript:void(0);" class="wpNext icon-angle-right" onclick="PhotoViewer.next();" style="display: none;"></a><a href="javascript:void(0);" class="wpClose icon-remove" onclick="PhotoViewer.hide();"></a><div class="wpPhoto"><table width="100%" class="wpPhotoContentTable"><tr><td align="center" valign="center" class="wpPhotoContent"></td></tr></table></div><div class="wpComments"><div class="wpCommentsContent"><div class="photo_comment loadingComments"><div class="layout_page_photoviewer_index_comments"><div class="generic_layout_container layout_main"><span class="loading">'+ en4.core.language.translate("PHOTOVIEWER_loading")+'</span></div></div></div></div></div><div class="wpBar"><div class="wpPhotoList"><div class="title">'+en4.core.language.translate("PHOTOVIEWER_All photos")+'&nbsp;(<span class="count">0</span>)<a href="javascript:void(0);" onclick="PhotoViewer.hideList();" class="wpListClose"><i class="icon-remove"></i></a></div><div class="photos"></div></div><div class="wpPhotoOptions"><div class="leftside"><a href="javascript:void(0);" class="wpbtn wpbtn-inverse allPhotos" onclick="PhotoViewer.toggleList();" style="display: none;">'+ en4.core.language.translate("PHOTOVIEWER_All photos")+'<i class="right icon-caret-up"></i></a><a href="javascript:void(0);" class="wpbtn wpbtn-inverse goSlideshow" onclick="PhotoViewer.slideshow();" style="display: none;">'+en4.core.language.translate("PHOTOVIEWER_Slideshow")+'</a><div class="info" style="display: none;"><div class="album_info"><span class="album_title"></span><span class="album_owner"></span></div><div class="count"><span class="current"></span>&nbsp;'+en4.core.language.translate("PHOTOVIEWER_from")+ '&nbsp;<span class="total"></span></div></div></div></div></div></div><div class="wpSlideshow" style="display: none;"><a href="javascript:void(0);" onclick="PhotoViewer.startSlideshow();" style="display: none;" class="wpSlidStart wpbtn wpbtn-inverse">'+en4.core.language.translate("PHOTOVIEWER_Play")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.pauseSlideshow();" style="display: none;" class="wpSlidPause wpbtn wpbtn-inverse">'+en4.core.language.translate("PHOTOVIEWER_Pause")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.repeatSlideshow();" style="display: none;" class="wpSlidRepeat wpbtn wpbtn-inverse">'+ en4.core.language.translate("PHOTOVIEWER_Repeat")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.slideshowClose();" class="wpSlidClose wpbtn wpbtn-inverse"><i class="icon-remove"></i></a></div><div class="wpOver" onclick="PhotoViewer.hideList();" style="display: none;"></div>'},reset:function(){this.viewer().find(".photos").jScrollPane().data("jsp").destroy();this.viewer().find(".wpOver, .wpNext, .wpPrev, .info, .allPhotos, .goSlideshow, .wpSlideshow, .wpSlidStart, .wpSlidPause, .wpSlidRepeat").hide(); this.viewer().find(".wpPhotoContent, .photos").empty();this.viewer().find(".wpCommentsContent").children().hide();this.viewer().removeClass("fullmode").removeClass("zooming").removeClass("slideshow_process").removeClass("mouseActive");this.viewer().find(".wpPhotoList").removeClass(".one_col");this.viewer().find(".wpCommentsContent").children(".loadingComments").show();return this.viewer()},showLoading:function(){this.viewer().find(".wpCommentsContent").children().hide();this.viewer().find(".wpCommentsContent").children(".loadingComments").show()}, hideLoading:function(){this.viewer().find(".wpCommentsContent").children(".loadingComments").hide()},bindPhotoViewer:function(){j&&j("#global_content").find("a").not(".wp_init").addClass("wp_init").each(function(a,b){var d=j(b).attr("href");if(d&&"javascript:void(0)"!=d){var c=0,e=d.match(/album_id\/([0-9]{0,})\/*\/photo_id\/([0-9]{0,})/i);e||(e=d.match(/content\/pagealbumphoto\/album_id\/([0-9]{0,})\/content_id\/([0-9]{0,})/i),c=1);if(e&&e[0]&&e[1]&&e[2]){d=e[1];e=e[2];$(b).removeEvents();var f= $(b).getElement("img");f&&f.removeEvents("click");j(b).attr("onclick","").data("album_id",d).data("photo_id",e).data("isPage",c).click(function(a){a.stopPropagation();a.preventDefault();PhotoViewer.open({album_id:j(this).data("album_id"),photo_id:j(this).data("photo_id"),isPage:j(this).data("isPage")})})}}})}};