/* Minify: at least one missing file. See http://code.google.com/p/minify/wiki/Debugging */

;en4.ynfilesharing={foldersPermissions:[],parentType:null,parentId:null,_getURI:function(action){var uri=null;url='';if(action=='delete'){url=en4.core.baseUrl+'filesharing/index/delete/parent_type/{parent_type}/parent_id/{parent_id}';}else if(action=='move'){url=en4.core.baseUrl+'filesharing/index/move/parent_type/{parent_type}/parent_id/{parent_id}';}
if(url.length>0){url=url.substitute({'parent_type':this.parentType,'parent_id':this.parentId});uri=new URI(url);}
return uri;},_handleDeleteAndMove:function(event,action){event.stop();var listFilesAndFolders=[];Array.each($$('.ynfs_browse li.ynfs_item input[type="checkbox"]'),function(item,index){if(item.checked){listFilesAndFolders.push(item);}});if(listFilesAndFolders.length>1)
{var folderIds=[];var fileIds=[];for(var i=0;i<listFilesAndFolders.length;i++){var item=listFilesAndFolders[i];if(item.get('name')=='folderIds[]'){var ck=true;var folderId=item.get('value');var folderPermissions=en4.ynfilesharing.getPermissionOfFolder(folderId);if(action=='move'){var parent=en4.ynfilesharing.getParentItem(folderId,'folder');if(!(parent.parentType==this.parentType&&parent.parentId==this.parentId)){ck=false;}}else{if(!en4.ynfilesharing.getPermissionOfFolder(folderId).contains(action)){ck=false;}}
if(ck==false){alert(en4.core.language.translate('You do not permission to %s the folder %s',action,en4.ynfilesharing.getItemName(folderId,'folder')));return;}
folderIds.push(folderId);}else{var fileId=item.get('value');if(action=='move'){var parent=en4.ynfilesharing.getParentItem(fileId,'file');if(!(parent.parentType==this.parentType&&parent.parentId==this.parentId)){alert(en4.core.language.translate('You do not permission to %s the file %s',action,en4.ynfilesharing.getItemName(fileId,'file')));return;}}
fileIds.push(fileId);}}
var uri=this._getURI(action);if(folderIds.length>0){uri.setData('folderIds',folderIds);}
if(fileIds.length>0){uri.setData('fileIds',fileIds);}
Smoothbox.open(uri.toString());}
else
{Smoothbox.open(event.target);}},_deleteFoldersAndFiles:function(event){en4.ynfilesharing._handleDeleteAndMove(event,'delete');},_moveFoldersAndFiles:function(event){en4.ynfilesharing._handleDeleteAndMove(event,'move');},setOptions:function(options){for(opt in options){if(this.hasOwnProperty(opt)){this[opt]=options[opt];}}},setFoldersPermissions:function(folderPerms){en4.ynfilesharing.foldersPermissions=folderPerms;},getPermissionOfFolder:function(folderId){return this.foldersPermissions[folderId];},getItemName:function(itemId,type){var name='';var ele;var items=$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item');for(var i=0;i<items.length;i++){if(type=='folder'){if(items[i].getProperty('folderId')==itemId){ele=items[i];}}else{if(type=='file'){if(items[i].getProperty('fileId')==itemId){ele=items[i];}}}}
var nameEle=ele.getFirst('.ynfs_name_column  > a');if(nameEle){return nameEle.get('text').trim();}},getParentItem:function(itemId,type){var items=$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item');var ele=null;for(var i=0;i<items.length;i++){if(type=='folder'){if(items[i].getProperty('folderId')==itemId){ele=items[i];break;}}else{if(items[i].getProperty('fileId')==itemId){ele=items[i];break;}}}
if(ele){return{'parentType':ele.getProperty('parentType'),'parentId':ele.getProperty('parentId')};}},showControlForFolder:function(folderId,controlColumn,parentType,parentId){var permissions=en4.ynfilesharing.getPermissionOfFolder(folderId);var editElement=null;var deleteElement=null;var moveElement=null;var shareElement=null;if(permissions==null||permissions.contains('edit')){editElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/folder/edit/'+folderId,'html':en4.core.language.translate('Edit'),'class':'buttonlink ynfs_control_edit'});if(parentType==this.parentType&&parentId==this.parentId){var moveUrl='filesharing/index/move/folder_id/{folder_id}/parent_type/{parent_type}/parent_id/{parent_id}/format/smoothbox';moveElement=new Element('a',{'href':en4.core.baseUrl+moveUrl.substitute({'parent_type':this.parentType,'parent_id':this.parentId,'folder_id':folderId}),'html':en4.core.language.translate('Move'),'class':'buttonlink ynfs_control_move'});moveElement.addEvent('click',this._moveFoldersAndFiles);}}
if(permissions==null||permissions.contains('delete')){deleteElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/folder/delete/'+folderId,'html':en4.core.language.translate('Delete'),'class':'buttonlink ynfs_control_delete'});deleteElement.addEvent('click',this._deleteFoldersAndFiles);}
if(parentType==this.parentType&&parentId==this.parentId){shareElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/index/share/folder_id/'+folderId+'/format/smoothbox','html':en4.core.language.translate('Share'),'class':'buttonlink ynfs_control_share'});shareElement.addEvent('click',function(event){event.stop();Smoothbox.open(shareElement);});}
if(shareElement!=null){shareElement.inject(controlColumn);}
if(editElement!=null){editElement.inject(controlColumn);}
if(deleteElement!=null){deleteElement.inject(controlColumn);}
if(moveElement!=null){moveElement.inject(controlColumn);}
fileSizeElement=$("ynfilesharing_filesize");if(fileSizeElement!=null)
fileSizeElement.destroy();},showControlForFile:function(currentFolderId,fileId,controlColumn,parentType,parentId){var permissions=en4.ynfilesharing.getPermissionOfFolder(currentFolderId);var editElement=null;var deleteElement=null;var moveElement=null;var fileSizeElement=null;var shareElement=null;if(permissions!=null&&permissions.contains('edit')){editElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/file/edit/'+fileId,'html':en4.core.language.translate('Edit'),'class':'buttonlink ynfs_control_edit'});editElement.addEvent('click',function(event){event.stop();Smoothbox.open(editElement);});if(parentType==this.parentType&&parentId==this.parentId){var moveUrl='filesharing/index/move/file_id/{file_id}/parent_type/{parent_type}/parent_id/{parent_id}';moveElement=new Element('a',{'href':en4.core.baseUrl+moveUrl.substitute({'parent_type':this.parentType,'parent_id':this.parentId,'file_id':fileId}),'html':en4.core.language.translate('Move'),'class':'buttonlink ynfs_control_move'});}
if(moveElement){moveElement.addEvent('click',this._moveFoldersAndFiles);}}
if(permissions!=null&&permissions.contains('delete')){deleteElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/file/delete/'+fileId,'html':en4.core.language.translate('Delete'),'class':'buttonlink ynfs_control_delete'});deleteElement.addEvent('click',en4.ynfilesharing._deleteFoldersAndFiles);}
if(parentType==this.parentType&&parentId==this.parentId){shareElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/index/share/file_id/'+fileId+'/format/smoothbox','html':en4.core.language.translate('Share'),'class':'buttonlink ynfs_control_share'});shareElement.addEvent('click',function(event){event.stop();Smoothbox.open(shareElement);});}
fileSizeElement=$("ynfilesharing_filesize");if(fileSizeElement!=null)
fileSizeElement.destroy();fileSizeElement=document.createElement('span');fileSizeElement.setAttribute('id','ynfilesharing_filesize');fileSizeElement.innerHTML=en4.ynfilesharing.formatFileSize($$("li[fileid="+fileId+"]").get('size'));if(shareElement!=null){shareElement.inject(controlColumn);}
if(editElement!=null){editElement.inject(controlColumn);}
if(deleteElement!=null){deleteElement.inject(controlColumn);}
if(moveElement!=null){moveElement.inject(controlColumn);}
if(fileSizeElement!=null){$(fileSizeElement).inject(controlColumn);}},roundNumber:function(number,digits){var multiple=Math.pow(10,digits);var rndedNum=Math.round(number*multiple)/multiple;return rndedNum;},formatFileSize:function(size){fileSize=parseInt(size);sizeKB=1024;sizeMB=1024*1024;if(fileSize>sizeKB&&fileSize<sizeMB)
return en4.ynfilesharing.roundNumber(fileSize/sizeKB,2)+en4.core.language.translate(" KB");else if(fileSize>sizeMB)
return en4.ynfilesharing.roundNumber(fileSize/sizeMB,2)+en4.core.language.translate(" MB");else
return String(fileSize)+en4.core.language.translate(" Bytes");},cancelUploadFile:function(){if(upload.inputFiles){upload.inputFiles._files.length=0;$$(".ynfs_uploadList").set('html','');$("file").value
$('uploadForm').hide();}
else
{window.location=window.location;}},showControls:function(element){element.addClass('ynfs_item_selected').removeClass('ynfs_item_hover');var controlsElement=element.getSiblings('.ynfs_browse_control')[0];controlsElement.getElements('a').destroy();controlsElement.set('styles',{'display':'block'});var titleElement=element.getSiblings('.ynfs_browse_title')[0];titleElement.set('styles',{'display':'none'});var controlColumn=controlsElement.getElement('.ynfs_control_column');var folderId=element.getProperty('folderId');if(folderId)
{var parentType=element.getProperty('parentType');var parentId=element.getProperty('parentId');en4.ynfilesharing.showControlForFolder(folderId,controlColumn,parentType,parentId);}
else
{currentFolderId=element.getProperty('currentFolerId');fileId=element.getProperty('fileId');var parentType=element.getProperty('parentType');var parentId=element.getProperty('parentId');en4.ynfilesharing.showControlForFile(currentFolderId,fileId,controlColumn,parentType,parentId);}},showHeader:function(){$(document.body).getElements('li.ynfs_browse_title').set('styles',{'display':'block'});$(document.body).getElements('li.ynfs_browse_control').set('styles',{'display':'none'});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item_selected').removeClass('ynfs_item_selected');}}
en4.core.runonce.add(function(){$(document.body).addEvent('click',function(e){var parent=e.target.getParent();if(parent&&parent.contains($('ynfs_control_browse'))){en4.ynfilesharing.showHeader();}});$$('.ynfs_checkall').addEvent('click',function(e){var checked=e.target.checked;Array.each($$('.ynfs_browse li input[type="checkbox"]'),function(item,index){item.checked=checked;var eleLi=item.getParent('li.ynfs_item');if(eleLi){if(checked){eleLi.addClass('ynfs_item_selected');}else{eleLi.removeClass('ynfs_item_selected');}}});if(checked){var selectedItems=$$('.ynfs_browse .ynfs_item.ynfs_item_selected');if(selectedItems.length>0){en4.ynfilesharing.showControls(selectedItems[0]);}}else{en4.ynfilesharing.showHeader();}});$$('.ynfs_browse li.ynfs_item input[type="checkbox"]').removeEvent('click').addEvent('click',function(e){var checked=e.target.checked;if(!checked){Array.each($$('.ynfs_checkall'),function(item,index){item.checked=false;});}else{var checkAll=true;var ckboxes=$$('.ynfs_browse li.ynfs_item input[type="checkbox"]');for(var i=0;i<ckboxes.length;i++){if(!ckboxes[i].checked){checkAll=false;break;}}
if(checkAll){Array.each($$('.ynfs_checkall'),function(item,index){item.checked=true;});}}
var eleLi=e.target.getParent('li.ynfs_item');if(!checked){eleLi.removeClass('ynfs_item_selected');var ckboxes=$$('.ynfs_browse li.ynfs_item input[type="checkbox"]');var notCheckAll=true;for(var i=0;i<ckboxes.length;i++){if(ckboxes[i].checked){notCheckAll=false;break;}}
if(notCheckAll){en4.ynfilesharing.showHeader();}}else{eleLi.addClass('ynfs_item_selected');en4.ynfilesharing.showControls(eleLi);}});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item').removeEvent('mouseenter').addEvent('mouseenter',function(event){var element=event.target;if(!element.hasClass('ynfs_item_selected')){element.addClass('ynfs_item_hover');}});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item').removeEvent('mouseleave').addEvent('mouseleave',function(event){var element=event.target;element.removeClass('ynfs_item_hover');});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item').removeEvent('click').addEvent('click',function(event){var element=event.target;if(element.get('tag')!='input'){if(element.get('tag')!='li'){element=element.getParent('li');}
Array.each(element.getSiblings(),function(item,index){if(item.getFirst('.ynfs_check_column').getFirst().checked==false){item.removeClass('ynfs_item_selected');}});en4.ynfilesharing.showControls(element);}});});;var Picker=new Class({Implements:[Options,Events],options:{pickerClass:'datepicker',inject:null,animationDuration:400,useFadeInOut:true,positionOffset:{x:0,y:0},pickerPosition:'bottom',draggable:true,showOnInit:true,columns:1,footer:false},initialize:function(options){this.setOptions(options);this.constructPicker();if(this.options.showOnInit)this.show();},constructPicker:function(){var options=this.options;var picker=this.picker=new Element('div',{'class':options.pickerClass,styles:{left:0,top:0,display:'none',opacity:0}}).inject(options.inject||document.body);picker.addClass('column_'+options.columns);if(options.useFadeInOut){picker.set('tween',{duration:options.animationDuration,link:'cancel'});}
var header=this.header=new Element('div.header').inject(picker);var title=this.title=new Element('div.title').inject(header);var titleID=this.titleID='pickertitle-'+String.uniqueID();this.titleText=new Element('div',{'role':'heading','class':'titleText','id':titleID,'aria-live':'assertive','aria-atomic':'true'}).inject(title);this.closeButton=new Element('div.closeButton[text=x][role=button]').addEvent('click',this.close.pass(false,this)).inject(header);var body=this.body=new Element('div.body').inject(picker);if(options.footer){this.footer=new Element('div.footer').inject(picker);picker.addClass('footer');}
var slider=this.slider=new Element('div.slider',{styles:{position:'absolute',top:0,left:0}}).set('tween',{duration:options.animationDuration,transition:Fx.Transitions.Quad.easeInOut}).inject(body);this.newContents=new Element('div',{styles:{position:'absolute',top:0,left:0}}).inject(slider);this.oldContents=new Element('div',{styles:{position:'absolute',top:0}}).inject(slider);this.originalColumns=options.columns;this.setColumns(options.columns);var shim=this.shim=window['IframeShim']?new IframeShim(picker):null;if(options.draggable&&typeOf(picker.makeDraggable)=='function'){this.dragger=picker.makeDraggable(shim?{onDrag:shim.position.bind(shim)}:null);picker.setStyle('cursor','move');}},open:function(noFx){if(this.opened==true)return this;this.opened=true;var picker=this.picker.setStyle('display','block').set('aria-hidden','false')
if(this.shim)this.shim.show();this.fireEvent('open');if(this.options.useFadeInOut&&!noFx){picker.fade('in').get('tween').chain(this.fireEvent.pass('show',this));}else{picker.setStyle('opacity',1);this.fireEvent('show');}
return this;},show:function(){return this.open(true);},close:function(noFx){if(this.opened==false)return this;this.opened=false;this.fireEvent('close');var self=this,picker=this.picker,hide=function(){picker.setStyle('display','none').set('aria-hidden','true');if(self.shim)self.shim.hide();self.fireEvent('hide');};if(this.options.useFadeInOut&&!noFx){picker.fade('out').get('tween').chain(hide);}else{picker.setStyle('opacity',0);hide();}
return this;},hide:function(){return this.close(true);},toggle:function(){return this[this.opened==true?'close':'open']();},destroy:function(){this.picker.destroy();if(this.shim)this.shim.destroy();},position:function(x,y){var offset=this.options.positionOffset,scroll=document.getScroll(),size=document.getSize(),pickersize=this.picker.getSize();if(typeOf(x)=='element'){var element=x,where=y||this.options.pickerPosition;var elementCoords=element.getCoordinates();x=(where=='left')?elementCoords.left-pickersize.x:(where=='bottom'||where=='top')?elementCoords.left:elementCoords.right
y=(where=='bottom')?elementCoords.bottom:(where=='top')?elementCoords.top-pickersize.y:elementCoords.top;}
x+=offset.x*((where&&where=='left')?-1:1);y+=offset.y*((where&&where=='top')?-1:1);if((x+pickersize.x)>(size.x+scroll.x))x=(size.x+scroll.x)-pickersize.x;if((y+pickersize.y)>(size.y+scroll.y))y=(size.y+scroll.y)-pickersize.y;if(x<0)x=0;if(y<0)y=0;x=x-124;this.picker.setStyles({left:x,top:y});if(this.shim)this.shim.position();return this;},setBodySize:function(){var bodysize=this.bodysize=this.body.getSize();this.slider.setStyles({width:2*bodysize.x,height:bodysize.y});this.oldContents.setStyles({left:bodysize.x,width:bodysize.x,height:bodysize.y});this.newContents.setStyles({width:bodysize.x,height:bodysize.y});},setColumnContent:function(column,content){var columnElement=this.columns[column];if(!columnElement)return this;var type=typeOf(content);if(['string','number'].contains(type))columnElement.set('text',content);else columnElement.empty().adopt(content);return this;},setColumnsContent:function(content,fx){var old=this.columns;this.columns=this.newColumns;this.newColumns=old;content.forEach(function(_content,i){this.setColumnContent(i,_content);},this);return this.setContent(null,fx);},setColumns:function(columns){var _columns=this.columns=new Elements,_newColumns=this.newColumns=new Elements;for(var i=columns;i--;){_columns.push(new Element('div.column').addClass('column_'+(columns-i)));_newColumns.push(new Element('div.column').addClass('column_'+(columns-i)));}
var oldClass='column_'+this.options.columns,newClass='column_'+columns;this.picker.removeClass(oldClass).addClass(newClass);this.options.columns=columns;return this;},setContent:function(content,fx){if(content)return this.setColumnsContent([content],fx);var old=this.oldContents;this.oldContents=this.newContents;this.newContents=old;this.newContents.empty();this.newContents.adopt(this.columns);this.setBodySize();if(fx){this.fx(fx);}else{this.slider.setStyle('left',0);this.oldContents.setStyles({left:0,opacity:0});this.newContents.setStyles({left:0,opacity:1});}
return this;},fx:function(fx){var oldContents=this.oldContents,newContents=this.newContents,slider=this.slider,bodysize=this.bodysize;if(fx=='right'){oldContents.setStyles({left:0,opacity:1});newContents.setStyles({left:bodysize.x,opacity:1});slider.setStyle('left',0).tween('left',0,-bodysize.x);}else if(fx=='left'){oldContents.setStyles({left:bodysize.x,opacity:1});newContents.setStyles({left:0,opacity:1});slider.setStyle('left',-bodysize.x).tween('left',-bodysize.x,0);}else if(fx=='fade'){slider.setStyle('left',0);oldContents.setStyle('left',0).set('tween',{duration:this.options.animationDuration/2}).tween('opacity',1,0).get('tween').chain(function(){oldContents.setStyle('left',bodysize.x);});newContents.setStyles({opacity:0,left:0}).set('tween',{duration:this.options.animationDuration}).tween('opacity',0,1);}},toElement:function(){return this.picker;},setTitle:function(content,fn){if(!fn)fn=Function.from;this.titleText.empty().adopt(Array.from(content).map(function(item,i){return typeOf(item)=='element'?item:new Element('div.column',{text:fn(item,this.options)}).addClass('column_'+(i+1));},this));return this;},setTitleEvent:function(fn){this.titleText.removeEvents('click');if(fn)this.titleText.addEvent('click',fn);this.titleText.setStyle('cursor',fn?'pointer':'');return this;}});Picker.Attach=new Class({Extends:Picker,options:{togglesOnly:true,showOnInit:false,blockKeydown:true},initialize:function(attachTo,options){this.parent(options);this.attachedEvents=[];this.attachedElements=[];this.toggles=[];this.inputs=[];var documentEvent=function(event){if(this.attachedElements.contains(event.target))return;this.close();}.bind(this);var document=this.picker.getDocument().addEvent('click',documentEvent);var preventPickerClick=function(event){event.stopPropagation();return false;};this.picker.addEvent('click',preventPickerClick);if(this.options.toggleElements)this.options.toggle=document.getElements(this.options.toggleElements);this.attach(attachTo,this.options.toggle);},attach:function(attachTo,toggle){if(typeOf(attachTo)=='string')attachTo=document.id(attachTo);if(typeOf(toggle)=='string')toggle=document.id(toggle);var elements=Array.from(attachTo),toggles=Array.from(toggle),allElements=[].append(elements).combine(toggles),self=this;var closeEvent=function(event){var stopInput=self.options.blockKeydown&&event.type=='keydown'&&!(['tab','esc'].contains(event.key)),isCloseKey=event.type=='keydown'&&(['tab','esc'].contains(event.key)),isA=event.target.get('tag')=='a';if(stopInput||isA)event.preventDefault();if(isCloseKey||isA)self.close();};var getOpenEvent=function(element){return function(event){var tag=event.target.get('tag');if(tag=='input'&&event.type=='click'&&!element.match(':focus')||(self.opened&&self.input==element))return;if(tag=='a')event.stop();self.position(element);self.open();self.fireEvent('attached',[event,element]);};};var getToggleEvent=function(open,close){return function(event){if(self.opened)close(event);else open(event);};};allElements.each(function(element){if(self.attachedElements.contains(element))return;var events={},tag=element.get('tag'),openEvent=getOpenEvent(element),toggleEvent=getToggleEvent(openEvent,closeEvent);if(tag=='input'){if(!self.options.togglesOnly||!toggles.length){events={focus:openEvent,click:openEvent,keydown:closeEvent};}
self.inputs.push(element);}else{if(toggles.contains(element)){self.toggles.push(element);events.click=toggleEvent}else{events.click=openEvent;}}
element.addEvents(events);self.attachedElements.push(element);self.attachedEvents.push(events);});return this;},detach:function(attachTo,toggle){if(typeOf(attachTo)=='string')attachTo=document.id(attachTo);if(typeOf(toggle)=='string')toggle=document.id(toggle);var elements=Array.from(attachTo),toggles=Array.from(toggle),allElements=[].append(elements).combine(toggles),self=this;if(!allElements.length)allElements=self.attachedElements;allElements.each(function(element){var i=self.attachedElements.indexOf(element);if(i<0)return;var events=self.attachedEvents[i];element.removeEvents(events);delete self.attachedEvents[i];delete self.attachedElements[i];var toggleIndex=self.toggles.indexOf(element);if(toggleIndex!=-1)delete self.toggles[toggleIndex];var inputIndex=self.inputs.indexOf(element);if(toggleIndex!=-1)delete self.inputs[inputIndex];});return this;},destroy:function(){this.detach();return this.parent();}});String.prototype.leftpad=function(padString,length){var str=this;while(str.length<length)
str=padString+str;return str;}
function getShortDateString(d){return d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate();}
(function(){this.DatePicker=Picker.Date=new Class({Extends:Picker.Attach,options:{format:'%m-%d-%Y',timePicker:false,timePickerOnly:false,timeWheelStep:1,yearPicker:true,yearsPerPage:20,fnAfterRender:false,startDay:0,rtl:(en4.orientation=='rtl'),startView:'days',openLastView:false,pickOnly:false,canAlwaysGoUp:['months','days'],updateAll:false,weeknumbers:false,months_abbr:null,days_abbr:null,years_title:function(date,options){var year=date.get('year');return year+'-'+(year+options.yearsPerPage-1);},months_title:function(date,options){return date.get('year');},days_title:function(date,options){return date.format('%b %Y');},time_title:function(date,options){return(options.pickOnly=='time')?en4.core.language.translate('select a time'):date.format('%d %B, %Y');}},initialize:function(attachTo,options){this.parent(attachTo,options);this.setOptions(options);options=this.options;this.options.days_abbr=[en4.core.language.translate('Sun'),en4.core.language.translate('Mon'),en4.core.language.translate('Tue'),en4.core.language.translate('Wed'),en4.core.language.translate('Thu'),en4.core.language.translate('Fri'),en4.core.language.translate('Sat')];['year','month','day','time'].some(function(what){if(options[what+'PickerOnly']){options.pickOnly=what;return true;}
return false;});if(options.pickOnly){options[options.pickOnly+'Picker']=true;options.startView=options.pickOnly;}
var newViews=['days','months','years'];['month','year','decades'].some(function(what,i){return(options.startView==what)&&(options.startView=newViews[i]);});options.canAlwaysGoUp=options.canAlwaysGoUp?Array.from(options.canAlwaysGoUp):[];if(options.minDate){if(!(options.minDate instanceof Date))options.minDate=Date.parse(options.minDate);options.minDate.clearTime();}
if(options.maxDate){if(!(options.maxDate instanceof Date))options.maxDate=Date.parse(options.maxDate);options.maxDate.clearTime();}
if(!options.format){options.format=(options.pickOnly!='time')?Locale.get('Date.shortDate'):'';if(options.timePicker)options.format=(options.format)+(options.format?' ':'')+Locale.get('Date.shortTime');}
this.addEvent('attached',function(event,element){if(!this.currentView||!options.openLastView)this.currentView=options.startView;this.date=limitDate(new Date(),options.minDate,options.maxDate);var tag=element.get('tag'),input;if(tag=='input')input=element;else{var index=this.toggles.indexOf(element);if(this.inputs[index])input=this.inputs[index];}
this.getInputDate(input);this.input=input;this.setColumns(this.originalColumns);}.bind(this),true);},getInputDate:function(input){this.date=new Date();if(!input)return;var date=Date.parse(input.get('value'));if(date==null||!date.isValid()){var storeDate=input.retrieve('datepicker:value');if(storeDate)date=Date.parse(storeDate);}
if(date!=null&&date.isValid())this.date=date;},constructPicker:function(){this.parent();if(!this.options.rtl){this.previous=new Element('div.previous[html=&#171;]').inject(this.header);this.next=new Element('div.next[html=&#187;]').inject(this.header);}else{this.next=new Element('div.previous[html=&#171;]').inject(this.header);this.previous=new Element('div.next[html=&#187;]').inject(this.header);}},hidePrevious:function(_next,_show){this[_next?'next':'previous'].setStyle('display',_show?'block':'none');return this;},showPrevious:function(_next){return this.hidePrevious(_next,true);},setPreviousEvent:function(fn,_next){this[_next?'next':'previous'].removeEvents('click');if(fn)this[_next?'next':'previous'].addEvent('click',fn);return this;},hideNext:function(){return this.hidePrevious(true);},showNext:function(){return this.showPrevious(true);},setNextEvent:function(fn){return this.setPreviousEvent(fn,true);},setColumns:function(columns,view,date,viewFx){var ret=this.parent(columns),method;if((view||this.currentView)&&(method='render'+(view||this.currentView).capitalize())&&this[method])this[method](date||this.date.clone(),viewFx);return ret;},renderYears:function(date,fx){var options=this.options,pages=options.columns,perPage=options.yearsPerPage,_columns=[],_dates=[];this.dateElements=[];date=date.clone().decrement('year',date.get('year')%perPage);var iterateDate=date.clone().decrement('year',Math.floor((pages-1)/2)*perPage);for(var i=pages;i--;){var _date=iterateDate.clone();_dates.push(_date);_columns.push(renderers.years(timesSelectors.years(options,_date.clone()),options,this.date.clone(),this.dateElements,function(date){if(options.pickOnly=='years')this.select(date);else this.renderMonths(date,'fade');this.date=date;}.bind(this)));iterateDate.increment('year',perPage);}
this.setColumnsContent(_columns,fx);this.setTitle(_dates,options.years_title);var limitLeft=(options.minDate&&date.get('year')<=options.minDate.get('year')),limitRight=(options.maxDate&&(date.get('year')+options.yearsPerPage)>=options.maxDate.get('year'));this[(limitLeft?'hide':'show')+'Previous']();this[(limitRight?'hide':'show')+'Next']();this.setPreviousEvent(function(){this.renderYears(date.decrement('year',perPage),'left');}.bind(this));this.setNextEvent(function(){this.renderYears(date.increment('year',perPage),'right');}.bind(this));this.setTitleEvent(null);this.currentView='years';},renderMonths:function(date,fx){var options=this.options,years=options.columns,_columns=[],_dates=[],iterateDate=date.clone().decrement('year',Math.floor((years-1)/2));this.dateElements=[];for(var i=years;i--;){var _date=iterateDate.clone();_dates.push(_date);_columns.push(renderers.months(timesSelectors.months(options,_date.clone()),options,this.date.clone(),this.dateElements,function(date){if(options.pickOnly=='months')this.select(date);else this.renderDays(date,'fade');this.date=date;}.bind(this)));iterateDate.increment('year',1);}
this.setColumnsContent(_columns,fx);this.setTitle(_dates,options.months_title);var year=date.get('year'),limitLeft=(options.minDate&&year<=options.minDate.get('year')),limitRight=(options.maxDate&&year>=options.maxDate.get('year'));this[(limitLeft?'hide':'show')+'Previous']();this[(limitRight?'hide':'show')+'Next']();this.setPreviousEvent(function(){this.renderMonths(date.decrement('year',years),'left');}.bind(this));this.setNextEvent(function(){this.renderMonths(date.increment('year',years),'right');}.bind(this));var canGoUp=options.yearPicker&&(options.pickOnly!='months'||options.canAlwaysGoUp.contains('months'));var titleEvent=(canGoUp)?function(){this.renderYears(date,'fade');}.bind(this):null;this.setTitleEvent(titleEvent);this.currentView='months';},renderDays:function(date,fx){var options=this.options,months=options.columns,_columns=[],_dates=[],iterateDate=date.clone().decrement('month',Math.floor((months-1)/2));this.dateElements=[];for(var i=months;i--;){_date=iterateDate.clone();_dates.push(_date);_columns.push(renderers.days(timesSelectors.days(options,_date.clone()),options,this.date.clone(),this.dateElements,function(date){if(options.pickOnly=='days'||!options.timePicker)this.select(date)
else this.renderTime(date,'fade');this.date=date;}.bind(this)));iterateDate.increment('month',1);}
this.setColumnsContent(_columns,fx);this.setTitle(_dates,options.days_title);var yearmonth=date.format('%Y%m').toInt(),limitLeft=(options.minDate&&yearmonth<=options.minDate.format('%Y%m')),limitRight=(options.maxDate&&yearmonth>=options.maxDate.format('%Y%m'));this[(limitLeft?'hide':'show')+'Previous']();this[(limitRight?'hide':'show')+'Next']();this.setPreviousEvent(function(){this.renderDays(date.decrement('month',months),'left');}.bind(this));this.setNextEvent(function(){this.renderDays(date.increment('month',months),'right');}.bind(this));var canGoUp=options.pickOnly!='days'||options.canAlwaysGoUp.contains('days');var titleEvent=(canGoUp)?function(){this.renderMonths(date,'fade');}.bind(this):null;this.setTitleEvent(titleEvent);this.currentView='days';if(this.options.fnAfterRender){this.options.fnAfterRender(date);}},renderTime:function(date,fx){var options=this.options;this.setTitle(date,options.time_title);var originalColumns=this.originalColumns=options.columns;this.currentView=null;if(originalColumns!=1)this.setColumns(1);this.setContent(renderers.time(options,date.clone(),function(date){this.select(date);}.bind(this)),fx);this.hidePrevious().hideNext().setPreviousEvent(null).setNextEvent(null);var canGoUp=options.pickOnly!='time'||options.canAlwaysGoUp.contains('time');var titleEvent=(canGoUp)?function(){this.setColumns(originalColumns,'days',date,'fade');}.bind(this):null;this.setTitleEvent(titleEvent);this.currentView='time';},select:function(date,all){this.date=date;var formatted=date.format(this.options.format),time=date.strftime(),inputs=(!this.options.updateAll&&!all&&this.input)?[this.input]:this.inputs;inputs.each(function(input){input.set('value',formatted).store('datepicker:value',time).fireEvent('change');},this);this.fireEvent('select',[date].concat(inputs));this.close();return this;}});var timesSelectors={years:function(options,date){var times=[];for(var i=0;i<options.yearsPerPage;i++){times.push(+date);date.increment('year',1);}
return times;},months:function(options,date){var times=[];date.set('month',0);for(var i=0;i<=11;i++){times.push(+date);date.increment('month',1);}
return times;},days:function(options,date){var times=[];date.set('date',1);while(date.get('day')!=options.startDay)date.set('date',date.get('date')-1);for(var i=0;i<42;i++){times.push(+date);date.increment('day',1);}
return times;}};var renderers={years:function(years,options,currentDate,dateElements,fn){var container=new Element('div.years'),today=new Date(),element,classes;years.each(function(_year,i){var date=new Date(_year),year=date.get('year');classes='.year.year'+i;if(year==today.get('year'))classes+='.today';if(year==currentDate.get('year'))classes+='.selected';element=new Element('div'+classes,{text:year}).inject(container);dateElements.push({element:element,time:_year});if(isUnavailable('year',date,options))element.addClass('unavailable');else element.addEvent('click',fn.pass(date));});return container;},months:function(months,options,currentDate,dateElements,fn){var today=new Date(),month=today.get('month'),thisyear=today.get('year'),selectedyear=currentDate.get('year'),container=new Element('div.months'),monthsAbbr=options.months_abbr||Locale.get('Date.months_abbr'),element,classes;months.each(function(_month,i){var date=new Date(_month),year=date.get('year');classes='.month.month'+(i+1);if(i==month&&year==thisyear)classes+='.today';if(i==currentDate.get('month')&&year==selectedyear)classes+='.selected';element=new Element('div'+classes,{text:monthsAbbr[i]}).inject(container);dateElements.push({element:element,time:_month});if(isUnavailable('month',date,options))element.addClass('unavailable');else element.addEvent('click',fn.pass(date));});return container;},days:function(days,options,currentDate,dateElements,fn){var month=new Date(days[14]).get('month'),todayString=new Date().toDateString(),currentString=currentDate.toDateString(),weeknumbers=options.weeknumbers,container=new Element('table.days'+(weeknumbers?'.weeknumbers':''),{role:'grid','aria-labelledby':this.titleID}),header=new Element('thead').inject(container),body=new Element('tbody').inject(container),titles=new Element('tr.titles').inject(header),localeDaysShort=options.days_abbr,day,classes,element,weekcontainer,dateString,where=options.rtl?'top':'bottom';if(weeknumbers)new Element('th.title.day.weeknumber',{text:Locale.get('DatePicker.week')}).inject(titles);for(day=options.startDay;day<(options.startDay+7);day++){new Element('th.title.day.day'+(day%7),{text:localeDaysShort[(day%7)],role:'columnheader'}).inject(titles,where);}
days.each(function(_date,i){var date=new Date(_date);if(i%7==0){weekcontainer=new Element('tr.week.week'+(Math.floor(i/7))).set('role','row').inject(body);if(weeknumbers)new Element('th.day.weeknumber',{text:date.get('week'),scope:'row',role:'rowheader'}).inject(weekcontainer);}
dateString=date.toDateString();classes='.day.ynevent-cal-day.day'+date.get('day');if(dateString==todayString)classes+='.today';if(date.get('month')!=month)classes+='.otherMonth';element=new Element('td'+classes,{text:date.getDate(),role:'gridcell'}).inject(weekcontainer,where);if(dateString==currentString)element.addClass('selected').set('aria-selected','true');else element.set('aria-selected','false');element.set('id','yndc-'+getShortDateString(date));dateElements.push({element:element,time:_date});if(isUnavailable('date',date,options))element.addClass('unavailable');else element.addEvent('click',fn.pass(date.clone()));});return container;},time:function(options,date,fn){var container=new Element('div.time'),initMinutes=(date.get('minutes')/options.timeWheelStep).round()*options.timeWheelStep
if(initMinutes>=60)initMinutes=0;date.set('minutes',initMinutes);var hoursInput=new Element('input.hour[type=text]',{title:Locale.get('DatePicker.use_mouse_wheel'),value:date.format('%H'),events:{click:function(event){event.target.focus();event.stop();},mousewheel:function(event){event.stop();hoursInput.focus();var value=hoursInput.get('value').toInt();value=(event.wheel>0)?((value<23)?value+1:0):((value>0)?value-1:23)
date.set('hours',value);hoursInput.set('value',date.format('%H'));}.bind(this)},maxlength:2}).inject(container);var minutesInput=new Element('input.minutes[type=text]',{title:Locale.get('DatePicker.use_mouse_wheel'),value:date.format('%M'),events:{click:function(event){event.target.focus();event.stop();},mousewheel:function(event){event.stop();minutesInput.focus();var value=minutesInput.get('value').toInt();value=(event.wheel>0)?((value<59)?(value+options.timeWheelStep):0):((value>0)?(value-options.timeWheelStep):(60-options.timeWheelStep));if(value>=60)value=0;date.set('minutes',value);minutesInput.set('value',date.format('%M'));}.bind(this)},maxlength:2}).inject(container);new Element('div.separator[text=:]').inject(container);new Element('input.ok[type=submit]',{value:Locale.get('DatePicker.time_confirm_button'),events:{click:function(event){event.stop();date.set({hours:hoursInput.get('value').toInt(),minutes:minutesInput.get('value').toInt()});fn(date.clone());}}}).inject(container);return container;}};Picker.Date.defineRenderer=function(name,fn){renderers[name]=fn;return this;};var limitDate=function(date,min,max){if(min&&date<min)return min;if(max&&date>max)return max;return date;};var isUnavailable=function(type,date,options){var minDate=options.minDate,maxDate=options.maxDate,availableDates=options.availableDates,year,month,day,ms;if(!minDate&&!maxDate&&!availableDates)return false;date.clearTime();if(type=='year'){year=date.get('year');return((minDate&&year<minDate.get('year'))||(maxDate&&year>maxDate.get('year'))||((availableDates!=null&&!options.invertAvailable)&&(availableDates[year]==null||Object.getLength(availableDates[year])==0||Object.getLength(Object.filter(availableDates[year],function(days){return(days.length>0);}))==0)));}
if(type=='month'){year=date.get('year');month=date.get('month')+1;ms=date.format('%Y%m').toInt();return((minDate&&ms<minDate.format('%Y%m').toInt())||(maxDate&&ms>maxDate.format('%Y%m').toInt())||((availableDates!=null&&!options.invertAvailable)&&(availableDates[year]==null||availableDates[year][month]==null||availableDates[year][month].length==0)));}
year=date.get('year');month=date.get('month')+1;day=date.get('date');var dateAllow=(minDate&&date<minDate)||(minDate&&date>maxDate);if(availableDates!=null){dateAllow=dateAllow||availableDates[year]==null||availableDates[year][month]==null||!availableDates[year][month].contains(day);if(options.invertAvailable)dateAllow=!dateAllow;}
return dateAllow;};})();;function ynvideochannelAddNewPlaylist(ele,guid,url){var nextEle=ele.getNext();if(nextEle.hasClass("ynvideochannel_active_add_playlist")){nextEle.removeClass("ynvideochannel_active_add_playlist");nextEle.setStyle("display","none");}else{nextEle.addClass("ynvideochannel_active_add_playlist");nextEle.setStyle("display","block");}
$$('.play_list_span').each(function(el){if(el===nextEle){}else{el.empty();el.setStyle("display","none");el.removeClass("ynvideochannel_active_add_playlist");}});var data=guid;var request=new Request.HTML({url:url,data:{subject:data,},onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){var spanEle=nextEle;spanEle.innerHTML=responseHTML;eval(responseJavaScript);var popup=spanEle.getParent('.ynvideochannel-action-pop-up');var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getHeight();if(p_height-y_position<(c_height+65)){layout_parent.addClass('popup-padding-bottom');var margin_bottom=parseInt(layout_parent.getStyle('padding-bottom').replace(/\D+/g,''));layout_parent.setStyle('padding-bottom',(margin_bottom+c_height+65+y_position-p_height)+'px');}}});request.send();}
function ynvideochannelAddToPlaylist(ele,playlistId,guild,url){var checked=ele.get('checked');var data=guild;var request=new Request.JSON({url:url,data:{subject:data,playlist_id:playlistId,checked:checked,},onSuccess:function(responseJSON){if(!responseJSON.status){ele.set('checked',!checked);}
var div=ele.getParent('.ynvideochannel-action-pop-up');var notices=div.getElement('.add-to-playlist-notices');var notice=new Element('div',{'class':'add-to-playlist-notice',text:responseJSON.message});notices.adopt(notice);notice.fade('in');(function(){notice.fade('out').get('tween').chain(function(){notice.destroy();});}).delay(2000,notice);}});request.send();}
function ynvideochannelAddToFavorite(ele,video_id,url,favtext,unfavtext){var popup=ele.getParent('.ynvideochannel-action-pop-up');var favorite=popup.getElement('.favorite-loading');if(favorite){favorite.show();}
var favorite_link=popup.getElement('.favorite_link');if(favorite_link){favorite_link.hide();}
var request=new Request.JSON({url:url,data:{id:video_id},onSuccess:function(responseJSON){if(favorite){favorite.hide();}
if(favorite_link){favorite_link.show();}
if(responseJSON.result){if(responseJSON.added==1){var html='<i class="fa fa-star"></i>'+' '+unfavtext;ele.innerHTML=html;}else{var html='<i class="fa fa-star-o"></i>'+' '+favtext;ele.innerHTML=html;}}
var notices=popup.getElement('.add-to-playlist-notices');var notice=new Element('div',{'class':'add-to-playlist-notice',text:responseJSON.message});notices.adopt(notice);notice.fade('in');(function(){notice.fade('out').get('tween').chain(function(){notice.destroy();});}).delay(2000,notice);}});request.send();}
window.addEvent('domready',function(){ynvideochannelAddToOptions();});(function($,$$){var events;var check=function(e){var target=$(e.target);var parents=target.getParents();events.each(function(item){var element=item.element;if(element!=target&&!parents.contains(element))
item.fn.call(element,e);});};Element.Events.outerClick={onAdd:function(fn){if(!events){document.addEvent('click',check);events=[];}
events.push({element:this,fn:fn});},onRemove:function(fn){events=events.filter(function(item){return item.element!=this||item.fn!=fn;},this);if(!events.length){document.removeEvent('click',check);events=null;}}};})(document.id,$$);function ynvideochannelAddToOptions(){$$('a.ynvideochannel-action-link.show-hide-btn').removeEvents('click').addEvent('click',function(){var parent=this.getParent('.action-container');var popup=parent.getElement('.ynvideochannel-action-pop-up');var parent_active=$$('.ynvideochannel_video-channel-playlist_options').length;$$('.action-container').each(function(el){el.removeClass("ynvideochannel-action-shown");});if(parent_active){this.getParents('.ynvideochannel_video-channel-playlist_options').toggleClass('ynvideochannel-addtoplaylist-active');}
var pageParent=popup.getParent('#global_content');var otherPopup=pageParent.getElement('.ynvideochannel_button_more_explain');if(otherPopup!=null){otherPopup.hide();}
$$('.ynvideochannel-action-pop-up').each(function(el){if(el!=popup)el.hide();});if(!popup.isDisplayed()){parent.addClass("ynvideochannel-action-shown");var loading=popup.getElement('.add-to-playlist-loading');if(loading){var url=loading.get('rel');loading.show();var checkbox=popup.getElement('.box-checkbox');checkbox.hide();var request=new Request.HTML({url:url,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){elements=Elements.from(responseHTML);if(elements.length>0){checkbox.empty();checkbox.adopt(elements);eval(responseJavaScript);loading.hide();checkbox.show();var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getHeight();if(p_height-y_position<(c_height+65)){layout_parent.addClass('popup-padding-bottom');var margin_bottom=parseInt(layout_parent.getStyle('padding-bottom').replace(/\D+/g,''));layout_parent.setStyle('padding-bottom',(margin_bottom+c_height+65+y_position-p_height)+'px');}}}});request.send();}
var favorite=popup.getElement('.favorite-loading');if(favorite){var url=favorite.get('rel');favorite.show();var favorite_link=popup.getElement('.favorite_link');favorite_link.hide();var request=new Request.HTML({url:url,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){elements=Elements.from(responseHTML);if(elements.length>0){favorite_link.empty();favorite_link.adopt(elements);eval(responseJavaScript);favorite.hide();favorite_link.show();}}});request.send();}}else{parent.removeClass("ynvideochannel-action-shown");}
popup.toggle();var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}
var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getHeight();if(popup.isDisplayed()){if(p_height-y_position<(c_height+1)){layout_parent.addClass('popup-padding-bottom');layout_parent.setStyle('padding-bottom',(c_height+1+y_position-p_height)+'px');}
else if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}}
else{if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}}});$$('.ynvideochannel-action-add-playlist').addEvent('outerClick',function(){var popup=this.getElement('.ynvideochannel-action-pop-up');var display_popup=popup.getStyle('display');var parent_popup_active=this.getParents('.ynvideochannel_video-channel-playlist_options');if(display_popup='block'){popup.setStyle('display','none');};if(this.hasClass('ynvideochannel-action-shown')){this.removeClass('ynvideochannel-action-shown');}
if(parent_popup_active.hasClass('ynvideochannel-addtoplaylist-active')){parent_popup_active.removeClass('ynvideochannel-addtoplaylist-active');}});$$('a.ynvideochannel-action-link.cancel').removeEvents('click').addEvent('click',function(){var parent=this.getParent('.ynvideochannel-action-pop-up');if(parent){parent.hide();var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}}});}
function ynvideochannelVideoOptions(){var parent_active=$$('.ynvideochannel_video-channel-playlist_options').length;$$('.ynvideochannel_video_options-btn').removeEvents('click').addEvent('click',function(){this.getParent('.ynvideochannel_video_options').toggleClass('explained');if(parent_active){this.getParents('.ynvideochannel_video-channel-playlist_options').toggleClass('ynvideochannel-options-active');}});$$('.ynvideochannel_video_options-btn').addEvent('outerClick',function(){var popup=this.getParent('.ynvideochannel_video_options');var parent_popup=this.getParents('.ynvideochannel_video-channel-playlist_options');if(popup.hasClass('explained')){popup.removeClass('explained');}
if(parent_popup.hasClass('ynvideochannel-options-active')){parent_popup.removeClass('ynvideochannel-options-active');}});}
function ynvideochannelChannelOptions(){$$('.ynvideochannel_channel_options-btn').removeEvents('click').addEvent('click',function(){var popup=this.getParent('.ynvideochannel_channel_options');popup.toggleClass('explained');var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getElement('.ynvideochannel_channel_options-block').getHeight();if(p_height-y_position<(c_height+60)){layout_parent.addClass('popup-padding-bottom');var margin_bottom=parseInt(layout_parent.getStyle('padding-bottom').replace(/\D+/g,''));layout_parent.setStyle('padding-bottom',(margin_bottom+c_height+80+y_position-p_height)+'px');}});$$('.ynvideochannel_channel_options').addEvent('outerClick',function(){var popup=this;if(popup.hasClass('explained')){popup.removeClass('explained');$$('.owl-next').setStyle('display','block');}})}
function ynvideochannelPlaylistOptions(){var parent_active=$$('.ynvideochannel_video-channel-playlist_options').length;$$('.ynvideochannel_video_options-btn').removeEvents('click').addEvent('click',function(){this.getParent('.ynvideochannel_video_options').toggleClass('explained');if(parent_active){this.getParents('.ynvideochannel_video-channel-playlist_options').toggleClass('ynvideochannel-options-active');}});$$('.ynvideochannel_video_options-btn').addEvent('outerClick',function(){var popup=this.getParent('.ynvideochannel_video_options');var parent_popup=this.getParents('.ynvideochannel_video-channel-playlist_options');if(popup.hasClass('explained')){popup.removeClass('explained');}
if(parent_popup.hasClass('ynvideochannel-options-active')){parent_popup.removeClass('ynvideochannel-options-active');}})};var Wall={};Wall.rolldownload=true;Wall.dialogConfirm=true;Wall.submitOnEnter=false;Wall.autoupdate=true;Wall.globalBind=function()
{window.addEvent('domready',function(){try{window.clearTimeout(window.wallTimeout);window.wallTimeout=setTimeout(function(){Smoothbox.bind($$('body')[0]);if(!Wall.elements){Wall.elements=new Wall.Storage();}
$$('.wall_tips').each(function(item){if(item.get('title')){Wall.elementClass(Wall.Tips,item);}});if(Wall.liketips_enabled){$$('.wall_liketips').each(function(item){if(!item||!$(item).get('rev')){return;}
var type=$(item).get('rev').split("_")[0];var types=['user','page','group','event'];if(!types.contains(type)){return;}
Wall.elementClass(Wall.LikeTips,item);});}
$$('.wall_blurlink').each(function(item){Wall.elementClass(Wall.BlurLink,item);});},300);}catch(e){}});};Wall.globalBind();Wall.runonce={is_ready:false,add:function(fn,force)
{if(this.is_ready&&force){fn();}else{en4.core.runonce.add(fn);}}};Wall.window_title='';Wall.activityCount=function(count)
{if(!count){document.title=Wall.window_title;}else{document.title='('+count+') '+Wall.window_title;}};var WallLoader=function(){Wall.window_title=document.title;Wall.runonce.is_ready=true;};window.addEvent('load',function(){WallLoader();});window.addEvent('domready',function(){WallLoader();});Wall.is_request=false;Wall.request=function(url,data,callback)
{if(typeof(data)=='object'){data.format='json';}else if(typeof(data)=='string'){data+='&format=json';}
Wall.is_request=true;(new Request.JSON({secure:false,url:url,method:'post',data:data,onSuccess:function(obj){Wall.is_request=false;if($type(callback)=='function'){callback(obj);}
Wall.globalBind();en4.core.runonce.trigger();}})).send();};Wall.requestHTML=function(url,callback,$container,data)
{data=$merge({'format':'html'},data);Wall.is_request=true;var request=new Request.HTML({'url':url,'method':'get','data':data,'evalScripts':false,'onComplete':function(responseTree,responseElements,responseHTML,responseJavaScript){Wall.is_request=false;if($container&&$type($container)=='element'){$container.set('html',responseHTML);}
if($type(callback)=='function'){callback(responseHTML);}
eval(responseJavaScript);Wall.globalBind();en4.core.runonce.trigger();}});request.send();};Wall.is_setKeyEvent=false;Wall.setKeyEvent=function(fn)
{var self=this;if(this.is_setKeyEvent){return;}
window.addEvent('keyup',function(e){if(e.target.get('tag')=='html'||e.target.get('tag')=='body'){if(fn&&$type(fn)=='function'){fn(e);}}});this.is_setKeyEvent=true;};Wall.$external_div=null;Wall.externalDiv=function(){if(!this.$external_div||$type(this.$external_div)!='element'){this.$external_div=new Element('div',{'class':'wall-element-external'});this.$external_div.inject($$('body')[0]);}
return this.$external_div;};Wall.applyAll=function(fn)
{if(!fn||$type(fn)!='function'){return;}
Wall.feeds.getAll().each(function(item){fn(item);});};Wall.BlurLink=new Class({name:'Wall.BlurLink',initialize:function(element)
{element=$(element);element.addEvent('focus',function(){$try(function(){if(element){element.blur();}});});}});Wall.getWindowSize=function()
{if(typeof(document.body.clientWidth)=='number'){return{x:document.body.clientWidth,y:document.body.clientHeight};}else{return $$('body')[0].getSize();}};Wall.injectAbsolute=function(element,container,direction)
{element=$(element);container=$(container);if($$('html[dir=rtl]').length){direction=!direction;}
if($type(element)!='element'||$type(container)!='element'){return;}
var build=function()
{var pos=element.getCoordinates();var page_width=Wall.getWindowSize().x;var top=(pos.top)?pos.top:0;var height=(pos.height)?pos.height:0;var left=(pos.left)?pos.left:0;var width=(pos.width)?pos.width:0;var body_top=($$('body')[0].getStyle('top').toInt())?$$('body')[0].getStyle('top').toInt():0;if(top&&body_top){top-=body_top;}
try{container.setStyle('position','absolute').setStyle('top',top+height);if(direction){container.setStyle('right',page_width-left-width);}else{container.setStyle('left',left);}}catch(e){}};container.inject(Wall.externalDiv(),'bottom');window.addEvent('resize',function(){build();}.bind(this));build();return container;};Wall.OverText=new Class({element:null,text:'',initialize:function(element,text)
{this.element=element=$(element);this.text=text;element.set('value',text);element.addClass('overTxtLabel');element.addEvent('focus',function(){if(element.get('value')==text){element.set('value','');}
element.removeClass('overTxtLabel');});element.addEvent('blur',function(){if(element.get('value')==''){element.set('value',text);}
if(element.get('value')==text){element.addClass('overTxtLabel');}});},clear:function()
{this.element.value=this.text;this.element.addClass('overTxtLabel');}});Wall.Loader=new Class({element:null,initialize:function(element)
{this.element=element=$(element);},hide:function()
{if(this.element){$(this.element).setStyle('display','none');}},show:function()
{if(this.element){$(this.element).setStyle('display','');}}});Wall.OverLoader=new Class({name:'Wall.OverLoader',Implements:[Events,Options],element:null,overloader:null,icon:null,type:'',options:{is_smoothbox:false},initialize:function(element,type,options)
{this.element=element=$(element);this.type=type||'loader1';this.setOptions(options);this.overloader=new Element('div',{'class':'wall-overloader '+this.type,'style':'display: none'});this.icon=new Element('div',{'class':'wall_icon'});this.icon.inject(this.overloader);this.build();this.overloader.inject(element,'after');},show:function()
{this.build();this.overloader.setStyle('display','');},hide:function()
{this.overloader.setStyle('display','none');},build:function()
{if(!this.element.isVisible()){return;}
var pos=this.element.getCoordinates();var body_top=($$('body')[0].getStyle('top').toInt())?$$('body')[0].getStyle('top').toInt():0;if(pos.top&&body_top){pos.top-=body_top;}
this.overloader.setStyle('position','absolute').setStyle('left',pos.left).setStyle('top',pos.top).setStyle('width',pos.width+((this.options.is_smoothbox)?0:1)).setStyle('height',pos.height+((this.options.is_smoothbox)?0:1)).setStyle('display','none');var loader_width=0;var loader_height=0;if(this.type=='loader1'){loader_width=16;loader_height=16;}else if(this.type=='loader2'){loader_width=48;loader_height=48;}
if($$('html[dir=rtl]').length){this.icon.setStyle('margin-right',pos.width/2-loader_width/2).setStyle('margin-top',pos.height/2-loader_height/2);}else{this.icon.setStyle('margin-left',pos.width/2-loader_width/2).setStyle('margin-top',pos.height/2-loader_height/2);}}});Wall.elementClass=function()
{var options=Array.prototype.slice.call(arguments||[]);var newClass=options[0];if(!newClass||($type(newClass)!='class')){return;}
var name=newClass.prototype.name;if(!name){return;}
if($type($(options[1]))=='element'){var element=$(options[1]);var key=name+'_'+(window.$uid||Slick.uidOf)(element);var instance=Wall.elements.get(key);if(instance){return instance;}
newClass._prototyping=true;newClass.$prototyping=true;instance=new newClass();delete newClass._prototyping;delete newClass.$prototyping;newClass.prototype.initialize.apply(instance,options.slice(1));Wall.elements.add(key,instance);return instance;}};Wall.TipFx=new Class({Implements:[Events,Options],options:{class_var:'',is_arrow:true,relative_element:null,delay:1},timeout:null,mouseActive:false,initialize:function(element,options)
{this.setOptions(options);this.element=$(element);this.createDom();},createDom:function()
{var self=this;if($type($(this.element))!='element'){return;}
this.$container=new Element('div',{'class':'wall-tips '+(this.options.class_var||''),style:'display:none'});this.$inner=new Element('div',{'class':'container','html':(this.options.html||'')});if(!Wall.isLightTheme()){this.$container.addClass('night_theme');}
if(this.options.is_arrow){this.$arrow_container=new Element('div',{'class':'arrow_container'});this.$arrow=new Element('div',{'class':'arrow'});}
this.$inner.inject(this.$container);if(this.options.is_arrow){this.$arrow.inject(this.$arrow_container);this.$arrow_container.inject(this.$container);}
this.$container.inject(Wall.externalDiv());window.addEvent('resize',function(){this.build();}.bind(this));this.build();var mouseover=function(){this.mouseActive=true;if(this.options.delay){window.clearTimeout(this.timeout);this.timeout=window.setTimeout(function(){this.build();this.$container.setStyle('display','');this.fireEvent('mouseover');}.bind(this),this.options.delay);}else{this.build();this.$container.setStyle('display','');this.fireEvent('mouseover');}}.bind(this);this.element.addEvent('mouseover',mouseover);this.$container.addEvent('mouseover',mouseover);var mouseout=function(e){this.mouseActive=false;if(this.options.delay){window.clearTimeout(this.timeout);this.timeout=window.setTimeout(function(){if(e&&$(e.relatedTarget)){}
this.$container.setStyle('display','none');this.fireEvent('mouseout');}.bind(this),this.options.delay);}else{this.$container.setStyle('display','none');this.fireEvent('mouseout');}}.bind(this);this.element.addEvent('mouseout',mouseout);this.$container.addEvent('mouseout',mouseout);this.fireEvent('complete');},build:function()
{if(!this.element.isVisible()){return;}
var dir='ltr';if($$('html')[0]){dir=$$('html')[0].get('dir');}
this.$container.setStyle('display','');var e_pos=this.element.getCoordinates();var c_pos=this.$container.getCoordinates();var w_pos=this.options.relative_element||$$('body')[0].getSize();var body_top=($$('body')[0].getStyle('top').toInt())?$$('body')[0].getStyle('top').toInt():0;if(e_pos.top&&body_top){e_pos.top-=body_top;}
this.$container.setStyle('display','none').setStyle('padding-bottom',2);var rebuild=function(left,top){if(left){this.$container.setStyle('left',e_pos.left);if(this.options.is_arrow){var left=(e_pos.width/2-2.5).toInt();if(left>c_pos.width/2-2.5){left=10;}
this.$arrow.setStyle('left',left);}}else{this.$container.setStyle('left',e_pos.left-(c_pos.width-e_pos.width));if(this.options.is_arrow){var right=(e_pos.width/2-2.5).toInt();if(right>c_pos.width/2-2.5){right=10;}
this.$arrow.setStyle('right',right);}}
if(top){this.$container.setStyle('top',e_pos.top-c_pos.height-1);if(this.options.is_arrow){this.$arrow_container.inject(this.$inner,'after');this.$arrow.addClass('bottom');}}else{this.$container.setStyle('top',e_pos.top+e_pos.height+1);if(this.options.is_arrow){this.$arrow_container.inject(this.$inner,'before');this.$arrow.addClass('top');}}
this.fireEvent('build');}.bind(this);if(this.options.top!=undefined&&this.options.left!=undefined){rebuild(this.options.left,this.options.top);}else{if(dir=='rtl'){rebuild(0,1);}else{rebuild(1,1);}}}});Wall.Tips=new Class({Extends:Wall.TipFx,name:'Wall.Tips',initialize:function(element,options)
{this.addEvent('onComplete',function(){var title=this.options.title||this.element.get('title');this.$inner.set('html','<div class="data"><div class="title">'+title+'</div></div>');this.element.removeProperty('title');}.bind(this));this.parent(element,options);},setTitle:function(title)
{this.$inner.set('html','<div class="data"><div class="title">'+title+'</div></div>');this.build();if(this.mouseActive){this.$container.setStyle('display','block');}}});Wall.Storage=new Class({items:{},initialize:function()
{this.items=new Hash();},add:function(key,object)
{if(this.items[key]){return;}
this.items[key]=object;return this;},get:function(key)
{var options=Array.prototype.slice.call(arguments||[]);if(options.length>1){key=options.join("_");}
return this.items[key];},getAll:function()
{return this.items},remove:function(key)
{this.items.erase(key);return this;}});Wall.dialog={};Wall.dialog.message=function(message,result,in_parent){var type=(result)?'':'error';if(result==1){type='';}else if(result==2){type='notice';}else{type='error';}
var from=null;if(in_parent&&window.parent){from=window.parent;}else{from=window;}
from.he_show_message(message,type);};Wall.dialog.confirm=function(type,callback,in_parent){if(!Wall.dialogConfirm){$try(callback);return;}
var title=en4.core.language.translate('WALL_CONFIRM_'+type.toUpperCase()+'_TITLE');var description=en4.core.language.translate('WALL_CONFIRM_'+type.toUpperCase()+'_DESCRIPTION');var from=null;if(in_parent&&window.parent){from=window.parent;}else{from=window;}
from.he_show_confirm(title,description,callback);};Wall.List=new Class({Implements:[Events,Options],params:{'tab':'all','page':1,'search':''},options:{url:{},is_edit:false,list_id:0,selected:[]},select_paging_active:false,morph:null,initialize:function(options)
{this.setOptions(options);this.init($('wall-list'));},init:function(container)
{var self=this;this.$container=$(container);Wall.globalBind();this.loader=new Wall.OverLoader(this.$container.getElement('.items-container'),'loader2');if(this.options.is_edit){this.toggle(false);this.$container.getElements('.tabs-container .selected').addClass('is_active');this.$container.getElements('.selected-container .item').addClass('is_active');this.$container.getElement('.selected_count').set('html',self.options.selected.length);}
this.$container.getElements('.tabs-container .all').addEvent('click',function(){self.toggle(true);$(this).addClass('is_active');self.params={'tab':'all','page':1,'search':''};self.getItems(self.params);});this.$container.getElements('.tabs-container .selected').addEvent('click',function(){self.toggle(false);$(this).addClass('is_active');});this.$container.getElements('.tabs-container .type').addEvent('click',function(){self.toggle(true);$(this).addClass('is_active');var type=$(this).get('rev').substr(5);self.params={'tab':type,'page':1,'search':''};self.getItems(self.params);});this.$container.getElement('.all-prev').addEvent('click',function(){if($(this).hasClass('disabled')){return;}
self.params.page--;self.getItems(self.params);});this.$container.getElement('.all-next').addEvent('click',function(){if($(this).hasClass('disabled')){return;}
self.params.page++;self.getItems(self.params);});var searchSubmit=function(){self.params.page=1;self.params.search=self.$container.getElement('.search-form input').value;self.getItems(self.params);};this.$container.getElement('.search-form form').addEvent('submit',function(e){e.stop();searchSubmit();});this.$container.getElement('.search-form a').addEvent('click',function(){searchSubmit();});this.$container.getElement('.select-prev').addEvent('click',function(){self.selectedPaging(-1);});this.$container.getElement('.select-next').addEvent('click',function(){self.selectedPaging(1);});var $form=this.$container.getElement('.form');var formSubmit=function(){var data={'label':$form.label.value,'guids':self.options.selected,'list_id':self.options.list_id};Wall.request(self.options.url.save,data,function(obj){Wall.dialog.message(obj.message,obj.result,window.parent);if(obj.result){window.parent.Wall.feeds.getAll().each(function(item){item.loadList(obj.html);var $link=item.$types.getElement('.item[rev=list-'+obj.list_id+']');if($link){$link.fireEvent('click');}
window.parent.Smoothbox.close();});}});};this.$container.getElement('.form').addEvent('submit',function(e){e.stop();formSubmit();});this.$container.getElement('.form-submit').addEvent('click',function(e){e.stop();formSubmit();});this.initItem();},toggle:function(is_all)
{var tabs=this.$container.getElements('.tabs-container ul li a');var selected=this.$container.getElements('.selected-container');var all=this.$container.getElements('.all-container');if(is_all){tabs.removeClass('is_active');selected.removeClass('is_active');all.addClass('is_active');this.$container.getElements('.all-prev, .all-next').setStyle('display','');this.$container.getElements('.select-prev, .select-next').setStyle('display','none');}else{tabs.removeClass('is_active');selected.addClass('is_active');all.removeClass('is_active');this.$container.getElements('.all-prev, .all-next').setStyle('display','none');this.$container.getElements('.select-prev, .select-next').setStyle('display','');this.checkCountSelected();this.selectedPaging(0);}},checkCountSelected:function()
{var selected=this.$container.getElements('.selected-container');if(this.options.selected.length){selected.getElement('.message').setStyle('display','none');}else{selected.getElement('.message').setStyle('display','');}},selectedPaging:function(direction)
{var self=this;if(this.select_paging_active){return;}
var $items=this.$container.getElement('.selected-container .items');var $total=this.$container.getElement('.items-container .container');var new_top=0;var top=$items.getStyle('top').toInt();var step=$total.getSize().y;var total=$items.getSize().y;if(direction==1){new_top=top-step;}else if(direction==-1){new_top=top+step;}else{if(top<=-total){new_top=top+step;}else{new_top=top;}}
if(new_top>0||new_top<=-total){return;}
if(new_top-step<=-total){this.$container.getElement('.select-next').addClass('disabled');}else{this.$container.getElement('.select-next').removeClass('disabled');}
if(new_top+step>0){this.$container.getElement('.select-prev').addClass('disabled');}else{this.$container.getElement('.select-prev').removeClass('disabled');}
if(top==new_top){return;}
this.select_paging_active=true;var morph=new Fx.Morph($items,{duration:'short'});morph.addEvent('onComplete',function(){self.select_paging_active=false;});morph.start({'top':new_top});},getItems:function()
{var self=this;this.loader.show();Wall.request(self.options.url.browse,this.params,function(obj){self.$container.getElements('.all-container .items').set('html',obj.html);if(obj.prev){self.$container.getElement('.all-prev').removeClass('disabled');}else{self.$container.getElement('.all-prev').addClass('disabled');}
if(obj.next){self.$container.getElement('.all-next').removeClass('disabled');}else{self.$container.getElement('.all-next').addClass('disabled');}
self.loader.hide();self.initItem();});},initItem:function()
{var $container=this.$container;var self=this;this.options.selected.each(function(guid){$container.getElements('.all-container .items li.item_'+guid).addClass('is_active');});var selectedClick=function(){var guid=$(this).get('rev').substr(5);$container.getElements('.all-container .items li.item_'+guid).removeClass('is_active');$(this).destroy();self.options.selected.erase(guid);self.selectedPaging(0);self.checkCountSelected();self.$container.getElement('.selected_count').set('html',self.options.selected.length);};$container.getElements('.selected-container .items li.item').addEvent('click',selectedClick);$container.getElements('.all-container .items li.item').addEvent('click',function(){var guid=$(this).get('rev').substr(5);if($(this).hasClass('is_active')){$(this).removeClass('is_active');$container.getElements('.selected-container .items li.item_'+guid).destroy();self.options.selected.erase(guid);self.$container.getElement('.selected_count').set('html',self.options.selected.length);self.selectedPaging(0);}else{$(this).addClass('is_active');if(!self.options.selected.contains(guid)){self.options.selected[self.options.selected.length]=guid;}
self.$container.getElement('.selected_count').set('html',self.options.selected.length);$(this).clone().inject($container.getElement('.selected-container .items')).addEvent('click',selectedClick);}});}});Wall.slideshows=new Wall.Storage();Wall.Slideshow=new Class({feed_uid:'',Implements:[Events,Options],options:{item_width:107,item_count:7},url:'',src:'',is_loading:false,viewClose:function()
{this.slideshow.destroy();Wall.slideshows.remove(this.feed_uid);$$('html')[0].removeClass('wall_hidescrool');},createBox:function()
{this.slideshow.inject(Wall.externalDiv());$$('html')[0].addClass('wall_hidescrool');this.build();},createDom:function()
{this.slideshow=new Element('div',{'class':'wall-slideshow wall-window'});this.container=new Element('div',{'class':'container'});this.close=new Element('a',{'class':'close wall_blurlink','href':'javascript:void(0);'});this.prev=new Element('a',{'class':'prev navigation wall_blurlink','href':'javascript:void(0);','style':'display: none'});this.next=new Element('a',{'class':'next navigation wall_blurlink','href':'javascript:void(0);','style':'display: none'});this.content=new Element('div',{'class':'content'});var html='<table cellpadding="0" cellspacing="0"><tr><td valign="middle" align="center" style="width:960px;height:600px;text-align: center;"><a href="javascript:void(0);"><img src="'+this.src+'" alt=""/></a></td></tr>';this.preview=new Element('div',{'class':'preview is_active','html':html});if(!Wall.isLightTheme()){this.slideshow.addClass('night_theme');}
if(!!navigator.userAgent.match(/MSIE/)){this.slideshow.addClass('ie');}
this.close.inject(this.slideshow);this.prev.inject(this.container);this.next.inject(this.container);this.preview.inject(this.container);this.content.inject(this.container);this.container.inject(this.slideshow);},initialize:function(src,guid,element)
{var self=this;this.feed_uid=$random(1111,9999);this.src=src;Wall.setKeyEvent(function(e){if(e.key=='right'||e.key=='up'){Wall.slideshows.getAll().each(function(item){item.next.fireEvent('click');});}
if(e.key=='left'||e.key=='down'){Wall.slideshows.getAll().each(function(item){item.prev.fireEvent('click');});}
if(e.key=='esc'){Wall.slideshows.getAll().each(function(item){item.viewClose();});}});Wall.slideshows.add(this.feed_uid,this);Wall.slideshows.taggers=new Wall.Storage();this.createDom();window.addEvent('resize',function(){self.build();});this.slideshow.addEvent('click',function(e){if(e){e.stop();if(!$(e.target).getParent('body')||$(e.target).getParent('.container')||$(e.target).hasClass('container')){return;}}
self.viewClose();});Wall.globalBind();var thumb='';if(element){element=$(element);thumb=$(element).get('src');if(!thumb){thumb=$(element).getElement('img').get('src');}}
this.createBox();self.build();this.preview.getElement('img').addEvent('load',function(){self.build();});this.close.addEvent('click',function(){self.viewClose();});this.url=en4.core.baseUrl+'wall/photo/index?subject='+guid;Wall.requestHTML(this.url,function(html){if(!html){return;}
self.preview.setStyle('display','none');self.content.setStyle('display','');self.content.set('html',html);self.initPositions();self.initItems();var $items=self.content.getElement('.photo_list .items');var new_left=($items.getElement('.item.is_active').getAllPrevious().length/self.options.item_count).toInt()*(self.options.item_width*self.options.item_count);$items.setStyle('left',-new_left);self.paging(0);self.prev.setStyle('display','').addEvent('click',function(){var $items=self.content.getElement('.photo_list .items');var $active=self.content.getElement('.photo_list .item.is_active');var result=($active.getAllPrevious().length+1)%self.options.item_count;if(result===1){self.photosPrev();}else{var $prev=$active.getPrevious();if($prev){$prev.getElement('a').fireEvent('click');}}
self.checkPagination();});self.next.setStyle('display','').addEvent('click',function(){var $items=self.content.getElement('.photo_list .items');var $active=self.content.getElement('.photo_list .item.is_active');var result=($active.getAllPrevious().length+1)%self.options.item_count;if(result===0){self.photosNext();}else{var $next=$active.getNext();if($next){$next.getElement('a').fireEvent('click');}}
self.checkPagination();});self.content.getElements('.photos_next').addEvent('click',function(){self.photosNext();});self.content.getElements('.photos_prev').addEvent('click',function(){self.photosPrev();});self.checkPagination();});},checkPagination:function()
{var nextPhotos=this.container.getElement('.photos_next');var next=this.container.getElement('.next');if(!this.container.getElement('.photo_items .item.is_active').getNext()&&(nextPhotos.hasClass('disabled')&&!nextPhotos.hasClass('has_more'))){next.addClass('disabled');}else{next.removeClass('disabled');}
var prevPhotos=this.container.getElement('.photos_prev');var prev=this.container.getElement('.prev');if(!this.container.getElement('.photo_items .item.is_active').getPrevious()&&(prevPhotos.hasClass('disabled')&&!prevPhotos.hasClass('has_more'))){prev.addClass('disabled');}else{prev.removeClass('disabled');}},photosNext:function(callback)
{var self=this;var $element=this.content.getElement('.photos_next');if($element.hasClass('has_more')&&$element.hasClass('disabled')){self.loadNext(function(){self.paging(1,function(){if($type(callback)=='function'){callback();}});});return;}
self.paging(1,function(){if($type(callback)=='function'){callback();}});self.build();},photosPrev:function(callback)
{var self=this;var $element=this.content.getElement('.photos_prev');if($element.hasClass('has_more')&&$element.hasClass('disabled')){self.loadPrev(function(){self.paging(-1,function(){if($type(callback)=='function'){callback();}});});return;}
self.paging(-1,function(){if($type(callback)=='function'){callback();}});self.build();},initPositions:function()
{var $items=this.content.getElement('.items');$items.setStyle('width',this.options.item_width*$items.getChildren().length);this.paging(0);},initItems:function(container)
{var self=this;if(!container){container=this.content;}
container.getElements('.photo_list .item a').addEvent('click',function(){var id=$(this).get('rev').substr(5);self.view(id);});container.getElements('.header .description').enableLinks();container.getElements('.photo a').addEvent('click',function(e){if(e){e.stop();if(!$(e.target).getParent('body')||$(e.target).getParent('.container')){return;}}
self.next.fireEvent('click');});Wall.globalBind();},loadPrev:function(callback)
{var self=this;if(self.is_loading){return;}
self.is_loading=true;var prev=this.content.getElement('.photos_prev');var new_url=this.url+'&p='+prev.get('rev').substr(5);var $loader=this.content.getElement('.loader');$loader.setStyle('display','block');Wall.requestHTML(new_url,function(html){$loader.setStyle('display','none');self.is_loading=false;var new_elements=new Element('div',{'html':html});var count_items=new_elements.getElements('.photo_list .item').length;self.initItems(new_elements);new_elements.getElements('.photo .item').removeClass('is_active').each(function(item){item.inject(self.content.getElement('.photo'),'top');});new_elements.getElements('.photos_info .item').removeClass('is_active').each(function(item){item.inject(self.content.getElement('.photos_info'),'top');});new_elements.getElements('.photo_list .item').removeClass('is_active').each(function(item){item.inject(self.content.getElement('.photo_list .items'),'top');});if(new_elements.getElement('.photos_prev.has_more')){prev.addClass('has_more');}else{prev.removeClass('has_more');}
self.content.getElement('.photos_prev').set('rev',new_elements.getElement('.photos_prev').get('rev'));var $items=self.content.getElement('.photo_list .items');var current_left=0;$items.setStyle('left',current_left-(count_items*self.options.item_width));self.initPositions();if(callback&&$type(callback)=='function'){callback();}});},loadNext:function(callback)
{var self=this;if(self.is_loading){return;}
self.is_loading=true;var next=this.content.getElement('.photos_next');var new_url=this.url+'&p='+next.get('rev').substr(5);var $loader=this.content.getElement('.loader');$loader.setStyle('display','block');Wall.requestHTML(new_url,function(html){$loader.setStyle('display','none');self.is_loading=false;var new_elements=new Element('div',{'html':html});self.initItems(new_elements);new_elements.getElements('.photo .item').removeClass('is_active').each(function(item){item.inject(self.content.getElement('.photo'),'bottom');});new_elements.getElements('.photos_info .item').removeClass('is_active').each(function(item){item.inject(self.content.getElement('.photos_info'),'bottom');});new_elements.getElements('.photo_list .item').removeClass('is_active').each(function(item){item.inject(self.content.getElement('.photo_list .items'),'bottom');});if(new_elements.getElement('.photos_next.has_more')){next.addClass('has_more');}else{next.removeClass('has_more');}
self.content.getElement('.photos_next').set('rev',new_elements.getElement('.photos_next').get('rev'));self.initPositions();if(callback&&$type(callback)=='function'){callback();}});},view:function(id)
{this.content.getElements('.photo_list .item').removeClass('is_active');this.content.getElements('.photo_list .item_'+id).addClass('is_active');this.content.getElements('.photo .item').removeClass('is_active');this.content.getElements('.photos_info .item').removeClass('is_active');this.content.getElements('.photo .item_'+id).addClass('is_active');this.content.getElements('.photos_info .item_'+id).addClass('is_active');this.checkPagination();},paging:function(direction,callback)
{var self=this;if(this.select_paging_active){return;}
var $items=this.content.getElement('.items');var $total=this.content.getElement('.photo_list');var new_top=0;var top=$items.getStyle('left').toInt();if(!top){top=0;}
var step=self.options.item_width*this.options.item_count;var total=$items.getSize().x;if(direction==1){new_top=top-step;}else if(direction==-1){new_top=top+step;}else{if(top<=-total){new_top=top+step;}else{new_top=top;}}
if(new_top>0||new_top<=-total){return;}
if(new_top-step<=-total){this.content.getElement('.photos_next').addClass('disabled');}else{this.content.getElement('.photos_next').removeClass('disabled');}
if(new_top+step>0){this.content.getElement('.photos_prev').addClass('disabled');}else{this.content.getElement('.photos_prev').removeClass('disabled');}
if(top==new_top){return;}
this.select_paging_active=true;var $active=self.content.getElement('.photo_list .item.is_active');var active_number=$active.getAllPrevious().length;var show_step=active_number%self.options.item_count;var index=0;if(direction==1){index=active_number+self.options.item_count-show_step;}else if(direction==-1){index=active_number-show_step-1;}
var link=self.content.getElements('.photo_list .item a')[index];if(link){link.fireEvent('click');}
var morph=new Fx.Morph($items,{duration:'long'});morph.addEvent('onComplete',function(){self.select_paging_active=false;if(callback&&$type(callback)=='function'){callback();}});morph.start({'left':new_top});},build:function()
{var pos=$(this.container).getCoordinates();var total=$(this.slideshow).getCoordinates();$(this.container).setStyle('position','absolute').setStyle('left',(total.width/2-pos.width/2)).setStyle('top',20);}});Wall.liketips_enabled=true;Wall.liketips=new Wall.Storage();Wall.loaders=[];Wall.LikeTips=new Class({Extends:Wall.TipFx,name:'Wall.LikeTips',is_loading:false,options:{class_var:'wall-liketips',html:'<div class="data"><span class="wall-loading">&nbsp;</span>'+en4.core.language.translate('WALL_LOADING')+'</div>',delay:250},initialize:function(element,options)
{this.parent(element,options);var self=this;var guid=element.get('rev');var loadContent=function(){var element=Wall.liketips.get(guid);if(element){if(element.get('html')==''){self.$container.setStyle('display','none');return;}
element.inject(Wall.externalDiv());self.$inner.empty();element.inject(self.$inner);self.build();if(self.mouseActive){self.$container.setStyle('display','block');}
return;}
if(Wall.loaders.contains(guid)){return;}
Wall.loaders[Wall.loaders.length]=guid;Wall.requestHTML(en4.core.baseUrl+'wall/tips/index/subject/'+guid,function(html){var element=new Element('div',{'class':''});element.set('html',html);Wall.liketips.add(guid,element);loadContent();});};this.addEvent('mouseover',loadContent);}});Wall.Items=new Class({Implements:[Events,Options],options:{params:{}},loader:null,$container:null,initialize:function(container,options)
{this.setOptions(options);var self=this;this.$container=container=$(container);Wall.globalBind();this.loader=new Wall.OverLoader(container.getElement('.items-container'),'loader2');container.getElement('.prev').addEvent('click',function(){if($(this).hasClass('disabled')){return;}
self.options.params.page--;self.getItems(self.options.params);});container.getElement('.next').addEvent('click',function(){if($(this).hasClass('disabled')){return;}
self.options.params.page++;self.getItems(self.options.params);});var searchSubmit=function(){self.options.params.page=1;self.options.params.search=container.getElement('.search-form input').value;self.getItems(self.options.params);};container.getElement('.search-form form').addEvent('submit',function(e){e.stop();searchSubmit();});container.getElement('.search-form a').addEvent('click',function(){searchSubmit();});},getItems:function()
{var self=this;this.loader.show();var url=en4.core.baseUrl+'wall/items';Wall.request(url,self.options.params,function(obj){self.$container.getElements('.items').set('html',obj.html);if(obj.prev){self.$container.getElement('.prev').removeClass('disabled');}else{self.$container.getElement('.prev').addClass('disabled');}
if(obj.next){self.$container.getElement('.next').removeClass('disabled');}else{self.$container.getElement('.next').addClass('disabled');}
self.loader.hide();});}});Wall.Select=new Class({Implements:[Events,Options],options:{params:{}},loader:null,$container:null,initialize:function(container,options)
{this.setOptions(options);var self=this;this.$container=container=$(container);Wall.globalBind();this.loader=new Wall.OverLoader(container.getElement('.items-container'),'loader2');container.getElement('.prev').addEvent('click',function(){if($(this).hasClass('disabled')){return;}
self.options.params.page--;self.getItems(self.options.params);});container.getElement('.next').addEvent('click',function(){if($(this).hasClass('disabled')){return;}
self.options.params.page++;self.getItems(self.options.params);});var searchSubmit=function(){self.options.params.page=1;self.options.params.search=container.getElement('.search-form input').value;self.getItems(self.options.params);};container.getElement('.search-form form').addEvent('submit',function(e){e.stop();searchSubmit();});container.getElement('.search-form a').addEvent('click',function(){searchSubmit();});},getItems:function()
{var self=this;this.loader.show();var url=en4.core.baseUrl+'wall/items';Wall.request(url,self.options.params,function(obj){self.$container.getElements('.items').set('html',obj.html);if(obj.prev){self.$container.getElement('.prev').removeClass('disabled');}else{self.$container.getElement('.prev').addClass('disabled');}
if(obj.next){self.$container.getElement('.next').removeClass('disabled');}else{self.$container.getElement('.next').addClass('disabled');}
self.loader.hide();});}});Wall.Comment=new Class({Implements:[Options,Events],options:{'element_key':''},$container:null,$form:null,initialize:function(options)
{this.setOptions(options);var self=this;self.init();},init:function()
{var $container=this.$container=$(this.options.element_key);var $form=this.$form=$container.getElement('.comment-form');var $post=$container.getElement('.post-comment');if($post){$container.getElement('.post-comment').addEvent('click',function(){$form.style.display='';$form.body.focus();});$($form.body).autogrow();this.attachCreateComment($form);}
Wall.globalBind();},loadComments:function(type,id,page){var self=this;Wall.requestHTML(en4.core.baseUrl+'wall/comment/list',function(html){self.$container.set('html',html);self.init();},null,{type:type,id:id,page:page});},attachCreateComment:function(formElement){var bind=this;formElement.getElements('button[type=submit]').addEvent('click',function(e){e.stop();var form_values=formElement.toQueryString();form_values+='&format=json';form_values+='&id='+formElement.identity.value;Wall.request(en4.core.baseUrl+'wall/comment/create',form_values,function(obj){bind.$container.set('html',obj.body);bind.init();});});this.$container.getElements('.load-comments').addEvent('click',function(){var data=JSON.decode($(this).get('rev'));bind.loadComments.apply(bind,data);});this.$container.getElements('.delete-comment').addEvent('click',function(){var data=JSON.decode($(this).get('rev'));bind.deleteComment.apply(bind,data);});this.$container.getElements('.like, .comment-like').addEvent('click',function(){var data=JSON.decode($(this).get('rev'));bind.like.apply(bind,data);});this.$container.getElements('.unlike, .comment-unlike').addEvent('click',function(){var data=JSON.decode($(this).get('rev'));bind.unlike.apply(bind,data);});},comment:function(type,id,body){var self=this;Wall.request(en4.core.baseUrl+'wall/comment/create',{type:type,id:id,body:body},function(obj){self.$container.set('html',obj.body);self.init();});},like:function(type,id,comment_id){var self=this;Wall.request(en4.core.baseUrl+'wall/comment/like',{type:type,id:id,comment_id:comment_id},function(obj){self.$container.set('html',obj.body);self.init();});},unlike:function(type,id,comment_id){var self=this;Wall.request(en4.core.baseUrl+'wall/comment/unlike',{type:type,id:id,comment_id:comment_id},function(obj){self.$container.set('html',obj.body);self.init();});},deleteComment:function(type,id,comment_id){if(!confirm(en4.core.language.translate('Are you sure you want to delete this?'))){return;}
var self=this;Wall.request(en4.core.baseUrl+'wall/comment/delete',{type:type,id:id,comment_id:comment_id},function(obj){if(self.$container.getElement('.comment-'+comment_id)){self.$container.getElement('.comment-'+comment_id).destroy();}
try{var commentCount=self.$container.getElement('.comments_options span');var m=commentCount.get('html').match(/\d+/);var newCount=(parseInt(m[0])!='NaN'&&parseInt(m[0])>1?parseInt(m[0])-1:0);commentCount.set('html',commentCount.get('html').replace(m[0],newCount));}catch(e){}});}});Wall.getActionInfo=function(item){var $item=$(item);if(!$item){return false;}
var $action=$item.getParent('.wall-action-item');if(!$action){return false;}
var action_id=$action.get('rev').substr(5);return{'action_id':action_id,'action':$action,'comment_pagination':($action.hasClass('action_comment_pagination'))?1:0,'checkin':($action.getParent('.checkins'))?1:0};};Wall.getCommentInfo=function(item)
{var $item=$(item);if(!$item){return false;}
var $comment=$item.getParent('.wall-comment-item');if(!$comment){return false;}
var comment_id=$comment.get('rev').substr(5);return{'comment_id':comment_id};};Wall.UpdateHandler=new Class({Implements:[Events,Options],options:{debug:false,baseUrl:'/',identity:false,delay:5000,admin:false,idleTimeout:600000,last_id:0,subject_guid:null,feed_uid:null},state:true,activestate:1,fresh:true,lastEventTime:false,title:document.title,updateactive:0,initialize:function(options){this.setOptions(options);},start:function(){this.state=true;this.idleWatcher=new IdleWatcher(this,{timeout:this.options.idleTimeout});this.idleWatcher.register();this.addEvents({'onStateActive':function(){this.activestate=1;this.state=true;}.bind(this),'onStateIdle':function(){this.activestate=0;this.state=false;}.bind(this)});this.loop();},stop:function(){this.state=false;},checkFeedUpdate:function(){if(this.updateactive){return;}
var feed=Wall.feeds.get(this.options.feed_uid);var is_popular_list=(feed&&feed.params&&feed.params.mode=='type'&&feed.params.type=='popular');if(!is_popular_list){if(!feed.checkActive){feed.checkActive=true;var data=$merge(feed.params,{'minid':this.options.last_id+1,'checkUpdate':true});feed.feed.getElements('.container-get-last').destroy();feed.loadFeed(data,'top',function(){feed.checkActive=false;});}}
feed.streams.getAll().each(function(i){i.checkNew();});},loop:function(){var self=this;if(!this.state){this.loop.delay(this.options.delay,this);return;}
try{this.checkFeedUpdate().addEvent('complete',function(){this.loop.delay(1250,this);}.bind(this));}catch(e){this.loop.delay(this.options.delay,this);this._log(e);}},_log:function(object){if(!this.options.debug){return;}}});function array_reverse(array,preserve_keys){var arr_len=array.length,newkey=0,tmp_arr={},key='';preserve_keys=!!preserve_keys;for(key in array){newkey=arr_len-key-1;tmp_arr[preserve_keys?key:newkey]=array[key];}
return tmp_arr;}
Wall.feeds=new Wall.Storage();Wall.Feed=new Class({Implements:[Events,Options],options:{feed_uid:'',enableComposer:true,subject_guid:''},compose:{},params:{},watcher:null,streams:{},feed_config:{},checkActive:false,initialize:function(options)
{this.setOptions(options);Wall.feeds.add(this.options.feed_uid,this);this.streams=new Wall.Storage();this.feed=$(this.options.feed_uid);this.initializeComposer();this.initializeFeed();Wall.globalBind();this.fireEvent('complete');window.wall_object=this;},initializeComposer:function()
{if($type(this.feed)!='element'){return;}
this.compose=new Wall.Composer({container:this.feed.getElement('.wall-social-composer'),feed_uid:this.options.feed_uid});},initializeFeed:function()
{var self=this;if($type(this.feed)!='element'){return;}
self.addEvent('share',function(service){var s_obj=Wall.services.get(service);if(s_obj.isEnabled()){this.setShareEnabled(service,1,s_obj.options.object_name);Wall.request(en4.core.baseUrl+'wall/index/service-share',{'provider':service,'status':1},function(){});}});self.addEvent('activity-share',function(service){var w_list=window.frames;for(var i=0;i<w_list.length;i++){if($type(w_list[i].wallShareActive)=='function'){w_list[i].wallShareActive(service);}}});if(Wall.rolldownload){window.addEvent('scroll',function(){var link=self.feed.getElement('.wall-stream-social.is_active .utility-viewall .pagination a:not(.wall_feed_loading)');if(!link){return;}
if(window.getScrollTop()+5>=window.getScrollSize().y-window.getSize().y){link.fireEvent('click');}});}
this.initShare();this.initStream();this.loadList();this.initPrivacy();this.initAction();},initShare:function()
{var self=this;var $share=this.feed.getElements('.wallShareMenu a');if(!$share){return;}
Wall.services.getAll().each(function(item){item.addEvent('change',function(){if(!item.isEnabled()){self.setShareEnabled(item.getName(),0,'');return;}
if(item.options.share_enabled){self.setShareEnabled(item.getName(),1,item.options.object_name);}});});$share.addEvent('click',function(e){e.stop();var service=$(this).get('rev');if($(this).hasClass('disabled')){var serv_obj=Wall.services.get(service);if(serv_obj.isEnabled()){self.setShareEnabled(service,1,serv_obj.options.object_name);Wall.request(en4.core.baseUrl+'wall/index/service-share',{'provider':service,'status':1},function(){});}else{Wall.services.get(service).auth({'task':'share'});}}else{var title=en4.core.language.translate('WALL_SHARE_'+service.toUpperCase());var tips=Wall.elements.get('Wall.Tips',(window.$uid||Slick.uidOf)($(this)));if(tips){tips.setTitle(title);}
$(this).getParent('.service').getElement('.share_input').set('value',0);$(this).addClass('disabled');Wall.request(en4.core.baseUrl+'wall/index/service-share',{'provider':service,'status':0},function(){});}});},setShareEnabled:function(provider,enabled,object_name)
{var self=this;var $share=this.feed.getElement('.wall-share-'+provider);if(!$share){return;}
if(enabled){$share.removeClass('disabled');}else{$share.addClass('disabled');}
this.feed.getElement('input[name="share['+provider+']"]').set('value',enabled);var title='';if(enabled){title=en4.core.language.translate('WALL_SHARE_'+provider.toUpperCase()+'_ACTIVE',object_name);if(en4.core.subject.type=='page'){if(provider=='facebook'){var service=Wall.services.get(provider);if(service){if(service.options.fb_pages&&service.options.fb_pages.length){var select_box='<form action="">'+en4.core.language.translate('WALL_CHOOSE_MY_PAGE')+'<select style="display: block;margin: 5px 0;width: 100%;"><option>'+en4.core.language.translate('WALL_FBPAGE_NO')+'</option>';service.options.fb_pages.each(function(item){select_box+='<option value="'+item.fbpage_id+'" '+((self.options.fbpage_id==item.fbpage_id)?'selected="selected"':'')+'/>'+item.title+'</option>';});select_box+='</select></form>';title+=select_box;}}}}}else{title=en4.core.language.translate('WALL_SHARE_'+provider.toUpperCase()+'');}
var tips=Wall.elements.get('Wall.Tips',(window.$uid||Slick.uidOf)($share));if(tips){tips.setTitle(title);tips.$inner.getElements('a.wall_logout').addEvent('click',function(){Wall.services.get(provider).logout();});tips.$inner.getElements('select').addEvent('change',function(){var value=$(this).get('value');Wall.request(en4.core.baseUrl+'wall/facebook/select-page',{'fbpage_id':value,'page_id':en4.core.subject.id});self.options.fbpage_id=value;});}},initStream:function()
{var self=this;var $link=this.feed.getElement('.wall-list-button');if(!$link){return;}
var $types=this.$types=Wall.injectAbsolute($link,this.feed.getElement('.wall-types'),true);$link.addEvent('click',function(){$try(function(){window.fireEvent('resize');});if($(this).hasClass('is_active')){$(this).removeClass('is_active');$types.removeClass('is_active');}else{$(this).addClass('is_active');$types.addClass('is_active');}});$$('body')[0].addEvent('click',function(e){if(!$(e.target).getParent('.wall-lists')){$link.removeClass('is_active');$types.removeClass('is_active');}});this.feed.getElements('.wall-stream-type-social').addEvent('click',function(){self.feed.getElements('.wall-stream-type').removeClass('is_active');$(this).addClass('is_active');self.feed.getElements('.wall-stream-option').removeClass('is_active');self.feed.getElement('.wall-stream-option-social').addClass('is_active');self.feed.getElements('.wall-stream').removeClass('is_active');self.feed.getElements('.wall-stream-social').addClass('is_active');$try(function(){window.fireEvent('resize');});});this.feed.getElements('.wall-stream-type-welcome').addEvent('click',function(){self.feed.getElements('.wall-stream-type').removeClass('is_active');$(this).addClass('is_active');self.feed.getElements('.wall-stream-option').removeClass('is_active');self.feed.getElement('.wall-stream-option-welcome').addClass('is_active');self.feed.getElements('.wall-stream').removeClass('is_active');self.feed.getElements('.wall-stream-welcome').addClass('is_active');$try(function(){window.fireEvent('resize');});});},initPrivacy:function()
{var self=this;var $link=this.feed.getElement('.wallComposer .wall-privacy-link');if(!$link){return;}
var $privacy=this.$privacy=Wall.injectAbsolute($link,this.feed.getElement('.wallComposer .wall-privacy'));$link.addEvent('click',function(){$try(function(){window.fireEvent('resize');});if($(this).hasClass('is_active')){$(this).removeClass('is_active');$privacy.removeClass('is_active');}else{$(this).addClass('is_active');$privacy.addClass('is_active');}});$$('body')[0].addEvent('click',function(e){if(!$(e.target).getParent('.wall-privacy-container')){$link.removeClass('is_active');$privacy.removeClass('is_active');}});$privacy.getElements('a').addEvent('click',function(){var value=$(this).get('rev');self.feed.getElement('.wallComposer .wall_privacy_input').set('value',value);Wall.elements.get('Wall.Tips',(window.$uid||Slick.uidOf)($link)).setTitle($(this).getElement('.wall_text').get('text'));$privacy.getElements('a').removeClass('is_active');$(this).addClass('is_active');});},initActionPrivacy:function(action)
{var self=this;var $link=action.getElement('.wall-privacy-action-link');if(!$link){return;}
var $privacy=Wall.injectAbsolute($link,action.getElement('.wall-privacy'),true);$link.addEvent('click',function(){window.fireEvent('resize');if($(this).hasClass('is_active')){$(this).removeClass('is_active');$privacy.removeClass('is_active');}else{$(this).addClass('is_active');$privacy.addClass('is_active');}});$$('body')[0].addEvent('click',function(e){if(!$(e.target).getParent('.wall-privacy-container')){$link.removeClass('is_active');$privacy.removeClass('is_active');}});$privacy.getElements('a').addEvent('click',function(){var value=$(this).get('rev');action.getElement('.wall_privacy_input').set('value',value);$privacy.getElements('a').removeClass('is_active');$(this).addClass('is_active');if(value=='everyone'){$link.addClass('wall_is_public');}else{$link.removeClass('wall_is_public');}
var element_info=Wall.getActionInfo($link);Wall.request(en4.core.baseUrl+'wall/index/change-privacy',{'action_id':element_info.action_id,'privacy':value});var privacy_type=action.getElement('.wall_privacy_input_type').get('value');var title=en4.core.language.translate('WALL_PRIVACY_'+privacy_type.toUpperCase()+'_'+value.toUpperCase());if((value!='everyone'&&value!='registered')&&action.getElement('.wall_privacy_tag_active').get('value')){title+=en4.core.language.translate('WALL_'+privacy_type.toUpperCase()+'_'+value.toUpperCase()+'_TAGGED');}
Wall.elements.get('Wall.Tips',(window.$uid||Slick.uidOf)($link)).setTitle(title);});},initActionMenu:function(action)
{var self=this;var $link=action.getElement('.wall-menu-expand-link');if(!$link){return;}
var $menu=Wall.injectAbsolute($link,action.getElement('.wall-menu'),true);$link.addEvent('click',function(){window.fireEvent('resize');if($(this).hasClass('is_active')){$(this).removeClass('is_active');$menu.removeClass('is_active');}else{$(this).addClass('is_active');$menu.addClass('is_active');}});$$('body')[0].addEvent('click',function(e){if(!$(e.target).getParent('.wall-menu-container')){$link.removeClass('is_active');$menu.removeClass('is_active');}});$menu.getElements('a.wall_link_mute_action').addEvent('click',function(){var element=Wall.getActionInfo($link);Wall.request(en4.core.baseUrl+'wall/index/mute',{action_id:element.action_id},function(){});var new_html='';new_html+=en4.core.language.translate('WALL_No longer seeing this post.');new_html+=' ';new_html+='<a href="javascript:void(0);">'+en4.core.language.translate('WALL_Undo mute')+'</a>';element.action.set('html','<div class="wall_hide_action">'+new_html+'</div>');Wall.itemEffect(element.action);element.action.getElements('a').addEvent('click',function(){Wall.request(en4.core.baseUrl+'wall/index/unmute',{action_id:element.action_id},function(obj){if(obj.status){element.action.set('html',obj.body);self.initAction(element.action);Wall.itemEffect(element.action);}});});});$menu.getElements('a.wall_link_remove_tag').addEvent('click',function(){var element=Wall.getActionInfo($link);Wall.dialog.confirm('remove_tag',function(){Wall.request(en4.core.baseUrl+'wall/index/remove-tag',{action_id:element.action_id},function(obj){if(obj.status){element.action.set('html',obj.body);self.initAction(element.action);}});});});},initAction:function($container,params)
{var self=this;if(!$container){$container=this.getFeed();}
if(!params){params={};}
$container.getElements('.action-remove').addEvent('click',function(){var element=Wall.getActionInfo(this);var data={'action_id':element.action_id};var func=function(){var previous=element.action.getPrevious();element.action.addClass('wall_displaynone').inject(Wall.externalDiv());self.checkEmptyFeed();Wall.request(en4.core.baseUrl+'wall/index/delete',data,function(obj){if(obj.result){element.action.destroy();}else{element.action.removeClass('wall_displaynone');if(previous){element.action.inject(previous,'after');}else{element.action.inject(self.getFeed(),'top');}}
self.checkEmptyFeed();Wall.dialog.message(obj.message,obj.result);});};Wall.dialog.confirm('action_remove',func);});$container.getElements('.action-comment').addEvent('click',function(){var element=Wall.getActionInfo(this);var $form=element.action.getElement('.wall-comment-form');$form.setStyle('display','block');$form.body.focus();});$container.getElements('.action-like').addEvent('click',function(){var element=Wall.getActionInfo(this);var data={'action_id':element.action_id,'checkin':element.checkin};Wall.request(en4.core.baseUrl+'wall/index/like/subject/'+self.options.subject_guid,data,function(obj){if(obj.status){element.action.set('html',obj.body);self.initAction(element.action);}});});$container.getElements('.action-unlike').addEvent('click',function(){var element=Wall.getActionInfo(this);var data={'action_id':element.action_id,'checkin':element.checkin};Wall.request(en4.core.baseUrl+'wall/index/unlike/subject/'+self.options.subject_guid,data,function(obj){if(obj.status){element.action.set('html',obj.body);self.initAction(element.action);}});});$container.getElements('.wall-comment-form textarea').each(function(item){$(item).autogrow();});$container.getElements('.wall-comment-form').removeEvent('submit').addEvent('submit',function(e){e.stop();if($(this).hasClass('wall_loading')){return;}
$(this).addClass('wall_loading');var element=Wall.getActionInfo(this);var action_element=Wall.getActionInfo(this);var values=$(this).toQueryString();values+='&comment_pagination='+action_element.comment_pagination+'&checkin='+element.checkin;Wall.request(en4.core.baseUrl+'wall/index/comment/subject/'+self.options.subject_guid,values,function(obj){if(obj.status){element.action.set('html',obj.body);self.initAction(element.action);}});});$container.getElements('.comment-like').addEvent('click',function(){var element=Wall.getCommentInfo(this);var action_element=Wall.getActionInfo(this);var data={'action_id':action_element.action_id,'comment_id':element.comment_id,'comment_pagination':action_element.comment_pagination,'checkin':action_element.checkin};Wall.request(en4.core.baseUrl+'wall/index/like/subject/'+self.options.subject_guid,data,function(obj){if(obj.status){action_element.action.set('html',obj.body);self.initAction(action_element.action);}});});$container.getElements('.comment-unlike').addEvent('click',function(){var element=Wall.getCommentInfo(this);var action_element=Wall.getActionInfo(this);var data={'action_id':action_element.action_id,'comment_id':element.comment_id,'comment_pagination':action_element.comment_pagination,'checkin':action_element.checkin};Wall.request(en4.core.baseUrl+'wall/index/unlike/subject/'+self.options.subject_guid,data,function(obj){if(obj.status){action_element.action.set('html',obj.body);self.initAction(action_element.action);}});});$container.getElements('.comment-remove').addEvent('click',function(){var element=Wall.getCommentInfo(this);var action_element=Wall.getActionInfo(this);var data={'action_id':action_element.action_id,'comment_id':element.comment_id,'comment_pagination':action_element.comment_pagination,'checkin':action_element.checkin};Wall.dialog.confirm('comment_remove',function(){Wall.request(en4.core.baseUrl+'wall/index/delete',data,function(obj){if(obj.result){action_element.action.set('html',obj.body);self.initAction(action_element.action);}});});});$container.getElements('.comment_next').addEvent('click',function(){var $item=$(this);var element=Wall.getActionInfo(this);var page=$(this).get('rev').substr(5).toInt();var data={'action_id':element.action_id,'comment_pagination':true,'comment_page':page};Wall.request(en4.core.baseUrl+'posts/'+element.action_id,data,function(obj){if(obj.result){var html=obj.html.stripScripts(true);var $comments=$item.getParent('ul');var $container=new Element('div',{'html':html});self.initAction($container);var $items=$container.getChildren();var counter=0;var max=$items.length-1;var new_items=[];$items.each(function(item){new_items[max-counter]=item;counter++;});$comments.getElements('.pagination, .container-comment_likes').destroy();new_items.each(function(item){item.inject($comments,'top');});}});});$container.getElements('.utility-viewall .pagination a').addEvent('click',function(){$(this).addClass('wall_feed_loading');var data={};if($(this).get('rev').indexOf('page')!=-1){data=$merge(self.params,{'page':$(this).get('rev').substr(5).toInt()});}else{data=$merge(self.params,{'maxid':$(this).get('rev').substr(5).toInt()});}
var $loader=$(this).getParent('.utility-viewall').getElement('.loader');var loader=new Wall.Loader($loader);self.getFeed().getElements('.utility-viewall .pagination').setStyle('display','none');loader.show();self.loadFeed(data,'bottom',function(){loader.hide();},{'viewall':true,preInject:function(){self.getFeed().getElements('.utility-viewall').destroy();}});});if(!params.viewall){$container.getElements('.utility-setlast').each(function(item){self.setLastId(item.get('rev').substr(5).toInt());});}
$container.getElements('.utility-setlast').destroy();$container.getElements('.utility-getlast .link').addEvent('click',function(){var data=$merge(self.params,{'minid':self.watcher.options.last_id+1,'getUpdate':true});$$(this).getParent('.utility-getlast').destroy();self.loadFeed(data,'top',function(){Wall.activityCount(false);},null,null,true);});$container.getElements('.wall_grouped_other').each(function(item){new Wall.Tips(item,{title:item.getParent('li').getElement('.wall_grouped_other_html').get('html')});});var CommentLikesTooltips;$container.getElements('.comments_comment_likes').addEvent('mouseover',function(event){var el=$(event.target);if(!el.retrieve('tip-loaded',false)){el.store('tip-loaded',true);el.store('tip:title',en4.core.language.translate('WALL_LOADING'));el.store('tip:text','');var element=Wall.getCommentInfo(this);var action_element=Wall.getActionInfo(this);Wall.request(en4.core.baseUrl+'activity/index/get-likes',{action_id:action_element.action_id,comment_id:element.comment_id},function(responseJSON){el.store('tip:title',responseJSON.body);el.store('tip:text','');CommentLikesTooltips.elementEnter(event,el);});}});CommentLikesTooltips=new Tips($$('.comments_comment_likes'),{fixed:true,className:'comments_comment_likes_tips',offset:{'x':48,'y':16}});$container.getElements('.wall-privacy-container').each(function(item){try{self.initActionPrivacy(item);}catch(e){}});$container.getElements('.wall-menu-container').each(function(item){try{self.initActionMenu(item);}catch(e){}});self.feed_config={updateHandlerDisable:0};$container.getElements('.utility-feed-config').each(function(item){var temp=Wall.decodeData(item.get('onclick'));if(temp){self.feed_config=$merge(self.feed_config,temp);}});$container.getElements('.utility-feed-config').destroy();$container.get('html').stripScripts(true);Wall.globalBind();},setLastId:function(last_id)
{if(!last_id){return;}
this.options.last_id=last_id;if(this.watcher){this.watcher.options.last_id=last_id;}},getFeed:function()
{return this.feed.getElement('.wall-feed');},checkEmptyFeed:function()
{if(!this.getFeed().getElements('.wall-action-item').length){if(!this.getFeed().getElement('.wall-empty-feed')){var element=new Element('li',{'class':'wall-empty-feed',html:'<div class="tip"><span>'+en4.core.language.translate('WALL_EMPTY_FEED')+'</span></div>'});element.inject(this.getFeed(),'bottom');}}else{this.getFeed().getElements('.wall-empty-feed').destroy();}},loadList:function(html)
{var self=this;if(!this.$types){return;}
if(html){this.$types.set('html',html);}
this.$types.getElements('li').addEvent('mouseover',function(){var $options=$(this).getElement('.options');if($options){$options.addClass('is_active');}});this.$types.getElements('li').addEvent('mouseout',function(){var $options=$(this).getElement('.options');if($options){$options.removeClass('is_active');}});this.$types.getElements('.edit').addEvent('click',function(e){e.stop();var list_id=$(this).get('rev').substr(5);var url=en4.core.baseUrl+'wall/list/index'+'?list_id='+list_id;Smoothbox.open(new Element('a',{'href':url}));});this.$types.getElements('.remove').addEvent('click',function(e){e.stop();var $element=$(this);var list_id=$element.get('rev').substr(5);var url=en4.core.baseUrl+'wall/list/remove'+'?list_id='+list_id;Wall.dialog.confirm('list_remove',function(){Wall.request(url,{},function(obj){Wall.dialog.message(obj.message,obj.result);if(obj.result){self.loadList(obj.html);if(list_id==self.params.list_id){self.$types.getElements('.item[rev=recent]').fireEvent('click');}}});});});var $loader=self.feed.getElement('.wall-list-button');this.$types.getElements('.item').addEvent('click',function(){var rev=$(this).get('rev');if(rev.substr(0,4)=='type'){self.$types.getElements('a').removeClass('is_active');$(this).addClass('is_active');var type=rev.substr(5);self.params={};self.params.mode='type';self.params.type=type;self.params.list_id=0;$loader.getElement('.wall_icon').set('class','wall_icon').addClass('wall-type-'+type);$loader.getElement('.wall_text').set('html',$(this).getElement('.wall_text').get('html'));$loader.addClass('wall_loading');self.loadFeed(self.params,null,function(){$loader.removeClass('wall_loading');});}else if(rev.substr(0,4)=='list'){self.$types.getElements('a').removeClass('is_active');$(this).addClass('is_active');var list_id=rev.substr(5);self.params={};self.params.mode='list';self.params.type='';self.params.list_id=list_id;$loader.getElement('.wall_icon').set('class','wall_icon').addClass('wall-type-list');$loader.getElement('.wall_text').set('html',$(this).getElement('.wall_text').get('html'));$loader.addClass('wall_loading');self.loadFeed(self.params,null,function(){$loader.removeClass('wall_loading');});}else if(rev.substr(0,10)=='friendlist'){self.$types.getElements('a').removeClass('is_active');$(this).addClass('is_active');var list_id=rev.substr(11);self.params={};self.params.mode='friendlist';self.params.type='';self.params.list_id=list_id;$loader.getElement('.wall_icon').set('class','wall_icon').addClass('wall-type-list');$loader.getElement('.wall_text').set('html',$(this).getElement('.wall_text').get('html'));$loader.addClass('wall_loading');self.loadFeed(self.params,null,function(){$loader.removeClass('wall_loading');});}else if(rev=='create-new'){Smoothbox.open(new Element('a',{'href':en4.core.baseUrl+'wall/list/index'}));}else if(rev=='recent'){self.$types.getElements('a').removeClass('is_active');$(this).addClass('is_active');self.params={};self.params.mode='recent';self.params.type='';self.params.list_id=0;$loader.getElement('.wall_icon').set('class','wall_icon').addClass('wall-most-recent');$loader.getElement('.wall_text').set('html',$(this).getElement('.wall_text').get('html'));$loader.addClass('wall_loading');self.loadFeed(self.params,null,function(){$loader.removeClass('wall_loading');});}});},loadFeed:function(options,where,oncomplete,params,element,effect_item)
{var self=this;var data=$merge(options,{'subject':self.options.subject_guid,'feedOnly':true,'format':'html'});if(!params){params={};}
Wall.activityCount(false);var request_fn=function(html){var $feed=self.getFeed();if(where){var $container=new Element('div',{'html':html});if(Wall.autoupdate){try{if(!params.viewall){$container.getElements('.utility-setlast').each(function(item){self.setLastId(item.get('rev').substr(5).toInt());});}
$container.getElements('.utility-setlast').destroy();if($container.getElements('.utility-getlast').length){$container.getElements('.utility-getlast').destroy();var data=$merge(self.params,{'minid':self.watcher.options.last_id+1,'getUpdate':true});self.loadFeed(data,'top',function(){Wall.activityCount(false);},null,null,true);}}catch(e){}}
var $items=$container.getChildren();if($type(params.preInject)=='function'){params.preInject();}
$feed.getElements('.utility-setlast, .utility-getlast').destroy();if(where=='top'){$items.reverse();}
self.initAction($container,params);$items.each(function(item){item=$(item);item.inject($feed,where);if(effect_item){Wall.itemEffect(item);}});}else{$feed.set('html',html);self.initAction($feed,params);}
if($type(oncomplete)=='function'){oncomplete();}
self.checkEmptyFeed();};Wall.requestHTML(self.options.url_wall,request_fn,null,data);}});Wall.itemEffect=function(item)
{item.tween('opacity',[0,1]);};Wall._servicesRequest=null;Wall.ServicesRequest=new Class({Implements:[Events,Options],options:{},initialize:function(options)
{this.setOptions(options);},send:function()
{Wall.request(en4.core.baseUrl+'wall/index/services-request',this.options,function(data){this.fireEvent('complete',[data])}.bind(this));}});Wall.services=new Wall.Storage();Wall.Service={};Wall.Service.Abstract=new Class({Implements:[Events,Options],options:{enabled:false,object_id:'',object_name:'',share_enabled:false},initialize:function(options)
{var self=this;this.setOptions(options);if(Wall._servicesRequest){Wall._servicesRequest.addEvent('complete',function(obj){if(obj[self.getName()]){self.setServiceOptions(obj[self.getName()]);}});}},auth:function(data)
{data=new Hash(data);var query='/';data.each(function(item,key){query+=''+key+'/'+item+'/';});window.open(en4.core.baseUrl+'wall/'+this.getName()+'/index'+query,'','HEIGHT=600,WIDTH=850');},logout:function()
{this.setServiceOptions({'enabled':false});Wall.request(en4.core.baseUrl+'wall/'+this.getName()+'/logout',{});},setServiceOptions:function(options)
{this.setOptions(options);this.fireEvent('change');},isEnabled:function()
{return this.options.enabled;},getName:function()
{return this.name;}});Wall.Service.Facebook=new Class({Extends:Wall.Service.Abstract,name:'facebook'});Wall.Service.Twitter=new Class({Extends:Wall.Service.Abstract,name:'twitter'});Wall.Service.Linkedin=new Class({Extends:Wall.Service.Abstract,name:'linkedin'});Wall.Stream={};Wall.Stream.Abstract=new Class({Implements:[Events,Options],options:{url:{},feed_uid:null},$container:null,$refresh:null,is_composer_opened:false,name:'abstract',feed:null,is_loading:false,load_stream:false,checkActive:false,getName:function()
{return this.name;},initAction:function(feed)
{var self=this;feed.getElements('.utility-setsince').each(function(item){self.options.since=item.get('rev');item.destroy();});},getFeed:function()
{return this.$container.getElement('.service-feed');},initialize:function(options)
{var self=this;this.setOptions(options);this.feed=Wall.feeds.get(this.options.feed_uid);this.$container=this.feed.feed.getElement('.wall-stream-'+this.getName()+'');this.$refresh=this.feed.feed.getElement('.wall-stream-option-'+this.getName()+' a');this.$tab=this.feed.feed.getElement('.wall-stream-type-'+this.getName());if(this.$tab){this.$tab.addEvent('click',function(){self.onTabClick();});}
this.initComposer();Wall.globalBind();this.init();},init:function()
{var self=this;var service=Wall.services.get(self.getName());service.addEvent('change',function(){if(service.isEnabled()){self.changeTab('stream');if(self.feed.feed.getElement('.wall-stream-'+self.getName()).isVisible()){self.feed.feed.getElement('.wall-stream-option-'+self.getName()).addClass('is_active');}
self.load_stream=true;self.loadStream();}else{self.changeTab('login');if(self.feed.feed.getElement('.wall-stream-'+self.getName()).isVisible()){self.feed.feed.getElement('.wall-stream-option-'+self.getName()).removeClass('is_active');}}});self.$refresh.addEvent('click',function(){self.loadStream();});this.$container.getElements('.stream_login_link').addEvent('click',function(){Wall.services.get(self.getName()).auth({'task':'stream'});});self.feed.feed.getElements('.wall-stream-type-'+self.getName()).addEvent('click',function(){self.feed.feed.getElements('.wall-stream-type').removeClass('is_active');$(this).addClass('is_active');self.feed.feed.getElements('.wall-stream-option').removeClass('is_active');self.feed.feed.getElements('.wall-stream').removeClass('is_active');self.feed.feed.getElements('.wall-stream-'+self.getName()).addClass('is_active');if(Wall.services.get(self.getName()).isEnabled()){self.changeTab('stream');self.feed.feed.getElement('.wall-stream-option-'+self.getName()).addClass('is_active');if(!self.load_stream){self.load_stream=true;self.loadStream();}}else{self.changeTab('login');self.feed.feed.getElement('.wall-stream-option-'+self.getName()).removeClass('is_active');}
$try(function(){window.fireEvent('resize');});});if(Wall.rolldownload){window.addEvent('scroll',function(){var link=self.feed.feed.getElement('.wall-stream-'+self.getName()+'.is_active .utility-viewall .pagination a:not(.wall_feed_loading)');if(!link){return;}
if(window.getScrollTop()+5>=window.getScrollSize().y-window.getSize().y){link.fireEvent('click');}});}},loadStream:function()
{var self=this;if(this.is_loading){return;}
this.is_loading=true;this.changeTab('loader');Wall.request(en4.core.baseUrl+'wall/'+this.getName()+'/stream',{},function(obj){self.is_loading=false;self.changeTab('stream');if(!obj||!obj.enabled){return;}
obj.html.stripScripts(true);self.getFeed().set('html',obj.html);self.initAction(self.getFeed());});},onTabClick:function()
{this.$tab.removeClass('wall_new_updates');this.$tab.getElement('.wall_new_update_count').set('html',0);},checkNew:function()
{if(!Wall.services.get(this.getName()).isEnabled()){return;}
if(!this.options.since){return;}
if(this.checkActive){return;}
this.checkActive=true;var self=this;Wall.request(en4.core.baseUrl+'wall/'+this.getName()+'/checknew',{'since':this.options.since},function(obj){self.checkActive=false;self.getFeed().getElements('.wall_check_new').destroy();if(obj.ok){if(obj.count&&!self.$tab.hasClass('is_active')){self.$tab.addClass('wall_new_updates');self.$tab.getElement('.wall_new_update_count').set('html',obj.count);}
if(Wall.autoupdate){self.getFeed().getElements('.wall_check_new').destroy();self.loadLastStream();}else{var el=new Element('li',{'class':'wall_check_new','html':'<div class="tip"><span><a href="javascript:void(0);" class="wall_check_new_link">'+obj.title+'</a></span></div>'});el.inject(self.getFeed(),'top');el.getElements('.wall_check_new_link').addEvent('click',function(){self.getFeed().getElements('.wall_check_new').destroy();self.loadLastStream();});}}});},loadLastStream:function(callback)
{var self=this;Wall.request(en4.core.baseUrl+'wall/'+self.getName()+'/stream',{'since':self.options.since},function(obj){self.changeTab('stream');if(!obj||!obj.enabled){return;}
obj.html.stripScripts(true);var el=new Element('ul',{html:obj.html});self.initAction(el);el.getChildren().each(function(item){item.inject(self.getFeed(),'top');Wall.itemEffect(item);});if($type(callback)=='function'){callback();}});},changeTab:function(tab)
{if(tab=='stream'&&this.is_loading){this.changeTab('loader');return;}
this.$container.getElements('.wall-stream-tab').removeClass('is_active');this.$container.getElements('.wall-stream-tab-'+tab).addClass('is_active');this.$container.getElements('.wall-stream-option').removeClass('is_active');if(tab!='login'){this.$container.getElements('.wall-stream-option-'+this.getName()).removeClass('is_active');}},initComposer:function()
{var self=this;var container=this.$container.getElement('.wallComposer');container.getElement('textarea').autogrow();if(this.getName()=='twitter'){var counter=container.getElement('.wall_counter');var textarea=container.getElement('textarea');var keyup=function(e){if(140-textarea.get('value').length>=0){counter.set('html',140-textarea.get('value').length);}
if($(this).get('value').length>140&&(e.code>47||e.code==32)){e.stop();}};textarea.addEvent('keydown',keyup);}
container.getElement('.labelBox').addEvent('click',function(){this.open();}.bind(this));container.getElement('.textareaBox .close').addEvent('click',function(){this.close();}.bind(this));container.getElement('.inputBox').addEvent('click',function(){$(this).getElement('textarea').focus();});container.getElement('form').addEvent('submit',function(e){e.stop();if(!$(this).body.get('value')){return;}
var button=container.getElement('.submitMenu button');button.set('html','&nbsp;&nbsp;&nbsp;'+en4.core.language.translate('WALL_SENDING')+'&nbsp;&nbsp;&nbsp;').addClass('wall_active');Wall.request(en4.core.baseUrl+'wall/'+self.getName()+'/post',$(this).toQueryString(),function(){self.loadLastStream(function(){button.set('html','&nbsp;&nbsp;&nbsp;'+en4.core.language.translate('WALL_Share')+'&nbsp;&nbsp;&nbsp;').removeClass('wall_active');self.deactivate();self.close();});});});},open:function()
{this.deactivate();if(this.is_composer_opened){return;}
this.is_composer_opened=true;this.$container.getElements('.toolsBox a').addClass('is_active');this.$container.getElement('.labelBox').removeClass('is_active');var textarea_box=this.$container.getElement('.textareaBox');var fx=new Fx.Morph(textarea_box,{'duration':50});fx.addEvent('onStart',function(){textarea_box.setStyles({'height':30,'overflow':'hidden'});textarea_box.addClass('is_active');}.bind(this));fx.addEvent('onComplete',function(){textarea_box.setStyles({'height':'auto','overflow':'visible'});this.$container.getElement('.submitMenu').addClass('is_active');}.bind(this));fx.start({'height':[30,64]});},close:function()
{this.deactivate();if(!this.is_composer_opened){return;}
this.is_composer_opened=false;var textarea_box=this.$container.getElement('.textareaBox');textarea_box.getElement('textarea').set('value','');var fx=new Fx.Morph(textarea_box,{'duration':50});fx.addEvent('onStart',function(){this.$container.getElements('.toolsBox a').removeClass('is_active');this.$container.getElement('.submitMenu').removeClass('is_active');textarea_box.setStyles({'height':64,'overflow':'hidden'});}.bind(this));fx.addEvent('onComplete',function(){textarea_box.setStyles({'height':30,'overflow':'visible'});textarea_box.removeClass('is_active');var label=this.$container.getElement('.labelBox');var labelFx=new Fx.Morph(label,{'duration':1000});labelFx.addEvent('onStart',function(){label.addClass('is_active').setStyle('opacity',0);}).addEvent('onComplete',function(){}.bind(this)).start({'opacity':[0,1]});}.bind(this));fx.start({'height':[64,30]});},deactivate:function()
{this.$container.getElement('.textareaBox textarea').set('value','');}});Wall.Stream.Facebook=new Class({Extends:Wall.Stream.Abstract,name:'facebook',initAction:function($container)
{this.parent($container);var self=this;var $feed=this.getFeed();if(!$container){$container=$feed;}
$container.getElements('.wall_facebook_likes_like').addEvent('click',function(e){e.stop();var id=$(this).get('rev');var li=$(this).getParent('.wall_facebook_item');li.getElements('.wall_facebook_likes_like').removeClass('wall_active');li.getElements('.wall_facebook_likes_unlike').addClass('wall_active');Wall.request(en4.core.baseUrl+'wall/facebook/like',{'id':id},function(obj){if(obj.result){li.set('html',obj.body);self.initAction(li);}});});$container.getElements('.wall_facebook_likes_unlike').addEvent('click',function(e){e.stop();var id=$(this).get('rev');var li=$(this).getParent('.wall_facebook_item');li.getElements('.wall_facebook_likes_like').addClass('wall_active');li.getElements('.wall_facebook_likes_unlike').removeClass('wall_active');Wall.request(en4.core.baseUrl+'wall/facebook/unlike',{'id':id},function(obj){if(obj.result){li.set('html',obj.body);self.initAction(li);}});});$container.getElements('a.wall_facebook_comment').addEvent('click',function(e){e.stop();var $form=$(this).getParent('.wall_facebook_item').getElement('.wall-facebook-comment');if($form.hasClass('wall_active')){return;}
$form.addClass('wall_active');try{$form.getElement('textarea').autogrow();}catch(e){}
$form.getElement('textarea').focus();});$container.getElements('.wall-facebook-comment form').removeEvent('submit').addEvent('submit',function(e){var $form=$(this);var li=$(this).getParent('.wall_facebook_item');e.stop();Wall.request(en4.core.baseUrl+'wall/facebook/comment',$form.toQueryString(),function(obj){if(obj.result){li.set('html',obj.body);self.initAction(li);}});});$container.getElements('.utility-viewall .pagination a').addEvent('click',function(){$(this).addClass('wall_feed_loading');var loader=$(this).getParent('.utility-viewall').getElement('.loader');$feed.getElements('.utility-viewall .pagination').setStyle('display','none');var next=$(this).get('rev').substr(5);loader.show();Wall.request(en4.core.baseUrl+"wall/facebook/stream",{'next':next,'viewall':true},function(obj){if(!obj.enabled){Wall.services.get(self.getName()).setServiceOptions({'enabled':false});return;}
obj.html.stripScripts(true);var div=new Element('div',{'html':obj.html});self.initAction(div);var children=div.getChildren();$feed.getElements('.utility-viewall').destroy();if(children.length){children.each(function(item){item.inject($feed,'bottom');});}});});}});Wall.Stream.Twitter=new Class({Extends:Wall.Stream.Abstract,name:'twitter',options:{},initAction:function($container)
{this.parent($container);var self=this;var $feed=this.getFeed();if(!$container){$container=$feed;}
var intentRegex=/twitter\.com(\:\d{2,4})?\/intent\/(\w+)/,windowOptions='scrollbars=yes,resizable=yes,toolbar=no,location=yes',width=550,height=420,winHeight=screen.height,winWidth=screen.width;var handle=function(e){e=e||window.event;if(!e){return;}
var target=e.target||e.srcElement,m,left,top;while(target&&target.nodeName.toLowerCase()!=='a'){target=target.parentNode;}
if(target&&target.nodeName.toLowerCase()==='a'&&target.href){m=target.href.match(intentRegex);if(m){left=Math.round((winWidth/2)-(width/2));top=0;if(winHeight>height){top=Math.round((winHeight/2)-(height/2));}
window.open(target.href,'intent',windowOptions+',width='+width+',height='+height+',left='+left+',top='+top);e.returnValue=false;e.preventDefault&&e.preventDefault();}}};$container.getElements('a').addEvent('click',handle);$container.getElements('.utility-viewall .pagination a').addEvent('click',function(){$(this).addClass('wall_feed_loading');var loader=$(this).getParent('.utility-viewall').getElement('.loader');$feed.getElements('.utility-viewall .pagination').setStyle('display','none');var next=$(this).get('rev').substr(5);loader.show();Wall.request(en4.core.baseUrl+"wall/twitter/stream",{'next':next,'viewall':true},function(obj){if(!obj.enabled){Wall.services.get(self.getName()).setServiceOptions({'enabled':false});return;}
obj.html.stripScripts(true);var div=new Element('div',{'html':obj.html});self.initAction(div);var children=div.getChildren();$feed.getElements('.utility-viewall').destroy();if(children.length){children.each(function(item){item.inject($feed,'bottom');});}});});$container.getElements('a.wall_tweet').addEvent('click',function(){var $form=$(this).getParent('.wall_twitter_item').getElement('.wall-twitter-reply');if($form.hasClass('active')){return;}
$form.addClass('active');var textarea=$form.getElement('textarea');textarea.set('value',$form.getElement('.wall_start_message').get('value')).focus();if(textarea.createTextRange){var FieldRange=textarea.createTextRange();FieldRange.moveStart('character',textarea.value.length);FieldRange.collapse();FieldRange.select();}else{textarea.focus();var length=textarea.value.length;textarea.setSelectionRange(length,length);}
var counter=$form.getElement('.wall_counter');counter.set('html',140-textarea.get('value').length);var keyup=function(e){if(140-textarea.get('value').length>=0){counter.set('html',140-textarea.get('value').length);}
if($(this).get('value').length>140&&(e.code>47||e.code==32)){e.stop();}};textarea.removeEvent('keydown').addEvent('keydown',keyup);});$container.getElements('.wall-twitter-reply form').removeEvent('submit').addEvent('submit',function(e){var $form=$(this);var $c=$form.getParent('.wall-twitter-reply');e.stop();$c.addClass('wall_loading');Wall.request(en4.core.baseUrl+'wall/twitter/reply',$form.toQueryString(),function(){$c.removeClass('wall_loading');$c.removeClass('active');});});$container.getElements('a.wall_retweet').addEvent('click',function(e){$(this).getParent('.wall_twitter_item').addClass('wall_retweeted');Wall.request(en4.core.baseUrl+'wall/twitter/retweet',{id:$(this).getParent('.wall_twitter_item').getElement('.wall_twitter_id').get('text')},function(){});});$container.getElements('a.wall_favorite').addEvent('click',function(e){$(this).getParent('.wall_twitter_item').addClass('wall_favorited');Wall.request(en4.core.baseUrl+'wall/twitter/favorite',{id:$(this).getParent('.wall_twitter_item').getElement('.wall_twitter_id').get('text')},function(){});});$container.getElements('a.wall_unfavorite').addEvent('click',function(e){$(this).getParent('.wall_twitter_item').removeClass('wall_favorited');Wall.request(en4.core.baseUrl+'wall/twitter/unfavorite',{id:$(this).getParent('.wall_twitter_item').getElement('.wall_twitter_id').get('text')},function(){});});$container.getElements('a.wall_delete').addEvent('click',function(e){$(this).getParent('.wall_twitter_item').removeClass('wall_favorited');Wall.dialog.confirm('twitter_delete',function(){$(this).getParent('.wall_twitter_item').destroy();Wall.request(en4.core.baseUrl+'wall/twitter/destroy',{id:$(this).getParent('.wall_twitter_item').getElement('.wall_twitter_id').get('text')},function(){});}.bind(this));});}});Wall.Stream.Linkedin=new Class({Extends:Wall.Stream.Abstract,name:'linkedin',initAction:function($container)
{this.parent($container);var self=this;var $feed=this.getFeed();if(!$container){$container=$feed;}
$container.getElements('.wall_linkedin_likes_like').addEvent('click',function(e){e.stop();var id=$(this).get('rev');var li=$(this).getParent('.wall_linkedin_item');li.getElements('.wall_linkedin_likes_like').removeClass('wall_active');li.getElements('.wall_linkedin_likes_unlike').addClass('wall_active');Wall.request(en4.core.baseUrl+'wall/linkedin/like',{'id':id},function(obj){if(obj.result){li.set('html',obj.body);self.initAction(li);}});});$container.getElements('.wall_linkedin_likes_unlike').addEvent('click',function(e){e.stop();var id=$(this).get('rev');var li=$(this).getParent('.wall_linkedin_item');li.getElements('.wall_linkedin_likes_like').addClass('wall_active');li.getElements('.wall_linkedin_likes_unlike').removeClass('wall_active');Wall.request(en4.core.baseUrl+'wall/linkedin/unlike',{'id':id},function(obj){if(obj.result){li.set('html',obj.body);self.initAction(li);}});});$container.getElements('a.wall_linkedin_comment').addEvent('click',function(e){e.stop();var $form=$(this).getParent('.wall_linkedin_item').getElement('.wall-linkedin-comment');if($form.hasClass('wall_active')){return;}
$form.addClass('wall_active');try{$form.getElement('textarea').autogrow();}catch(e){}
$form.getElement('textarea').focus();});$container.getElements('.wall-linkedin-comment form').removeEvent('submit').addEvent('submit',function(e){var $form=$(this);var li=$(this).getParent('.wall_linkedin_item');e.stop();Wall.request(en4.core.baseUrl+'wall/linkedin/comment',$form.toQueryString(),function(obj){if(obj.result){li.set('html',obj.body);self.initAction(li);}});});$container.getElements('.utility-viewall .pagination a').addEvent('click',function(){$(this).addClass('wall_feed_loading');var loader=$(this).getParent('.utility-viewall').getElement('.loader');$feed.getElements('.utility-viewall .pagination').setStyle('display','none');var next=$(this).get('rev').substr(5);loader.show();Wall.request(en4.core.baseUrl+"wall/linkedin/stream",{'next':next,'viewall':true},function(obj){if(!obj.enabled){Wall.services.get(self.getName()).setServiceOptions({'enabled':false});return;}
obj.html.stripScripts(true);var div=new Element('div',{'html':obj.html});self.initAction(div);var children=div.getChildren();$feed.getElements('.utility-viewall').destroy();if(children.length){children.each(function(item){item.inject($feed,'bottom');});}});});}});$extend(Element.NativeEvents,{'paste':2,'input':2});Element.Events.paste={base:(Browser.Engine.presto||(Browser.Engine.gecko&&Browser.Engine.version<19))?'input':'paste',condition:function(e){this.fireEvent('paste',e,1);return false;}};Wall.Composer=new Class({Implements:[Events,Options],options:{container:'',feed_uid:''},container:null,textarea:null,elements:{},composer:{},is_opened:false,initialize:function(options)
{var self=this;this.setOptions(options);this.elements=new Hash(this.elements);this.composer=new Hash(this.composer);this.plugins=new Hash(this.plugins);var container=this.container=$(this.options.container);if($type(container)!='element'){return;}
container.getElement('.labelBox').addEvent('click',function(){this.open();}.bind(this));container.getElement('.textareaBox .close').addEvent('click',function(){this.close();}.bind(this));container.getElement('.inputBox').addEvent('click',function(){self.elements.body.focus();});this.elements.textarea=this.container.getElement('textarea');this.elements.textarea.store('Composer');this.attach();this.getTray();this.getMenu();this.pluginReady=false;this.getForm().getElement('.submitMenu button').addEvent('click',function(e){console.log(e);e.stop();var feed=Wall.feeds.get(this.options.feed_uid);feed.compose.makeFormInputs({fbpage_id:feed.options.fbpage_id});if(this.getContent()==''&&!this.pluginReady&&!this.ready&&(!this.getPlugin('people')||!this.getPlugin('people').peoples.length)){return;}
var button=container.getElement('.submitMenu button');if(button.hasClass('wall_active')){return;}
self.saveContent();self.fireEvent('editorSubmit');button.set('html','&nbsp;&nbsp;&nbsp;'+en4.core.language.translate('WALL_SENDING')+'&nbsp;&nbsp;&nbsp;').addClass('wall_active');Wall.request(en4.core.baseUrl+'wall/index/post',this.getForm().toQueryString(),function(obj){button.set('html','&nbsp;&nbsp;&nbsp;'+en4.core.language.translate('WALL_Share')+'&nbsp;&nbsp;&nbsp;').removeClass('wall_active');var element=new Element('div',{'html':obj.body});feed.initAction(element);element.getChildren().each(function(item){item.inject(feed.getFeed(),'top');Wall.itemEffect(item);});feed.checkEmptyFeed();feed.setLastId(obj.last_id);this.signalPluginReady(false);this.close();}.bind(this));}.bind(this));},open:function(callback)
{this.deactivate();if(this.is_opened){return;}
this.is_opened=true;this.container.getElements('.toolsBox a').addClass('is_active');this.container.getElement('.labelBox').removeClass('is_active');var textarea_box=this.container.getElement('.textareaBox');var fx=new Fx.Morph(textarea_box,{'duration':50});fx.addEvent('onStart',function(){textarea_box.setStyles({'height':30,'overflow':'hidden'});textarea_box.addClass('is_active');}.bind(this));fx.addEvent('onComplete',function(){textarea_box.setStyles({'height':'auto','overflow':'visible'});this.container.getElement('.submitMenu').addClass('is_active');if($type(callback)=='function'){callback();}}.bind(this));fx.start({'height':[30,64]});},close:function()
{this.deactivate();if(!this.is_opened){return;}
this.is_opened=false;var textarea_box=this.container.getElement('.textareaBox');this.setContent('');var fx=new Fx.Morph(textarea_box,{'duration':50});fx.addEvent('onStart',function(){this.container.getElements('.toolsBox a').removeClass('is_active');this.container.getElement('.submitMenu').removeClass('is_active');textarea_box.setStyles({'height':64,'overflow':'hidden'});}.bind(this));fx.addEvent('onComplete',function(){textarea_box.setStyles({'height':30,'overflow':'visible'});textarea_box.removeClass('is_active');var label=this.container.getElement('.labelBox');var labelFx=new Fx.Morph(label,{'duration':1000});labelFx.addEvent('onStart',function(){label.addClass('is_active').setStyle('opacity',0);}).addEvent('onComplete',function(){}.bind(this)).start({'opacity':[0,1]});}.bind(this));fx.start({'height':[64,30]});this.fireEvent('editorClose');},getMenu:function(){if(!$type(this.elements.menu)){if(!$type(this.elements.menu)){this.elements.menu=this.container.getElement('.toolsBox')}}
return this.elements.menu;},getTray:function(){if(!$type(this.elements.tray)){if(!$type(this.elements.tray)){this.elements.tray=this.container.getElement('.wall-compose-tray');}}
return this.elements.tray;},getInputArea:function(){if(!$type(this.elements.inputarea)){var form=this.elements.textarea.getParent('form');this.elements.inputarea=new Element('div',{'styles':{'display':'none'}}).inject(form);}
return this.elements.inputarea;},getForm:function(){return this.elements.textarea.getParent('form');},makeFormInputs:function(data){$H(data).each(function(value,key){this.setFormInputValue(key,value);}.bind(this));},setFormInputValue:function(key,value){var elName='composerForm'+key.capitalize();if(!this.composer.has(elName)){this.composer.set(elName,new Element('input',{'type':'hidden','name':'composer['+key+']','value':value||''}).inject(this.getInputArea()));}
this.composer.get(elName).value=value;},attach:function(){var self=this;this.elements.textarea.addClass('compose-textarea').setStyle('display','none');this.elements.container=new Element('div',{'id':'compose-container','class':'compose-container','styles':{}});this.elements.container.wraps(this.elements.textarea);this.elements.body=new Element('div',{'class':'compose-content','styles':{'display':'block'},'events':{'keypress':function(event){if(event.key=='a'&&event.control){if(Browser.Engine.gecko){fix_gecko_select_all_contenteditable_bug(this,event);}}}}}).inject(this.elements.textarea,'before');this.elements.body.addEvent('blur',function(e){if(''==this.get('html').replace(/\s/,'').replace(/<[^<>]+?>/ig,''))
{if(!Browser.Engine.trident){this.set('html','<br />');}else{this.set('html','<span></span>');}
if(self.options.hideSubmitOnBlur){(function(){if(!self.hasActivePlugin()){self.getMenu().setStyle('display','none');}}).delay(250);}}});if(self.options.hideSubmitOnBlur){this.getMenu().setStyle('display','none');this.elements.body.addEvent('focus',function(e){self.getMenu().setStyle('display','');});}
$(this.elements.body);this.elements.body.contentEditable=true;this.elements.body.designMode='On';['MouseUp','MouseDown','ContextMenu','Click','Dblclick','KeyPress','KeyUp','KeyDown','Focus','Blur','Paste'].each(function(eventName){var method=(this['editor'+eventName]||function(){}).bind(this);this.elements.body.addEvent(eventName.toLowerCase(),method);}.bind(this));this.editor=new Wall_Editor({'element':this.elements.body});this.setContent(this.elements.textarea.value);this.fireEvent('attach',this);this.plugins.each(function(){});},detach:function(){this.fireEvent('detach',this);return this;},focus:function(){(function(){this.elements.textarea.focus();this.fireEvent('focus',this);}).bind(this).delay(10);return this;},getContent:function(){return this.cleanup(this.elements.body.get('html'));},setContent:function(newContent){if(!newContent.trim()&&!Browser.Engine.trident)newContent='<br />';this.elements.body.set('html',newContent);return this;},saveContent:function(){this.elements.textarea.set('value',this.getContent());return this;},cleanup:function(html){return html.replace(/<(br|p|div)[^<>]*?>/ig,"\r\n").replace(/<[^<>]+?>/ig,'').replace(/(\r\n?|\n){3,}/ig,"\n\n").trim();},addPlugin:function(plugin){var key=plugin.getName();this.plugins.set(key,plugin);plugin.setComposer(this);return this;},addPlugins:function(plugins){plugins.each(function(plugin){this.addPlugin(plugin);}.bind(this));},getPlugin:function(name){return this.plugins.get(name);},activate:function(name){this.deactivate();this.plugins.get(name).activate();},deactivate:function(){var self=this;this.plugins.each(function(plugin){plugin.detach();plugin.deactivate();});this.composer.each(function(value,key){value.destroy();self.composer.erase(key);});this.getTray().empty();this.getTray().setStyle('display','none');this.signalPluginReady(false);},signalPluginReady:function(state){this.pluginReady=state;},hasActivePlugin:function(){var active=false;this.plugins.each(function(plugin){active=active||plugin.active;});return active;},editorMouseUp:function(e){this.fireEvent('editorMouseUp',e);},editorMouseDown:function(e){this.fireEvent('editorMouseDown',e);},editorContextMenu:function(e){this.fireEvent('editorContextMenu',e);},editorClick:function(e){this.fireEvent('editorClick',e);},editorDoubleClick:function(e){this.fireEvent('editorDoubleClick',e);},editorKeyPress:function(e){this.keyListener(e);this.fireEvent('editorKeyPress',e);},editorKeyUp:function(e){this.fireEvent('editorKeyUp',e);},editorKeyDown:function(e){this.fireEvent('editorKeyDown',e);},editorFocus:function(e){this.fireEvent('editorFocus',e);},editorBlur:function(e){this.fireEvent('editorBlur',e);},editorPaste:function(e){this.fireEvent('editorPaste',e);},keyListener:function(e){},_lang:function(){try{if(arguments.length<1){return'';}
var string=arguments[0];if($type(this.options.lang)&&$type(this.options.lang[string])){string=this.options.lang[string];}
if(arguments.length<=1){return string;}
var args=new Array();for(var i=1,l=arguments.length;i<l;i++){args.push(arguments[i]);}
return string.vsprintf(args);}catch(e){alert(e);}}});Wall.Composer.Plugin={};Wall.Composer.Plugin.Interface=new Class({Implements:[Options,Events],name:'interface',active:false,composer:false,options:{loadingImage:'application/modules/Core/externals/images/loading.gif'},elements:{},persistentElements:['activator','loadingImage'],params:{},initialize:function(options){this.params=new Hash();this.elements=new Hash();this.reset();this.setOptions(options);},getName:function(){return this.name;},setComposer:function(composer){this.composer=composer;this.attach();return this;},getComposer:function(){if(!this.composer)throw"No composer defined";return this.composer;},attach:function(){this.reset();},detach:function(){this.reset();if(this.elements.activator){this.elements.activator.destroy();this.elements.erase('menu');}},reset:function(){this.elements.each(function(element,key){if($type(element)=='element'&&!this.persistentElements.contains(key)){$(element).destroy();this.elements.erase(key);}}.bind(this));this.params=new Hash();this.elements=new Hash();},activate:function(){if(this.active)return;this.active=true;this.getComposer().open();this.getComposer().getTray().setStyle('display','block');var submitButtonEl=$(this.getComposer().options.submitElement);if(submitButtonEl){submitButtonEl.setStyle('display','none');}
switch($type(this.options.loadingImage)){case'element':break;case'string':this.elements.loadingImage=new Asset.image(this.options.loadingImage,{'class':'wall-compose-loading-image wall-compose-'+this.getName()+'-loading-image'});break;default:this.elements.loadingImage=new Asset.image('loading.gif',{'class':'wall-compose-loading-image wall-compose-'+this.getName()+'-loading-image'});break;}
(function(){$try(function(){window.fireEvent('resize');});}).delay(3000);},deactivate:function(){if(!this.active)return;this.active=false;this.reset();var submitButtonEl=$(this.getComposer().options.submitElement);if(submitButtonEl){submitButtonEl.setStyle('display','');}
this.getComposer().signalPluginReady(false);},ready:function(){this.getComposer().signalPluginReady(true);var submitEl=$(this.getComposer().options.submitElement);if(submitEl){submitEl.setStyle('display','');}},makeActivator:function(){if(!this.elements.activator){this.elements.activator=new Element('a',{'class':'wall-compose-activator wall-compose-'+this.getName()+'-activator wall_blurlink','href':'javascript:void(0);','html':'&nbsp;','title':this._lang(this.options.title),'events':{'click':this.activate.bind(this)}}).inject(this.getComposer().getMenu());new Wall.Tips(this.elements.activator);new Wall.BlurLink(this.elements.activator);}},makeMenu:function(){if(!this.elements.menu){var tray=this.getComposer().getTray();this.elements.menu=new Element('div',{'class':'wall-compose-container wall-compose-tray-headline  wall-compose-'+this.getName()+'-menu'}).inject(tray);this.elements.menuTitle=new Element('span',{'html':this._lang(this.options.title)+' ('}).inject(this.elements.menu);this.elements.menuClose=new Element('a',{'href':'javascript:void(0);','html':this._lang('cancel'),'events':{'click':function(e){e.stop();this.getComposer().deactivate();}.bind(this)}}).inject(this.elements.menuTitle);this.elements.menuTitle.appendText(')');}},makeBody:function(){if(!this.elements.body){var tray=this.getComposer().getTray();this.elements.body=new Element('div',{'class':'wall-compose-body wall-compose-'+this.getName()+'-body'}).inject(tray);}},makeLoading:function(action){if(!this.elements.loading){if(action=='empty'){this.elements.body.empty();}else if(action=='hide'){this.elements.body.getChildren().each(function(element){element.setStyle('display','none')});}else if(action=='invisible'){this.elements.body.getChildren().each(function(element){element.setStyle('height','0px').setStyle('visibility','hidden')});}
this.elements.loading=new Element('div',{'class':'wall-compose-loading wall-compose-'+this.getName()+'-loading'}).inject(this.elements.body);var image=this.elements.loadingImage||(new Element('img',{'class':'wall-compose-loading-image wall-compose-'+this.getName()+'-loading-image'}));image.inject(this.elements.loading);new Element('span',{'html':this._lang('Loading...')}).inject(this.elements.loading);}},makeError:function(message,action){if(!$type(action))action='empty';message=message||'An error has occurred';message=this._lang(message);this.elements.error=new Element('div',{'class':'wall-compose-error wall-compose-'+this.getName()+'-error','html':message}).inject(this.elements.body);},makeFormInputs:function(data){this.ready();this.getComposer().getInputArea().empty();data.type=this.getName();$H(data).each(function(value,key){this.setFormInputValue(key,value);}.bind(this));},setFormInputValue:function(key,value){var elName='attachmentForm'+key.capitalize();if(!this.elements.has(elName)){this.elements.set(elName,new Element('input',{'type':'hidden','name':'attachment['+key+']','value':value||''}).inject(this.getComposer().getInputArea()));}
this.elements.get(elName).value=value;},_lang:function(){try{if(arguments.length<1){return'';}
var string=arguments[0];if($type(this.options.lang)&&$type(this.options.lang[string])){string=this.options.lang[string];}
if(arguments.length<=1){return string;}
var args=new Array();for(var i=1,l=arguments.length;i<l;i++){args.push(arguments[i]);}
return string.vsprintf(args);}catch(e){alert(e);}}});Wall.camera_list=new Wall.Storage();Wall.Camera=new Class({Implements:[Events,Options],options:{m:''},shootEnabled:true,initialize:function(options)
{var self=this;this.setOptions(options);this.createDom();window.addEvent('resize',function(){self.build();});Wall.setKeyEvent(function(e){if(e.key=='esc'){Wall.camera_list.getAll().each(function(item){item.viewClose();});}
if(e.key=='space'){Wall.camera_list.getAll().each(function(item){item.fireEvent('freeze');});}});Wall.camera_list.add($random(1111,9999),this);this.camera.addEvent('click',function(e){if(e){e.stop();if(!$(e.target).getParent('body')||$(e.target).getParent('.container')||$(e.target).hasClass('container')){return;}}
self.viewClose();});webcam.set_hook('onLoad',function(){self.shootEnabled=true;});webcam.set_hook('onComplete',function(msg){self.upload.removeClass('wall_loading');msg=JSON.decode(msg);if(msg.error){alert(msg.message);}
else{self.fireEvent('success',msg);self.viewClose();}});webcam.set_hook('onError',function(e){alert(e);self.viewClose();});this.close.addEvent('click',function(){self.viewClose();});this.cancel.addEvent('click',function(){self.togglePane();webcam.reset();});this.freeze.addEvent('click',function(){self.togglePane();if(!self.shootEnabled){return false;}
webcam.freeze();});this.upload.addEvent('click',function(){self.upload.addClass('wall_loading');webcam.upload();});this.createBox();Wall.globalBind();},viewClose:function()
{this.fireEvent('cancel');this.camera.destroy();$$('html')[0].removeClass('wall_hidescrool');},createBox:function()
{this.camera.inject(Wall.externalDiv());webcam.set_swf_url(en4.core.basePath+'application/modules/Wall/externals/webcam/webcam.swf');if(this.options.url){webcam.set_api_url(this.options.url+'?format=json&m='+this.options.m);}else{webcam.set_api_url(en4.core.baseUrl+'wall/camera/upload?format=json&m='+this.options.m);}
webcam.set_quality(80);webcam.set_shutter_sound(true,en4.core.basePath+'application/modules/Wall/externals/webcam/shutter.mp3');var webcamera_element=(new Element('div',{'class':'embed','id':'wall_camera_embed'})).inject(this.container,'top');$$('html')[0].addClass('wall_hidescrool');this.build();webcamera_element.innerHTML=webcam.get_html(600,480);},togglePane:function()
{var self=this;if(this.upload.isVisible()){var fx=new Fx.Morph(this.freeze,{'duration':500});this.freeze.setStyle('display','none');fx.start({'opacity':[0,1]});fx.addEvent('complete',function(){self.freeze.setStyle('display','block');});var fx2=new Fx.Morph(this.cancel,{'duration':500});this.cancel.setStyle('display','block');fx2.start({'opacity':[1,0]});fx2.addEvent('complete',function(){self.cancel.setStyle('display','none');});var fx3=new Fx.Morph(this.upload,{'duration':500});this.upload.setStyle('display','block');fx3.start({'opacity':[1,0]});fx3.addEvent('complete',function(){self.upload.setStyle('display','none');});}else{var out_fx=new Fx.Morph(this.freeze,{'duration':500});this.freeze.setStyle('display','block');out_fx.start({'opacity':[1,0]});out_fx.addEvent('complete',function(){self.freeze.setStyle('display','none');});var out_fx2=new Fx.Morph(this.cancel,{'duration':500});this.cancel.setStyle('display','none');out_fx2.start({'opacity':[0,1]});out_fx2.addEvent('complete',function(){self.cancel.setStyle('display','block');});var out_fx3=new Fx.Morph(this.upload,{'duration':500});this.upload.setStyle('display','none');out_fx3.start({'opacity':[0,1]});out_fx3.addEvent('complete',function(){self.upload.setStyle('display','block');});}},createDom:function()
{this.camera=new Element('div',{'class':'wall-camera wall-window'});this.container=new Element('div',{'class':'container'});if(!Wall.isLightTheme()){this.camera.addClass('night_theme');}
if(!!navigator.userAgent.match(/MSIE/)){this.camera.addClass('ie');}
this.close=new Element('a',{'href':'javascript:void(0);','class':'close wall_blurlink'});this.submit_menu=new Element('div',{'class':'submit-menu'});this.freeze=new Element('a',{'href':'javascript:void(0);','class':'freeze wall-button wall_blurlink','html':'<span class="wall_icon">&nbsp;</span>'+en4.core.language.translate('WALL_CAMERA_FREEZE')});this.cancel=new Element('a',{'href':'javascript:void(0);','style':'display:none','class':'cancel wall-button wall_blurlink','html':'<span class="wall_icon">&nbsp;</span>'+en4.core.language.translate('WALL_CAMERA_CANCEL')});this.upload=new Element('a',{'href':'javascript:void(0);','style':'display:none','class':'upload wall-button wall_blurlink','html':'<span class="wall_icon">&nbsp;</span>'+en4.core.language.translate('WALL_CAMERA_UPLOAD')});this.close.inject(this.camera);this.freeze.inject(this.submit_menu);this.cancel.inject(this.submit_menu);this.upload.inject(this.submit_menu);this.submit_menu.inject(this.container);this.container.inject(this.camera);},build:function()
{var pos=$(this.container).getCoordinates();var total=$(this.camera).getCoordinates();$(this.container).setStyle('position','absolute').setStyle('left',(total.width/2-pos.width/2)).setStyle('top',20);}});Wall.lightHexColor=function(hex)
{if(hex[0]=="#")hex=hex.substr(1);if(hex.length==3){var temp=hex;hex='';temp=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(temp).slice(1);for(var i=0;i<3;i++)hex+=temp[i]+temp[i];}
var result=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(hex);if(!result){return 150;}
var triplets=result.slice(1);return 0.213*parseInt(triplets[0],16)+0.715*parseInt(triplets[1],16)+0.072*parseInt(triplets[2],16);};Wall.lightDiv=null;Wall.isLightTheme=function()
{if(!Wall.lightDiv){Wall.lightDiv=new Element('div',{style:'display:none','class':'wall-theme-foreground'});Wall.lightDiv.inject(Wall.externalDiv());}
var hex=Wall.lightDiv.getStyle('background-color');if(hex=='transparent'){hex=Wall.lightDiv.removeClass('wall-theme-foreground').addClass('wall-theme-background').getStyle('background-color');}
return Wall.lightHexColor(hex)>100;};var Wall_Editor=new Class({Implements:[Events,Options],options:{win:window},element:null,initialize:function(options)
{this.setOptions(options);this.init();},init:function()
{var self=this;if(this.options.element){this.element=$(this.options.element);if(this.element){this.element.addEvent('paste',function(){self.clearHtmlTags();});}}},getRange:function()
{if($type(this.options.win.getSelection)&&this.options.win.getSelection().rangeCount){return this.options.win.getSelection().getRangeAt(0);}else if(this.options.win.document.selection&&$type(this.options.win.document.selection.createRange)){return this.options.win.document.selection.createRange();}},clearHtmlTags:function()
{var self=this;if(!self.element.innerHTML.match(/<[^<>]+?>/i)){return;}
var content=self.element.innerHTML.replace(/<(br|p|div)[^<>]*?>/ig,"\r\n").replace(/<[^<>]+?>/ig,'').replace(/&nbsp;/ig,'').replace(/(\r\n?|\n){3,}/ig,"<br />").trim();this.setContent(content);},getCaretAndText:function()
{var range=this.getRange();var caretPos=0;var text='';if(!range){return;}
if(window.getSelection){caretPos=range.endOffset;}else if(document.selection){var tl=this.element.innerText.length;var selection=document.selection;var range_t=selection.createRange();if(range_t==null||range_t['text']==null){}else{var sl=range.text.length;range.moveStart("character",-tl);caretPos=range.text.length;}}
if(this.getRange().startContainer){text=this.getRange().startContainer.data;}else if(this.getRange().parentElement()){text=this.element.innerText;}
return{caret:caretPos,text:text};},cleanup:function(content)
{return content.replace(/<(br|p|div)[^<>]*?>/ig,"\r\n").replace(/<[^<>]+?>/ig,'').replace(/(\r\n?|\n){3,}/ig,"\n\n").trim();},moveCaretToEnd:function()
{this.element.focus();var range=this.getRange();if(window.getSelection){range.setStart(this.element.lastChild,this.element.lastChild.textContent.length);range.setEnd(this.element.lastChild,this.element.lastChild.textContent.length);}else if(typeof this.element.createTextRange!="undefined"){var range=this.element.createTextRange();range.collapse(false);range.select();}},setCaretAfterElement:function(element)
{if(!element){return;}
this.element.focus();if(window.getSelection){window.getSelection().collapse(element.nextSibling,1);}else if(document.selection){this.getRange().moveToElementText(element);}},getContent:function(){return this.cleanup(this.element.get('html'));},setContent:function(newContent){if(!newContent.trim()&&!Browser.Engine.trident)newContent='<br />';this.element.set('html',newContent.replace(/\r\n/ig,"<br />"));return this;}});function Wall_htmlspecialchars(text){var chars=Array("&","<",">",'"',"'");var replacements=Array("&amp;","&lt;","&gt;","&quot;","'");for(var i=0;i<chars.length;i++){var re=new RegExp(chars[i],"gi");if(re.test(text)){text=text.replace(re,replacements[i]);}}
return text;}
Wall.clearHTML=function(content)
{return content.replace(/<(br|p|div)[^<>]*?>/ig,"\r\n").replace(/<[^<>]+?>/ig,'').replace(/(\r\n?|\n){3,}/ig,"\n\n").trim();};Wall.decodeData=function(str)
{try{return eval('(function(){'+str+'})();');}catch(e){return null;}};Wall.showLink=function(link)
{var description=en4.core.language.translate("WALL_Copy this link to send a copy of this post to others:");description+='<div class="wall-share-link"><input type="text" onfocus="this.select();" onclick="this.select();" name="link" value="'+link+'" /> <a href="'+link+'" class="wall_go">'+en4.core.language.translate("WALL_GO")+'</a></div>';he_show_confirm(en4.core.language.translate("WALL_Link to this post"),description,function(){});$('TB_ajaxContent').addClass('wall-share-link-container');};function WallPreload(images){if(typeof document.body=="undefined")return;try{var div=document.createElement("div");var s=div.style;s.position="absolute";s.top=s.left=0;s.visibility="hidden";document.body.appendChild(div);div.innerHTML="<img src=\""+images.join("\" /><img src=\"")+"\" />";var lastImg=div.lastChild;lastImg.onload=function(){document.body.removeChild(document.body.lastChild);};}
catch(e){}};var Lasso=new Class({Implements:[Options,Events],active:false,options:{autoHide:true,cropMode:false,globalTrigger:false,min:false,max:false,ratio:false,contain:false,trigger:null,border:'#999',color:'#7389AE',opacity:.3,zindex:10000,bgimage:'./blank.gif'},binds:{},initialize:function(options){this.setOptions(options);this.box=new Element('div',{'styles':{'display':'none','position':'absolute','z-index':this.options.zindex}}).inject((this.container)?this.container:document.body);this.overlay=new Element('div',{'class':'lasso-overlay','styles':{'position':'relative','background':'url('+this.options.bgimage+')','height':'100%','width':'100%','z-index':this.options.zindex+1}}).inject(this.box);this.mask=new Element('div',{'styles':{'position':'absolute','background-color':this.options.color,'opacity':this.options.opacity,'height':'100%','width':'100%','z-index':this.options.zindex-1}});if(this.options.cropMode){this.mask.setStyle('z-index',this.options.zindex-2).inject(this.container);this.options.trigger=this.mask;}else{this.mask.inject(this.overlay);}
this.trigger=$(this.options.trigger);var antStyles={'position':'absolute','width':1,'height':1,'overflow':'hidden','z-index':this.options.zindex+1};if(this.options.border.test(/\.(jpe?g|gif|png)/))antStyles.backgroundImage='url('+this.options.border+')';else var antBorder='1px dashed '+this.options.border;this.marchingAnts={};['left','right','top','bottom'].each(function(side,idx){switch(side){case'left':style=$merge(antStyles,{top:0,left:-1,height:'100%'});break;case'right':style=$merge(antStyles,{top:0,right:-1,height:'100%'});break;case'top':style=$merge(antStyles,{top:-1,left:0,width:'100%'});break;case'bottom':style=$merge(antStyles,{bottom:-1,left:0,width:'100%'});break;}
if(antBorder)style['border-'+side]=antBorder;this.marchingAnts[side]=new Element('div',{'styles':style}).inject(this.overlay);},this);this.binds.start=this.start.bindWithEvent(this);this.binds.move=this.move.bindWithEvent(this);this.binds.end=this.end.bindWithEvent(this);this.attach();document.body.onselectstart=function(e){e=new Event(e).stop();return false;};this.removeDOMSelection=(document.selection&&document.selection.empty)?function(){document.selection.empty();}:(window.getSelection)?function(){var s=window.getSelection();if(s&&s.removeAllRanges)s.removeAllRanges();}:$lambda(false);this.resetCoords();},attach:function(){this.trigger.addEvent('mousedown',this.binds.start);},detach:function(){if(this.active)this.end();this.trigger.removeEvent('mousedown',this.binds.start);},start:function(event){if((!this.options.autoHide&&event.target==this.box)||(!this.options.globalTrigger&&(this.trigger!=event.target)))return false;this.active=true;document.addEvents({'mousemove':this.binds.move,'mouseup':this.binds.end});this.resetCoords();if(this.options.contain)this.getContainCoords();if(this.container)this.getRelativeOffset();this.setStartCoords(event.page);this.fireEvent('start');return true;},move:function(event){if(!this.active)return false;this.removeDOMSelection();var s=this.coords.start,m=event.page,box=this.coords.box={},c=this.coords.container;if(this.container){m.y-=this.offset.top;m.x-=this.offset.left;}
var f=this.flip={y:(s.y>m.y),x:(s.x>m.x)};box.y=(f.y)?[m.y,s.y]:[s.y,m.y];box.x=(f.x)?[m.x,s.x]:[s.x,m.x];if(this.options.contain){if(box.y[0]<c.y[0])box.y[0]=c.y[0];if(box.y[1]>c.y[1])box.y[1]=c.y[1];if(box.x[0]<c.x[0])box.x[0]=c.x[0];if(box.x[1]>c.x[1])box.x[1]=c.x[1];}
if(this.options.max){if(box.x[1]-box.x[0]>this.options.max[0]){if(f.x)box.x[0]=box.x[1]-this.options.max[0];else box.x[1]=box.x[0]+this.options.max[0];}
if(box.y[1]-box.y[0]>this.options.max[1]){if(f.y)box.y[0]=box.y[1]-this.options.max[1];else box.y[1]=box.y[0]+this.options.max[1];}}
if(this.options.ratio){var ratio=this.options.ratio;var r={x:(box.x[1]-box.x[0])/ratio[0],y:(box.y[1]-box.y[0])/ratio[1]};if(r.x>r.y){if(f.x)box.x[0]=box.x[1]-(r.y*ratio[0]);else box.x[1]=box.x[0]+(r.y*ratio[0]);}else if(r.x<r.y){if(f.y)box.y[0]=box.y[1]-(r.x*ratio[1]);else box.y[1]=box.y[0]+(r.x*ratio[1]);}}
this.refresh();return true;},refresh:function(){var c=this.coords,box=this.coords.box,cc=this.coords.container;c.w=box.x[1]-box.x[0];c.h=box.y[1]-box.y[0];c.top=box.y[0];c.left=box.x[0];this.box.setStyles({'display':'block','top':c.top,'left':c.left,'width':c.w,'height':c.h});this.fireEvent('resize',this.getRelativeCoords());},end:function(event){if(!this.active)return false;this.active=false;document.removeEvents({'mousemove':this.binds.move,'mouseup':this.binds.end});if(this.options.autoHide)this.resetCoords();else if(this.options.min){if(this.coords.w<this.options.min[0]||this.coords.h<this.options.min[1])this.resetCoords();}
var ret=(this.options.autoHide)?null:this.getRelativeCoords();this.fireEvent('complete',ret);return true;},setStartCoords:function(coords){if(this.container){coords.y-=this.offset.top;coords.x-=this.offset.left;}
this.coords.start=coords;this.coords.w=0;this.coords.h=0;this.box.setStyles({'display':'block','top':this.coords.start.y,'left':this.coords.start.x});},resetCoords:function(){this.coords={start:{x:0,y:0},move:{x:0,y:0},end:{x:0,y:0},w:0,h:0};this.box.setStyles({'display':'none','top':0,'left':0,'width':0,'height':0});this.getContainCoords();},getRelativeCoords:function(){var box=this.coords.box,cc=$merge(this.coords.container),c=this.coords;if(!this.options.contain)cc={x:[0,0],y:[0,0]};return{x:(box.x[0]-cc.x[0]).toInt(),y:(box.y[0]-cc.y[0]).toInt(),w:(c.w).toInt(),h:(c.h).toInt()};},getContainCoords:function(){var tc=this.trigger.getCoordinates(this.container);this.coords.container={y:[tc.top,tc.top+tc.height],x:[tc.left,tc.left+tc.width]};},getRelativeOffset:function(){this.offset=this.container.getCoordinates();},reset:function(){this.detach();},destroy:function(){this.detach();this.mask.destroy();this.overlay.destroy();this.box.destroy();}});;Lasso.Crop=new Class({Extends:Lasso,options:{autoHide:false,cropMode:true,contain:true,handleSize:8,preset:false,handleStyle:{'border':'1px solid #000','background-color':'#ccc',opacity:.75},handlePreventsDefault:true},initialize:function(img,options){this.img=$(img);if(this.img.get('tag')!='img')return false;var coords=this.img.getCoordinates();var widthFix=coords.width-2;var heightFix=coords.height-2;this.container=new Element('div',{'id':'lassoMask','styles':{'position':'relative','width':widthFix,'height':heightFix,'background':'url('+this.img.get('src')+') no-repeat'}}).inject(this.img,'after');this.img.setStyle('display','none');options.p=this.container;this.crop=new Element('span',{styles:{'position':'absolute','top':0,'left':0,'width':coords.width,'height':coords.height,'padding':0,'margin':0,'z-index':this.options.zindex-1,'background-image':'url('+this.img.get('src')+')'}}).inject(this.container);this.parent(options);this.binds.handleMove=this.handleMove.bind(this);this.binds.handleEnd=this.handleEnd.bind(this);this.binds.handles={};this.handles={};this.handlesGrid={'NW':[0,0],'N':[0,1],'NE':[0,2],'W':[1,0],'E':[1,2],'SW':[2,0],'S':[2,1],'SE':[2,2]};['NW','N','NE','W','E','SW','S','SE'].each(function(handle){var grid=this.handlesGrid[handle];this.binds.handles[handle]=this.handleStart.bindWithEvent(this,[handle,grid[0],grid[1]]);this.handles[handle]=new Element("div",{'styles':$merge({'position':'absolute','display':'block','visibility':'hidden','width':this.options.handleSize,'height':this.options.handleSize,'overflow':'hidden','cursor':(handle.toLowerCase()+'-resize'),'z-index':this.options.zindex+2},this.options.handleStyle),'events':{'mousedown':this.binds.handles[handle]}}).inject(this.box,'bottom');this.handles[handle].style.visibility='hidden';},this);this.binds.drag=this.handleStart.bindWithEvent(this,['DRAG',1,1]);this.overlay.addEvent('mousedown',this.binds.drag);this.setDefault();},setDefault:function(){if(!this.options.preset)return this.resetCoords();this.getContainCoords();this.getRelativeOffset();var c=this.coords.container,d=this.options.preset;this.coords.start={x:d[0],y:d[1]};this.active=true;this.move({page:{x:d[2]+this.offset.left,y:d[3]+this.offset.top}});this.active=false;},handleStart:function(event,handle,row,col){this.currentHandle={'handle':handle,'row':row,'col':col};document.addEvents({'mousemove':this.binds.handleMove,'mouseup':this.binds.handleEnd});event.page.y-=this.offset.top;event.page.x-=this.offset.left;this.coords.hs={'s':event.page,'b':$merge(this.coords.box)};this.active=true;if(this.options.handlePreventsDefault){event.stop();}},handleMove:function(event){var box=this.coords.box,c=this.coords.container,m=event.page,cur=this.currentHandle,s=this.coords.start;m.y-=this.offset.top;m.x-=this.offset.left;if(cur.handle=='DRAG'){var hs=this.coords.hs,xm=m.x-hs.s.x,ym=m.y-hs.s.y,diff;box.y[0]=hs.b.y[0]+ym;box.y[1]=hs.b.y[1]+ym;box.x[0]=hs.b.x[0]+xm;box.x[1]=hs.b.x[1]+xm;if((diff=box.y[0]-c.y[0])<0){box.y[0]-=diff;box.y[1]-=diff;}
if((diff=box.y[1]-c.y[1])>0){box.y[0]-=diff;box.y[1]-=diff;}
if((diff=box.x[0]-c.x[0])<0){box.x[0]-=diff;box.x[1]-=diff;}
if((diff=box.x[1]-c.x[1])>0){box.x[0]-=diff;box.x[1]-=diff;}
return this.refresh();}
if(cur.row==0&&box.y[1]<m.y){cur.row=2;}
if(cur.row==2&&box.y[0]>m.y){cur.row=0;}
if(cur.col==0&&box.x[1]<m.x){cur.col=2;}
if(cur.col==2&&box.x[0]>m.x){cur.col=0;}
if(cur.row==0||cur.row==2){s.y=(cur.row)?box.y[0]:box.y[1];if(cur.col==0){s.x=box.x[1];}
if(cur.col==1){s.x=box.x[0];m.x=box.x[1];}
if(cur.col==2){s.x=box.x[0];}}
if(!this.options.ratio){if(cur.row==1){if(cur.col==0){s.y=box.y[0];m.y=box.y[1];s.x=box.x[1];}
else if(cur.col==2){s.y=box.y[0];m.y=box.y[1];s.x=box.x[0];}}}
m.y+=this.offset.top;m.x+=this.offset.left;this.move(event);if(this.options.handlePreventsDefault){event.stop();}},handleEnd:function(event){document.removeEvents({'mousemove':this.binds.handleMove,'mouseup':this.binds.handleEnd});this.active=false;this.currentHandle=false;if(this.options.min&&(this.coords.w<this.options.min[0]||this.coords.h<this.options.min[1])){if(this.options.preset)this.setDefault();else this.resetCoords();}
if(this.options.handlePreventsDefault){event.stop();}},end:function(event){if(!this.parent(event))return false;if(this.options.min&&(this.coords.w<this.options.min[0]||this.coords.h<this.options.min[1])){this.setDefault();}},resetCoords:function(){this.parent();this.coords.box={x:[0,0],y:[0,0]};this.hideHandlers();this.crop.setStyle('clip','rect(0px 0px 0px 0px)');},showHandlers:function(){var box=this.coords.box;if(this.options.min&&(this.coords.w<this.options.min[0]||this.coords.h<this.options.min[1]))this.hideHandlers();else{var tops=[],lefts=[],pxdiff=(this.options.handleSize/2)+1;for(var cell=0,cells=2;cell<=cells;cell++){tops[cell]=((cell==0)?0:((cell==2)?box.y[1]-box.y[0]:(box.y[1]-box.y[0])/2))-pxdiff;lefts[cell]=((cell==0)?0:((cell==2)?box.x[1]-box.x[0]:(box.x[1]-box.x[0])/2))-pxdiff;}
for(var handleID in this.handlesGrid){var grid=this.handlesGrid[handleID],handle=this.handles[handleID];if(!this.options.ratio||(grid[0]!=1&&grid[1]!=1)){if(this.options.min&&this.options.max){if((this.options.min[0]==this.options.max[0])&&(grid[1]%2)==0)continue;if(this.options.min[1]==this.options.max[1]&&(grid[0]%2)==0)continue;}
handle.setStyles({'visibility':'visible','top':tops[grid[0]],'left':lefts[grid[1]]});}}}},hideHandlers:function(){for(handle in this.handles){this.handles[handle].setStyle('visibility','hidden');}},refresh:function(){this.parent();var box=this.coords.box,cc=this.coords.container;if(Browser.Engine.trident&&Browser.Engine.version<5&&this.currentHandle&&this.currentHandle.col===1)
this.overlay.setStyle('width','100.1%').setStyle('width','100%');this.crop.setStyle('clip','rect('+(box.y[0])+'px '+(box.x[1])+'px '+(box.y[1])+'px '+(box.x[0])+'px )');this.showHandlers();},destroy:function(){this.parent();this.img.inject(this.container,'after');this.img.setStyle('display','');this.container.destroy();}});;var Observer=new Class({Implements:[Options,Events],options:{periodical:false,delay:1000},initialize:function(el,onFired,options){this.element=$(el)||$$(el);this.addEvent('onFired',onFired);this.setOptions(options);this.bound=this.changed.bind(this);this.resume();},changed:function(){var value=this.element.get('value');if($equals(this.value,value))return;this.clear();this.value=value;this.timeout=this.onFired.delay(this.options.delay,this);},setValue:function(value){this.value=value;this.element.set('value',value);return this.clear();},onFired:function(){this.fireEvent('onFired',[this.value,this.element]);},clear:function(){$clear(this.timeout||null);return this;},pause:function(){if(this.timer)$clear(this.timer);else this.element.removeEvent('keyup',this.bound);return this.clear();},resume:function(){this.value=this.element.get('value');if(this.options.periodical)this.timer=this.changed.periodical(this.options.periodical,this);else this.element.addEvent('keyup',this.bound);return this;}});var $equals=function(obj1,obj2){return(obj1==obj2||JSON.encode(obj1)==JSON.encode(obj2));};;var Autocompleter=new Class({Implements:[Options,Events],options:{minLength:1,markQuery:true,width:'inherit',maxChoices:10,injectChoice:null,customChoices:null,emptyChoices:null,visibleChoices:true,className:'autocompleter-choices',zIndex:42,delay:1,observerOptions:{},fxOptions:{},autoSubmit:false,overflow:false,overflowMargin:25,selectFirst:true,filter:null,filterCase:false,filterSubset:false,forceSelect:false,selectMode:true,choicesMatch:null,multiple:false,separator:', ',separatorSplit:/\s*[,;]\s*/,autoTrim:false,allowDupes:false,cache:true,relative:true,tokenFormat:'object',tokenIdKey:'id',tokenValueKey:'label',prefetchOnInit:false,alwaysOpen:false,ignoreKeys:false,ignoreOverlayFix:false},initialize:function(element,options){this.element=$(element);this.setOptions(options);this.build();this.observer=new Observer(this.element,this.prefetch.bind(this),$merge({'delay':this.options.delay},this.options.observerOptions));this.queryValue=null;if(this.options.filter)this.filter=this.options.filter.bind(this);var mode=this.options.selectMode;this.typeAhead=(mode=='type-ahead');this.selectMode=(mode===true)?'selection':mode;this.cached=[];if(this.options.prefetchOnInit)this.prefetch.delay(this.options.delay+50,this);},build:function(){if($(this.options.customChoices)){this.choices=this.options.customChoices;}else{this.choices=new Element('ul',{'class':this.options.className,'styles':{'zIndex':this.options.zIndex}}).inject(document.body);this.relative=false;if(this.options.relative){this.choices.inject(this.element,'after');this.relative=this.element.getOffsetParent();}
if(!this.options.ignoreOverlayFix)this.fix=new OverlayFix(this.choices);}
if(!this.options.separator.test(this.options.separatorSplit)){this.options.separatorSplit=this.options.separator;}
if(!this.options.alwaysOpen){this.fx=(!this.options.fxOptions)?null:new Fx.Tween(this.choices,$merge({'property':'opacity','link':'cancel','duration':200},this.options.fxOptions)).addEvent('onStart',Chain.prototype.clearChain).set(0);}
this.element.setProperty('autocomplete','off').addEvent((Browser.Engine.trident||Browser.Engine.webkit)?'keydown':'keypress',this.onCommand.bind(this)).addEvent('click',this.onCommand.bind(this,[false]));if(!this.options.alwaysOpen){this.element.addEvent('focus',this.toggleFocus.create({bind:this,arguments:true,delay:100})).addEvent('blur',this.toggleFocus.create({bind:this,arguments:false,delay:100}));}},destroy:function(){if(this.fix)this.fix.destroy();this.choices=this.selected=this.choices.destroy();},toggleFocus:function(state){this.focussed=state;if(!state)this.hideChoices(true);this.fireEvent((state)?'onFocus':'onBlur',[this.element]);},onCommand:function(e){if(!e&&this.focussed)return this.prefetch();if(e&&e.key&&!e.shift&&!this.options.ignoreKeys){switch(e.key){case'enter':e.stop();if(!this.selected){if(!this.options.customChoices){this.element.value='';}
return true;}
if(this.selected&&this.visible){this.choiceSelect(this.selected);return!!(this.options.autoSubmit);}
break;case'up':case'down':var value=this.element.value;if(!this.prefetch()&&this.queryValue!==null){var up=(e.key=='up');this.choiceOver((this.selected||this.choices)[(this.selected)?((up)?'getPrevious':'getNext'):((up)?'getLast':'getFirst')](this.options.choicesMatch),true);this.element.value=value;}
return false;case'esc':this.hideChoices(true);if(!this.options.customChoices)this.element.value='';break;case'tab':if(this.selected&&this.visible){this.choiceSelect(this.selected);return!!(this.options.autoSubmit);}else{this.hideChoices(true);if(!this.options.customChoices)this.element.value='';break;}}}
this.fireEvent('onCommand',e);return true;},setSelection:function(finish){var tokenInfo=this.selected.retrieve('autocompleteChoice');var input=(this.options.tokenFormat=='object'?tokenInfo[this.options.tokenValueKey]:tokenInfo);var value=input;var start=this.queryValue.length,end=input.length;if((input.substr(0,start)||'').toLowerCase()!=(this.queryValue||'').toLowerCase())start=0;if(this.options.multiple){var split=this.options.separatorSplit;value=this.element.value;start+=this.queryIndex;end+=this.queryIndex;var old=value.substr(this.queryIndex).split(split,1)[0];value=value.substr(0,this.queryIndex)+input+value.substr(this.queryIndex+old.length);if(finish){var tokens=value.split(this.options.separatorSplit).filter(function(entry){return this.test(entry);},/[^\s,]+/);if(!this.options.allowDupes)tokens=[].combine(tokens);var sep=this.options.separator;value=tokens.join(sep)+sep;end=value.length;}}
if(this.options.autocompleteType=='tag')this.observer.setValue(value);this.opted=value;if(finish||this.selectMode=='pick')start=end;$try(function(){this.element.selectRange(start,end)}.bind(this));this.fireEvent('onSelection',[this.element,this.selected,value,input]);},showChoices:function(){var match=this.options.choicesMatch,first=this.choices.getFirst(match);this.selected=this.selectedValue=null;if(this.fix){var pos=this.element.getCoordinates(this.relative),width=this.options.width||'auto';this.choices.setStyles({'width':(width===true||width=='inherit')?pos.width:width});}
if(!first)return;if(!this.visible){this.visible=true;this.choices.setStyle('display','');if(this.fx)this.fx.start(1);this.fireEvent('onShow',[this.element,this.choices]);}
if(this.options.selectFirst||this.typeAhead||first.inputValue==this.queryValue)this.choiceOver(first,this.typeAhead);var items=this.choices.getChildren(match),max=this.options.maxChoices;var styles={'overflowY':'hidden','height':''};this.overflown=false;if(items.length>max){var item=items[max-1];styles.overflowY='scroll';styles.height=item.getCoordinates(this.choices).bottom;this.overflown=true;};this.choices.setStyles(styles);if(this.fix)this.fix.show();if(this.options.visibleChoices){var scroll=document.getScroll(),size=document.getSize(),coords=this.choices.getCoordinates();if(coords.right>scroll.x+size.x)scroll.x=coords.right-size.x;if(coords.bottom>scroll.y+size.y)scroll.y=coords.bottom-size.y;window.scrollTo(Math.min(scroll.x,coords.left),Math.min(scroll.y,coords.top));}},hideChoices:function(clear){if(clear){var value=this.element.value;if(this.options.forceSelect)value=this.opted;if(this.options.autoTrim){value=value.split(this.options.separatorSplit).filter($arguments(0)).join(this.options.separator);}
this.observer.setValue(value);}
if(!this.visible)return;this.visible=false;if(this.selected)this.selected.removeClass('autocompleter-selected');this.observer.clear();var hide=function(){this.choices.setStyle('display','none');if(this.fix)this.fix.hide();}.bind(this);if(this.fx)this.fx.start(0).chain(hide);else hide();this.fireEvent('onHide',[this.element,this.choices]);},prefetch:function(){var value=this.element.value,query=value;if(this.options.multiple){var split=this.options.separatorSplit;var values=value.split(split);var index=this.element.getSelectedRange().start;var toIndex=value.substr(0,index).split(split);var last=toIndex.length-1;index-=toIndex[last].length;query=values[last];}
if(query.length<this.options.minLength){this.hideChoices();}else{if(query===this.queryValue||(this.visible&&query==this.selectedValue)){if(this.visible)return false;this.showChoices();}else{this.queryValue=query;this.queryIndex=index;if(!this.fetchCached())this.query();}}
return true;},fetchCached:function(){switch(true){case(!this.options.cache):case(!this.cachedQueryValue||this.queryValue.length<this.cachedQueryValue.length):case(this.queryValue.indexOf(this.cachedQueryValue)==-1):return false;break;}
if(this.cached.length<this.options.maxChoices)
{this.update(this.filter(this.cached));return true;}
var newChoices=this.filter(this.cached,this.queryValue);if(newChoices.length>=this.cached.length)
{this.update(this.filter(this.cached));return true;}
return false;},update:function(tokens){$(this.choices).empty();this.cached=tokens;this.cachedQueryValue=this.queryValue;var type=tokens&&$type(tokens);if(!type||(type=='array'&&!tokens.length)||(type=='hash'&&!tokens.getLength())){(this.options.emptyChoices||this.hideChoices).call(this);}else{if(this.options.maxChoices<tokens.length&&!this.options.overflow)tokens.length=this.options.maxChoices;tokens.each(this.options.injectChoice||function(token){tokenValue=(this.options.tokenFormat=='object'?token[this.options.tokenValueKey]:token);var choice=new Element('li',{'html':this.markQueryValue(tokenValue)});this.addChoiceEvents(choice).inject(this.choices);choice.store('autocompleteChoice',token);},this);this.showChoices();}},choiceOver:function(choice,selection){if(!choice||choice==this.selected)return;if(this.selected)this.selected.removeClass('autocompleter-selected');this.selected=choice.addClass('autocompleter-selected');this.fireEvent('onSelect',[this.element,this.selected,selection]);if(!this.selectMode)this.opted=this.element.value;if(!selection)return;this.selectedValue=this.selected.retrieve('autocompleteChoice');if(this.overflown){var coords=this.selected.getCoordinates(this.choices),margin=this.options.overflowMargin,top=this.choices.scrollTop,height=this.choices.offsetHeight,bottom=top+height;if(coords.top-margin<top&&top)this.choices.scrollTop=Math.max(coords.top-margin,0);else if(coords.bottom+margin>bottom)this.choices.scrollTop=Math.min(coords.bottom-height+margin,bottom);}
if(this.selectMode)this.setSelection();},choiceSelect:function(choice){if(choice)this.choiceOver(choice);this.setSelection(true);this.queryValue=false;if(!this.options.alwaysOpen){this.hideChoices();}else{this.observer.setValue('');this.prefetch.delay(this.options.delay,this);}
this.fireEvent('onChoiceSelect',choice);if(this.options.autocompleteType=='message'){this.element.value='';var token=choice.retrieve('autocompleteChoice');if(token.friends){var friend_ids="";for(var id in token.friends){if(friend_ids=="")friend_ids=id;else friend_ids=friend_ids+","+id;}
this.doAddValueToHidden(token.label,friend_ids,'toValues',true,' tag_friend');}
else this.doAddValueToHidden(choice.id,token.id,'toValues',true);}},doAddValueToHidden:function(name,toID,hideLoc,newItem,list){var hiddenInputField=document.getElementById(hideLoc);var previousToValues=hiddenInputField.value;if(this.checkSpanExists(name,toID)){if(previousToValues==''){document.getElementById(hideLoc).value=toID;}
else{document.getElementById(hideLoc).value=previousToValues+","+toID;}
this.doPushSpan(name,toID,newItem,hideLoc,list);}},doPushSpan:function(name,toID,newItem,hideLoc,list){var myElement=new Element("span");if(newItem){myElement.id="tospan_"+name+"_"+toID;myElement.innerHTML=name+" <a href='javascript:void(0);' onclick='this.parentNode.destroy();removeFromToValue(\""+toID+"\", \""+hideLoc+"\");'>x</a>";}
else{myElement.id="tospan_"+name+"_"+toID;myElement.innerHTML=name+" <a href='javascript:void(0);' onclick='this.parentNode.destroy();removeFromToValue(\""+toID+"\", \""+hideLoc+"\");'>x</a>";}
$('toValues-wrapper').setStyle('height','auto');if(list==null)list="";myElement.addClass("tag"+list);document.getElementById('toValues-element').appendChild(myElement);this.fireEvent('push');},checkToValue:function(toID,toValues){var checkValue=true;var checkMulti=toID.search(/,/);var x;var toValueArray=toValues.split(",");if(checkMulti!=-1){var recipientsArray=toID.split(",");var multiBool=false;for(var i=0;i<recipientsArray.length;i++){var tempBool=true;for(var x=0;x<toValueArray.length;x++){if(toValueArray[x]==recipientsArray[i]){tempBool=false;}}
multiBool=multiBool||tempBool;}
checkValue=multiBool;}
else{for(x in toValueArray)
{if(toValueArray[x]==toID){checkValue=false;}}}
return checkValue;},checkSpanExists:function(name,toID){var span_id="tospan_"+name+"_"+toID;if($(span_id)){return false;}
else return true;},filter:function(tokens,queryValue){queryValue=queryValue||this.queryValue;tokens=tokens||this.tokens;var regex=new RegExp(((this.options.filterSubset)?'':'^')+queryValue.escapeRegExp(),(this.options.filterCase)?'':'i');if(this.options.tokenFormat=='object'){var key=this.options.tokenValueKey;return tokens.filter(function(token){return regex.test(token[key]);});}else{return tokens.filter(function(token){return regex.test(token);});}
return tokens;},markQueryValue:function(str){return(!this.options.markQuery||!this.queryValue)?str:str.replace(new RegExp('('+((this.options.filterSubset)?'':'^')+this.queryValue.escapeRegExp()+')',(this.options.filterCase)?'':'i'),'<span class="autocompleter-queried">$1</span>');},addChoiceEvents:function(el){return el.addEvents({'mouseover':this.choiceOver.bind(this,el),'click':this.choiceSelect.bind(this,el)});}});var OverlayFix=new Class({initialize:function(el){if(Browser.Engine.trident){this.element=$(el);this.relative=this.element.getOffsetParent();this.fix=new Element('iframe',{'frameborder':'0','scrolling':'no','src':'javascript:false;','styles':{'position':'absolute','border':'none','display':'none','filter':'progid:DXImageTransform.Microsoft.Alpha(opacity=0)'}}).inject(this.element,'after');}},show:function(){if(this.fix){var coords=this.element.getCoordinates(this.relative);delete coords.right;delete coords.bottom;this.fix.setStyles($extend(coords,{'display':'','zIndex':(this.element.getStyle('zIndex')||1)-1}));}
return this;},hide:function(){if(this.fix)this.fix.setStyle('display','none');return this;},destroy:function(){if(this.fix)this.fix=this.fix.destroy();}});Element.implement({getSelectedRange:function(){if(!Browser.Engine.trident)return{start:this.selectionStart,end:this.selectionEnd};var pos={start:0,end:0};var range=this.getDocument().selection.createRange();if(!range||range.parentElement()!=this)return pos;var dup=range.duplicate();if(this.type=='text'){pos.start=0-dup.moveStart('character',-100000);pos.end=pos.start+range.text.length;}else{var value=this.value;var offset=value.length-value.match(/[\n\r]*$/)[0].length;dup.moveToElementText(this);dup.setEndPoint('StartToEnd',range);pos.end=offset-dup.text.length;dup.setEndPoint('StartToStart',range);pos.start=offset-dup.text.length;}
return pos;},selectRange:function(start,end){if(Browser.Engine.trident){var diff=this.value.substr(start,end-start).replace(/\r/g,'').length;start=this.value.substr(0,start).replace(/\r/g,'').length;var range=this.createTextRange();range.collapse(true);range.moveEnd('character',start+diff);range.moveStart('character',start);range.select();}else{this.focus();this.setSelectionRange(start,end);}
return this;}});Autocompleter.Base=Autocompleter;;Autocompleter.Local=new Class({Extends:Autocompleter,options:{minLength:0,delay:200},initialize:function(element,tokens,options){this.parent(element,options);this.tokens=tokens;},query:function(){this.update(this.filter());}});;Autocompleter.Request=new Class({Extends:Autocompleter,options:{postData:{},ajaxOptions:{},postVar:'value',delay:250},query:function(){var data=$unlink(this.options.postData)||{};data[this.options.postVar]=this.queryValue;var indicator=$(this.options.indicator);if(indicator)indicator.setStyle('display','');var cls=this.options.indicatorClass;if(cls)this.element.addClass(cls);this.fireEvent('onRequest',[this.element,this.request,data,this.queryValue]);this.request.send({'data':data});},queryResponse:function(){var indicator=$(this.options.indicator);if(indicator)indicator.setStyle('display','none');var cls=this.options.indicatorClass;if(cls)this.element.removeClass(cls);return this.fireEvent('onComplete',[this.element,this.request]);}});Autocompleter.Request.JSON=new Class({Extends:Autocompleter.Request,initialize:function(el,url,options){this.parent(el,options);this.request=new Request.JSON($merge({'url':url,'link':'cancel'},this.options.ajaxOptions)).addEvent('onComplete',this.queryResponse.bind(this));},queryResponse:function(response){this.parent();this.update(response);}});Autocompleter.Request.HTML=new Class({Extends:Autocompleter.Request,initialize:function(el,url,options){this.parent(el,options);this.request=new Request.HTML($merge({'url':url,'link':'cancel','update':this.choices},this.options.ajaxOptions)).addEvent('onComplete',this.queryResponse.bind(this));},queryResponse:function(tree,elements){this.parent();if(!elements||!elements.length){this.hideChoices();}else{this.choices.getChildren(this.options.choicesMatch).each(this.options.injectChoice||function(choice){var value=choice.innerHTML;choice.inputValue=value;this.addChoiceEvents(choice.set('html',this.markQueryValue(value)));},this);this.showChoices();}}});Autocompleter.Ajax={Base:Autocompleter.Request,Json:Autocompleter.Request.JSON,Xhtml:Autocompleter.Request.HTML};;var Tagger=new Class({Implements:[Events,Options],options:{'title':false,'description':false,'transImage':'application/modules/Core/externals/images/trans.gif','existingTags':[],'tagListElement':false,'linkElement':false,'noTextTagHref':true,'guid':false,'enableCreate':false,'enableDelete':false,'createRequestOptions':{'url':'','data':{'format':'json'}},'deleteRequestOptions':{'url':'','data':{'format':'json'}},'cropOptions':{'preset':[10,10,58,58],'min':[48,48],'max':[128,128],'handleSize':8,'opacity':.6,'color':'#7389AE','border':'externals/moolasso/crop.gif'},'suggestProto':'local','suggestParam':[],'suggestOptions':{'minLength':0,'maxChoices':100,'delay':250,'selectMode':'pick','multiple':false,'className':'message-autosuggest','filterSubset':true,'tokenFormat':'object','tokenValueKey':'label','injectChoice':$empty,'onPush':$empty,'prefetchOnInit':true,'alwaysOpen':true,'ignoreKeys':true}},initialize:function(el,options){el=$(el);if(el.get('tag')!='img'){this.image=el.getElement('img');}else{this.image=el;}
this.element=el;this.count=0;this.setOptions(options);this.options.existingTags.each(this.addTag.bind(this));},begin:function(){if(!this.options.enableCreate)return;this.getCrop();this.getForm();this.getSuggest();this.fireEvent('onBegin');},end:function(){if(this.crop){this.crop.destroy();delete this.crop;}
if(this.form){this.form.destroy();delete this.form;}
if(this.suggest){delete this.suggest;}
this.fireEvent('onEnd');},getCrop:function(){if(!this.crop){var options=$merge(this.options.cropOptions,{});this.crop=new Lasso.Crop(this.image,options);this.crop.addEvent('resize',this.onMove.bind(this));this.crop.refresh();}
return this.crop;},getForm:function(){if(!this.form){this.form=new Element('div',{'id':'tagger_form','class':'tagger_form','styles':{'position':'absolute','z-index':'100000','width':'150px'}}).inject(this.element,'after');if(this.options.title){new Element('div',{'class':'media_photo_tagform_titlebar','html':this.options.title}).inject(this.form);}
this.formContainer=new Element('div',{'class':'media_photo_tagform_container'}).inject(this.form);if(this.options.description){new Element('div',{'class':'media_photo_tagform_text','html':this.options.description}).inject(this.formContainer);}
this.input=new Element('input',{'id':'tagger_input','class':'tagger_input','type':'text','styles':{}}).inject(this.formContainer);this.choices=new Element('div',{'class':'tagger_list'}).inject(this.formContainer);var submitContainer=new Element('div',{'class':'media_photo_tagform_submits'}).inject(this.formContainer);var self=this;new Element('a',{'id':'tag_save','href':'javascript:void(0);','html':en4.core.language.translate('Save'),'events':{'click':function(){var data={};data.label=self.input.value;if($type(data.label)&&data.label!=''){data.extra=self.coords;self.createTag(data);}}}}).inject(submitContainer);new Element('a',{'id':'tag_cancel','href':'javascript:void(0);','html':en4.core.language.translate('Cancel'),'events':{'click':function(){this.end();}.bind(this)}}).inject(submitContainer);this.input.focus();}
return this.form;},getSuggest:function(){if(!this.suggest){var self=this;var options=$merge(this.options.suggestOptions,{'overflow':true,'maxChoices':4,'customChoices':this.choices,'injectChoice':function(token){var choice=new Element('li',{'class':'autocompleter-choices','html':token.photo||'','id':token.guid});new Element('div',{'html':this.markQueryValue(token.label),'class':'autocompleter-choice'}).inject(choice);new Element('input',{'type':'hidden','value':JSON.encode(token)}).inject(choice);this.addChoiceEvents(choice).inject(this.choices);choice.store('autocompleteChoice',token);},'onChoiceSelect':function(choice){var data=JSON.decode(choice.getElement('input').value);data.extra=self.coords;self.createTag(data);},'emptyChoices':function(){this.fireEvent('onHide',[this.element,this.choices]);},'onCommand':function(e){switch(e.key){case'enter':self.createTag({label:self.input.value,extra:self.coords});break;}}});if(this.options.suggestProto=='local'){this.suggest=new Autocompleter.Local(this.input,this.options.suggestParam,options);}else if(this.options.suggestProto=='request.json'){this.suggest=new Autocompleter.Request.JSON(this.input,this.options.suggestParam,options);}}
return this.suggest;},getTagList:function(){if(!this.tagList){if(!this.options.tagListElement){this.tagList=new Element('div',{'class':'tag_list'}).inject(this.element,'after');}else{this.tagList=$(this.options.tagListElement);}}
return this.tagList;},onMove:function(coords){this.coords=coords;var pos={x:0,y:0};var form=this.getForm();form.setStyles({'top':pos.y+coords.y+20,'left':pos.x+coords.x+coords.w+20});},addTag:function(params){if('object'!=$type(params)){return;}
var baseX=0,baseY=0,baseW=0,baseH=0;["x","y","w","h"].each(function(key){params.extra[key]=parseInt(params.extra[key]);});if(this.options.noTextTagHref&&params.tag_type=='core_tag'){delete params.href;}
var tag=new Element('div',{'id':'tag_'+params.id,'class':'tag_div','html':'<img src="'+this.options.transImage+'" width="100%" height="100%" />','styles':{'position':'absolute','width':params.extra.w,'height':params.extra.h,'top':baseY+params.extra.y,'left':baseX+params.extra.x},'events':{'mouseover':function(){this.showTag(params.id);}.bind(this),'mouseout':function(){this.hideTag(params.id);}.bind(this)}}).inject(this.element,'after');var label=new Element("span",{'id':'tag_label_'+params.id,'class':'tag_label','html':params.text,'styles':{'position':'absolute'}}).inject(this.element,'after');var labelPos={};labelPos.top=(baseY+params.extra.y+tag.getSize().y);labelPos.left=Math.round((baseX+params.extra.x)+(tag.getSize().x/2)-(label.getSize().x/2));if(this.element.getSize().y<labelPos.top.toInt()+20){labelPos.top=baseY+params.extra.y-label.getSize().y;}
label.setStyles(labelPos);this.hideTag(params.id);var isFirst=(!$type(this.count)||this.count==0);this.getTagList().setStyle('display','');if(!isFirst)new Element('span',{'id':'tag_comma_'+params.id,'class':'tag_comma','html':','}).inject(this.getTagList());var info=new Element('span',{'id':'tag_info_'+params.id,'class':'tag_info media_tag_listcontainer'}).inject(this.getTagList());var activator=new Element('a',{'id':'tag_activator_'+params.id,'class':'tag_activator','href':params.href||null,'html':params.text,'events':{'mouseover':function(){this.showTag(params.id);}.bind(this),'mouseout':function(){this.hideTag(params.id);}.bind(this)}}).inject(info);if(this.checkCanRemove(params.id))
{info.appendText(' (');var destroyer=new Element('a',{'id':'tag_destroyer_'+params.id,'class':'tag_destroyer albums_tag_delete','href':'javascript:void(0);','html':en4.core.language.translate('delete'),'events':{'click':function(){this.removeTag(params.id);}.bind(this)}}).inject(info);info.appendText(')');}
this.count++;},createTag:function(params){if(!this.options.enableCreate)return;var requestOptions=$merge(this.options.createRequestOptions,{'data':$merge(params,{}),'onComplete':function(responseJSON){this.addTag(responseJSON);}.bind(this)});var request=new Request.JSON(requestOptions);request.send();this.end();},removeTag:function(id){if(!this.checkCanRemove(id))return;var next=$('tag_info_'+id).getNext();if(next&&next.get('html').trim()==',')next.destroy();$('tag_'+id).destroy();$('tag_label_'+id).destroy();$('tag_info_'+id).destroy();this.count--;var requestOptions=$merge(this.options.deleteRequestOptions,{'data':{'tagmap_id':id},'onComplete':function(responseJSON){}.bind(this)});var request=new Request.JSON(requestOptions);request.send();},checkCanRemove:function(id){var tagData;this.options.existingTags.each(function(datum){if(datum.tagmap_id==id){tagData=datum;}});if(this.options.enableDelete)return true;if(tagData){if(tagData.tag_type+'_'+tagData.tag_id==this.options.guid)return true;if(tagData.tagger_type+'_'+tagData.tagger_id==this.options.guid)return true;}
return false;},showTag:function(id){$('tag_'+id).removeClass('tag_div_hidden');$('tag_label_'+id).removeClass('tag_label_hidden');},hideTag:function(id){$('tag_'+id).addClass('tag_div_hidden');$('tag_label_'+id).addClass('tag_label_hidden');}});;window.webcam={version:'1.0.9',ie:!!navigator.userAgent.match(/MSIE/),protocol:location.protocol.match(/https/i)?'https':'http',callback:null,swf_url:'webcam.swf',shutter_url:'shutter.mp3',api_url:'',loaded:false,quality:90,shutter_sound:true,stealth:false,hooks:{onLoad:null,onComplete:null,onError:null},set_hook:function(name,callback){if(typeof(this.hooks[name])=='undefined')
return alert("Hook type not supported: "+name);this.hooks[name]=callback;},fire_hook:function(name,value){if(this.hooks[name]){if(typeof(this.hooks[name])=='function'){this.hooks[name](value);}
else if(typeof(this.hooks[name])=='array'){this.hooks[name][0][this.hooks[name][1]](value);}
else if(window[this.hooks[name]]){window[this.hooks[name]](value);}
return true;}
return false;},set_api_url:function(url){this.api_url=url;},set_swf_url:function(url){this.swf_url=url;},get_html:function(width,height,server_width,server_height){if(!server_width)server_width=width;if(!server_height)server_height=height;var html='';var flashvars='shutter_enabled='+(this.shutter_sound?1:0)+'&shutter_url='+escape(this.shutter_url)+'&width='+width+'&height='+height+'&server_width='+server_width+'&server_height='+server_height;if(this.ie){html+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+this.protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+width+'" height="'+height+'" id="webcam_movie" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+this.swf_url+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+flashvars+'"/></object>';}
else{html+='<embed id="webcam_movie" src="'+this.swf_url+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+width+'" height="'+height+'" name="webcam_movie" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+flashvars+'" />';}
this.loaded=false;return html;},getFlashMovieObject:function(movieName){if(window[movieName])
return window[movieName];if(document.embeds[movieName])
return document.embeds[movieName];if(window.document[movieName])
return window.document[movieName];if(document[movieName])
return document[movieName];return null;},get_movie:function(){if(!this.loaded)return alert("ERROR: Movie is not loaded yet");var movie=this.getFlashMovieObject('webcam_movie');if(!movie)alert("ERROR: Cannot locate movie 'webcam_movie' in DOM");return movie;},set_stealth:function(stealth){this.stealth=stealth;},snap:function(url,callback,stealth){if(callback)this.set_hook('onComplete',callback);if(url)this.set_api_url(url);if(typeof(stealth)!='undefined')this.set_stealth(stealth);this.get_movie()._snap(this.api_url,this.quality,this.shutter_sound?1:0,this.stealth?1:0);},freeze:function(){this.get_movie()._snap('',this.quality,this.shutter_sound?1:0,0);},upload:function(url,callback){if(callback)this.set_hook('onComplete',callback);if(url)this.set_api_url(url);this.get_movie()._upload(this.api_url);},reset:function(){this.get_movie()._reset();},configure:function(panel){if(!panel)panel="camera";this.get_movie()._configure(panel);},set_quality:function(new_quality){this.quality=new_quality;},set_shutter_sound:function(enabled,url){this.shutter_sound=enabled;this.shutter_url=url?url:'shutter.mp3';},flash_notify:function(type,msg){switch(type){case'flashLoadComplete':this.loaded=true;this.fire_hook('onLoad');break;case'error':if(!this.fire_hook('onError',msg)){alert("JPEGCam Flash Error: "+msg);}
break;case'success':this.fire_hook('onComplete',msg.toString());break;default:alert("jpegcam flash_notify: "+type+": "+msg);break;}}};;function he_show_message(message,type,delay){var text='';var duration=400;var delay=(delay==undefined)?3000:delay;text=message;if(window.$message_container==undefined){window.$message_container=new Element('div',{'class':'he_message_container'});$(document.body).adopt(window.$message_container);}
var className='he_msg_text';if(type=='error'){className='he_msg_error';}else if(type=='notice'){className='he_msg_notice';}else{className='he_msg_text';}
var $message=new Element('div',{'class':className,'styles':{'opacity':0}});var $close_btn=new Element('a',{'class':'he_close','href':'javascript://','events':{'click':function(){$message.fade('out');$message.removeClass('visible');window.setTimeout(function(){$message.dispose();if(window.$message_container.getElements('.visible').length==0){window.$message_container.empty();};},duration);}}});$message.addClass('visible');$message.adopt($close_btn);$message.adopt('html',new Element('span',{'html':message}));window.$message_container.adopt($message);$message.set('tween',{duration:duration});$message.fade('in');window.setTimeout(function(){$message.fade('out');$message.removeClass('visible');window.setTimeout(function(){if(window.$message_container.getElements('.visible').length==0){window.$message_container.empty();};},duration);},delay);}
function he_show_image(src,element)
{if(!src){return false;}
var $element=(element)?$(element):$('he_temp_photo_start');if(!$element){$element=new Element('div',{'id':'he_temp_photo_start'});$element.setStyles({'position':'fixed','top':'50%','left':'50%'});$$('body')[0].grab($element);}
var close_title=(typeof(en4.core.language.translate)=='undefined')?language.translate('close'):en4.core.language.translate('close');var instance=new Imagezoom({'image':src,'startElement':$element,'closeText':close_title});instance.show();}
function he_replace_form_error(msg)
{var $container=$$('.global_form .errors li');if($container.length!=1){return false;}
$container.set('html',msg);var $error_link=$container.getElement('a.smoothbox');if($error_link){Smoothbox.bind($error_link);}}
function he_add_lang_vars(data)
{if(!data){return;}
var obj_link=en4.core.language.options.lang;for(var key in data){obj_link[key]=data[key];}}
function object_to_query_string(object)
{var query="";for(key in object){query+='&params['+key+']='+object[key];}
return query;}
var HEContacts=new Class({Implements:[Events,Options],options:{m:'hecore',l:'',c:'',t:'',params:{},nli:0,keyword:'',p:1,ipp:30,total:0,contacts:[],itemClass:'item',filterField:'contacts_filter',filterSubmit:'contacts_filter_submit',container:'he_contacts_list',activeClass:'active',hiddenClass:'hidden',disabledClass:'disabled',visibleClass:'visible',listType:'all',contactsCountNode:'selected_contacts_count',submitButtonNode:'submit_contacts',selectAllNode:'select_all_contacs',moreNode:'contacts_more',listTypeAll:'he_contacts_list_all',listTypeSelected:'he_contacts_list_selected',format:'json'},url:'hecore/index/contacts',block:false,$filter:null,$container:null,$items:null,$selectedCount:null,$submit:null,$filterSubmit:null,$selectAll:null,$more:null,$listAll:null,$listSelected:null,needPagination:false,onLoad:false,onClose:false,width:550,height:390,initialize:function(options){this.setOptions(options);},box:function(){var self=this;var url=this.url+this.getQuery();var $element=new Element('a',{'href':url,'class':'smoothbox'});Smoothbox.open($element,{'mode':'Request',width:this.width,height:this.height,'onLoad':function(){self.init();if(self.onLoad){self.onLoad();self.onLoad=false;}},'onClose':function(){if(self.onClose){self.onClose();self.onClose=false;}}});},getQuery:function(){var query=object_to_query_string(this.options.params);return'?m='+this.options.m+'&l='+this.options.l+'&c='+this.options.c+'&t='+this.options.t+'&nli='+this.options.nli+query;},init:function(){this.$filter=$(this.options.filterField);this.$container=$(this.options.container);this.$selectedCount=$(this.options.contactsCountNode);this.$submit=$(this.options.submitButtonNode);this.$filterSubmit=$(this.options.filterSubmit);this.$selectAll=$(this.options.selectAllNode);this.$more=$(this.options.moreNode);this.$listAll=$(this.options.listTypeAll);this.$listSelected=$(this.options.listTypeSelected);this.$items=$$(this.$container.getElements('.'+this.options.itemClass));$('TB_ajaxContent').addClass('hecore_he_list_window');var self=this;if(this.$items.length>0){this.$items.removeEvents('click').addEvent('click',function(){this.blur();self.chooseContact(this);});}
if(this.$submit){this.$submit.removeEvents('click').addEvent('click',function(){self.submit();});}
if(this.$more){this.$more.removeEvents('click').addEvent('click',function(){self.more();});}
if(this.$listAll){this.$listAll.removeEvents('click').addEvent('click',function(){self.chooseList('all');});}
if(this.$listSelected){this.$listSelected.removeEvents('click').addEvent('click',function(){self.chooseList('selected');});}
if(this.$filterSubmit){this.$filterSubmit.removeEvents('click').addEvent('click',function(){self.search();});}
if(this.$selectAll){this.$selectAll.removeEvents('click').addEvent('click',function(){var value=this.checked?1:0;self.chooseAll(value);});}
if(this.$filter){this.$filter.removeEvents('keyup').addEvent('keyup',function(event){if(event.code==13){self.search();}});}},chooseList:function(type){this.options.listType=type;switch(type){case'all':this.$listSelected.removeClass(this.options.activeClass);this.$listAll.addClass(this.options.activeClass);this.$items.removeClass(this.options.hiddenClass);this.$items.setStyle('opacity',1);if(this.needPagination){this.$more.removeClass(this.options.hiddenClass);}
break;case'selected':this.$listSelected.addClass(this.options.activeClass);this.$listAll.removeClass(this.options.activeClass);this.$items.addClass(this.options.hiddenClass);if(this.$more){this.$more.addClass(this.options.hiddenClass);}
var $items=$$(this.$container.getElements('.'+this.options.activeClass));$items.removeClass(this.options.hiddenClass);break;}},chooseContact:function($node){$node=$($node);if(!$node){return;}
if($node.hasClass(this.options.disabledClass)){return;}
var contactId=parseInt($node.id.substr(8));if(this.options.contacts.indexOf(contactId)==-1){this.select($node,contactId);}else{this.deselect($node,contactId);}
var self=this;this.initCount();setTimeout(function(){self.no_result();},650);},select:function($node,contactId){$node=$($node);if(!$node){return;}
if($node.hasClass(this.options.disabledClass)){return;}
if(!contactId){contactId=parseInt($node.id.substr(8));}
$node=$($node);if(!$node.hasClass(this.options.activeClass)){$node.addClass(this.options.activeClass);}
if(this.options.contacts.indexOf(contactId)==-1){this.options.contacts.push(contactId);}
if(this.options.listType=='selected'){this.show($node,true);}},deselect:function($node,contactId){$node=$($node);if(!$node){return;}
if($node.hasClass(this.options.disabledClass)){return;}
if(!contactId){contactId=parseInt($node.id.substr(8));}
$node=$($node);if($node.hasClass(this.options.activeClass)){$node.removeClass(this.options.activeClass);}
if(this.options.contacts.indexOf(contactId)>-1){this.options.contacts.splice(this.options.contacts.indexOf(contactId),1);}
if(this.options.listType=='selected'){this.hide($node,true);}},initCount:function(){if(this.$selectedCount){this.$selectedCount.set('text',this.options.contacts.length)}},submit:function(){eval("window.parent."+this.options.c+"(["+this.options.contacts.toString()+"])");window.parent.Smoothbox.close();},chooseAll:function(choose){var self=this;if(choose){$$(this.$items).each(function($item){$item=$($item);if($item.hasClass(self.options.disabledClass)){return;}
self.select($item);});}else{$$(this.$items).each(function($item){$item=$($item);if($item.hasClass(self.options.disabledClass)){return;}
self.deselect($item);});}
this.initCount();},search:function(){this.options.keyword=this.$filter.value;this.options.p=1;if(this.options.listType!='all'){this.chooseList('all');}
this.getItems(true);},more:function(){this.options.p++;this.getItems();},getItems:function(replace){if(replace===undefined){replace=false;}
if(this.block){return false;}
this.block=true;var self=this;new Request.JSON({url:self.url,method:'post',data:self.options,onSuccess:function(response){self.block=false;self.respond(response,replace);}}).send();},respond:function(response,replace){if(replace===undefined){replace=false;}
if(replace){this.$container.set('html',response.html);}else{var html=this.$container.get('html')+response.html;this.$container.set('html',html);}
if(this.$more){this.needPagination=response.need_pagination;if(!this.needPagination){this.$more.addClass(this.options.hiddenClass);}else{this.$more.removeClass(this.options.hiddenClass);}}
this.init();},hide:function($node,fx){var self=this;$node=$($node);if(!$node){return;}
var func=function(){if(!$node.hasClass(self.options.hiddenClass)){$node.addClass(self.options.hiddenClass);}}
if(fx){setTimeout(func,650);$node.tween('opacity',[1,0]);}else{$node.setStyle('opacity',0);func();}},show:function($node,fx){var self=this;$node=$($node);if(!$node){return;}
var func=function(){if($node.hasClass(self.options.hiddenClass)){$node.removeClass(self.options.hiddenClass);}
if($node.hasClass(self.options.disabledClass)){$node.setStyle('opacity',.5);}}
$node.setStyle('visibility','visible');if(fx){setTimeout(func,650);if($node.hasClass(this.options.disabledClass)){$node.tween('opacity',[0,.5]);}else{$node.tween('opacity',[0,1]);}}else{$node.setStyle('opacity',1);func();}},no_result:function(){if($$('.visible').length==0){this.show($('no_result'));}else{this.hide($('no_result'));}}});var he_contacts={callback:'',contacts:[],title:'',list_type:'',keyword:'',params:{},onLoad:false,onClose:false,width:550,height:390,box:function(module,list,callback,title,params,not_logged_in){this.params=params;not_logged_in=not_logged_in===undefined?0:1;var options={c:callback,listType:"all",m:module,l:list,p:1,params:params,nli:not_logged_in};window.HE_CONTACTS=new HEContacts(options);if(this.onLoad){window.HE_CONTACTS.onLoad=this.onLoad;}
if(this.onClose){window.HE_CONTACTS.onClose=this.onClose;}
window.HE_CONTACTS.width=this.width;window.HE_CONTACTS.height=this.height;window.HE_CONTACTS.box();},init:function(){var self=this;if(!$('contacts_filter')){return;}
$('contacts_filter').addEvent('keyup',function(){self.keyword=this.value;self.search_contacts();});var contacts=[];for(var i=0;i<this.contacts.length;i++){contacts.push(parseInt(this.contacts[i]));}
this.contacts=contacts;},search_contacts:function(){var self=this;var selector="";if(this.list_type=='selected'){selector='#he_contacts_list .active';$$('#he_contacts_list .item').removeClass('visible');$$('#he_contacts_list .item').removeClass('hidden');$$('#he_contacts_list .item').addClass('hidden');$$('#he_contacts_list .active').addClass('visible');$$('#he_contacts_list .active').removeClass('hidden');}else{selector='#he_contacts_list .item';}
var $items=$$(selector);$items.each(function($item){if(!$item.getElement('span.name').get('html').test(self.keyword,'i')){self.hide($item);}else{self.show($item);}});self.no_result();},choose_contact:function(contact_id){if($("contact_"+contact_id).hasClass("disabled")){return;}
if(this.contacts.indexOf(contact_id)==-1){$("contact_"+contact_id).addClass("active");this.contacts[this.contacts.length]=contact_id;}
else{$("contact_"+contact_id).removeClass("active");this.contacts.splice(this.contacts.indexOf(contact_id),1);if(this.list_type=='selected'){this.hide($("contact_"+contact_id),true);}}
var self=this;if($('selected_contacts_count')!=undefined){$('selected_contacts_count').set('text',self.contacts.length)}
setTimeout(function(){self.no_result();},650);},choose_all_contacts:function($el){var $list_items=$('he_contacts_list').getChildren('a');for(var i in $list_items)
{if(typeof $list_items[i].getProperty=='function'){$id=parseInt($list_items[i].getProperty('id').substr(8));if($el.checked){if(this.contacts.indexOf($id)==-1){this.choose_contact($id);}
if($('checkbox_'+$id)!=undefined&&!$('checkbox_'+$id).checked){$('checkbox_'+$id).checked=true;}}
else
if(this.contacts.indexOf($id)!=-1){this.choose_contact($id);if($('checkbox_'+$id)!=undefined&&$('checkbox_'+$id).checked){$('checkbox_'+$id).checked=false;}}}}
if($('selected_contacts_count')!=undefined){$('selected_contacts_count').set('text',this.contacts.length)}},add_class:function($el,css_class,$el2){$el.addClass(css_class);$el2.removeClass(css_class);},no_result:function(){if($$('.visible').length==0){this.show($('no_result'));}else{this.hide($('no_result'));}},send:function(){eval("window.parent."+this.callback+"(["+this.contacts.toString()+"])");window.parent.Smoothbox.close();},hide:function($element,fx){var func=function(){if(!$element.hasClass('hidden')){$element.addClass('hidden');}
$element.removeClass('visible');}
if(fx){setTimeout(func,650);$element.tween('opacity',[1,0]);}else{$element.setStyle('visibility','hidden');$element.setStyle('opacity',0);func();}},show:function($element,fx){var func=function(){if(!$element.hasClass('visible')){$element.addClass('visible');}
$element.removeClass('hidden');if($element.hasClass('disabled')){$element.setStyle('opacity',.5);}}
if(fx){setTimeout(func,650);if($element.hasClass('disabled')){$element.tween('opacity',[0,.5]);}else{$element.tween('opacity',[0,1]);}}else{$element.setStyle('visibility','visible');$element.setStyle('opacity',1);func();}},showElements:function($elements){var self=this;$elements.each(function($element){self.show($element);});},hideElements:function($elements){var self=this;$elements.each(function($element){self.hide($element);});},select:function(type){var self=this;if(this.list_type==type){return;}
this.list_type=type;this.search_contacts();}}
function form_redirect_level(url,$formElement)
{$$($formElement.form.elements).each(function($el){$el.disabled=true;});window.location.href=url+'?level_id='+$formElement.value;}
var he_list={list_type:'',keyword:'',page:1,ajax_url:'',module:'',list:'',params:{},onLoad:false,onClose:false,width:550,height:390,box:function(module,list,title,params){this.params=params;var self=this;var not_logged_in=0;var query=object_to_query_string(params);var $el=new Element('a',{'href':'hecore/index/list?m='+module+'&l='+list+'&t='+title+'&nli='+not_logged_in+query,'class':'smoothbox'});Smoothbox.open($el,{'mode':'Request',width:this.width,height:this.height,'onLoad':function(){self.init();if(self.onLoad){self.onLoad();self.onLoad=false;}
if(self.onClose){self.onClose();self.onClose=false;}}});},init:function(){var self=this;$('TB_ajaxContent').addClass('hecore_he_list_window');$('list_filter_btn').addEvent('click',function(){self.page=1;self.get_items();});$('list_filter').addEvent('keydown',function(event){if(event.key=='enter'){self.page=1;self.get_items();}});},select:function(list_type){if(list_type==this.list_type){return;}
this.keyword='';this.page=1;this.list_type=list_type;this.get_items();},get_items:function(){var self=this;this.keyword=$('list_filter').value;$('he_list').innerHTML='';$('he_contacts_loading').setStyle('display','block');if(this.params.list_type){this.params.list_type=self.list_type;}
var query=object_to_query_string(this.params);new Request.JSON({'url':self.ajax_url+'?nocache='+Math.random()+query,'method':'post','data':{'format':'json','keyword':self.keyword,'list_type':self.list_type,'p':self.page,'m':self.module,'l':self.list},onSuccess:function(response){$('he_list').innerHTML=response.html;$('he_contacts_loading').setStyle('display','none');}}).send();},set_page:function(page){this.page=page;this.get_items();}}
function he_show_confirm(title,message,callback,options)
{if(window.$he_confirm_container==undefined){window.$he_confirm_container=new Element('div',{'class':'he_confirm_container'});var $link=window.$he_confirm_container;var $title=new Element('div',{'class':'he_confirm_title'});var $description=new Element('div',{'class':'he_confirm_desc'});if(typeof(en4.core.language.translate)=='undefined'){var confirm_label=language.translate('Confirm');var or_label=language.translate('or');var cancel_label=language.translate('Cancel');}else{var confirm_label=en4.core.language.translate('Confirm');var or_label=en4.core.language.translate('or');var cancel_label=en4.core.language.translate('Cancel');}
var $tools=new Element('div',{'class':'he_confirm_tools'});var $confirm_btn=new Element('button',{'class':'confirm_btn','html':confirm_label});var $or_text=new Element('span',{'class':'or_btn','html':or_label});var $cancel_btn=new Element('a',{'class':'cancel_btn','href':'javascript://','html':cancel_label});$tools.adopt($confirm_btn,$or_text,$cancel_btn);$link.adopt($title,$description,$tools);var $hidden_cont=new Element('div',{'class':'display_none'});$hidden_cont.adopt($link);$(document.body).adopt($hidden_cont);}
var $link=window.$he_confirm_container;if(title&&title.length>0){$link.getElement('.he_confirm_title').removeClass('display_none').set('html',title);}else{$link.getElement('.he_confirm_title').addClass('display_none');}
if(message&&message.length>0){$link.getElement('.he_confirm_desc').removeClass('display_none').set('html',message);}else{$link.getElement('.he_confirm_desc').addClass('display_none');}
if(options&&options.confirm_label!=undefined)
$link.getElement('.he_confirm_tools .confirm_btn').set('html',options.confirm_label);if(options&&options.cancel_label!=undefined)
$link.getElement('.he_confirm_tools .cancel_btn').set('html',options.cancel_label);if(options&&options.or_label!=undefined)
$link.getElement('.he_confirm_tools .or_btn').set('html',options.or_label);var width=(options&&options.width)?options.width:500;var height=(options&&options.height)?options.height:100;Smoothbox.open($link,{mode:'Inline',width:width,height:height});$('TB_ajaxContent').getElement('.he_confirm_tools .cancel_btn').addEvent('click',function(){Smoothbox.close();});if(callback&&typeof(callback)=='function'){$('TB_ajaxContent').getElement('.he_confirm_tools .confirm_btn').addEvent('click',function(){Smoothbox.close();callback();});}}
var he_friend={link:'settings_toggler',$link:null,form:'settings_form',$form:null,container:'he_friend_conatainer',$container:null,ipp:'friends_ipp',$ipp:null,loader:'he_friends_loader',$loader:null,privacy:'friends_privacy',$privacy:null,list:'friend_list',$list:null,url:{},init:function(){var self=this;this.$link=$(this.link);this.$form=$(this.form);this.$container=$(this.container);this.$ipp=$(this.ipp);this.$loader=$(this.loader);this.$privacy=$(this.privacy);this.$list=$(this.list);this.$link.addEvent('click',function(){self.toggle_settings();});this.$link.addEvent('focus',function(){this.blur();});this.$ipp.addEvent('change',function(){self.change_ipp(this.value);});this.$privacy.addEvent('change',function(){self.change_privacy(this.value);});this.$list.addEvent('click',function(){self.list_box();});},list_box:function(){he_contacts.box('hecore','getFriends','he_friend.save_friends',en4.core.language.translate('Choose Friends'),{'object':window.en4.core.subject.type,'object_id':window.en4.core.subject.id},0);},see_all:function(list_type){he_list.box('hecore','getMutualFriends',en4.core.language.translate('Friends'),{'object':window.en4.core.subject.type,'object_id':window.en4.core.subject.id,'list_type':list_type});},toggle_settings:function(){if(this.$link.getParent().hasClass('active')){this.$link.getParent().removeClass('active');}else{this.$link.getParent().addClass('active');}
if(this.$form.hasClass('hidden')){this.$form.removeClass('hidden');}else{this.$form.addClass('hidden');}},change_ipp:function(value){var self=this;var url=this.url.change_ipp;this.show_loader();new Request.JSON({'url':url+'?&rand='+Math.random(),'method':'post','data':{'format':'json','value':value},onSuccess:function(response){self.$container.set('html',response.html);self.hide_loader();}}).send();},change_privacy:function(value){var self=this;var url=this.url.change_privacy;this.$privacy.disabled=true;new Request.JSON({'url':url+'?&rand='+Math.random(),'method':'post','data':{'format':'json','value':value},onSuccess:function(response){self.$privacy.disabled=false;}}).send();},show_loader:function(){this.$loader.removeClass('hidden');this.$container.addClass('hidden');},hide_loader:function(){this.$loader.addClass('hidden');this.$container.removeClass('hidden');},save_friends:function(user_ids){var self=this;var url=this.url.save_list;this.show_loader();new Request.JSON({'url':url+'?&rand='+Math.random(),'method':'post','data':{'format':'json','value':user_ids},onSuccess:function(response){self.$container.set('html',response.html);self.hide_loader();}}).send();}}
var HETips=new Class({Implements:[Events,Options],options:{url:'',ajax:true,cache:true,delay:300,className:'he-tool-tip',id:'he-tool-tip-id',display:'top',htmlElement:'',visibleOnHover:true},elements:null,cache:{},tip:null,timeout:null,block:false,request:null,show:true,initialize:function(elements,options){try{if(Hetips&&!Hetips.isCustomTipsEnabled(elements,options)){return false;}}catch(e){}
this.elements=elements;this.setOptions(options);this.tip=this.getTipBlock();this.bind();},getTipBlock:function(){var self=this;if($(this.options.id)){return $(this.options.id);}
var $container=new Element('div',{'class':self.options.className+' hidden','id':self.options.id,'style':'position:absolute;'});var $header=new Element('div',{'class':'he-tip-title'});var $content=new Element('div',{'class':'he-tip'});var $footer=new Element('div',{'class':'he-tip-footer'});var $clr=new Element('div',{'class':'clr'});$container.appendChild($header);$container.appendChild($content);$container.appendChild($footer);$container.appendChild($clr);$$('body')[0].appendChild($container);return $container;},bind:function(){var self=this;$$(this.elements).each(function($item){self.bindItem($item);});},bindItem:function($item){var self=this;$item=$($item);$item.addEvents({'mouseover':function(){var id=this.id;var element=this;self.show=true;self.timeout=window.setTimeout(function(){self.hint(id,element);},self.options.delay);},'mouseout':function(){window.clearTimeout(self.timeout);self.show=false;self.timeout=window.setTimeout(function(){self.hideTip();},self.options.delay);}});},hint:function(id,element){var self=this;if(this.options.htmlElement){this.show=true;var html=$(element).getParent().getElement(this.options.htmlElement).innerHTML;this.showTip(html,element);this.block=false;return;}
if(this.cache[id]&&this.options.cache){this.show=true;this.showTip(this.cache[id],element);this.block=false;return;}
if(this.block&&this.options.ajax){return;}
this.block=true;self.showTip('',element);this.request=new Request.JSON({'method':'post','url':self.options.url+'?rand='+Math.random(),'data':{'id':id,'format':'json'},onSuccess:function(response){self.cache[id]=response.html;self.showTip(response.html,element);self.block=false;self.fireEvent('onRequestSuccess',[response,element]);}}).send();},getPos:function($element){var data=$($element).getPosition();return data;},showTip:function(html,element){if(html==''){html='<span class="loader_icon">&nbsp;</span>';this.tip.addClass('he_loader');}else{this.tip.removeClass('he_loader');}
this.tip=$(this.tip);element=$(element);var data=this.getPos(element);var x=data.x;var y=data.y;this.tip.getElements('.he-tip')[0].set('html',html);this.tip.style.left=x+'px';this.tip.style.top=y+'px';if(html!=''&&this.show){this.tip.removeClass('hidden');}
this.tip.style.top=(parseInt(this.tip.style.top)-$(this.tip).getSize().y)+'px';var self=this;this.tip.removeEvents('mouseover').removeEvents('mouseout').addEvents({'mouseover':function(){if(self.options.visibleOnHover){window.clearTimeout(self.timeout);}},'mouseout':function(){self.timeout=window.setTimeout(function(){self.hideTip();},self.options.delay);}});this.fireEvent('onShow',[this.tip,element]);},hideTip:function(){this.tip.addClass('hidden');this.fireEvent('onHide',[this.tip]);},getDocHeight:function(){var D=document;return Math.max(Math.max(D.body.scrollHeight,D.documentElement.scrollHeight),Math.max(D.body.offsetHeight,D.documentElement.offsetHeight),Math.max(D.body.clientHeight,D.documentElement.clientHeight));}});
;// Minified by http://closure-compiler.appspot.com/home
var PhotoViewer={is_setup:!1,c:null,is_viewer:!1,last_scroll_top:0,timeout:null,total_count:0,photos:{},album_title:"",album_href:"",owner_title:"",owner_href:"",slideshow_is_stop:!0,slideshow_is_pause:!1,scale:1,move:{top:0,left:0},comments:{},options:{album_id:0,photo_id:0,isPage:0,slideshow_time:3E3,min_scale:1,max_scale:3,scale_step:10},open:function(a){var b=this;this.options.album_id=a.album_id;this.options.photo_id=a.photo_id;this.options.isPage=a.isPage;this.setup();b.last_scroll_top=j(window).scrollTop(); this.viewer();this.reset();b.viewer().addClass("active");setTimeout(function(){j(window).scrollTop(0);j("html").addClass("hideScroll");b.resize();b.loadPhoto()},10);this.old_comments_block=j(".layout_core_comments");this.setIdPrefix(this.old_comments_block)},hide:function(){this.viewer().hasClass("fullmode")?this.fullHide():(this.viewer().removeClass("active"),j("html").removeClass("hideScroll"),j(window).scrollTop(this.last_scroll_top),this.removeIdPrefix(this.old_comments_block))},resize:function(){var a= j(window).width(),b=j(window).height();this.viewer().hasClass("fullmode")?(j("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b),j("#wpPhotoViewer").find(".wpPhoto").css("width",a),j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right",0)):(a-=50,b-=50,j("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b-70),j("#wpPhotoViewer").find(".wpPhoto").css("width",a-400),j("#wpPhotoViewer").find(".wpComments").css("width",400),j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right", 390));j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("line-height",b+"px");0<this.viewer().find(".photos").width()-100*this.total_count?this.viewer().find(".wpPhotoList").addClass("one_col"):this.viewer().find(".wpPhotoList").removeClass("one_col");this.hideOptions()},loadPhoto:function(){var a=this;j.ajax({url:en4.core.baseUrl+"photoviewer",data:{format:"json",photo_id:this.options.photo_id,isPage:this.options.isPage},success:function(b){if(b&&b.photos){a.total_count=b.count;a.album_title=b.album_title; a.album_href=b.album_href;a.owner_title=b.owner_title;a.owner_href=b.owner_href;a.photos={};var d=0,c="";j(b.photos).each(function(b,f){c+='<a href="javascript:void(0);" class="wpPhotoItem" onclick="PhotoViewer.view('+f.photo_id+');" id="wp_'+f.photo_id+'"><img id="fullphoto_'+f.photo_id+'" src="'+f.thumb+'" alt=""/></a>';a.photos[f.photo_id]=f;0==b&&(d=f.photo_id);f.active&&(d=f.photo_id)});a.viewer().find(".wpPhotoList").find(".photos").html(c);a.viewer().find(".wpPhotoList").find(".photos").find("img").load(function(){j(this).addClass("loaded")}); a.viewer().find(".wpPhotoList").find(".count").html(a.total_count);1<a.total_count&&a.viewer().find(".allPhotos").show();a.viewer().find(".goSlideshow").show();a.view(d);a._checkPagination();a.resize()}}})},view:function(a){if(this.photos[a]){var b=this.photos[a];this.viewer().find(".wpPhotoItem").removeClass("active");this.viewer().find("#wp_"+a).addClass("active");var d=this.viewer().find("#wp_"+a).prevAll().length+1,c=this.viewer().find(".wpPhotoContent");c.find(".active").removeClass("active").removeClass("fade"); var e=c.find("#thephoto_"+a);e.length?(e.addClass("active"),setTimeout(function(){e.addClass("fade")},10)):(c.append(j('<div class="thephoto" id="thephoto_'+a+'"><div class="moveElement"><div id="imgPlace_'+a+'"><img src="'+b.src+'" alt=""/></div><span class="photo_options"><a href="javascript:void(0);" class="openfull icon-resize-full" onclick="PhotoViewer.fullOpen();"></a><a href="javascript:void(0);" class="hidefull icon-resize-small" onclick="PhotoViewer.fullHide();"></a></span></div></div>')), e=j("#thephoto_"+a),clearTimeout(this.photo),this.photo=setTimeout(function(){e.addClass("active");setTimeout(function(){e.addClass("fade")},10)},10));this.resize();this.viewer().find(".wpPhotoOptions").find(".info").show();b=this.viewer().find(".wpPhotoOptions").find(".album_info");b.find(".album_title").html('<a href="'+this.album_href+'">'+this.album_title+"</a>");b.find(".album_owner").html(' - <a href="'+this.owner_href+'">'+this.owner_title+"</a>");this.viewer().find(".wpPhotoOptions").find(".count").find(".total").html(this.total_count); this.viewer().find(".wpPhotoOptions").find(".count").find(".current").html(d);this.loadComments(a);this._checkPagination()}},_checkPagination:function(){var a=this.viewer().find(".wpNext"),b=this.viewer().find(".wpPrev");if(2>this.total_count)a.hide(),b.hide();else{var d=this.viewer().find(".wpPhotoItem.active");d.prev().length?b.show():b.hide();d.next().length?a.show():a.hide()}},next:function(a){var b=this.viewer().find(".wpPhotoItem.active");b.next().length?b.next().click():a?a():this.showList(); this._checkPagination()},prev:function(){var a=this.viewer().find(".wpPhotoItem.active");a.prev().length?a.prev().click():this.showList();this._checkPagination()},toggleList:function(){this.viewer().find(".wpPhotoList").hasClass("active")?this.hideList():this.showList()},showList:function(){!(2>this.total_count)&&!this.viewer().hasClass("fullmode")&&(this.viewer().find(".photos").jScrollPane(),this.viewer().find(".wpPhotoList").addClass("active"),this.showOver())},isListActive:function(){return this.viewer().find(".wpPhotoList").hasClass("active")}, hideList:function(){this.viewer().find(".wpPhotoList").removeClass("active");this.hideOver()},loadComments:function(a){var b=this;j("#photo_comment_"+a).length?(b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide()),b.removeIdPrefix(j("#photo_comment_"+a).show())):(this.comment_request&&this.comment_request.abort(),b.showLoading(),this.comment_request=j.ajax({url:en4.core.baseUrl+"photoviewer/index/comments",data:{format:"html",photo_id:a,isPage:this.options.isPage},success:function(d){b.hideLoading(); b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide());var c=j("<div />").attr({id:"photo_comment_"+a,"class":"photo_comment"});c.html(d);b.viewer().find(".wpCommentsContent").append(c);en4.core.runonce.trigger();Smoothbox.bind($("photo_comment_"+a))}}))},setIdPrefix:function(a){a.find("*[id]").not(".iswphprefix").each(function(a,d){j(d).attr("id","wphPrefix"+(1E3*Math.random()).toInt()+"wphEnd"+j(d).attr("id"));j(d).addClass("iswphprefix")})},removeIdPrefix:function(a){a.find(".iswphprefix").each(function(a, d){var c=j(d).attr("id"),e=c.indexOf("wphEnd");-1!==e&&(c=c.substr(e+6),j(d).attr("id",c),j(d).removeClass("iswphprefix"))})},onError:function(a){alert(a)},setup:function(){var a=this;if(!this.is_setup){this.is_setup=!0;j(window).resize(function(){a.resize()});var b="keypress";if(Browser.Engine.trident||Browser.Engine.webkit)b="keydown";j(document).bind(b,function(b){var c=j(b.target).prop("tagName").toLowerCase();"textarea"==c||"input"==c||"select"==c||a.isListActive()||(37==b.keyCode?a.prev():39== b.keyCode?a.next():0!=b.keyCode&&(27==b.keyCode?a.viewer().hasClass("fullmode")?a.fullHide():a.hide():109==b.keyCode||38==b.keyCode?a.zoom(2):(107==b.keyCode||40==b.keyCode)&&a.zoom(-2)))});this.viewer().find(".wpPhoto").mousewheel(function(b){if(!a.viewer().hasClass("tagging_process")){b=b.originalEvent;var c=0;b.wheelDelta&&(c=b.wheelDelta/120);b.detail&&(c=-b.detail/3);a.zoom(c)}});this.viewer().click(function(b){!j(b.target).closest(".external-options").length&&(!j(b.target).hasClass("actions")&& !j(b.target).parent().hasClass("actions"))&&a.hideOptions()});document.addEventListener&&(document.addEventListener("fullscreenchange",function(){},!1),document.addEventListener("mozfullscreenchange",function(){a.fullToggle(document.mozFullScreen)},!1),document.addEventListener("webkitfullscreenchange",function(){a.fullToggle(document.webkitIsFullScreen)},!1))}},fullToggle:function(a){a?this.fullOpen():this.fullHide()},zoom:function(a){if(!this.isListActive())if(a/=this.options.scale_step,this.scale+= a,this.scale<this.options.min_scale)this.viewer().removeClass("zooming"),this.scale-=a;else if(this.scale>this.options.max_scale)this.scale-=a;else if(this.viewer().addClass("zooming"),j("#wpPhotoViewer").find(".wpPhoto").find(".active").css("-moz-transform","scale("+this.scale+")").css("-webkit-transform","scale("+this.scale+")").css("transform","scale("+this.scale+")"),a=this.getInternetExplorerVersion(),7==a||8==a)a=j("#wpPhotoViewer").find(".wpPhoto").find(".active").find("img"),a.data("original-width")|| (a.data("original-width",a.width()),a.data("original-height",a.height())),a.css("width",a.data("original-width")*this.scale).css("height",a.data("original-height")*this.scale)},getInternetExplorerVersion:function(){var a=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1));return a},noZoom:function(a){a?this.viewer().addClass("nozoom"):this.viewer().removeClass("nozoom")},fullOpen:function(){var a=this.viewer(); a.addClass("fullmode");this.resize();a=a[0];a.requestFullScreen&&a.requestFullScreen();a.webkitRequestFullScreen&&a.webkitRequestFullScreen();a.mozRequestFullScreen&&a.mozRequestFullScreen();a.requestFullscreen&&a.requestFullscreen()},fullHide:function(){this.viewer().removeClass("fullmode");this.resize();this.stopSlideshow();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide();document.cancelFullScreen&&document.cancelFullScreen();document.webkitCancelFullScreen&& document.webkitCancelFullScreen();document.mozCancelFullScreen&&document.mozCancelFullScreen();document.exitFullscreen&&document.exitFullscreen()},viewer:function(){var a=this;if(this.is_viewer)return this.c;this.is_viewer=!0;var b=j("<div />");b.attr({id:"wpPhotoViewer","class":"wpPhotoViewer"});b.html(this.getHtmlContent());b.appendTo(j("body"));var d=this.getInternetExplorerVersion();-1!==d&&(b.addClass("wpIe"),b.addClass("wpIe"+d));clearTimeout(a.mouseTimer);b.mouseover(function(){clearTimeout(a.mouseTimer); a.mouseTimer=setTimeout(function(){a.viewer().addClass("mouseActive");clearTimeout(a.mouseTimerOut);a.mouseTimerOut=setTimeout(function(){a.viewer().removeClass("mouseActive")},2E3)},10)});var c=b.find(".wpPhotoContent");c.unbind("mousemove").mousemove(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed&&(clearInterval(a.moving_timer),a.moving_timer=setTimeout(function(){var c=a.move.startClientX-b.clientX,d=a.move.startClientY-b.clientY;a.move.startClientX=b.clientX;a.move.startClientY= b.clientY;a.photoMove(c,d)},1)),!1});c.unbind("mousedown").mousedown(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!0,a.move.startClientX=b.clientX,a.move.startClientY=b.clientY,c.addClass("moving"),!1});c.unbind("mouseup").mouseup(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!1,c.removeClass("moving"),!1});c.unbind("mouseout").mouseout(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!1,c.removeClass("moving"), !1});return this.c=b},photoMove:function(a,b){var d=j("#thephoto_"+this.getActiveId());this.move.top+=1.5*-b;this.move.left+=1.5*-a;d.css("margin-top",this.move.top);d.css("margin-left",this.move.left)},showOver:function(){var a=this;this.viewer().find(".wpOver").show();clearTimeout(this.timeout);this.timeout=setTimeout(function(){a.viewer().find(".wpOver").addClass("active")},100)},hideOver:function(){var a=this;a.viewer().find(".wpOver").removeClass("active");clearTimeout(this.timeout);this.timeout= setTimeout(function(){a.viewer().find(".wpOver").hide()},500)},slideshow:function(){this.fullOpen();this.startSlideshow()},slideshowClose:function(){this.stopSlideshow();this.fullHide();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide()},startSlideshow:function(){var a=this;this.stopSlideshow();this.slideshow_is_pause=this.slideshow_is_stop=!1;this.viewer().addClass("slideshow_process");this.slideshow_timer=setInterval(function(){a.slideshow_is_pause||a.next(function(){a.stopSlideshow()})}, this.options.slideshow_time);this._checkStatusSlideShow()},stopSlideshow:function(){clearInterval(this.slideshow_timer);this.slideshow_is_stop=!0;this._checkStatusSlideShow()},repeatSlideshow:function(){this.viewer().find(".photos").find("a:first").click();this.startSlideshow();this._checkStatusSlideShow()},_checkStatusSlideShow:function(){this.slideshow_is_pause?(this.viewer().find(".wpSlidStart").show(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").hide()):this.slideshow_is_stop? (this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").show()):(this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").show(),this.viewer().find(".wpSlidRepeat").hide())},pauseSlideshow:function(){this.slideshow_is_pause=!0;this._checkStatusSlideShow()},hideOptions:function(){j("#photo_comment_"+this.getActiveId()).find(".external-options").hide()},toggleOptions:function(){var a=j("#photo_comment_"+this.getActiveId()).find(".external-options"); a.toggle();var b=this.viewer().find(".actions").offset();a.css("top",32).css("left",b.left)},getActiveId:function(){var a=this.viewer().find(".photos").find(".active");if(a.length)return a.attr("id").substr(3)},getActive:function(){return this.photos[this.getActiveId()]},getHtmlContent:function(){return'<div class="wpContainer"><a href="javascript:void(0);" class="wpPrev icon-angle-left" onclick="PhotoViewer.prev();" style="display: none;"></a><a href="javascript:void(0);" class="wpNext icon-angle-right" onclick="PhotoViewer.next();" style="display: none;"></a><a href="javascript:void(0);" class="wpClose icon-remove" onclick="PhotoViewer.hide();"></a><div class="wpPhoto"><table width="100%" class="wpPhotoContentTable"><tr><td align="center" valign="center" class="wpPhotoContent"></td></tr></table></div><div class="wpComments"><div class="wpCommentsContent"><div class="photo_comment loadingComments"><div class="layout_page_photoviewer_index_comments"><div class="generic_layout_container layout_main"><span class="loading">'+ en4.core.language.translate("PHOTOVIEWER_loading")+'</span></div></div></div></div></div><div class="wpBar"><div class="wpPhotoList"><div class="title">'+en4.core.language.translate("PHOTOVIEWER_All photos")+'&nbsp;(<span class="count">0</span>)<a href="javascript:void(0);" onclick="PhotoViewer.hideList();" class="wpListClose"><i class="icon-remove"></i></a></div><div class="photos"></div></div><div class="wpPhotoOptions"><div class="leftside"><a href="javascript:void(0);" class="wpbtn wpbtn-inverse allPhotos" onclick="PhotoViewer.toggleList();" style="display: none;">'+ en4.core.language.translate("PHOTOVIEWER_All photos")+'<i class="right icon-caret-up"></i></a><a href="javascript:void(0);" class="wpbtn wpbtn-inverse goSlideshow" onclick="PhotoViewer.slideshow();" style="display: none;">'+en4.core.language.translate("PHOTOVIEWER_Slideshow")+'</a><div class="info" style="display: none;"><div class="album_info"><span class="album_title"></span><span class="album_owner"></span></div><div class="count"><span class="current"></span>&nbsp;'+en4.core.language.translate("PHOTOVIEWER_from")+ '&nbsp;<span class="total"></span></div></div></div></div></div></div><div class="wpSlideshow" style="display: none;"><a href="javascript:void(0);" onclick="PhotoViewer.startSlideshow();" style="display: none;" class="wpSlidStart wpbtn wpbtn-inverse">'+en4.core.language.translate("PHOTOVIEWER_Play")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.pauseSlideshow();" style="display: none;" class="wpSlidPause wpbtn wpbtn-inverse">'+en4.core.language.translate("PHOTOVIEWER_Pause")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.repeatSlideshow();" style="display: none;" class="wpSlidRepeat wpbtn wpbtn-inverse">'+ en4.core.language.translate("PHOTOVIEWER_Repeat")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.slideshowClose();" class="wpSlidClose wpbtn wpbtn-inverse"><i class="icon-remove"></i></a></div><div class="wpOver" onclick="PhotoViewer.hideList();" style="display: none;"></div>'},reset:function(){this.viewer().find(".photos").jScrollPane().data("jsp").destroy();this.viewer().find(".wpOver, .wpNext, .wpPrev, .info, .allPhotos, .goSlideshow, .wpSlideshow, .wpSlidStart, .wpSlidPause, .wpSlidRepeat").hide(); this.viewer().find(".wpPhotoContent, .photos").empty();this.viewer().find(".wpCommentsContent").children().hide();this.viewer().removeClass("fullmode").removeClass("zooming").removeClass("slideshow_process").removeClass("mouseActive");this.viewer().find(".wpPhotoList").removeClass(".one_col");this.viewer().find(".wpCommentsContent").children(".loadingComments").show();return this.viewer()},showLoading:function(){this.viewer().find(".wpCommentsContent").children().hide();this.viewer().find(".wpCommentsContent").children(".loadingComments").show()}, hideLoading:function(){this.viewer().find(".wpCommentsContent").children(".loadingComments").hide()},bindPhotoViewer:function(){j&&j("#global_content").find("a").not(".wp_init").addClass("wp_init").each(function(a,b){var d=j(b).attr("href");if(d&&"javascript:void(0)"!=d){var c=0,e=d.match(/album_id\/([0-9]{0,})\/*\/photo_id\/([0-9]{0,})/i);e||(e=d.match(/content\/pagealbumphoto\/album_id\/([0-9]{0,})\/content_id\/([0-9]{0,})/i),c=1);if(e&&e[0]&&e[1]&&e[2]){d=e[1];e=e[2];$(b).removeEvents();var f= $(b).getElement("img");f&&f.removeEvents("click");j(b).attr("onclick","").data("album_id",d).data("photo_id",e).data("isPage",c).click(function(a){a.stopPropagation();a.preventDefault();PhotoViewer.open({album_id:j(this).data("album_id"),photo_id:j(this).data("photo_id"),isPage:j(this).data("isPage")})})}}})}};