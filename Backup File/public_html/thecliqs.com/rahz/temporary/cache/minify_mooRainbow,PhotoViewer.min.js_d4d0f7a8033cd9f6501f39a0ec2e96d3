var Rainbows=[];var MooRainbow=new Class({options:{id:'mooRainbow',prefix:'moor-',imgPath:'application/modules/Seaocore/externals/images/',startColor:[255,0,0],wheel:false,onComplete:$empty,onChange:$empty},initialize:function(el,options){this.element=$(el);if(!this.element)return;this.setOptions(options);this.sliderPos=0;this.pickerPos={x:0,y:0};this.backupColor=this.options.startColor;this.currentColor=this.options.startColor;this.sets={rgb:[],hsb:[],hex:[]};this.pickerClick=this.sliderClick=false;if(!this.layout)this.doLayout();this.OverlayEvents();this.sliderEvents();this.backupEvent();if(this.options.wheel)this.wheelEvents();this.element.addEvent('click',function(e){this.closeAll().toggle(e);}.bind(this));this.layout.overlay.setStyle('background-color',this.options.startColor.rgbToHex());this.layout.backup.setStyle('background-color',this.backupColor.rgbToHex());this.pickerPos.x=this.snippet('curPos').l+this.snippet('curSize','int').w;this.pickerPos.y=this.snippet('curPos').t+this.snippet('curSize','int').h;this.manualSet(this.options.startColor);this.pickerPos.x=this.snippet('curPos').l+this.snippet('curSize','int').w;this.pickerPos.y=this.snippet('curPos').t+this.snippet('curSize','int').h;this.sliderPos=this.snippet('arrPos')-this.snippet('arrSize','int');if(window.khtml)this.hide();},toggle:function(){this[this.visible?'hide':'show']();},show:function(){this.rePosition();this.layout.setStyle('display','block');this.visible=true;},hide:function(){this.layout.setStyles({'display':'none'});this.visible=false;},closeAll:function(){Rainbows.each(function(obj){obj.hide();});return this;},manualSet:function(color,type){if(!type||(type!='hsb'&&type!='hex'))type='rgb';var rgb,hsb,hex;if(type=='rgb'){rgb=color;hsb=color.rgbToHsb();hex=color.rgbToHex();}
else if(type=='hsb'){hsb=color;rgb=color.hsbToRgb();hex=rgb.rgbToHex();}
else{hex=color;rgb=color.hexToRgb(true);hsb=rgb.rgbToHsb();}
this.setMooRainbow(rgb);this.autoSet(hsb);},autoSet:function(hsb){var curH=this.snippet('curSize','int').h;var curW=this.snippet('curSize','int').w;var oveH=this.layout.overlay.height;var oveW=this.layout.overlay.width;var sliH=this.layout.slider.height;var arwH=this.snippet('arrSize','int');var hue;var posx=Math.round(((oveW*hsb[1])/100)-curW);var posy=Math.round(-((oveH*hsb[2])/100)+oveH-curH);var c=Math.round(((sliH*hsb[0])/360));c=(c==360)?0:c;var position=sliH-c+this.snippet('slider')-arwH;hue=[this.sets.hsb[0],100,100].hsbToRgb().rgbToHex();this.layout.cursor.setStyles({'top':posy,'left':posx});this.layout.arrows.setStyle('top',position);this.layout.overlay.setStyle('background-color',hue);this.sliderPos=this.snippet('arrPos')-arwH;this.pickerPos.x=this.snippet('curPos').l+curW;this.pickerPos.y=this.snippet('curPos').t+curH;},setMooRainbow:function(color,type){if(!type||(type!='hsb'&&type!='hex'))type='rgb';var rgb,hsb,hex;if(type=='rgb'){rgb=color;hsb=color.rgbToHsb();hex=color.rgbToHex();}
else if(type=='hsb'){hsb=color;rgb=color.hsbToRgb();hex=rgb.rgbToHex();}
else{hex=color;rgb=color.hexToRgb();hsb=rgb.rgbToHsb();}
this.sets={rgb:rgb,hsb:hsb,hex:hex};if(!$chk(this.pickerPos.x))
this.autoSet(hsb);this.RedInput.value=rgb[0];this.GreenInput.value=rgb[1];this.BlueInput.value=rgb[2];this.HueInput.value=hsb[0];this.SatuInput.value=hsb[1];this.BrighInput.value=hsb[2];this.hexInput.value=hex;this.currentColor=rgb;this.chooseColor.setStyle('background-color',rgb.rgbToHex());},parseColors:function(x,y,z){var s=Math.round((x*100)/this.layout.overlay.width);var b=100-Math.round((y*100)/this.layout.overlay.height);var h=360-Math.round((z*360)/this.layout.slider.height)+this.snippet('slider')-this.snippet('arrSize','int');h-=this.snippet('arrSize','int');h=(h>=360)?0:(h<0)?0:h;s=(s>100)?100:(s<0)?0:s;b=(b>100)?100:(b<0)?0:b;return[h,s,b];},OverlayEvents:function(){var lim,curH,curW,inputs;curH=this.snippet('curSize','int').h;curW=this.snippet('curSize','int').w;inputs=$A(this.arrRGB).concat(this.arrHSB,this.hexInput);document.addEvent('click',function(){if(this.visible)this.hide(this.layout);}.bind(this));inputs.each(function(el){el.addEvent('keydown',this.eventKeydown.bindWithEvent(this,el));el.addEvent('keyup',this.eventKeyup.bindWithEvent(this,el));},this);[this.element,this.layout].each(function(el){el.addEvents({'click':function(e){new Event(e).stop();},'keyup':function(e){e=new Event(e);if(e.key=='esc'&&this.visible)this.hide(this.layout);}.bind(this)},this);},this);lim={x:[0-curW,(this.layout.overlay.width-curW)],y:[0-curH,(this.layout.overlay.height-curH)]};this.layout.drag=new Drag(this.layout.cursor,{limit:lim,onBeforeStart:this.overlayDrag.bind(this),onStart:this.overlayDrag.bind(this),onDrag:this.overlayDrag.bind(this),snap:0});this.layout.overlay2.addEvent('mousedown',function(e){e=new Event(e);this.layout.cursor.setStyles({'top':e.page.y-this.layout.overlay.getTop()-curH,'left':e.page.x-this.layout.overlay.getLeft()-curW});this.layout.drag.start(e);}.bind(this));this.okButton.addEvent('click',function(){if(this.currentColor==this.options.startColor){this.hide();this.fireEvent('onComplete',[this.sets,this]);}
else{this.backupColor=this.currentColor;this.layout.backup.setStyle('background-color',this.backupColor.rgbToHex());this.hide();this.fireEvent('onComplete',[this.sets,this]);}}.bind(this));this.transp.addEvent('click',function(){this.hide();this.fireEvent('onComplete',['transparent',this]);}.bind(this));},overlayDrag:function(){var curH=this.snippet('curSize','int').h;var curW=this.snippet('curSize','int').w;this.pickerPos.x=this.snippet('curPos').l+curW;this.pickerPos.y=this.snippet('curPos').t+curH;this.setMooRainbow(this.parseColors(this.pickerPos.x,this.pickerPos.y,this.sliderPos),'hsb');this.fireEvent('onChange',[this.sets,this]);},sliderEvents:function(){var arwH=this.snippet('arrSize','int'),lim;lim=[0+this.snippet('slider')-arwH,this.layout.slider.height-arwH+this.snippet('slider')];this.layout.sliderDrag=new Drag(this.layout.arrows,{limit:{y:lim},modifiers:{x:false},onBeforeStart:this.sliderDrag.bind(this),onStart:this.sliderDrag.bind(this),onDrag:this.sliderDrag.bind(this),snap:0});this.layout.slider.addEvent('mousedown',function(e){e=new Event(e);this.layout.arrows.setStyle('top',e.page.y-this.layout.slider.getTop()+this.snippet('slider')-arwH);this.layout.sliderDrag.start(e);}.bind(this));},sliderDrag:function(){var arwH=this.snippet('arrSize','int'),hue;this.sliderPos=this.snippet('arrPos')-arwH;this.setMooRainbow(this.parseColors(this.pickerPos.x,this.pickerPos.y,this.sliderPos),'hsb');hue=[this.sets.hsb[0],100,100].hsbToRgb().rgbToHex();this.layout.overlay.setStyle('background-color',hue);this.fireEvent('onChange',[this.sets,this]);},backupEvent:function(){this.layout.backup.addEvent('click',function(){this.manualSet(this.backupColor);this.fireEvent('onChange',[this.sets,this]);}.bind(this));},wheelEvents:function(){var arrColors=$A(this.arrRGB).extend(this.arrHSB);arrColors.each(function(el){el.addEvents({'mousewheel':this.eventKeys.bindWithEvent(this,el),'keydown':this.eventKeys.bindWithEvent(this,el)});},this);[this.layout.arrows,this.layout.slider].each(function(el){el.addEvents({'mousewheel':this.eventKeys.bindWithEvent(this,[this.arrHSB[0],'slider']),'keydown':this.eventKeys.bindWithEvent(this,[this.arrHSB[0],'slider'])});},this);},eventKeys:function(e,el,id){var wheel,type;id=(!id)?el.id:this.arrHSB[0];if(e.type=='keydown'){if(e.key=='up')wheel=1;else if(e.key=='down')wheel=-1;else return;}else if(e.type==Element.Events.mousewheel.base)wheel=(e.wheel>0)?1:-1;if(this.arrRGB.contains(el))type='rgb';else if(this.arrHSB.contains(el))type='hsb';else type='hsb';if(type=='rgb'){var rgb=this.sets.rgb,hsb=this.sets.hsb,prefix=this.options.prefix,pass;var value=(el.value.toInt()||0)+wheel;value=(value>255)?255:(value<0)?0:value;switch(el.className){case prefix+'rInput':pass=[value,rgb[1],rgb[2]];break;case prefix+'gInput':pass=[rgb[0],value,rgb[2]];break;case prefix+'bInput':pass=[rgb[0],rgb[1],value];break;default:pass=rgb;}
this.manualSet(pass);this.fireEvent('onChange',[this.sets,this]);}else{var rgb=this.sets.rgb,hsb=this.sets.hsb,prefix=this.options.prefix,pass;var value=(el.value.toInt()||0)+wheel;if(el.className.test(/(HueInput)/))value=(value>359)?0:(value<0)?0:value;else value=(value>100)?100:(value<0)?0:value;switch(el.className){case prefix+'HueInput':pass=[value,hsb[1],hsb[2]];break;case prefix+'SatuInput':pass=[hsb[0],value,hsb[2]];break;case prefix+'BrighInput':pass=[hsb[0],hsb[1],value];break;default:pass=hsb;}
this.manualSet(pass,'hsb');this.fireEvent('onChange',[this.sets,this]);}
e.stop();},eventKeydown:function(e,el){var n=e.code,k=e.key;if((!el.className.test(/hexInput/)&&!(n>=48&&n<=57))&&(k!='backspace'&&k!='tab'&&k!='delete'&&k!='left'&&k!='right'))
e.stop();},eventKeyup:function(e,el){var n=e.code,k=e.key,pass,prefix,chr=el.value.charAt(0);if(!$chk(el.value))return;if(el.className.test(/hexInput/)){if(chr!="#"&&el.value.length!=6)return;if(chr=='#'&&el.value.length!=7)return;}else{if(!(n>=48&&n<=57)&&(!['backspace','tab','delete','left','right'].contains(k))&&el.value.length>3)return;}
prefix=this.options.prefix;if(el.className.test(/(rInput|gInput|bInput)/)){if(el.value<0||el.value>255)return;switch(el.className){case prefix+'rInput':pass=[el.value,this.sets.rgb[1],this.sets.rgb[2]];break;case prefix+'gInput':pass=[this.sets.rgb[0],el.value,this.sets.rgb[2]];break;case prefix+'bInput':pass=[this.sets.rgb[0],this.sets.rgb[1],el.value];break;default:pass=this.sets.rgb;}
this.manualSet(pass);this.fireEvent('onChange',[this.sets,this]);}
else if(!el.className.test(/hexInput/)){if(el.className.test(/HueInput/)&&el.value<0||el.value>360)return;else if(el.className.test(/HueInput/)&&el.value==360)el.value=0;else if(el.className.test(/(SatuInput|BrighInput)/)&&el.value<0||el.value>100)return;switch(el.className){case prefix+'HueInput':pass=[el.value,this.sets.hsb[1],this.sets.hsb[2]];break;case prefix+'SatuInput':pass=[this.sets.hsb[0],el.value,this.sets.hsb[2]];break;case prefix+'BrighInput':pass=[this.sets.hsb[0],this.sets.hsb[1],el.value];break;default:pass=this.sets.hsb;}
this.manualSet(pass,'hsb');this.fireEvent('onChange',[this.sets,this]);}else{pass=el.value.hexToRgb(true);if(isNaN(pass[0])||isNaN(pass[1])||isNaN(pass[2]))return;if($chk(pass)){this.manualSet(pass);this.fireEvent('onChange',[this.sets,this]);}}},doLayout:function(){var id=this.options.id,prefix=this.options.prefix;var idPrefix=id+' .'+prefix;this.layout=new Element('div',{'styles':{'display':'block','position':'absolute'},'id':id}).inject(document.body);Rainbows.push(this);var box=new Element('div',{'styles':{'position':'relative'},'class':prefix+'box'}).inject(this.layout);var div=new Element('div',{'styles':{'position':'absolute','overflow':'hidden'},'class':prefix+'overlayBox'}).inject(box);var ar=new Element('div',{'styles':{'position':'absolute','zIndex':1},'class':prefix+'arrows'}).inject(box);ar.width=ar.getStyle('width').toInt();ar.height=ar.getStyle('height').toInt();var ov=new Element('img',{'styles':{'background-color':'#fff','position':'relative','zIndex':2},'src':this.options.imgPath+'moor_woverlay.png','class':prefix+'overlay'}).inject(div);var ov2=new Element('img',{'styles':{'position':'absolute','top':0,'left':0,'zIndex':2},'src':this.options.imgPath+'moor_boverlay.png','class':prefix+'overlay'}).inject(div);if(window.ie6){div.setStyle('overflow','');var src=ov.src;ov.src=this.options.imgPath+'blank.gif';ov.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+src+"', sizingMethod='scale')";src=ov2.src;ov2.src=this.options.imgPath+'blank.gif';ov2.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+src+"', sizingMethod='scale')";}
ov.width=ov2.width=div.getStyle('width').toInt();ov.height=ov2.height=div.getStyle('height').toInt();var cr=new Element('div',{'styles':{'overflow':'hidden','position':'absolute','zIndex':2},'class':prefix+'cursor'}).inject(div);cr.width=cr.getStyle('width').toInt();cr.height=cr.getStyle('height').toInt();var sl=new Element('img',{'styles':{'position':'absolute','z-index':2},'src':this.options.imgPath+'moor_slider.png','class':prefix+'slider'}).inject(box);this.layout.slider=document.getElement('#'+idPrefix+'slider');sl.width=sl.getStyle('width').toInt();sl.height=sl.getStyle('height').toInt();new Element('div',{'styles':{'position':'absolute'},'class':prefix+'colorBox'}).inject(box);new Element('div',{'styles':{'zIndex':2,'position':'absolute'},'class':prefix+'chooseColor'}).inject(box);this.layout.backup=new Element('div',{'styles':{'zIndex':2,'position':'absolute','cursor':'pointer'},'class':prefix+'currentColor'}).inject(box);var R=new Element('label').inject(box).setStyle('position','absolute');var G=R.clone().inject(box).addClass(prefix+'gLabel').appendText('G: ');var B=R.clone().inject(box).addClass(prefix+'bLabel').appendText('B: ');R.appendText('R: ').addClass(prefix+'rLabel');var inputR=new Element('input');var inputG=inputR.clone().inject(G).addClass(prefix+'gInput');var inputB=inputR.clone().inject(B).addClass(prefix+'bInput');inputR.inject(R).addClass(prefix+'rInput');var HU=new Element('label').inject(box).setStyle('position','absolute');var SA=HU.clone().inject(box).addClass(prefix+'SatuLabel').appendText('S: ');var BR=HU.clone().inject(box).addClass(prefix+'BrighLabel').appendText('B: ');HU.appendText('H: ').addClass(prefix+'HueLabel');var inputHU=new Element('input');var inputSA=inputHU.clone().inject(SA).addClass(prefix+'SatuInput');var inputBR=inputHU.clone().inject(BR).addClass(prefix+'BrighInput');inputHU.inject(HU).addClass(prefix+'HueInput');SA.appendText(' %');BR.appendText(' %');new Element('span',{'styles':{'position':'absolute'},'class':prefix+'ballino'}).set('html'," &deg;").injectAfter(HU);var hex=new Element('label').inject(box).setStyle('position','absolute').addClass(prefix+'hexLabel').appendText('#hex: ').adopt(new Element('input').addClass(prefix+'hexInput'));var ok=new Element('input',{'styles':{'position':'absolute'},'type':'button','value':'Select','class':prefix+'okButton'}).inject(box);var transp=new Element('a',{'style':{'position':'absolute'},'href':'#','class':prefix+'transp'}).inject(box);this.rePosition();var overlays=$$('#'+idPrefix+'overlay');this.layout.overlay=overlays[0];this.layout.overlay2=overlays[1];this.layout.cursor=document.getElement('#'+idPrefix+'cursor');this.layout.arrows=document.getElement('#'+idPrefix+'arrows');this.chooseColor=document.getElement('#'+idPrefix+'chooseColor');this.layout.backup=document.getElement('#'+idPrefix+'currentColor');this.RedInput=document.getElement('#'+idPrefix+'rInput');this.GreenInput=document.getElement('#'+idPrefix+'gInput');this.BlueInput=document.getElement('#'+idPrefix+'bInput');this.HueInput=document.getElement('#'+idPrefix+'HueInput');this.SatuInput=document.getElement('#'+idPrefix+'SatuInput');this.BrighInput=document.getElement('#'+idPrefix+'BrighInput');this.hexInput=document.getElement('#'+idPrefix+'hexInput');this.arrRGB=[this.RedInput,this.GreenInput,this.BlueInput];this.arrHSB=[this.HueInput,this.SatuInput,this.BrighInput];this.okButton=document.getElement('#'+idPrefix+'okButton');this.transp=box.getElement('.'+prefix+'transp');if(!window.khtml)this.hide();},rePosition:function(){var coords=this.element.getCoordinates();this.layout.setStyles({'left':coords.left,'top':coords.top+coords.height+1});},snippet:function(mode,type){var size;type=(type)?type:'none';switch(mode){case'arrPos':var t=this.layout.arrows.getStyle('top').toInt();size=t;break;case'arrSize':var h=this.layout.arrows.height;h=(type=='int')?(h/2).toInt():h;size=h;break;case'curPos':var l=this.layout.cursor.getStyle('left').toInt();var t=this.layout.cursor.getStyle('top').toInt();size={'l':l,'t':t};break;case'slider':var t=this.layout.slider.getStyle('marginTop').toInt();size=t;break;default:var h=this.layout.cursor.height;var w=this.layout.cursor.width;h=(type=='int')?(h/2).toInt():h;w=(type=='int')?(w/2).toInt():w;size={w:w,h:h};};return size;}});MooRainbow.implement(new Options);MooRainbow.implement(new Events);function hexcolorTonumbercolor(hexcolor){var hexcolorAlphabets="0123456789ABCDEF";var valueNumber=new Array(3);var j=0;if(hexcolor.charAt(0)=="#")
hexcolor=hexcolor.slice(1);hexcolor=hexcolor.toUpperCase();for(var i=0;i<6;i+=2){valueNumber[j]=(hexcolorAlphabets.indexOf(hexcolor.charAt(i))*16)+hexcolorAlphabets.indexOf(hexcolor.charAt(i+1));j++;}
return(valueNumber);}
;// Minified by http://closure-compiler.appspot.com/home
var PhotoViewer={is_setup:!1,c:null,is_viewer:!1,last_scroll_top:0,timeout:null,total_count:0,photos:{},album_title:"",album_href:"",owner_title:"",owner_href:"",slideshow_is_stop:!0,slideshow_is_pause:!1,scale:1,move:{top:0,left:0},comments:{},options:{album_id:0,photo_id:0,isPage:0,slideshow_time:3E3,min_scale:1,max_scale:3,scale_step:10},open:function(a){var b=this;this.options.album_id=a.album_id;this.options.photo_id=a.photo_id;this.options.isPage=a.isPage;this.setup();b.last_scroll_top=j(window).scrollTop(); this.viewer();this.reset();b.viewer().addClass("active");setTimeout(function(){j(window).scrollTop(0);j("html").addClass("hideScroll");b.resize();b.loadPhoto()},10);this.old_comments_block=j(".layout_core_comments");this.setIdPrefix(this.old_comments_block)},hide:function(){this.viewer().hasClass("fullmode")?this.fullHide():(this.viewer().removeClass("active"),j("html").removeClass("hideScroll"),j(window).scrollTop(this.last_scroll_top),this.removeIdPrefix(this.old_comments_block))},resize:function(){var a= j(window).width(),b=j(window).height();this.viewer().hasClass("fullmode")?(j("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b),j("#wpPhotoViewer").find(".wpPhoto").css("width",a),j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right",0)):(a-=50,b-=50,j("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b-70),j("#wpPhotoViewer").find(".wpPhoto").css("width",a-400),j("#wpPhotoViewer").find(".wpComments").css("width",400),j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right", 390));j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("line-height",b+"px");0<this.viewer().find(".photos").width()-100*this.total_count?this.viewer().find(".wpPhotoList").addClass("one_col"):this.viewer().find(".wpPhotoList").removeClass("one_col");this.hideOptions()},loadPhoto:function(){var a=this;j.ajax({url:en4.core.baseUrl+"photoviewer",data:{format:"json",photo_id:this.options.photo_id,isPage:this.options.isPage},success:function(b){if(b&&b.photos){a.total_count=b.count;a.album_title=b.album_title; a.album_href=b.album_href;a.owner_title=b.owner_title;a.owner_href=b.owner_href;a.photos={};var d=0,c="";j(b.photos).each(function(b,f){c+='<a href="javascript:void(0);" class="wpPhotoItem" onclick="PhotoViewer.view('+f.photo_id+');" id="wp_'+f.photo_id+'"><img id="fullphoto_'+f.photo_id+'" src="'+f.thumb+'" alt=""/></a>';a.photos[f.photo_id]=f;0==b&&(d=f.photo_id);f.active&&(d=f.photo_id)});a.viewer().find(".wpPhotoList").find(".photos").html(c);a.viewer().find(".wpPhotoList").find(".photos").find("img").load(function(){j(this).addClass("loaded")}); a.viewer().find(".wpPhotoList").find(".count").html(a.total_count);1<a.total_count&&a.viewer().find(".allPhotos").show();a.viewer().find(".goSlideshow").show();a.view(d);a._checkPagination();a.resize()}}})},view:function(a){if(this.photos[a]){var b=this.photos[a];this.viewer().find(".wpPhotoItem").removeClass("active");this.viewer().find("#wp_"+a).addClass("active");var d=this.viewer().find("#wp_"+a).prevAll().length+1,c=this.viewer().find(".wpPhotoContent");c.find(".active").removeClass("active").removeClass("fade"); var e=c.find("#thephoto_"+a);e.length?(e.addClass("active"),setTimeout(function(){e.addClass("fade")},10)):(c.append(j('<div class="thephoto" id="thephoto_'+a+'"><div class="moveElement"><div id="imgPlace_'+a+'"><img src="'+b.src+'" alt=""/></div><span class="photo_options"><a href="javascript:void(0);" class="openfull icon-resize-full" onclick="PhotoViewer.fullOpen();"></a><a href="javascript:void(0);" class="hidefull icon-resize-small" onclick="PhotoViewer.fullHide();"></a></span></div></div>')), e=j("#thephoto_"+a),clearTimeout(this.photo),this.photo=setTimeout(function(){e.addClass("active");setTimeout(function(){e.addClass("fade")},10)},10));this.resize();this.viewer().find(".wpPhotoOptions").find(".info").show();b=this.viewer().find(".wpPhotoOptions").find(".album_info");b.find(".album_title").html('<a href="'+this.album_href+'">'+this.album_title+"</a>");b.find(".album_owner").html(' - <a href="'+this.owner_href+'">'+this.owner_title+"</a>");this.viewer().find(".wpPhotoOptions").find(".count").find(".total").html(this.total_count); this.viewer().find(".wpPhotoOptions").find(".count").find(".current").html(d);this.loadComments(a);this._checkPagination()}},_checkPagination:function(){var a=this.viewer().find(".wpNext"),b=this.viewer().find(".wpPrev");if(2>this.total_count)a.hide(),b.hide();else{var d=this.viewer().find(".wpPhotoItem.active");d.prev().length?b.show():b.hide();d.next().length?a.show():a.hide()}},next:function(a){var b=this.viewer().find(".wpPhotoItem.active");b.next().length?b.next().click():a?a():this.showList(); this._checkPagination()},prev:function(){var a=this.viewer().find(".wpPhotoItem.active");a.prev().length?a.prev().click():this.showList();this._checkPagination()},toggleList:function(){this.viewer().find(".wpPhotoList").hasClass("active")?this.hideList():this.showList()},showList:function(){!(2>this.total_count)&&!this.viewer().hasClass("fullmode")&&(this.viewer().find(".photos").jScrollPane(),this.viewer().find(".wpPhotoList").addClass("active"),this.showOver())},isListActive:function(){return this.viewer().find(".wpPhotoList").hasClass("active")}, hideList:function(){this.viewer().find(".wpPhotoList").removeClass("active");this.hideOver()},loadComments:function(a){var b=this;j("#photo_comment_"+a).length?(b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide()),b.removeIdPrefix(j("#photo_comment_"+a).show())):(this.comment_request&&this.comment_request.abort(),b.showLoading(),this.comment_request=j.ajax({url:en4.core.baseUrl+"photoviewer/index/comments",data:{format:"html",photo_id:a,isPage:this.options.isPage},success:function(d){b.hideLoading(); b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide());var c=j("<div />").attr({id:"photo_comment_"+a,"class":"photo_comment"});c.html(d);b.viewer().find(".wpCommentsContent").append(c);en4.core.runonce.trigger();Smoothbox.bind($("photo_comment_"+a))}}))},setIdPrefix:function(a){a.find("*[id]").not(".iswphprefix").each(function(a,d){j(d).attr("id","wphPrefix"+(1E3*Math.random()).toInt()+"wphEnd"+j(d).attr("id"));j(d).addClass("iswphprefix")})},removeIdPrefix:function(a){a.find(".iswphprefix").each(function(a, d){var c=j(d).attr("id"),e=c.indexOf("wphEnd");-1!==e&&(c=c.substr(e+6),j(d).attr("id",c),j(d).removeClass("iswphprefix"))})},onError:function(a){alert(a)},setup:function(){var a=this;if(!this.is_setup){this.is_setup=!0;j(window).resize(function(){a.resize()});var b="keypress";if(Browser.Engine.trident||Browser.Engine.webkit)b="keydown";j(document).bind(b,function(b){var c=j(b.target).prop("tagName").toLowerCase();"textarea"==c||"input"==c||"select"==c||a.isListActive()||(37==b.keyCode?a.prev():39== b.keyCode?a.next():0!=b.keyCode&&(27==b.keyCode?a.viewer().hasClass("fullmode")?a.fullHide():a.hide():109==b.keyCode||38==b.keyCode?a.zoom(2):(107==b.keyCode||40==b.keyCode)&&a.zoom(-2)))});this.viewer().find(".wpPhoto").mousewheel(function(b){if(!a.viewer().hasClass("tagging_process")){b=b.originalEvent;var c=0;b.wheelDelta&&(c=b.wheelDelta/120);b.detail&&(c=-b.detail/3);a.zoom(c)}});this.viewer().click(function(b){!j(b.target).closest(".external-options").length&&(!j(b.target).hasClass("actions")&& !j(b.target).parent().hasClass("actions"))&&a.hideOptions()});document.addEventListener&&(document.addEventListener("fullscreenchange",function(){},!1),document.addEventListener("mozfullscreenchange",function(){a.fullToggle(document.mozFullScreen)},!1),document.addEventListener("webkitfullscreenchange",function(){a.fullToggle(document.webkitIsFullScreen)},!1))}},fullToggle:function(a){a?this.fullOpen():this.fullHide()},zoom:function(a){if(!this.isListActive())if(a/=this.options.scale_step,this.scale+= a,this.scale<this.options.min_scale)this.viewer().removeClass("zooming"),this.scale-=a;else if(this.scale>this.options.max_scale)this.scale-=a;else if(this.viewer().addClass("zooming"),j("#wpPhotoViewer").find(".wpPhoto").find(".active").css("-moz-transform","scale("+this.scale+")").css("-webkit-transform","scale("+this.scale+")").css("transform","scale("+this.scale+")"),a=this.getInternetExplorerVersion(),7==a||8==a)a=j("#wpPhotoViewer").find(".wpPhoto").find(".active").find("img"),a.data("original-width")|| (a.data("original-width",a.width()),a.data("original-height",a.height())),a.css("width",a.data("original-width")*this.scale).css("height",a.data("original-height")*this.scale)},getInternetExplorerVersion:function(){var a=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1));return a},noZoom:function(a){a?this.viewer().addClass("nozoom"):this.viewer().removeClass("nozoom")},fullOpen:function(){var a=this.viewer(); a.addClass("fullmode");this.resize();a=a[0];a.requestFullScreen&&a.requestFullScreen();a.webkitRequestFullScreen&&a.webkitRequestFullScreen();a.mozRequestFullScreen&&a.mozRequestFullScreen();a.requestFullscreen&&a.requestFullscreen()},fullHide:function(){this.viewer().removeClass("fullmode");this.resize();this.stopSlideshow();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide();document.cancelFullScreen&&document.cancelFullScreen();document.webkitCancelFullScreen&& document.webkitCancelFullScreen();document.mozCancelFullScreen&&document.mozCancelFullScreen();document.exitFullscreen&&document.exitFullscreen()},viewer:function(){var a=this;if(this.is_viewer)return this.c;this.is_viewer=!0;var b=j("<div />");b.attr({id:"wpPhotoViewer","class":"wpPhotoViewer"});b.html(this.getHtmlContent());b.appendTo(j("body"));var d=this.getInternetExplorerVersion();-1!==d&&(b.addClass("wpIe"),b.addClass("wpIe"+d));clearTimeout(a.mouseTimer);b.mouseover(function(){clearTimeout(a.mouseTimer); a.mouseTimer=setTimeout(function(){a.viewer().addClass("mouseActive");clearTimeout(a.mouseTimerOut);a.mouseTimerOut=setTimeout(function(){a.viewer().removeClass("mouseActive")},2E3)},10)});var c=b.find(".wpPhotoContent");c.unbind("mousemove").mousemove(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed&&(clearInterval(a.moving_timer),a.moving_timer=setTimeout(function(){var c=a.move.startClientX-b.clientX,d=a.move.startClientY-b.clientY;a.move.startClientX=b.clientX;a.move.startClientY= b.clientY;a.photoMove(c,d)},1)),!1});c.unbind("mousedown").mousedown(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!0,a.move.startClientX=b.clientX,a.move.startClientY=b.clientY,c.addClass("moving"),!1});c.unbind("mouseup").mouseup(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!1,c.removeClass("moving"),!1});c.unbind("mouseout").mouseout(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!1,c.removeClass("moving"), !1});return this.c=b},photoMove:function(a,b){var d=j("#thephoto_"+this.getActiveId());this.move.top+=1.5*-b;this.move.left+=1.5*-a;d.css("margin-top",this.move.top);d.css("margin-left",this.move.left)},showOver:function(){var a=this;this.viewer().find(".wpOver").show();clearTimeout(this.timeout);this.timeout=setTimeout(function(){a.viewer().find(".wpOver").addClass("active")},100)},hideOver:function(){var a=this;a.viewer().find(".wpOver").removeClass("active");clearTimeout(this.timeout);this.timeout= setTimeout(function(){a.viewer().find(".wpOver").hide()},500)},slideshow:function(){this.fullOpen();this.startSlideshow()},slideshowClose:function(){this.stopSlideshow();this.fullHide();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide()},startSlideshow:function(){var a=this;this.stopSlideshow();this.slideshow_is_pause=this.slideshow_is_stop=!1;this.viewer().addClass("slideshow_process");this.slideshow_timer=setInterval(function(){a.slideshow_is_pause||a.next(function(){a.stopSlideshow()})}, this.options.slideshow_time);this._checkStatusSlideShow()},stopSlideshow:function(){clearInterval(this.slideshow_timer);this.slideshow_is_stop=!0;this._checkStatusSlideShow()},repeatSlideshow:function(){this.viewer().find(".photos").find("a:first").click();this.startSlideshow();this._checkStatusSlideShow()},_checkStatusSlideShow:function(){this.slideshow_is_pause?(this.viewer().find(".wpSlidStart").show(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").hide()):this.slideshow_is_stop? (this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").show()):(this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").show(),this.viewer().find(".wpSlidRepeat").hide())},pauseSlideshow:function(){this.slideshow_is_pause=!0;this._checkStatusSlideShow()},hideOptions:function(){j("#photo_comment_"+this.getActiveId()).find(".external-options").hide()},toggleOptions:function(){var a=j("#photo_comment_"+this.getActiveId()).find(".external-options"); a.toggle();var b=this.viewer().find(".actions").offset();a.css("top",32).css("left",b.left)},getActiveId:function(){var a=this.viewer().find(".photos").find(".active");if(a.length)return a.attr("id").substr(3)},getActive:function(){return this.photos[this.getActiveId()]},getHtmlContent:function(){return'<div class="wpContainer"><a href="javascript:void(0);" class="wpPrev icon-angle-left" onclick="PhotoViewer.prev();" style="display: none;"></a><a href="javascript:void(0);" class="wpNext icon-angle-right" onclick="PhotoViewer.next();" style="display: none;"></a><a href="javascript:void(0);" class="wpClose icon-remove" onclick="PhotoViewer.hide();"></a><div class="wpPhoto"><table width="100%" class="wpPhotoContentTable"><tr><td align="center" valign="center" class="wpPhotoContent"></td></tr></table></div><div class="wpComments"><div class="wpCommentsContent"><div class="photo_comment loadingComments"><div class="layout_page_photoviewer_index_comments"><div class="generic_layout_container layout_main"><span class="loading">'+ en4.core.language.translate("PHOTOVIEWER_loading")+'</span></div></div></div></div></div><div class="wpBar"><div class="wpPhotoList"><div class="title">'+en4.core.language.translate("PHOTOVIEWER_All photos")+'&nbsp;(<span class="count">0</span>)<a href="javascript:void(0);" onclick="PhotoViewer.hideList();" class="wpListClose"><i class="icon-remove"></i></a></div><div class="photos"></div></div><div class="wpPhotoOptions"><div class="leftside"><a href="javascript:void(0);" class="wpbtn wpbtn-inverse allPhotos" onclick="PhotoViewer.toggleList();" style="display: none;">'+ en4.core.language.translate("PHOTOVIEWER_All photos")+'<i class="right icon-caret-up"></i></a><a href="javascript:void(0);" class="wpbtn wpbtn-inverse goSlideshow" onclick="PhotoViewer.slideshow();" style="display: none;">'+en4.core.language.translate("PHOTOVIEWER_Slideshow")+'</a><div class="info" style="display: none;"><div class="album_info"><span class="album_title"></span><span class="album_owner"></span></div><div class="count"><span class="current"></span>&nbsp;'+en4.core.language.translate("PHOTOVIEWER_from")+ '&nbsp;<span class="total"></span></div></div></div></div></div></div><div class="wpSlideshow" style="display: none;"><a href="javascript:void(0);" onclick="PhotoViewer.startSlideshow();" style="display: none;" class="wpSlidStart wpbtn wpbtn-inverse">'+en4.core.language.translate("PHOTOVIEWER_Play")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.pauseSlideshow();" style="display: none;" class="wpSlidPause wpbtn wpbtn-inverse">'+en4.core.language.translate("PHOTOVIEWER_Pause")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.repeatSlideshow();" style="display: none;" class="wpSlidRepeat wpbtn wpbtn-inverse">'+ en4.core.language.translate("PHOTOVIEWER_Repeat")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.slideshowClose();" class="wpSlidClose wpbtn wpbtn-inverse"><i class="icon-remove"></i></a></div><div class="wpOver" onclick="PhotoViewer.hideList();" style="display: none;"></div>'},reset:function(){this.viewer().find(".photos").jScrollPane().data("jsp").destroy();this.viewer().find(".wpOver, .wpNext, .wpPrev, .info, .allPhotos, .goSlideshow, .wpSlideshow, .wpSlidStart, .wpSlidPause, .wpSlidRepeat").hide(); this.viewer().find(".wpPhotoContent, .photos").empty();this.viewer().find(".wpCommentsContent").children().hide();this.viewer().removeClass("fullmode").removeClass("zooming").removeClass("slideshow_process").removeClass("mouseActive");this.viewer().find(".wpPhotoList").removeClass(".one_col");this.viewer().find(".wpCommentsContent").children(".loadingComments").show();return this.viewer()},showLoading:function(){this.viewer().find(".wpCommentsContent").children().hide();this.viewer().find(".wpCommentsContent").children(".loadingComments").show()}, hideLoading:function(){this.viewer().find(".wpCommentsContent").children(".loadingComments").hide()},bindPhotoViewer:function(){j&&j("#global_content").find("a").not(".wp_init").addClass("wp_init").each(function(a,b){var d=j(b).attr("href");if(d&&"javascript:void(0)"!=d){var c=0,e=d.match(/album_id\/([0-9]{0,})\/*\/photo_id\/([0-9]{0,})/i);e||(e=d.match(/content\/pagealbumphoto\/album_id\/([0-9]{0,})\/content_id\/([0-9]{0,})/i),c=1);if(e&&e[0]&&e[1]&&e[2]){d=e[1];e=e[2];$(b).removeEvents();var f= $(b).getElement("img");f&&f.removeEvents("click");j(b).attr("onclick","").data("album_id",d).data("photo_id",e).data("isPage",c).click(function(a){a.stopPropagation();a.preventDefault();PhotoViewer.open({album_id:j(this).data("album_id"),photo_id:j(this).data("photo_id"),isPage:j(this).data("isPage")})})}}})}};