(function(){var $='id'in document?document.id:window.$;en4.activity={load:function(next_id,subject_guid){if(en4.core.request.isRequestActive())return;$('feed_viewmore').style.display='none';$('feed_loading').style.display='';en4.core.request.send(new Request.HTML({url:en4.core.baseUrl+'activity/widget/feed',data:{'maxid':next_id,'feedOnly':true,'nolayout':true,'subject':subject_guid}}),{'element':$('activity-feed'),'updateHtmlMode':'append'});},like:function(action_id,comment_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/index/like',data:{format:'json',action_id:action_id,comment_id:comment_id,subject:en4.core.subject.guid}}),{'element':$('comment-likes-activity-item-'+action_id),'updateHtmlMode':'comments2'});},unlike:function(action_id,comment_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/index/unlike',data:{format:'json',action_id:action_id,comment_id:comment_id,subject:en4.core.subject.guid}}),{'element':$('comment-likes-activity-item-'+action_id),'updateHtmlMode':'comments2'});},comment:function(action_id,body){if(body.trim()=='')
{return;}
en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/index/comment',data:{format:'json',action_id:action_id,body:body,subject:en4.core.subject.guid}}),{'element':$('comment-likes-activity-item-'+action_id),'updateHtmlMode':'comments2'});},attachComment:function(formElement){var bind=this;formElement.addEvent('submit',function(event){event.stop();bind.comment(formElement.action_id.value,formElement.body.value);});},viewComments:function(action_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/index/viewComment',data:{format:'json',action_id:action_id,nolist:true}}),{'element':$('activity-item-'+action_id),'updateHtmlMode':'comments'});},viewLikes:function(action_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/index/viewLike',data:{format:'json',action_id:action_id,nolist:true}}),{'element':$('activity-item-'+action_id),'updateHtmlMode':'comments'});},hideNotifications:function(reset_text){en4.core.request.send(new Request.JSON({'url':en4.core.baseUrl+'activity/notifications/hide'}));$('updates_toggle').set('html',reset_text).removeClass('new_updates');if($('notifications_main')){var notification_children=$('notifications_main').getChildren('li');notification_children.each(function(el){el.setAttribute('class','');});}
if($('notifications_menu')){var notification_children=$('notifications_menu').getChildren('li');notification_children.each(function(el){el.setAttribute('class','');});}},updateNotifications:function(){if(en4.core.request.isRequestActive())return;en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/notifications/update',data:{format:'json'},onSuccess:this.showNotifications.bind(this)}));},showNotifications:function(responseJSON){if(responseJSON.notificationCount>0){$('updates_toggle').set('html',responseJSON.text).addClass('new_updates');}},markRead:function(action_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/notifications/test',data:{format:'json','actionid':action_id}}));},cometNotify:function(responseObject){$('core_menu_mini_menu_updates').style.display='';$('core_menu_mini_menu_updates_count').innerHTML=responseObject.text;}};NotificationUpdateHandler=new Class({Implements:[Events,Options],options:{debug:false,baseUrl:'/',identity:false,delay:5000,minDelay:5000,maxDelay:600000,delayFactor:1.5,admin:false,idleTimeout:600000,last_id:0,subject_guid:null},state:true,activestate:1,fresh:true,lastEventTime:false,title:document.title,initialize:function(options){this.setOptions(options);this.options.minDelay=this.options.delay;},start:function(){this.state=true;this.idleWatcher=new IdleWatcher(this,{timeout:this.options.idleTimeout});this.idleWatcher.register();this.addEvents({'onStateActive':function(){this.activestate=1;this.state=true;}.bind(this),'onStateIdle':function(){this.activestate=0;this.state=false;}.bind(this)});this.loop();},stop:function(){this.state=false;},updateNotifications:function(){if(en4.core.request.isRequestActive())return;en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/notifications/update',data:{format:'json'},onSuccess:this.showNotifications.bind(this)}));},showNotifications:function(responseJSON){if(responseJSON.notificationCount>0){this.options.delay=this.options.minDelay;$('updates_toggle').set('html',responseJSON.text).addClass('new_updates');}else{this.options.delay=Math.min(this.options.maxDelay,this.options.delayFactor*this.options.delay);}},loop:function(){if(!this.state){this.loop.delay(this.options.delay,this);return;}
try{this.updateNotifications().addEvent('complete',function(){this.loop.delay(this.options.delay,this);}.bind(this));}catch(e){this.loop.delay(this.options.delay,this);this._log(e);}},_log:function(object){if(!this.options.debug){return;}
try{if(typeof(console)&&$type(console)){console.log(object);}}catch(e){}}});en4.activity.compose={composers:{},register:function(object){name=object.getName();this.composers[name]=object;},deactivate:function(){for(var x in this.composers){this.composers[x].deactivate();}
return this;}};en4.activity.compose.icompose=new Class({Implements:[Events,Options],name:false,element:false,options:{},initialize:function(element,options){this.element=$(element);this.setOptions(options);},getName:function(){return this.name;},activate:function(){en4.activity.compose.deactivate();},deactivate:function(){}});ActivityUpdateHandler=new Class({Implements:[Events,Options],options:{debug:true,baseUrl:'/',identity:false,delay:5000,admin:false,idleTimeout:600000,last_id:0,next_id:null,subject_guid:null,showImmediately:false},state:true,activestate:1,fresh:true,lastEventTime:false,title:document.title,initialize:function(options){this.setOptions(options);},start:function(){this.state=true;this.idleWatcher=new IdleWatcher(this,{timeout:this.options.idleTimeout});this.idleWatcher.register();this.addEvents({'onStateActive':function(){this._log('activity loop onStateActive');this.activestate=1;this.state=true;}.bind(this),'onStateIdle':function(){this._log('activity loop onStateIdle');this.activestate=0;this.state=false;}.bind(this)});this.loop();},stop:function(){this.state=false;},checkFeedUpdate:function(action_id,subject_guid){if(en4.core.request.isRequestActive())return;function getAllElementsWithAttribute(attribute){var matchingElements=[];var values=[];var allElements=document.getElementsByTagName('*');for(var i=0;i<allElements.length;i++){if(allElements[i].getAttribute(attribute)){matchingElements.push(allElements[i]);values.push(allElements[i].getAttribute(attribute));}}
return values;}
var list=getAllElementsWithAttribute('data-activity-feed-item');this.options.last_id=Math.max.apply(Math,list);min_id=this.options.last_id+1;var req=new Request.HTML({url:en4.core.baseUrl+'widget/index/name/activity.feed',data:{'format':'html','minid':min_id,'feedOnly':true,'nolayout':true,'subject':this.options.subject_guid,'getUpdate':true}});en4.core.request.send(req,{'element':$('activity-feed'),'updateHtmlMode':'prepend'});req.addEvent('complete',function(){(function(){if(this.options.showImmediately&&$('feed-update').getChildren().length>0){$('feed-update').setStyle('display','none');$('feed-update').empty();this.getFeedUpdate(this.options.next_id);}}).delay(50,this);}.bind(this));if(localStorage){var pageTitle=document.title;var feed=document.getElementById('activity-feed');var items=feed.getElementsByTagName("li");var itemObject={};var c=0;for(var i=0;i<items.length;++i){if(items[i].getAttribute('data-activity-feed-item')!=null){var itemId=items[i].getAttribute('data-activity-feed-item');itemObject[c]={id:itemId,content:document.getElementById('activity-item-'+itemId).innerHTML};c++;}}
var activityFeedJSON=JSON.stringify(itemObject);localStorage.setItem(pageTitle+'-activity-feed-widget',activityFeedJSON);}
if(localStorage.getItem(pageTitle+'-activity-feed-widget')){var storedFeedJSON=localStorage.getItem(pageTitle+'-activity-feed-widget');var storedObj=eval("("+storedFeedJSON+")");}
return req;},getFeedUpdate:function(last_id){if(en4.core.request.isRequestActive())return;var min_id=this.options.last_id+1;this.options.last_id=last_id;document.title=this.title;var req=new Request.HTML({url:en4.core.baseUrl+'widget/index/name/activity.feed',data:{'format':'html','minid':min_id,'feedOnly':true,'nolayout':true,'getUpdate':true,'subject':this.options.subject_guid}});en4.core.request.send(req,{'element':$('activity-feed'),'updateHtmlMode':'prepend'});return req;},loop:function(){this._log('activity update loop start');if(!this.state){this.loop.delay(this.options.delay,this);return;}
try{this.checkFeedUpdate().addEvent('complete',function(){try{this._log('activity loop req complete');this.loop.delay(this.options.delay,this);}catch(e){this.loop.delay(this.options.delay,this);this._log(e);}}.bind(this));}catch(e){this.loop.delay(this.options.delay,this);this._log(e);}
this._log('activity update loop stop');},_log:function(object){if(!this.options.debug){return;}
try{if('console'in window&&typeof(console)&&'log'in console){console.log(object);}}catch(e){}}});})();;var my_location={my_lat:'',my_lon:'',my_request:'',my_map:'',my_url:'',my_marker:'',my_location_page_num:1,my_location_address:'',init:function(myurl){var self=this;self.my_url=myurl;self.my_map=new google.maps.Map(document.getElementById("my_map_canvas"),{mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:false,center:new google.maps.LatLng(37.0902400,-95.7128910),zoom:3});self.my_marker=new google.maps.Marker({map:self.my_map,animation:google.maps.Animation.BOUNCE,html:'My Location!',title:'My Location!'});},show_pages:function(markers,bounds){var self=this;var marker;if(markers.length==0){return false;}
var infoWindow=new google.maps.InfoWindow({content:''});for(var i=0;i<markers.length;i++)
{marker=markers[i];var point=new google.maps.LatLng(marker.lat,marker.lng);var marker_obj=new google.maps.Marker({position:point,map:self.my_map});marker_obj.html='<table width="500px"><tr valign="top"><td width="110px"><img src="'+marker.pages_photo+'" width="100"></td><td width="400px"><h3 style="margin-top:0; margin-bottom:6px;"><a href="'+marker.url+'">'+marker.title+'</a></h3>'+marker.desc+'</td></tr></table>';if(!marker.desc){marker.desc='';}
google.maps.event.addListener(marker_obj,'click',function(){infoWindow.setContent(this.html);infoWindow.open(self.my_map,this);});}
self.my_map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));self.my_map.setZoom(4);if(bounds&&bounds.min_lat&&bounds.max_lng&&bounds.min_lat&&bounds.max_lng){var bds=new google.maps.LatLngBounds(new google.maps.LatLng(bounds.min_lat,bounds.min_lng),new google.maps.LatLng(bounds.max_lat,bounds.max_lng));}
if(bounds&&bounds.map_center_lat&&bounds.map_center_lng){self.my_map.setCenter(new google.maps.LatLng(bounds.map_center_lat,bounds.map_center_lng));self.my_map.setZoom(4);}else{self.my_map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));self.my_map.setZoom(this.zoom);}
if(bds){self.my_map.fitBounds(bds);}},set_my_marker:function(latitude,longitude){var self=this;self.my_lat=latitude;self.my_lon=longitude;var point=new google.maps.LatLng(self.my_lat,self.my_lon);self.my_marker.setPosition(point);self.my_map.setCenter(point);var infoWindow=new google.maps.InfoWindow({content:''});google.maps.event.addListener(self.my_marker,'click',function(){infoWindow.setContent(this.html);infoWindow.open(self.my_map,this);});},get_geolocation:function(){var self=this;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){self.set_my_marker(position.coords.latitude,position.coords.longitude);self.get_pages();});}
else{alert('Your browser does not support geolocation api');}},set_my_location_page:function(page_num){this.my_location_page_num=page_num;this.get_pages();},set_my_location_address:function(address)
{this.my_location_address=address;this.my_location_page_num=1;this.get_pages();},get_pages:function()
{var self=this;$('my_location_loading').removeClass('hidden');my_request=new Request.HTML({url:self.my_url,data:{my_latitude:self.my_lat,my_longitude:self.my_lon,my_address:self.my_location_address,my_page_num:self.my_location_page_num},onComplete:function(responseTree,responseElements,responseHTML,responseJavaScript){var el=$$('.layout_page_my_location');var tElement=new Element('div',{'html':responseHTML});$('my_location_pages').innerHTML=tElement.getElement('.layout_page_my_location').innerHTML;if($('my_location_pagination_select'))
$('my_location_pagination_select').value=self.my_location_page_num;}}).post();}};var donations_map={pages_array:{},markers_array:{},map_bounds:{},current_data:{},zoom:4,constructed:false,canvas_id:'map_canvas',construct:function(pages_array,markers_array,zoom,map_bounds,edit_mode){this.pages_array=pages_array;this.markers_array=markers_array;this.map_bounds=map_bounds;this.zoom=zoom;this.init();if(edit_mode==undefined&&!edit_mode){this.show_map();}else{this.show_edit_map();}
this.constructed=true;},init:function(){window.map=new google.maps.Map(document.getElementById('map_canvas'),{mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:false});},show_map:function(){if(this.markers_array.length==0){return false;}
var infoWindow=new google.maps.InfoWindow({content:''});for(var i=0;i<this.markers_array.length;i++)
{marker=this.markers_array[i];point=new google.maps.LatLng(marker.lat,marker.lng);marker_obj=new google.maps.Marker({position:point,map:window.map});marker_obj.html='<table width="500px"><tr valign="top"><td width="110px"><img src="'+marker.pages_photo+'" width="100"></td><td width="400px"><h3 style="margin-top:0; margin-bottom:6px;"><a href="'+marker.url+'">'+marker.title+'</a></h3>'+marker.desc+'</td></tr></table>';if(!marker.desc){marker.desc='';}
google.maps.event.addListener(marker_obj,'click',function(){infoWindow.setContent(this.html);infoWindow.open(window.map,this);});}
window.map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));window.map.setZoom(4);if(this.map_bounds&&this.map_bounds.min_lat&&this.map_bounds.max_lng&&this.map_bounds.min_lat&&this.map_bounds.max_lng){var bds=new google.maps.LatLngBounds(new google.maps.LatLng(this.map_bounds.min_lat,this.map_bounds.min_lng),new google.maps.LatLng(this.map_bounds.max_lat,this.map_bounds.max_lng));}
if(this.map_bounds&&this.map_bounds.map_center_lat&&this.map_bounds.map_center_lng){window.map.setCenter(new google.maps.LatLng(this.map_bounds.map_center_lat,this.map_bounds.map_center_lng));window.map.setZoom(4);}else{window.map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));window.map.setZoom(this.zoom);}
if(bds){window.map.fitBounds(bds);}},show_edit_map:function(){if(this.markers_array.length==0){return false;}
var self=this;var infoWindow=new google.maps.InfoWindow({content:''});for(var i=0;i<this.markers_array.length;i++)
{marker=this.markers_array[i];point=new google.maps.LatLng(marker.lat,marker.lng);marker_obj=new google.maps.Marker({position:point,map:window.map,draggable:true});marker_obj.html='<table width="500"><tr valign="top"><td width="110"><img src="'+marker.pages_photo+'" width="100"></td><td width="400"><h3 style="margin-top:0; margin-bottom:6px;"><a href="'+marker.url+'">'+marker.title+'</a></h3>'+marker.desc+'</td></tr></table>';if(!marker.desc){marker.desc='';}
google.maps.event.addListener(marker_obj,'click',function(){infoWindow.setContent(this.html);infoWindow.open(window.map,this);});}
window.map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));window.map.setZoom(4);if(this.map_bounds&&this.map_bounds.min_lat&&this.map_bounds.max_lng&&this.map_bounds.min_lat&&this.map_bounds.max_lng){var bds=new google.maps.LatLngBounds(new google.maps.LatLng(this.map_bounds.min_lat,this.map_bounds.min_lng),new google.maps.LatLng(this.map_bounds.max_lat,this.map_bounds.max_lng));}
if(this.map_bounds&&this.map_bounds.map_center_lat&&this.map_bounds.map_center_lng){window.map.setCenter(new google.maps.LatLng(this.map_bounds.map_center_lat,this.map_bounds.map_center_lng));window.map.setZoom(4);}else{window.map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));window.map.setZoom(this.zoom);}
if(bds){window.map.fitBounds(bds);}
google.maps.event.addListener(marker_obj,"dragend",function(){self.trackChanges(marker_obj);});},showEditMap:function(pages_array,markers_array,zoom,map_bounds,edit_mode){$$('.page_edit_form_map_show').addClass('display_none');$$('.page_edit_form_map_hide').removeClass('display_none');$('map_canvas').removeClass('display_none');if(!this.constructed){this.construct(pages_array,markers_array,zoom,map_bounds,edit_mode);}},hideEditMap:function(){$$('.page_edit_form_map_show').removeClass('display_none');$$('.page_edit_form_map_hide').addClass('display_none');$('map_canvas').addClass('display_none');},trackChanges:function(marker){var coords=marker.getPosition();$('coordinates').value=coords.lat()+';'+coords.lng();geocoder=new google.maps.Geocoder();geocoder.geocode({'latLng':marker.getPosition()},function(results,status){if(status==google.maps.GeocoderStatus.OK){if(results[0]){var address=csvToArray(results[0].formatted_address,',');var index=address.length-1;if(index>=0){$('country').value=address[index].trim();index--;}
if(index>=0){var len=results[0].address_components.length,i;for(i=len-1;i>0;i--){if(results[0].address_components[i].types[0]=='country'){i--;$('state').value=results[0].address_components[i].long_name;break;}}
index--;}
if(index>=0){$('city').value=address[index].trim();index--;}
if(index>=0){$('street').value=address[index].trim();index--;}}}});}};var Donate={chooseAmount:'.donation_select > ul > li',checkAnonymous:'anon',fullName:'name',fieldsAnonymous:'.for_guests .fields_anonymous',selected_id:null,init:function(user_id){this.initSelectors();if(!user_id){var $name=$(this.fullName);$name.addEvent('focus',function(){if(this.value==en4.core.language.translate('DONATION_Anonym')){this.value='';}});$name.addEvent('blur',function(){if(this.value==''){this.value=en4.core.language.translate('DONATION_Anonym');}});}},initSelectors:function(){var self=this;var $selectors=$$(this.chooseAmount);if($selectors){$selectors.addEvent('click',function(){$selectors.removeClass('active');this.addClass('active');self.selected_id=this.id;});}}};;var like_api={likes:null,viewer:null,like_url:'',unlike_url:'',viewer_url:'',urls:{},like_img:'',unlike_img:'',like_count:0,block:false,login_url:'',unlike_class:'unlike',like_class:'like',likes_container_id:'like_button_likes',subject_guid:'',$link:null,method:'post',format:'json',like_button_container:'like_button_wrapper',$like_button_container:{},like:function(){var self=this;if(this.block){return;}
if(!this.viewer_url){this.login();return;}
this.block=true;self.show_loader();new Request.JSON({method:self.method,url:self.like_url,data:{format:self.format},onSuccess:function(response){self.hide_loader();if(response.error==3){self.login();return false;}else if(response.error>0){return false;}
self.toggle();self.viewer_url=response.viewer_url;self.viewer=response.viewer;self.add_like(response.viewer);self.like_count++;self.build();self.block=false;return true;}}).send();},unlike:function(){var self=this;if(this.block){return;}
this.block=true;this.show_loader();new Request.JSON({method:self.method,url:self.unlike_url,data:{format:self.format},onSuccess:function(response){self.hide_loader();if(response.error==3){self.login();return false;}else if(response.error>0){return false;}
self.toggle();self.remove_like(response.viewer.user_id);self.like_count--;self.build();self.block=false;return true;}}).send();},show_loader:function(){this.$like_button_container.setStyle('display','none');},hide_loader:function(){this.$like_button_container.setStyle('display','block');},remove_like:function(user_id){var likes=this.likes;if(!likes.length||!likes){return;}
for(var i=0;i<likes.length;i++){var like=likes[i];if(like.user_id==user_id){likes=likes.slice(0,i).concat(likes.slice(i+1));break;}}
this.urls[user_id]='';this.likes=likes;},add_like:function(like){if(!this.likes){this.likes=[];}
this.likes.push(like);this.urls[like.user_id]=this.viewer_url;},build:function(){var likes=this.likes;var html='';var urls=this.urls;var like={};var out='';var like_count=this.like_count;var other_count=like_count-likes.length;if(!other_count&&!likes.length){$(this.likes_container_id).innerHTML=langs.l_noResult;return;}
if(likes[likes.length-1]){like=likes[likes.length-1];if(like.user_id==this.viewer.user_id){html+='<a href="'+urls[like.user_id]+'" style="font-weight: bold; text-decoration: none;" target="_blank">'+langs.l_you+'</a>';likes=likes.slice(0,likes.length-1).concat(likes.slice(likes.length));if((other_count>0&&likes.length>0)||(!other_count&&likes.length>1)){html+=', ';}else if(!other_count&&!likes.length){html+='';}else{html+=' '+langs.l_and+' ';}}}
for(var i=0;i<likes.length;i++){like=likes[i];out='<a href="'+urls[like.user_id]+'" style="font-weight: bold; text-decoration: none;" target="_blank">'+like.displayname+'</a>';if(i!=(likes.length-1)){out+=', '}
html+=out;}
if(likes.length>0){html+=' '+langs.l_and+' ';}
if(other_count>1){html+=other_count+' '+langs.l_people+' ';}else if(other_count==1){html+=other_count+' '+langs.l_person+' ';}
html+=' '+langs.l_like_it;$(this.likes_container_id).innerHTML=html;},login:function(){return window.open(this.login_url,'popup','width=450,height=240,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=yes,left=0,top=0');},toggle:function(){var $link=$(this.$link);if($link.hasClass(this.unlike_class)){this.set_like();}else{this.set_unlike();}},set_like:function(){var $link=$(this.$link);var self=this;$link.removeEvents('click');$link.children[0].className='like_button';$link.children[0].innerHTML=langs.l_Like;$link.children[0].style.backgroundImage='url('+this.like_img+')';$link.removeClass(this.unlike_class);$link.addClass(this.like_class);$link.addEvent('click',function(){self.like();});return $link;},set_unlike:function(){var $link=$(this.$link);var self=this;$link.removeEvents('click');$link.children[0].className='unlike_button';$link.children[0].innerHTML=langs.l_Unlike;$link.children[0].style.backgroundImage='url('+this.unlike_img+')';$link.removeClass(this.like_class);$link.addClass(this.unlike_class);$link.addEvent('click',function(){self.unlike();});return $link;},init:function(){this.$link=$('_'+this.subject_guid);this.$like_button_container=$(this.like_button_container);this.init_link();},init_link:function(){var self=this;this.$link.removeEvents('click');if(this.$link.hasClass(this.unlike_class)){this.$link.addEvent('click',function(){self.unlike();});}else{this.$link.addEvent('click',function(){self.like();});}}}
function showLikesList($node,type){$node=$($node);var $box=$node.getParents('.he_like_cont');if(!$box||!$box[0]){return;}
$box=$box[0];$box.getElements('ul.like_list_switcher li a').removeClass('active');$node.addClass('active');$cur_list=$box.getElement('.likes_'+type);$old_list=$box.getElement('div.active_list');if($cur_list.hasClass('active_list')){$node.blur();return;}
var cur_tween=new Fx.Morph($cur_list,{duration:300,opacity:0});var old_tween=new Fx.Morph($old_list,{duration:300,opacity:1});old_tween.start({opacity:0}).chain(function(){$old_list.removeClass('active_list');$cur_list.addClass('active_list');cur_tween.start({opacity:1}).chain(function(){$node.blur();});});}
function print_arr(object,flag){var type=typeof(object);var output='';var property=null;switch(type){case'object':{for(property in object){output+=property+': '+print_arr(object[property],true)+'; ';}}
break;case'array':{for(var i=0;i<object.length;i++){output+=i+': '+print_arr(object[i],true)+'; ';}}
break;case'string':{output='"'+object+'"';}
break;case'number':default:{output=object;}}
if(flag){return output;}
if(window.console!==undefined){window.console.log(output);}else{alert(output);}};var LikeButton=new Class({Implements:[Options],options:{object_type:'',object_id:0,likeBtn:'',loader:'',menuHtml:'',menuId:'',suggestBtn:'',likeUrl:en4.core.baseUrl+'like/like',unlikeUrl:en4.core.baseUrl+'like/unlike',switcher:''},unlike_class:'unlike',like_class:'like',block:false,menuContainer:null,initialize:function(options){this.setOptions(options);this.options.likeBtn=$(this.options.likeBtn);this.options.loader=$(this.options.loader);this.options.switcher=$(this.options.switcher);if(this.options.likeBtn){if(this.options.likeBtn.hasClass(this.unlike_class)){this.setUnlike();}else{this.setLike();}}
this.init_menu();},init_menu:function(){var $div=new Element('div',{'html':this.options.menuHtml,'style':'position:absolute;','id':this.options.menuId});this.menuContainer=$div=$div.getElements('.like_container_menu_wrapper')[0];$$('body')[0].appendChild($div);this.initPosition();this.options.suggestBtn=$$(this.options.suggestBtn)[0];this.init_suggest_link();if(this.options.switcher){var self=this;this.options.switcher.addEvent('click',function(){self.toggle_menu();});}
if(Smoothbox&&Smoothbox.init){Smoothbox.init();}},initPosition:function(){var $switcher=$(this.options.likeBtn).getNext();var position=$switcher.getPosition();if(this.menuContainer!=undefined){if(en4.orientation=='rtl'){this.menuContainer.setStyle('left',position.x-this.menuContainer.getSize().x);}
else
{this.menuContainer.setStyle('left',position.x+20);}
this.menuContainer.setStyle('top',position.y);}},init_suggest_link:function(){var self=this;if(!this.options.suggestBtn){return;}
this.options.suggestBtn.addEvent('click',function(e){e.stop();like.url.suggest=this.href;he_contacts.box('like','getFriends','like.suggest',en4.core.language.translate('like_Suggest to Friends'),{'object':self.options.object_type,'object_id':self.options.object_id},0);});},like:function(){var self=this;if(this.block){return;}
this.showLoader();this.block=true;new Request.JSON({method:'post',url:self.options.likeUrl,data:{format:'json'},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);return;}
self.hideLoader();self.toggle();return true;}}).send();},unlike:function(){var self=this;if(this.block){return;}
self.showLoader();this.block=true;new Request.JSON({method:'post',url:self.options.unlikeUrl,data:{format:'json'},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);return;}
self.hideLoader();self.toggle();return true;}}).send();},toggle:function(){var $link=$(this.options.likeBtn);if($link.hasClass(this.unlike_class)){this.setLike();}else{this.setUnlike();}
this.initPosition();},toggle_menu:function(){var menu=this.menuContainer
var link=this.options.switcher;if(menu.hasClass('hidden')){menu.removeClass('hidden');link.getElements('span')[0].set('class','hide_options');link.set('title',en4.core.language.translate('like_Hide'));this.initPosition();}else{menu.addClass('hidden');link.getElements('span')[0].set('class','show_options');link.set('title',en4.core.language.translate('like_Show Like'));}},setLike:function(){var $link=$(this.options.likeBtn);var self=this;$link.getElements('span')[0].set('class','like_button');$link.getElements('span')[0].set('text',en4.core.language.translate('like_Like'));$link.set('class','like_button_link '+self.like_class);$link.removeEvents('click');$link.addEvent('click',function(){self.like();});return this;},setUnlike:function(){var $link=$(this.options.likeBtn);var self=this;$link.removeEvents('click');$link.getElements('span')[0].set('class','unlike_button');$link.getElements('span')[0].set('text',en4.core.language.translate('like_Unlike'));$link.set('class','like_button_link '+self.unlike_class);$link.addEvent('click',function(){self.unlike();});return this;},showLoader:function(){this.options.likeBtn.addClass('hidden');if(this.options.switcher){this.options.switcher.addClass('hidden');}
this.options.loader.removeClass('hidden');},hideLoader:function(){this.options.likeBtn.removeClass('hidden');if(this.options.switcher){this.options.switcher.removeClass('hidden');}
this.options.loader.addClass('hidden');}});var like={block:false,sender:{},url:{ajax:'',suggest:'',remove:''},clubs:{pages:{count:0,items:[]},users:{count:0,items:[]}},loader_id:'he_contacts_loading',disabled_div:'he_disabled_div',$link:{},method:'post',format:'json',unlike_class:'unlike',like_class:'like',like_url:'',unlike_url:'',menu_html:'',init:function(){var self=this;$$('.disable_like_club, .enable_like_club').addEvent('click',function(e){e.stop();self.url.ajax=this.href;self.sender=this;self.send();});if($$('a.like_display_none')){$$('a.like_display_none').each(function($item){$item.getParent().setStyle('display','none');});}
var guid=en4.core.subject.guid;if($('_'+guid)){this.$link=$('_'+guid);if(this.$link.hasClass(this.unlike_class)){this.set_unlike();}else{this.set_like();}}
this.init_menu();},init_menu:function(){var $div=new Element('div',{'html':this.menu_html,'style':'position:absolute;'});$div=$div.getElements('.like_container_menu_wrapper')[0];$$('body')[0].appendChild($div);var $switcher=$(this.$link).getNext();var position=$switcher.getPosition();$div.setStyle('left',position.x+20);$div.setStyle('top',position.y);this.init_suggest_link();Smoothbox.init();},init_suggest_link:function(){var self=this;if(!$$('.like_suggest')){return;}
$$('.like_suggest').addEvent('click',function(e){e.stop();self.url.suggest=this.href;he_contacts.box('like','getFriends','like.suggest',en4.core.language.translate('like_Suggest to Friends'),{'object':window.en4.core.subject.type,'object_id':window.en4.core.subject.id},0);});},set_menu_pos:function(){var $div=$$('.like_container_menu_wrapper')[0];var $switcher=$(this.$link).getNext();var position=$switcher.getPosition();$div.setStyle('left',position.x+20);$div.setStyle('top',position.y);},like:function(){var self=this;if(this.block){return;}
self.show_like_loader();this.block=true;new Request.JSON({method:self.method,url:self.like_url,data:{format:self.format},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);return;}
self.hide_like_loader();self.toggle();return true;}}).send();},unlike:function(){var self=this;if(this.block){return;}
self.show_like_loader();this.block=true;new Request.JSON({method:self.method,url:self.unlike_url,data:{format:self.format},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);return;}
self.hide_like_loader();self.toggle();return true;}}).send();},toggle:function(){var $link=$(this.$link);if($link.hasClass(this.unlike_class)){this.set_like();}else{this.set_unlike();}},set_like:function(){var $link=$(this.$link);var self=this;$link.getElements('span')[0].set('class','like_button');$link.getElements('span')[0].set('text',en4.core.language.translate('like_Like'));$link.set('class','like_button_link '+self.like_class);$link.removeEvents('click');$link.addEvent('click',function(){self.like();});this.$link=$($link);return this.$link;},set_unlike:function(){var $link=$(this.$link);var self=this;$link.removeEvents('click');$link.getElements('span')[0].set('class','unlike_button');$link.getElements('span')[0].set('text',en4.core.language.translate('like_Unlike'));$link.set('class','like_button_link '+self.unlike_class);$link.addEvent('click',function(){self.unlike();});this.$link=$($link);return $link;},show_like_loader:function(){$(this.$link).addClass('hidden');if($$('.like_menu_switcher')[0]){$$('.like_menu_switcher')[0].addClass('hidden');}
$$('.like_button_loader')[0].removeClass('hidden');},hide_like_loader:function(){$(this.$link).removeClass('hidden');if($$('.like_menu_switcher')[0]){$$('.like_menu_switcher')[0].removeClass('hidden');}
$$('.like_button_loader')[0].addClass('hidden');},init_counts:function(){var self=this;if($('like_users_count')){$('like_users_count').innerHTML="("+this.clubs.users.count+")";}
if($('like_pages_count')){$('like_pages_count').innerHTML="("+this.clubs.pages.count+")";}
if($$('.like_profile_pages')[0]){$$('.like_profile_pages')[0].addEvent('click',function(){self.make_active(this);});}
if($$('.like_profile_users')[0]){$$('.like_profile_users')[0].addEvent('click',function(){self.make_active(this);});this.make_active($$('.like_profile_users')[0]);}
if($$('.menu_like_profile')){$$('.menu_like_profile').addEvent('focus',function(){this.blur();});}
if(!this.clubs.users.count){if($$('.no_result_users'))$$('.no_result_users').removeClass('hidden');}
if(!this.clubs.pages.count){if($$('.no_result_pages'))$$('.no_result_pages').removeClass('hidden');}},make_active:function($link){if($$('ul.like_navigation li.active'))$$('ul.like_navigation li.active').removeClass('active');$link.getParent().addClass('active');},list:function(type,$link){var id="likes_"+type;$$('.like_navigation_item').removeClass('active');$($link).getParent().addClass('active');if(!$(id).hasClass('hidden')){return;}
$$('.like_club_container').addClass('hidden');$(id).removeClass('hidden');},suggest:function(user_ids){var self=this;new Request.JSON({'url':self.url.suggest,'method':'post','data':{'user_ids':user_ids,'format':'json'}}).send();},send:function(){if(this.block||!this.url.ajax){return;}
this.block=true;var self=this;new Request.JSON({'url':self.url.ajax,'method':'post','data':{'format':'json'},onSuccess:function(response){self.sender.getParent().innerHTML=response.html;self.init();self.block=false;switch(response.link){case'disable':if($$('.like_promote')[0])$$('.like_promote')[0].getParent().setStyle('display','block');if($$('.like_send_update')[0])$$('.like_send_update')[0].getParent().setStyle('display','block');if($$('.like_suggest')[0])$$('.like_suggest')[0].getParent().setStyle('display','block');if($$('.like_button_container')[0])$$('.like_button_container')[0].setStyle('display','block');break;case'enable':if($$('.like_promote')[0])$$('.like_promote')[0].getParent().setStyle('display','none');if($$('.like_send_update')[0])$$('.like_send_update')[0].getParent().setStyle('display','none');if($$('.like_suggest')[0])$$('.like_suggest')[0].getParent().setStyle('display','none');if($$('.like_button_container')[0])$$('.like_button_container')[0].setStyle('display','none');break;}}}).send();},see_all:function(object,object_id,period_type){he_list.box('like','getLikes','Likes',{'object':object,'object_id':object_id,'period_type':period_type});},see_all_liked:function(user_id,period_type){var $el=new Element('a',{'href':'like/see-liked/user_id/'+user_id+'/period_type/'+period_type,'class':'smoothbox'});Smoothbox.open($el);},list_like:function(object,object_id,$element,callback){var self=this;$element=$($element);if(this.block){return false;}
this.block=true;new Request.JSON({'url':'like/like/object/'+object+'/object_id/'+object_id,'method':'post','data':{'format':'json'},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);callback(false);return;}
$('unlike_'+object+'_'+object_id).getParent().setStyle('display','block');$('like_'+object+'_'+object_id).getParent().setStyle('display','none');if(typeof(callback)=='function'){callback(true);}}}).send();},list_unlike:function(object,object_id,$element,callback){var self=this;$element=$($element);if(this.block){return false;}
this.block=true;new Request.JSON({'url':'like/unlike/object/'+object+'/object_id/'+object_id,'method':'post','data':{'format':'json'},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);callback(true);return;}
$('unlike_'+object+'_'+object_id).getParent().setStyle('display','none');$('like_'+object+'_'+object_id).getParent().setStyle('display','block');if(typeof(callback)=='function'){callback(false);}}}).send();},init_buttons:function(){var self=this;if($$('div.like_button_container a.unlike')){var $btns=$$('.like_button_container a.unlike');$btns.removeEvents('click');$btns.each(function($item){if($item.hasClass('unlike')){$item.addEvent('click',function(){var id=this.id;var guid=id.substr(7);var info=guid.split('_');self.list_unlike(info[0],info[1],$item);});}});}
if($$('div.like_button_container a.like')){var $btns=$$('.like_button_container a.like');$btns.removeEvents('click');$btns.each(function($item){if($item.hasClass('like')){$item.addEvent('click',function(){var id=this.id;var guid=id.substr(5);var info=guid.split('_');self.list_like(info[0],info[1],$item);});}});}},init_like_buttons:function(){var self=this;if($$('.page_browser_likebox a.unlike')){var $btns=$$('.page_browser_likebox a.unlike');$btns.removeEvents('click');$btns.each(function($item){if($item.hasClass('unlike')){$item.addEvent('click',function(){var id=this.id;var guid=id.substr(7);var info=guid.split('_');if(info.length==3){self.show_page_loader(info[2]);self.list_unlike(info[0]+'_'+info[1],info[2],$item,function(liked){self.hide_page_loader(info[2],liked);});}else{self.show_page_loader(info[1]);self.list_unlike(info[0],info[1],$item,function(liked){self.hide_page_loader(info[1],liked);});}});}});}
if($$('.page_browser_likebox a.like')){var $btns=$$('.page_browser_likebox a.like');$btns.removeEvents('click');$btns.each(function($item){if($item.hasClass('like')){$item.addEvent('click',function(){var id=this.id;var guid=id.substr(5);var info=guid.split('_');if(info.length==3){self.show_page_loader(info[2]);self.list_like(info[0]+'_'+info[1],info[2],$item,function(liked){self.hide_page_loader(info[2],liked);});}else{self.show_page_loader(info[1]);self.list_like(info[0],info[1],$item,function(liked){self.hide_page_loader(info[1],liked);});}});}});}},show_page_loader:function(id){$('page_status_'+id).addClass('hidden');$('page_loader_like_'+id).removeClass('hidden');},hide_page_loader:function(id,liked){$('page_status_'+id).removeClass('hidden');$('page_loader_like_'+id).addClass('hidden');var $item=$('page_status_'+id).getParent('.item');if(liked){$item.addClass('liked_item');}else{$item.removeClass('liked_item');}},select_list:function(list,user_id,$link){var self=this;self.show_loader();new Request.JSON({'url':'like/see-liked/list/'+list+'/user_id/'+user_id,'method':'post','data':{'format':'json'},onSuccess:function(response){$('he_list').innerHTML=response.html;if($$('.select_btns .active')){$$('.select_btns .active').each(function($element){$($element).removeClass('active');});}
$($link).addClass('active');self.hide_loader();self.init_buttons();}}).send();},do_remove:function(object,object_id){var self=this;var $item=$('like_'+object+'_'+object_id);$item.dispose();new Request.JSON({'url':self.url.remove,'method':'post','data':{'object':object,'object_id':object_id,'format':'json'},onSuccess:function(response){if(response.error){he_show_message(response.html,'error',3000);return;}
self.counting(object+'s',-1);}}).send();},remove:function(object,object_id){var self=this;var callback=function(){self.do_remove(object,object_id)};he_show_confirm(en4.core.language.translate("like_Unlike"),en4.core.language.translate("like_Are you sure you want to unlike this?"),callback);},counting:function(type,count){var prev=$('like_'+type+'_count').innerHTML.substr(1).toInt();var next=prev+count;$('like_'+type+'_count').innerHTML="("+next+")";if(!next){$$('.no_result_'+type).removeClass('hidden');}},show_loader:function(){$(this.loader_id).removeClass('hidden');$(this.disabled_div).removeClass('hidden');},hide_loader:function(){$(this.loader_id).addClass('hidden');},toggle_menu:function($link){$link=$($link);if($$('.like_container_menu_wrapper')[0].hasClass('hidden')){$$('.like_container_menu_wrapper')[0].removeClass('hidden');$link.getElements('span')[0].set('class','hide_options');$link.set('title',en4.core.language.translate('like_Hide'));this.set_menu_pos();}else{$$('.like_container_menu_wrapper')[0].addClass('hidden');$link.getElements('span')[0].set('class','show_options');$link.set('title',en4.core.language.translate('like_Show Like'));}},get_mutual_friends:function(user_id){he_list.box('like','getMutualFriends',en4.core.language.translate('Friends'),{'user_id':user_id,'list_type':'mutual'});},get_friends:function(user_id){he_list.box('like','getFriends',en4.core.language.translate('Friends'),{'user_id':user_id,'list_type':'all'});}}
var LikeTips=new Class({Implements:[Options],type:'',id:0,guid:'',options:{container:'comments',html:'',url:{like:'',unlike:'',hint:'',showLikes:'',postComment:''}},likeBtn:null,unlikeBtn:null,commentBtn:null,commentForm:null,commentViewAllBtns:[],container:null,likeContainer:null,likeCountBtn:null,viewAllLikes:false,cache:{},tipBlock:{},blockHints:false,timeout:null,tips:null,initialize:function(type,id,options){this.type=type;this.id=id;this.guid=type+'_'+id;this.setOptions(options);this.tipBlock=this.createTipBlock();this.container=$(this.options.container);this.replace();this.init();this.bind();return this;},createTipBlock:function(){if($('like_tip_'+this.guid)){return $('like_tip_'+this.guid);}
var $container=new Element('div',{'class':'like_tool_tip hidden','id':'like_tip_'+this.guid,'style':'position:absolute;'});var $header=new Element('div',{'class':'like-tip-title'});var $content=new Element('div',{'class':'like-tip'});var $footer=new Element('div',{'class':'like-tip-footer'});var $clr=new Element('div',{'class':'clr'});$container.appendChild($header);$container.appendChild($content);$container.appendChild($footer);$container.appendChild($clr);$$('body')[0].appendChild($container);return $container;},init:function(){this.likeContainer=$('comments_likes_list_'+this.guid);this.likeCountBtn=$('show_likes_'+this.guid);this.likeBtn=$('comments_like_'+this.guid);this.unlikeBtn=$('comments_unlike_'+this.guid);this.commentBtn=$('post_comment_'+this.guid);this.commentViewAllBtns=$$('.comments_view_all_'+this.guid);this.commentForm=$('comment-form_'+this.guid);if(this.likeCountBtn){this.bindLikeCountBtn();}
if(this.likeBtn){this.bindLikeBtn();}
if(this.unlikeBtn){this.bindUnlikeBtn();}
if(this.commentBtn){this.bindCommentBtn();}
if(this.commentViewAllBtns){this.bindCommentViewAllBtns();}
if(this.commentForm){this.bindCommentForm();}
return this;},replace:function(html){if(!html){html=this.options.html;}
if(this.container){this.container.set('html',html);}
return this;},runScripts:function(){$$(this.container.getElements('script')).each(function($script){var script=$script.innerHTML;eval(script);});return this;},bind:function(){var self=this;if(!$(this.likeContainer)){return;}
var $likes=$$($(this.likeContainer).getElements('a'));if($likes.length){$likes.each(function($item){self.bindItem($item);});}},bindItem:function($item){var self=this;if(!$item){return;}
if($item.href.indexOf('javascript')>=0){return;}
$($item).addEvents({'mouseover':function(){var username=this.href.split('/').pop();var x=$(this).getPosition().x;var y=$(this).getPosition().y;self.timeout=window.setTimeout(function(){self.hint(username,x,y);},500);},'mouseout':function(){window.clearTimeout(self.timeout);self.timeout=window.setTimeout(function(){self.hideTip();},500);}});},hint:function(username,x,y){var self=this;if(this.blockHints){return;}
if(this.cache[username]){this.showTip(this.cache[username],x,y);this.blockHints=false;return;}
this.blockHints=true;new Request.JSON({'method':'post','url':self.options.url.hint,'data':{'username':username,'format':'json'},onSuccess:function(response){self.cache[username]=response.html;self.showTip(response.html,x,y);self.blockHints=false;}}).send();},showTip:function(html,x,y){var self=this;$(this.tipBlock).getElements('.like-tip')[0].set('html',html);$(this.tipBlock).setStyle('left',x);$(this.tipBlock).setStyle('top',(y-175));$(this.tipBlock).removeClass('hidden');Smoothbox.bind();var miniTipsOptions={'htmlElement':'.like_hint_text','delay':100,'className':'he-tip-mini','id':'he-mini-tool-tip-id','ajax':false,'visibleOnHover':false};var internalTips=new HETips($$('.like_hint_tip_links'),miniTipsOptions);this.tipBlock.removeEvents('mouseover').removeEvents('mouseout').addEvents({'mouseover':function(){if(self.options.visibleOnHover){window.clearTimeout(self.timeout);}},'mouseout':function(){self.timeout=window.setTimeout(function(){self.hideTip();},500);}});},hideTip:function(){this.tipBlock.addClass('hidden');},bindLikeCountBtn:function(){var self=this;this.resetLikeCountBtn();var $btn=this.likeCountBtn;$btn.removeEvents('click').addEvent('click',function(){self.viewAllLikes=true;new Request.JSON({'method':'post','url':self.options.url.showLikes,'data':{'format':'json','type':self.type,'id':self.id,'viewAllLikes':self.viewAllLikes},onSuccess:function(response){self.replace(response.body);self.init();self.bind();}}).send();});return this;},bindLikeBtn:function(){var self=this;this.resetLikeBtn();var $btn=this.likeBtn;$btn.removeEvents('click').addEvent('click',function(){new Request.JSON({'method':'post','url':self.options.url.like,'data':{'format':'json','type':self.type,'id':self.id,'viewAllLikes':self.viewAllLikes},onSuccess:function(response){self.replace(response.body);self.init();self.bind();}}).send();});return this;},bindUnlikeBtn:function(){var self=this;this.resetUnlikeBtn();var $btn=this.unlikeBtn;$btn.removeEvents('click').addEvent('click',function(){new Request.JSON({'method':'post','url':self.options.url.unlike,'data':{'format':'json','type':self.type,'id':self.id,'viewAllLikes':self.viewAllLikes},onSuccess:function(response){self.replace(response.body);self.init();self.bind();}}).send();});return this;},bindCommentBtn:function(){var self=this;this.resetCommentBtn();var $btn=this.commentBtn;$btn.removeEvents('click').addEvent('click',function(){if(self.commentForm){self.commentForm.style.display='';self.commentForm.body.focus();}});return this;},bindCommentForm:function(){var self=this;this.resetCommentForm();var $form=$(this.commentForm);$($form.body).autogrow();$form.removeEvents('submit').addEvent('submit',function(e){e.stop();var body=this.body.value;new Request.JSON({'method':'post','url':self.options.url.postComment,'data':{'format':'json','type':self.type,'id':self.id,'body':body,'viewAllLikes':self.viewAllLikes},onSuccess:function(response){self.replace(response.body);self.init();self.bind();$form.style.display='none';}}).send();});return this;},bindCommentViewAllBtns:function(){var self=this;this.resetCommentViewAllBtns();var $btns=this.commentViewAllBtns;$btns.removeEvents('click').addEvent('click',function(){var page=this.id.split('_').pop();new Request.JSON({'method':'post','url':self.options.url.showLikes,'data':{'format':'json','type':self.type,'id':self.id,'page':page},onSuccess:function(response){self.replace(response.body);self.init();self.bind();}}).send();});return this;},resetLikeCountBtn:function(){this.likeCountBtn.set('onclick','');return this;},resetLikeBtn:function(){this.likeBtn.set('onclick','');return this;},resetUnlikeBtn:function(){this.unlikeBtn.set('onclick','');return this;},resetCommentBtn:function(){this.commentBtn.set('onclick','');return this;},resetCommentForm:function(){$(this.commentForm).set('onsubmit','');return this;},resetCommentViewAllBtns:function(){this.commentViewAllBtns.set('onclick','');}});var likeInterest={data:{},interests:{},html:null,id:0,button:"save_changes",$button:null,url:{add:'',remove:'',suggest:''},defaultText:{},defaultTextClass:'default_text',autoCompleters:{},interestItemClass:'.select',interestSelectedClass:'selected',linkIdPrefix:'select_',inputIdPrefix:'interest_',selectedInterestWrapperIdPrefix:'selected_interest_',linkListIdPrefix:'interests_list_',addedInterests:null,addedInterestsFake:null,isChanged:null,addedFiedlId:'added',privacyOptions:'.like_interests_privacy .options .option',privacyValue:'',init:function(id){this.id=id;this.initButton();this.initInputs();this.initInterests();this.initPrivacy();},input:function(type){return $(this.data[type].input);},initButton:function(){var self=this;this.$button=$(this.button);this.$button.addEvent('click',function(){var $form=self.createForm();$$('body')[0].appendChild($form);$form.submit();});},initPrivacy:function(){var self=this;var $buttons=$$(this.privacyOptions);$buttons.addEvent('click',function(){$buttons.removeClass('active');this.addClass('active');self.privacyValue=this.id;});},createForm:function(){var $form=new Element('form',{'action':this.url.submit,'method':'post','class':'hidden'});for(var type in this.addedInterests){var ids=this.addedInterests[type];var $input=new Element('input',{'type':'hidden','name':'data['+type+']','value':ids});$form.appendChild($input);}
for(var type in this.addedInterestsFake){var ids=this.addedInterestsFake[type];var $input=new Element('input',{'type':'hidden','name':'fake_data['+type+']','value':ids});$form.appendChild($input);}
var $input=new Element('input',{'type':'hidden','name':'view_interest','value':this.privacyValue});$form.appendChild($input);return $form;},initInterests:function(){var self=this;this.interests=$$(this.interestItemClass);this.interests.removeEvents('click').addEvents({'click':function(){self.initLink(this);},'focus':function(){this.blur();}});},initLink:function($link){this.interests.removeClass(this.interestSelectedClass);$link.addClass(this.interestSelectedClass);var guid=$link.id.substr(this.linkIdPrefix.length);var data=guid.split('_');var type=data[0];if(data.length>2){for(var i=1;i<(data.length-1);i++){type+='_'+data[i];}}
var id=data[data.length-1];this.showInterest(type,id);},showInterest:function(type,id){var previewType=this.convertType(type);$(this.selectedInterestWrapperIdPrefix+previewType).set('html',this.html[type+'_'+id]);},showInterestGuid:function(guid){var data=guid.split('_');var type=data[0];if(data.length>2){for(var i=1;i<(data.length-1);i++){type+='_'+data[i];}}
var id=data[data.length-1];this.showInterest(type,id);},initInputs:function(){var self=this;var data={id:self.id};if(this.data&&this.data.length<1){return;}
for(var type in this.data){data.type=type;data.except=self.addedInterests[type];data.fake_except=self.addedInterestsFake[type];switch(type)
{case'event':data.page_except=self.addedInterests['pageevent'];break;case'blog':data.page_except=self.addedInterests['pageblog'];break;case'music_playlist':data.page_except=self.addedInterests['playlist'];break;case'album':data.page_except=self.addedInterests['pagevideo'];default:break;}
this.autoCompleters[type]=new Autocompleter.Request.JSON(this.data[type].input,this.url.suggest,{'postVar':'text','postData':data,'customChoices':true,'minLength':1,'selectMode':'selection','autocompleteType':'interest','className':'interest-autosuggest','filterSubset':true,'multiple':false,'maxChoices':5,'cache':false,'injectChoice':function(token){var choice=new Element('li',{'class':'interest-choice','value':token.label,'id':token.id});var photo=new Element('div',{'html':'','class':'interest-choice-photo'});var a=new Element('a',{'html':'','class':'hidden href_holder','href':token.href});var img=new Element('img',{'src':token.img,'class':'thumb_icon item_photo_interest_suggest'});var title=new Element('div',{'html':this.markQueryValue(token.label),'class':'interest-choice-title'});var clr=new Element('div',{'html':'','class':'clr'});photo.appendChild(img);choice.appendChild(photo);choice.appendChild(title);choice.appendChild(a);choice.appendChild(clr);choice.inputValue=token;this.addChoiceEvents(choice).inject(this.choices);choice.store('autocompleteChoice',token);},onChoiceSelect:function(selected){var guid=selected.id;var data=guid.split('_');var type=data[0];if(data.length>2){for(var i=1;i<(data.length-1);i++){type+='_'+data[i];}}
var id=data[data.length-1];var interest={};var label=$(selected).getElement('.interest-choice-title').get('text');interest.title=label;interest.img=$(selected).getElement('img').src;interest.href=$(selected).getElement('a.href_holder').href;self.newInterest(type,id,interest);self.newInterestLink(type,id,label);switch(type){case'pageevent':var previewType='event';break;case'pageblog':var previewType='blog';break;case'pagevideo':var previewType='video';break;case'playlist':var previewType='music_playlist';break;default:var previewType=type;break;}
$(self.data[previewType].input).value='';},onBlur:function(input){var type=input.id.substr(self.inputIdPrefix.length);if(input.value.trim()==''){input.value=self.defaultText[type];$(input).addClass(self.defaultTextClass);}},onFocus:function(input){var type=input.id.substr(self.inputIdPrefix.length);if(input.value==self.defaultText[type]){input.value='';$(input).removeClass(self.defaultTextClass);}}});}},newInterestLink:function(type,id,title){var previewType=this.convertType(type);var self=this;var $item=new Element('div',{'class':'item'});var $a=new Element('a',{'href':'javascript:void(0)','html':title,'class':self.interestItemClass.substr(1),'id':self.linkIdPrefix+type+'_'+id});$item.appendChild($a);$item.setStyle('opacity',0);$item.set('tween',{duration:300});var $list=$(this.linkListIdPrefix+previewType).grab($item,'top');window.setTimeout(function(){$item.tween('opacity',1);},300);this.initInterests();$($a).fireEvent('click');},newInterest:function(type,id,interest){var $container=new Element('div');var $photo=new Element('div',{'class':'pic'});var $a=new Element('a',{'href':interest.href});var $img=new Element('img',{'src':interest.img,'class':'thumb_icon item_photo_'+type});if(parseInt(id))
{$a.appendChild($img);$photo.appendChild($a);}
else
{$photo.appendChild($img);}
$container.appendChild($photo);var $wrapper=new Element('div',{'class':'wrapper'});var $link=new Element('div',{'class':'link'});if(parseInt(id))
{var $a=new Element('a',{'href':interest.href,'html':interest.title});}
else
{var $a=new Element('label',{'text':interest.title});}
$link.appendChild($a);var $delete=new Element('div',{'class':'delete'});if(parseInt(id))
{var $a=new Element('a',{'href':'javascript:likeInterest.doRemove("'+type+'", '+id+')','html':'Remove'});}
else
{var $a=new Element('a',{'href':'javascript:likeInterest.doRemove("'+type+'", "'+id+'")','html':'Remove'});}
$delete.appendChild($a);$wrapper.appendChild($link);$wrapper.appendChild($delete);$container.appendChild($wrapper);var html=$container.innerHTML;if(this.addedInterests[type]===undefined)
{this.addedInterests[type]=[];}
if(parseInt(id))
{this.addedInterests[type].push(parseInt(id));this.refreshPostData(type);}
else
{this.addedInterestsFake[type].push(id);this.refreshPostData(type,true);}
this.newInterestHTML(type,id,html);this.showInterest(type,id);},newInterestHTML:function(type,id,html){this.html[type+'_'+id]=html;},remove:function(type,id){var self=this;he_show_confirm(en4.core.language.translate('like_Delete Interest'),en4.core.language.translate('like_If you delete it, you will unlike this item. Are you sure you want to delete it?'),function(){self.doRemove(type,id);});},doRemove:function(type,id){this.removeInterest(type,id);this.removeInterestLink(type,id);},removeInterest:function(type,id){var previewType=this.convertType(type);var $wrapper=$(this.selectedInterestWrapperIdPrefix+previewType);var guid=type+'_'+id;delete this.html[guid];var last=0;if(parseInt(id))
{this.addedInterests[type].erase(id);this.refreshPostData(type);}
else
{this.addedInterestsFake[type].erase(id);this.refreshPostData(type,true);if(this.addedInterestsFake[type].length)
{last=this.addedInterestsFake[type][this.addedInterestsFake[type].length-1];}
if(last)
{$(this.linkIdPrefix+type+'_'+last).fireEvent('click');return;}}
if(this.addedInterests[type].length){last=this.addedInterests[type][this.addedInterests[type].length-1];}
if(last){$(this.linkIdPrefix+type+'_'+last).fireEvent('click');}
else{if(this.isPageType(type))
{var new_type=this.convertType(type);}
else
{var new_type=this.convertToPageType(type);}
if(this.addedInterests[new_type]===undefined)
{this.addedInterests[new_type]=[];}
if(this.addedInterests[new_type].length)
{last=this.addedInterests[new_type][this.addedInterests[new_type].length-1];}
if(last)
{$(this.linkIdPrefix+new_type+'_'+last).fireEvent('click');}
else
{new_type=this.convertType(type);if(this.addedInterestsFake[new_type].length)
{last=this.addedInterestsFake[new_type][this.addedInterestsFake[new_type].length-1];}
if(last)
{$(this.linkIdPrefix+new_type+'_'+last).fireEvent('click');}
else
{$wrapper.set('html',' &nbsp; ');}}}},removeInterestLink:function(type,id){var $link=$(this.linkIdPrefix+type+'_'+id);$link.dispose();},refreshPostData:function(type,fake){if(fake)
{this.autoCompleters[type].options.postData.fake_except=this.addedInterestsFake[type];return;}
switch(type)
{case'pageevent':this.autoCompleters['event'].options.postData.page_except=this.addedInterests[type];break;case'pageblog':this.autoCompleters['blog'].options.postData.page_except=this.addedInterests[type];break;case'pagevideo':this.autoCompleters['video'].options.postData.page_except=this.addedInterests[type];break;case'playlist':this.autoCompleters['music_playlist'].options.postData.page_except=this.addedInterests[type];break;default:this.autoCompleters[type].options.postData.except=this.addedInterests[type];break;}},convertType:function(type){switch(type){case'pageevent':var previewType='event';break;case'pageblog':var previewType='blog';break;case'pagevideo':var previewType='video';break;case'playlist':var previewType='music_playlist';break;default:var previewType=type;break;}
return previewType;},convertToPageType:function(type)
{switch(type)
{case'event':var pageType='pageevent';break;case'blog':var pageType='pageblog';break;case'video':var pageType='pagevideo';break;case'music_playlist':var pageType='playlist';break;default:var pageType=type;break;}
return pageType;},isPageType:function(type)
{if(type=='playlist')
return 1;else
return type.indexOf('page')+1;}};var LikeAction=new Class({Implements:[Options],options:{userIds:[],likecount:0},nodeId:'',$node:null,viewerId:0,viewerLiked:false,initialize:function(nodeId,options){this.nodeId=nodeId;this.$node=$(nodeId);this.viewerId=en4.user.viewer.id;this.setOptions(options);this.viewerLiked=this.options.userIds.indexOf(this.viewerId)<0?false:true;this.render();},render:function(){var out='like_';var likeCount=this.options.likeCount;if(this.viewerLiked){out+='You ';likeCount--;if(likeCount){out+='and ';}}
if(likeCount>1){out+='%s other people ';}else if(likeCount==1){out+='%s other person ';}else if(!this.viewerLiked){out+='No one ';}
out+='like it.'
this.$node.set('html',en4.core.language.translate(out,likeCount));return out;}});;var Daylogo={url:{'form':'','remove':'','enable':'','disable':'','remove_photo':'','edit':''},time_out:500,logo_id:0,$loader:null,$elm:null,$form:null,init:function()
{this.$loader=$('daylogo_loader');this.$elm=$('daylogo');this.$form=$('daylogo-form');},goForm:function()
{this.loadTab('form');},formLogo:function(logo_id)
{var self=this;if(logo_id)
{this.request(this.url.edit,{id:logo_id},function(obj){if(obj.result){self.loadTab('form');self.formReset();var $title=self.$form.getElement('h3');if($title){$title.set('html',en4.core.language.translate('DAYLOGO_EDIT_TITLE'));}
self.$form.getElements('.datepicker_container.starttime-container input').set('value',obj.logo_info.start_date);self.$form.getElements('.datepicker_container.endtime-container input').set('value',obj.logo_info.end_date);if(obj.photo_html){self.$form.getElement('#logo_photo-demo-status').setStyle('display','none');self.$form.getElement('#logo_photo-demo-list').setStyle('display','block').set('html',obj.photo_html);}
self.$form.title.value=obj.logo_info.title;self.$form.id.value=logo_id;}});}
else
{self.loadTab('form');self.formReset();var $title=self.$form.getElement('h3');if($title){$title.set('html',en4.core.language.translate('DAYLOGO_CREATE_TITLE'));}}},formSubmit:function(form)
{var self=this;this.request(this.url.form,$(form).toQueryString(),function(obj){if(obj.result){self.showMessage(obj.html);setTimeout(function(){self.view(obj.id);},self.time_out);}else{self.showMessage(obj.html);}});return false;},formReset:function()
{window.logo_photo_up.fileList.each(function(file){file.remove();});this.$form.title.value='';this.$form.starttime.value='';this.$form.endtime.value='';this.$form.getElements('.datepicker_container input').set('value','');this.$form.id.value=0;$('logo_photo-demo-list').setStyle('display','none').empty();$('logo_photo-demo-status').setStyle('display','block');},formCancel:function()
{location.href='admin/daylogo';},removePhoto:function(photo_id)
{this.request(this.url.remove_photo,{'photo_id':photo_id});this.$form.getElement('#logo_photo-demo-status').setStyle('display','block');this.$form.getElement('#logo_photo-demo-list').empty().setStyle('display','none');},loadTab:function(tab)
{var $tab=this.$elm.getElement('.tab_'+tab);this.$elm.getElements('.tab').addClass('hidden');$tab.removeClass('hidden');return $tab;},view:function(id)
{location.href='admin/daylogo';},remove:function(id)
{var self=this;he_show_confirm(en4.core.language.translate('DAYLOGO_DELETE_TITLE'),en4.core.language.translate('DAYLOGO_DELETE_DESCRIPTION'),function(){self.request(self.url.remove,{'logo_id':id},function(obj){if(obj.result){self.showMessage(obj.html);setTimeout(function(){self.view();},self.time_out);}else{self.showMessage(obj.html);}});});},enable:function(id)
{var self=this;he_show_confirm(en4.core.language.translate('DAYLOGO_ENABLE_TITLE'),en4.core.language.translate('DAYLOGO_ENABLE_DESCRIPTION'),function(){self.request(self.url.enable,{'logo_id':id},function(obj){if(obj.result){self.showMessage(obj.html);setTimeout(function(){self.view();},self.time_out);}else{self.showMessage(obj.html);}});});},disable:function(id)
{var self=this;he_show_confirm(en4.core.language.translate('DAYLOGO_DISABLE_TITLE'),en4.core.language.translate('DAYLOGO_DISABLE_DESCRIPTION'),function(){self.request(self.url.disable,{'logo_id':id},function(obj){if(obj.result){self.showMessage(obj.html);setTimeout(function(){self.view();},self.time_out);}else{self.showMessage(obj.html);}});});},showMessage:function(html)
{this.loadTab('message').set('html',html);},request:function(url,data,callback)
{var self=this;if(typeof(data)=='string')
{data+='&format=json&no_cache='+Math.random();}
else if(typeof(data)=='object')
{data.format='json';data.nocache=Math.random();}
if(self.$loader!=null)
self.$loader.removeClass('hidden');var request=new Request.JSON({secure:false,url:url,method:'post',data:data,onSuccess:function(obj)
{self.$loader.addClass('hidden');if(callback){callback(obj);}}}).send();}};;Swiff.Uploader=new Class({Extends:Swiff,Implements:Events,options:{path:'Swiff.Uploader.swf',target:null,zIndex:9999,height:30,width:100,callBacks:null,params:{wMode:'opaque',menu:'false',allowScriptAccess:'always'},typeFilter:null,multiple:true,queued:true,verbose:false,url:null,method:null,data:null,mergeData:true,fieldName:null,fileSizeMin:1,fileSizeMax:null,allowDuplicates:false,timeLimit:(Browser.Platform.linux)?0:30,buttonImage:null,policyFile:null,fileListMax:0,fileListSizeMax:0,instantStart:false,appendCookieData:false,fileClass:null},initialize:function(options){this.addEvent('load',this.initializeSwiff,true).addEvent('select',this.processFiles,true).addEvent('complete',this.update,true).addEvent('fileRemove',function(file){this.fileList.erase(file);}.bind(this),true);this.setOptions(options);if(this.options.callBacks){Hash.each(this.options.callBacks,function(fn,name){this.addEvent(name,fn);},this);}
this.options.callBacks={fireCallback:this.fireCallback.bind(this)};var path=this.options.path;if(!path.contains('?'))path+='?noCache='+$time();this.options.container=this.box=new Element('span',{'class':'swiff-uploader-box'}).inject($(this.options.container)||document.body);this.target=$(this.options.target);if(this.target){var scroll=window.getScroll();this.box.setStyles({position:'absolute',visibility:'visible',zIndex:this.options.zIndex,overflow:'hidden',height:1,width:1,top:scroll.y,left:scroll.x});this.parent(path,{params:{wMode:'transparent'},height:'100%',width:'100%'});this.target.addEvent('mouseenter',this.reposition.bind(this,[]));this.addEvents({buttonEnter:this.targetRelay.bind(this,['mouseenter']),buttonLeave:this.targetRelay.bind(this,['mouseleave']),buttonDown:this.targetRelay.bind(this,['mousedown']),buttonDisable:this.targetRelay.bind(this,['disable'])});this.reposition();window.addEvent('resize',this.reposition.bind(this,[]));}else{this.parent(path);}
this.inject(this.box);this.fileList=[];this.size=this.uploading=this.bytesLoaded=this.percentLoaded=0;if(Browser.Plugins.Flash.version<9){this.fireEvent('fail',['flash']);}else{this.verifyLoad.delay(1000,this);}},verifyLoad:function(){if(this.loaded)return;if(!this.object.parentNode){this.fireEvent('fail',['disabled']);}else if(this.object.style.display=='none'){this.fireEvent('fail',['hidden']);}else if(!this.object.offsetWidth){this.fireEvent('fail',['empty']);}},fireCallback:function(name,args){if(name.substr(0,4)=='file'){if(args.length>1)this.update(args[1]);var data=args[0];var file=this.findFile(data.id);this.fireEvent(name,file||data,5);if(file){var fire=name.replace(/^file([A-Z])/,function($0,$1){return $1.toLowerCase();});file.update(data).fireEvent(fire,[data],10);}}else{this.fireEvent(name,args,5);}},update:function(data){$extend(this,data);this.fireEvent('queue',[this],10);return this;},findFile:function(id){for(var i=0;i<this.fileList.length;i++){if(this.fileList[i].id==id)return this.fileList[i];}
return null;},initializeSwiff:function(){this.remote('initialize',{width:this.options.width,height:this.options.height,typeFilter:this.options.typeFilter,multiple:this.options.multiple,queued:this.options.queued,url:this.options.url,method:this.options.method,data:this.options.data,mergeData:this.options.mergeData,fieldName:this.options.fieldName,verbose:this.options.verbose,fileSizeMin:this.options.fileSizeMin,fileSizeMax:this.options.fileSizeMax,allowDuplicates:this.options.allowDuplicates,timeLimit:this.options.timeLimit,buttonImage:this.options.buttonImage,policyFile:this.options.policyFile});this.loaded=true;this.appendCookieData();},targetRelay:function(name){if(this.target)this.target.fireEvent(name);},reposition:function(coords){if($type(coords)=='array'&&coords.length==0){coords=null;}
coords=coords||((this.target&&this.target.offsetHeight)?this.target.getCoordinates():{top:window.getScrollTop(),left:0,width:40,height:40})
if('right'in coords&&(Browser.Engine.webkit||Browser.Engine.trident)&&$try(function(){return $$('html')[0].get('dir')=='rtl'})){coords.right=$$('body')[0].getComputedSize().x-coords.right;}
this.box.setStyles(coords);this.fireEvent('reposition',[coords,this.box,this.target]);},setOptions:function(options){if(options){if(options.url)options.url=Swiff.Uploader.qualifyPath(options.url);if(options.buttonImage)options.buttonImage=Swiff.Uploader.qualifyPath(options.buttonImage);this.parent(options);if(this.loaded)this.remote('setOptions',options);}
return this;},setEnabled:function(status){this.remote('setEnabled',status);},start:function(){this.fireEvent('beforeStart');this.remote('UploadStart');},stop:function(){this.fireEvent('beforeStop');this.remote('UploadStop');},remove:function(){this.fireEvent('beforeRemove');this.remote('remove');},fileStart:function(file){this.remote('fileStart',file.id);},fileStop:function(file){this.remote('fileStop',file.id);},fileRemove:function(file){this.remote('fileRemove',file.id);},fileRequeue:function(file){this.remote('fileRequeue',file.id);},appendCookieData:function(){var append=this.options.appendCookieData;if(!append)return;var hash={};document.cookie.split(/;\s*/).each(function(cookie){cookie=cookie.split('=');if(cookie.length==2){hash[decodeURIComponent(cookie[0])]=decodeURIComponent(cookie[1]);}});var data=this.options.data||{};if($type(append)=='string')data[append]=hash;else $extend(data,hash);this.setOptions({data:data});},processFiles:function(successraw,failraw,queue){var cls=this.options.fileClass||Swiff.Uploader.File;var fail=[],success=[];if(successraw){successraw.each(function(data){var ret=new cls(this,data);if(!ret.validate()){ret.remove.delay(10,ret);fail.push(ret);}else{this.size+=data.size;this.fileList.push(ret);success.push(ret);ret.render();}},this);this.fireEvent('selectSuccess',[success],10);}
if(failraw||fail.length){fail.extend((failraw)?failraw.map(function(data){return new cls(this,data);},this):[]).each(function(file){file.invalidate().render();});this.fireEvent('selectFail',[fail],10);}
this.update(queue);if(this.options.instantStart&&success.length)this.start();}});$extend(Swiff.Uploader,{STATUS_QUEUED:0,STATUS_RUNNING:1,STATUS_ERROR:2,STATUS_COMPLETE:3,STATUS_STOPPED:4,log:function(){if(window.console&&console.info)console.info.apply(console,arguments);},unitLabels:{b:[{min:1,unit:'B'},{min:1024,unit:'kB'},{min:1048576,unit:'MB'},{min:1073741824,unit:'GB'}],s:[{min:1,unit:'s'},{min:60,unit:'m'},{min:3600,unit:'h'},{min:86400,unit:'d'}]},formatUnit:function(base,type,join){var labels=Swiff.Uploader.unitLabels[(type=='bps')?'b':type];var append=(type=='bps')?'/s':'';var i,l=labels.length,value;if(base<1)return'0 '+labels[0].unit+append;if(type=='s'){var units=[];for(i=l-1;i>=0;i--){value=Math.floor(base/labels[i].min);if(value){units.push(value+' '+labels[i].unit);base-=value*labels[i].min;if(!base)break;}}
return(join===false)?units:units.join(join||', ');}
for(i=l-1;i>=0;i--){value=labels[i].min;if(base>=value)break;}
return(base/value).toFixed(1)+' '+labels[i].unit+append;}});Swiff.Uploader.qualifyPath=(function(){var anchor;return function(path){(anchor||(anchor=new Element('a'))).href=path;return anchor.href;};})();Swiff.Uploader.File=new Class({Implements:Events,initialize:function(base,data){this.base=base;this.update(data);},update:function(data){return $extend(this,data);},validate:function(){var options=this.base.options;if(options.fileListMax&&this.base.fileList.length>=options.fileListMax){this.validationError='fileListMax';return false;}
if(options.fileListSizeMax&&(this.base.size+this.size)>options.fileListSizeMax){this.validationError='fileListSizeMax';return false;}
return true;},invalidate:function(){this.invalid=true;this.base.fireEvent('fileInvalid',this,10);return this.fireEvent('invalid',this,10);},render:function(){return this;},setOptions:function(options){if(options){if(options.url)options.url=Swiff.Uploader.qualifyPath(options.url);this.base.remote('fileSetOptions',this.id,options);this.options=$merge(this.options,options);}
return this;},start:function(){this.base.fileStart(this);return this;},stop:function(){this.base.fileStop(this);return this;},remove:function(){this.base.fileRemove(this);return this;},requeue:function(){this.base.fileRequeue(this);}});;Fx.ProgressBar=new Class({Extends:Fx,options:{text:null,url:null,transition:Fx.Transitions.Circ.easeOut,fit:true,link:'cancel'},initialize:function(element,options){this.element=$(element);this.parent(options);var url=this.options.url;if(url){this.element.setStyles({'background-image':'url('+url+')','background-repeat':'no-repeat'});}
if(this.options.fit){url=url||this.element.getStyle('background-image').replace(/^url\(["']?|["']?\)$/g,'');if(url){var fill=new Image();fill.onload=function(){this.fill=fill.width;fill=fill.onload=null;this.set(this.now||0);}.bind(this);fill.src=url;if(!this.fill&&fill.width)fill.onload();}}else{this.set(0);}},start:function(to,total){return this.parent(this.now,(arguments.length==1)?to.limit(0,100):to/total*100);},set:function(to){this.now=to;var css=(this.fill)?(((this.fill/-2)+(to/100)*(this.element.width||1)||0).round()+'px'):((100-to)+'%');this.element.setStyle('backgroundPosition',css+' 0px').title=Math.round(to)+'%';var text=$(this.options.text);if(text)text.set('text',Math.round(to)+'%');return this;}});;var FancyUpload2=new Class({Extends:Swiff.Uploader,options:{queued:1,limitSize:0,limitFiles:0,validateFile:$lambda(true)},initialize:function(status,list,options){this.status=$(status);this.list=$(list);options.fileClass=options.fileClass||FancyUpload2.File;options.fileSizeMax=options.limitSize||options.fileSizeMax;options.fileListMax=options.limitFiles||options.fileListMax;this.parent(options);this.addEvents({'load':this.render,'select':this.onSelect,'cancel':this.onCancel,'start':this.onStart,'queue':this.onQueue,'complete':this.onComplete});},render:function(){this.overallTitle=this.status.getElement('.overall-title');this.currentTitle=this.status.getElement('.current-title');this.currentText=this.status.getElement('.current-text');var progress=this.status.getElement('.overall-progress');this.overallProgress=new Fx.ProgressBar(progress,{text:new Element('span',{'class':'progress-text'}).inject(progress,'after')});progress=this.status.getElement('.current-progress')
this.currentProgress=new Fx.ProgressBar(progress,{text:new Element('span',{'class':'progress-text'}).inject(progress,'after')});this.updateOverall();},onSelect:function(){this.status.removeClass('status-browsing');},onCancel:function(){this.status.removeClass('file-browsing');},onStart:function(){this.status.addClass('file-uploading');this.overallProgress.set(0);},onQueue:function(){this.updateOverall();},onComplete:function(){this.status.removeClass('file-uploading');if(this.size){this.overallProgress.start(100);}else{this.overallProgress.set(0);this.currentProgress.set(0);}},updateOverall:function(){this.overallTitle.set('html',MooTools.lang.get('FancyUpload','progressOverall').substitute({total:Swiff.Uploader.formatUnit(this.size,'b')}));if(!this.size){this.currentTitle.set('html',MooTools.lang.get('FancyUpload','currentTitle'));this.currentText.set('html','');}},upload:function(){this.start();},removeFile:function(){return this.remove();}});FancyUpload2.File=new Class({Extends:Swiff.Uploader.File,render:function(){if(this.invalid){if(this.validationError){var msg=MooTools.lang.get('FancyUpload','validationErrors')[this.validationError]||this.validationError;this.validationErrorMessage=msg.substitute({name:this.name,size:Swiff.Uploader.formatUnit(this.size,'b'),fileSizeMin:Swiff.Uploader.formatUnit(this.base.options.fileSizeMin||0,'b'),fileSizeMax:Swiff.Uploader.formatUnit(this.base.options.fileSizeMax||0,'b'),fileListMax:this.base.options.fileListMax||0,fileListSizeMax:Swiff.Uploader.formatUnit(this.base.options.fileListSizeMax||0,'b')});}
this.remove();return;}
this.addEvents({'start':this.onStart,'progress':this.onProgress,'complete':this.onComplete,'error':this.onError,'remove':this.onRemove});this.info=new Element('span',{'class':'file-info'});this.element=new Element('li',{'class':'file'}).adopt(new Element('span',{'class':'file-size','html':Swiff.Uploader.formatUnit(this.size,'b')}),new Element('a',{'class':'file-remove',href:'#',html:MooTools.lang.get('FancyUpload','remove'),title:MooTools.lang.get('FancyUpload','removeTitle'),events:{click:function(){this.remove();return false;}.bind(this)}}),new Element('span',{'class':'file-name','html':MooTools.lang.get('FancyUpload','fileName').substitute(this)}),this.info).inject(this.base.list);},validate:function(){return(this.parent()&&this.base.options.validateFile(this));},onStart:function(){this.element.addClass('file-uploading');this.base.currentProgress.cancel().set(0);this.base.currentTitle.set('html',MooTools.lang.get('FancyUpload','currentFile').substitute(this));},onProgress:function(){this.base.overallProgress.start(this.base.percentLoaded);this.base.currentText.set('html',MooTools.lang.get('FancyUpload','currentProgress').substitute({rate:(this.progress.rate)?Swiff.Uploader.formatUnit(this.progress.rate,'bps'):'- B',bytesLoaded:Swiff.Uploader.formatUnit(this.progress.bytesLoaded,'b'),timeRemaining:(this.progress.timeRemaining)?Swiff.Uploader.formatUnit(this.progress.timeRemaining,'s'):'-'}));this.base.currentProgress.start(this.progress.percentLoaded);},onComplete:function(){this.element.removeClass('file-uploading');this.base.currentText.set('html','Upload completed');this.base.currentProgress.start(100);if(this.response.error){var msg=MooTools.lang.get('FancyUpload','errors')[this.response.error]||'{error} #{code}';this.errorMessage=msg.substitute($extend({name:this.name,size:Swiff.Uploader.formatUnit(this.size,'b')},this.response));var args=[this,this.errorMessage,this.response];this.fireEvent('error',args).base.fireEvent('fileError',args);}else{this.base.fireEvent('fileSuccess',[this,this.response.text||'']);}},onError:function(){this.element.addClass('file-failed');var error=MooTools.lang.get('FancyUpload','fileError').substitute(this);this.info.set('html','<strong>'+error+':</strong> '+this.errorMessage);},onRemove:function(){this.element.getElements('a').setStyle('visibility','hidden');this.element.fade('out').retrieve('tween').chain(Element.destroy.bind(Element,this.element));}});(function(){var phrases={'progressOverall':'Overall Progress ({total})','currentTitle':'File Progress','currentFile':'Uploading "{name}"','currentProgress':'Upload: {bytesLoaded} with {rate}, {timeRemaining} remaining.','fileName':'{name}','remove':'Remove','removeTitle':'Click to remove this entry.','fileError':'Upload failed','validationErrors':{'duplicate':'{name} already added.','sizeLimitMin':'{name} ({size}) is too small, the minimal file size is {fileSizeMin}.','sizeLimitMax':'{name} ({size}) is too big, the maximal file size is {fileSizeMax}.','fileListMax':'{name} could not be added, amount of {fileListMax} files exceeded.','fileListSizeMax':'{name} ({size}) is too big, overall filesize of {fileListSizeMax} exceeded.'},'errors':{'httpStatus':'Server returned HTTP-Status <code>#{code}</code>','securityError':'Security error occurred ({text})','ioError':'Error caused a send or load operation to fail ({text})'}};if(('en4'in window)&&$type(en4)&&$type(en4.core.language)){$H(phrases).each(function(value,key){if($type(value)=='string'){phrases[key]=en4.core.language.translate(value);}else if($type(value)=='object'){$H(value).each(function(pvalue,pkey){if($type(value)=='string'){phrases[key][pkey]=en4.core.language.translate(pvalue);}});}});}
if(MooTools.lang){MooTools.lang.set('en-US','FancyUpload',phrases);}else{MooTools.lang={data:{'FancyUpload':phrases},get:function(from,key){return this.data[from][key];},set:function(locale,from,data){data[from]=data;}};}})();;var DatePicker=new Class({Implements:Options,d:'',today:'',choice:{},bodysize:{},limit:{},attachTo:null,picker:null,slider:null,oldContents:null,newContents:null,input:null,visual:null,options:{pickerClass:'datepicker',days:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],months:['January','February','March','April','May','June','July','August','September','October','November','December'],dayShort:2,monthShort:3,startDay:1,timePicker:false,timePickerOnly:false,yearPicker:true,yearsPerPage:20,format:'d-m-Y',allowEmpty:false,inputOutputFormat:'U',animationDuration:400,useFadeInOut:!Browser.Engine.trident,startView:'month',positionOffset:{x:0,y:0},minDate:null,maxDate:null,debug:false,toggleElements:null,onShow:$empty,onClose:$empty,onSelect:$empty},initialize:function(attachTo,options){this.attachTo=attachTo;this.setOptions(options).attach();if(this.options.timePickerOnly){this.options.timePicker=true;this.options.startView='time';}
this.formatMinMaxDates();document.addEvent('mousedown',this.close.bind(this));},formatMinMaxDates:function(){if(this.options.minDate&&this.options.minDate.format){this.options.minDate=this.unformat(this.options.minDate.date,this.options.minDate.format);}
if(this.options.maxDate&&this.options.maxDate.format){this.options.maxDate=this.unformat(this.options.maxDate.date,this.options.maxDate.format);this.options.maxDate.setHours(23);this.options.maxDate.setMinutes(59);this.options.maxDate.setSeconds(59);}},attach:function(){if($chk(this.options.toggleElements)){var togglers=$$(this.options.toggleElements);document.addEvents({'keydown':function(e){if(e.key=="tab"){this.close(null,true);}}.bind(this)});};$$(this.attachTo).each(function(item,index){if(item.retrieve('datepicker'))return;if($chk(item.get('value'))){var init_clone_val=this.format(new Date(this.unformat(item.get('value'),this.options.inputOutputFormat)),this.options.format);}else if(!this.options.allowEmpty){var init_clone_val=this.format(new Date(),this.options.format);}else{var init_clone_val='';}
var display=item.getStyle('display');var clone=item.setStyle('display',this.options.debug?display:'none').store('datepicker',true).clone().store('datepicker',true).removeProperty('name').setStyle('display',display).set('value',init_clone_val).inject(item,'after');if($chk(this.options.toggleElements)){togglers[index].setStyle('cursor','pointer').addEvents({'click':function(e){this.onFocus(item,clone);}.bind(this)});clone.addEvents({'blur':function(){item.set('value',clone.get('value'));}});}else{clone.addEvents({'keydown':function(e){if(this.options.allowEmpty&&(e.key=="delete"||e.key=="backspace")){item.set('value','');e.target.set('value','');this.close(null,true);}else if(e.key=="tab"){this.close(null,true);}else{e.stop();}}.bind(this),'focus':function(e){this.onFocus(item,clone);}.bind(this)});}}.bind(this));},onFocus:function(original_input,visual_input){var init_visual_date,d=visual_input.getCoordinates();if($chk(original_input.get('value'))){init_visual_date=this.unformat(original_input.get('value'),this.options.inputOutputFormat).valueOf();}else{init_visual_date=new Date();if($chk(this.options.maxDate)&&init_visual_date.valueOf()>this.options.maxDate.valueOf()){init_visual_date=new Date(this.options.maxDate.valueOf());}
if($chk(this.options.minDate)&&init_visual_date.valueOf()<this.options.minDate.valueOf()){init_visual_date=new Date(this.options.minDate.valueOf());}}
this.show({left:d.left+this.options.positionOffset.x,top:d.top+d.height+this.options.positionOffset.y},init_visual_date);this.input=original_input;this.visual=visual_input;this.options.onShow();},dateToObject:function(d){return{year:d.getFullYear(),month:d.getMonth(),day:d.getDate(),hours:d.getHours(),minutes:d.getMinutes(),seconds:d.getSeconds()};},dateFromObject:function(values){var d=new Date();d.setDate(1);['year','month','day','hours','minutes','seconds'].each(function(type){var v=values[type];if(!$chk(v))return;switch(type){case'day':d.setDate(v);break;case'month':d.setMonth(v);break;case'year':d.setFullYear(v);break;case'hours':d.setHours(v);break;case'minutes':d.setMinutes(v);break;case'seconds':d.setSeconds(v);break;}});return d;},show:function(position,timestamp){this.formatMinMaxDates();if($chk(timestamp)){this.d=new Date(timestamp);}else{this.d=new Date();}
this.today=new Date();this.choice=this.dateToObject(this.d);this.mode=(this.options.startView=='time'&&!this.options.timePicker)?'month':this.options.startView;this.render();this.picker.setStyles(position);},render:function(fx){if(!$chk(this.picker)){this.constructPicker();}else{var o=this.oldContents;this.oldContents=this.newContents;this.newContents=o;this.newContents.empty();}
var startDate=new Date(this.d.getTime());this.limit={right:false,left:false};if(this.mode=='decades'){this.renderDecades();}else if(this.mode=='year'){this.renderYear();}else if(this.mode=='time'){this.renderTime();this.limit={right:true,left:true};}else{this.renderMonth();}
this.picker.getElement('.previous').setStyle('visibility',this.limit.left?'hidden':'visible');this.picker.getElement('.next').setStyle('visibility',this.limit.right?'hidden':'visible');this.picker.getElement('.titleText').setStyle('cursor',this.allowZoomOut()?'pointer':'default');this.d=startDate;if(this.picker.getStyle('opacity')==0){this.picker.tween('opacity',0,1);}
if($chk(fx))this.fx(fx);},fx:function(fx){if(fx=='right'){this.oldContents.setStyles({left:0,opacity:1});this.newContents.setStyles({left:this.bodysize.x,opacity:1});this.slider.setStyle('left',0).tween('left',0,-this.bodysize.x);}else if(fx=='left'){this.oldContents.setStyles({left:this.bodysize.x,opacity:1});this.newContents.setStyles({left:0,opacity:1});this.slider.setStyle('left',-this.bodysize.x).tween('left',-this.bodysize.x,0);}else if(fx=='fade'){this.slider.setStyle('left',0);this.oldContents.setStyle('left',0).set('tween',{duration:this.options.animationDuration/2}).tween('opacity',1,0);this.newContents.setStyles({opacity:0,left:0}).set('tween',{duration:this.options.animationDuration}).tween('opacity',0,1);}},constructPicker:function(){this.picker=new Element('div',{'class':this.options.pickerClass}).inject(document.body);if(this.options.useFadeInOut){this.picker.setStyle('opacity',0).set('tween',{duration:this.options.animationDuration});}
var h=new Element('div',{'class':'header'}).inject(this.picker);var titlecontainer=new Element('div',{'class':'title'}).inject(h);new Element('div',{'class':'previous'}).addEvent('click',this.previous.bind(this)).set('text','').inject(h);new Element('div',{'class':'next'}).addEvent('click',this.next.bind(this)).set('text','').inject(h);new Element('div',{'class':'closeButton'}).addEvent('click',this.close.bindWithEvent(this,true)).set('text','x').inject(h);new Element('span',{'class':'titleText'}).addEvent('click',this.zoomOut.bind(this)).inject(titlecontainer);var b=new Element('div',{'class':'body'}).inject(this.picker);this.bodysize=b.getSize();this.slider=new Element('div',{styles:{position:'absolute',top:0,left:0,width:2*this.bodysize.x,height:this.bodysize.y}}).set('tween',{duration:this.options.animationDuration,transition:Fx.Transitions.Quad.easeInOut}).inject(b);this.oldContents=new Element('div',{styles:{position:'absolute',top:0,left:this.bodysize.x,width:this.bodysize.x,height:this.bodysize.y}}).inject(this.slider);this.newContents=new Element('div',{styles:{position:'absolute',top:0,left:0,width:this.bodysize.x,height:this.bodysize.y}}).inject(this.slider);},renderTime:function(){var container=new Element('div',{'class':'time'}).inject(this.newContents);if(this.options.timePickerOnly){this.picker.getElement('.titleText').set('text','Select a time');}else{this.picker.getElement('.titleText').set('text',this.format(this.d,'j M, Y'));}
new Element('input',{type:'text','class':'hour'}).set('value',this.leadZero(this.d.getHours())).addEvents({mousewheel:function(e){var i=e.target,v=i.get('value').toInt();i.focus();if(e.wheel>0){v=(v<23)?v+1:0;}else{v=(v>0)?v-1:23;}
i.set('value',this.leadZero(v));e.stop();}.bind(this)}).set('maxlength',2).inject(container);new Element('input',{type:'text','class':'minutes'}).set('value',this.leadZero(this.d.getMinutes())).addEvents({mousewheel:function(e){var i=e.target,v=i.get('value').toInt();i.focus();if(e.wheel>0){v=(v<59)?v+1:0;}else{v=(v>0)?v-1:59;}
i.set('value',this.leadZero(v));e.stop();}.bind(this)}).set('maxlength',2).inject(container);new Element('div',{'class':'separator'}).set('text',':').inject(container);new Element('input',{type:'submit',value:'OK','class':'ok'}).addEvents({click:function(e){e.stop();this.select($merge(this.dateToObject(this.d),{hours:this.picker.getElement('.hour').get('value').toInt(),minutes:this.picker.getElement('.minutes').get('value').toInt()}));}.bind(this)}).set('maxlength',2).inject(container);},renderMonth:function(){var month=this.d.getMonth();this.picker.getElement('.titleText').set('text',this.options.months[month]+' '+this.d.getFullYear());this.d.setDate(1);while(this.d.getDay()!=this.options.startDay){this.d.setDate(this.d.getDate()-1);}
var container=new Element('div',{'class':'days'}).inject(this.newContents);var titles=new Element('div',{'class':'titles'}).inject(container);var d,i,classes,e,weekcontainer;for(d=this.options.startDay;d<(this.options.startDay+7);d++){new Element('div',{'class':'title day day'+(d%7)}).set('text',this.options.days[(d%7)].substring(0,this.options.dayShort)).inject(titles);}
var available=false;var t=this.today.toDateString();var currentChoice=this.dateFromObject(this.choice).toDateString();for(i=0;i<42;i++){classes=[];classes.push('day');classes.push('day'+this.d.getDay());if(this.d.toDateString()==t)classes.push('today');if(this.d.toDateString()==currentChoice)classes.push('selected');if(this.d.getMonth()!=month)classes.push('otherMonth');if(i%7==0){weekcontainer=new Element('div',{'class':'week week'+(Math.floor(i/7))}).inject(container);}
e=new Element('div',{'class':classes.join(' ')}).set('text',this.d.getDate()).inject(weekcontainer);if(this.limited('date')){e.addClass('unavailable');if(available){this.limit.right=true;}else if(this.d.getMonth()==month){this.limit.left=true;}}else{available=true;e.addEvent('click',function(e,d){if(this.options.timePicker){this.d.setDate(d.day);this.d.setMonth(d.month);this.mode='time';this.render('fade');}else{this.select(d);}}.bindWithEvent(this,{day:this.d.getDate(),month:this.d.getMonth(),year:this.d.getFullYear()}));}
this.d.setDate(this.d.getDate()+1);}
if(!available)this.limit.right=true;},renderYear:function(){var month=this.today.getMonth();var thisyear=this.d.getFullYear()==this.today.getFullYear();var selectedyear=this.d.getFullYear()==this.choice.year;this.picker.getElement('.titleText').set('text',this.d.getFullYear());this.d.setMonth(0);var i,e;var available=false;var container=new Element('div',{'class':'months'}).inject(this.newContents);for(i=0;i<=11;i++){e=new Element('div',{'class':'month month'+(i+1)+(i==month&&thisyear?' today':'')+(i==this.choice.month&&selectedyear?' selected':'')}).set('text',this.options.monthShort?this.options.months[i].substring(0,this.options.monthShort):this.options.months[i]).inject(container);if(this.limited('month')){e.addClass('unavailable');if(available){this.limit.right=true;}else{this.limit.left=true;}}else{available=true;e.addEvent('click',function(e,d){this.d.setDate(1);this.d.setMonth(d);this.mode='month';this.render('fade');}.bindWithEvent(this,i));}
this.d.setMonth(i);}
if(!available)this.limit.right=true;},renderDecades:function(){while(this.d.getFullYear()%this.options.yearsPerPage>0){this.d.setFullYear(this.d.getFullYear()-1);}
this.picker.getElement('.titleText').set('text',this.d.getFullYear()+'-'+(this.d.getFullYear()+this.options.yearsPerPage-1));var i,y,e;var available=false;var container=new Element('div',{'class':'years'}).inject(this.newContents);if($chk(this.options.minDate)&&this.d.getFullYear()<=this.options.minDate.getFullYear()){this.limit.left=true;}
for(i=0;i<this.options.yearsPerPage;i++){y=this.d.getFullYear();e=new Element('div',{'class':'year year'+i+(y==this.today.getFullYear()?' today':'')+(y==this.choice.year?' selected':'')}).set('text',y).inject(container);if(this.limited('year')){e.addClass('unavailable');if(available){this.limit.right=true;}else{this.limit.left=true;}}else{available=true;e.addEvent('click',function(e,d){this.d.setFullYear(d);this.mode='year';this.render('fade');}.bindWithEvent(this,y));}
this.d.setFullYear(this.d.getFullYear()+1);}
if(!available){this.limit.right=true;}
if($chk(this.options.maxDate)&&this.d.getFullYear()>=this.options.maxDate.getFullYear()){this.limit.right=true;}},limited:function(type){var cs=$chk(this.options.minDate);var ce=$chk(this.options.maxDate);if(!cs&&!ce)return false;switch(type){case'year':return(cs&&this.d.getFullYear()<this.options.minDate.getFullYear())||(ce&&this.d.getFullYear()>this.options.maxDate.getFullYear());case'month':var ms=(''+this.d.getFullYear()+this.leadZero(this.d.getMonth())).toInt();return cs&&ms<(''+this.options.minDate.getFullYear()+this.leadZero(this.options.minDate.getMonth())).toInt()||ce&&ms>(''+this.options.maxDate.getFullYear()+this.leadZero(this.options.maxDate.getMonth())).toInt()
case'date':return(cs&&this.d<this.options.minDate)||(ce&&this.d>this.options.maxDate);}},allowZoomOut:function(){if(this.mode=='time'&&this.options.timePickerOnly)return false;if(this.mode=='decades')return false;if(this.mode=='year'&&!this.options.yearPicker)return false;return true;},zoomOut:function(){if(!this.allowZoomOut())return;if(this.mode=='year'){this.mode='decades';}else if(this.mode=='time'){this.mode='month';}else{this.mode='year';}
this.render('fade');},previous:function(){if(this.mode=='decades'){this.d.setFullYear(this.d.getFullYear()-this.options.yearsPerPage);}else if(this.mode=='year'){this.d.setFullYear(this.d.getFullYear()-1);}else if(this.mode=='month'){this.d.setDate(1);this.d.setMonth(this.d.getMonth()-1);}
this.render('left');},next:function(){if(this.mode=='decades'){this.d.setFullYear(this.d.getFullYear()+this.options.yearsPerPage);}else if(this.mode=='year'){this.d.setFullYear(this.d.getFullYear()+1);}else if(this.mode=='month'){this.d.setDate(1);this.d.setMonth(this.d.getMonth()+1);}
this.render('right');},close:function(e,force){if(!$(this.picker))return;var clickOutside=($chk(e)&&e.target!=this.picker&&!this.picker.hasChild(e.target)&&e.target!=this.visual);if(force||clickOutside){if(this.options.useFadeInOut){this.picker.set('tween',{duration:this.options.animationDuration/2,onComplete:this.destroy.bind(this)}).tween('opacity',1,0);}else{this.destroy();}}},destroy:function(){this.picker.destroy();this.picker=null;this.options.onClose();},select:function(values){this.choice=$merge(this.choice,values);var d=this.dateFromObject(this.choice);this.input.set('value',this.format(d,this.options.inputOutputFormat));this.visual.set('value',this.format(d,this.options.format));this.options.onSelect(d);this.close(null,true);},leadZero:function(v){return v<10?'0'+v:v;},format:function(t,format){var f='';var h=t.getHours();var m=t.getMonth();for(var i=0;i<format.length;i++){switch(format.charAt(i)){case'\\':i++;f+=format.charAt(i);break;case'y':f+=(t.getFullYear()+'').substring(2);break;case'Y':f+=t.getFullYear();break;case'm':f+=this.leadZero(m+1);break;case'n':f+=(m+1);break;case'M':f+=this.options.months[m].substring(0,this.options.monthShort);break;case'F':f+=this.options.months[m];break;case'd':f+=this.leadZero(t.getDate());break;case'j':f+=t.getDate();break;case'D':f+=this.options.days[t.getDay()].substring(0,this.options.dayShort);break;case'l':f+=this.options.days[t.getDay()];break;case'G':f+=h;break;case'H':f+=this.leadZero(h);break;case'g':f+=(h%12?h%12:12);break;case'h':f+=this.leadZero(h%12?h%12:12);break;case'a':f+=(h>11?'pm':'am');break;case'A':f+=(h>11?'PM':'AM');break;case'i':f+=this.leadZero(t.getMinutes());break;case's':f+=this.leadZero(t.getSeconds());break;case'U':f+=Math.floor(t.valueOf()/1000);break;default:f+=format.charAt(i);}}
return f;},unformat:function(t,format){var d=new Date();d.setMonth(0);d.setDate(1);var a={};var c,m;t=t.toString();for(var i=0;i<format.length;i++){c=format.charAt(i);switch(c){case'\\':r=null;i++;break;case'y':r='[0-9]{2}';break;case'Y':r='[0-9]{4}';break;case'm':r='0[1-9]|1[012]';break;case'n':r='[1-9]|1[012]';break;case'M':r='[A-Za-z]{'+this.options.monthShort+'}';break;case'F':r='[A-Za-z]+';break;case'd':r='0[1-9]|[12][0-9]|3[01]';break;case'j':r='[12][0-9]|3[01]|[1-9]';break;case'D':r='[A-Za-z]{'+this.options.dayShort+'}';break;case'l':r='[A-Za-z]+';break;case'G':case'H':case'g':case'h':r='[0-9]{1,2}';break;case'a':r='(am|pm)';break;case'A':r='(AM|PM)';break;case'i':case's':r='[012345][0-9]';break;case'U':r='-?[0-9]+$';break;default:r=null;}
if($chk(r)){m=t.match('^'+r);if($chk(m)){a[c]=m[0];t=t.substring(a[c].length);}else{if(this.options.debug)alert("Fatal Error in DatePicker\n\nUnexpected format at: '"+t+"' expected format character '"+c+"' (pattern '"+r+"')");return d;}}else{t=t.substring(1);}}
for(c in a){var v=a[c];switch(c){case'y':d.setFullYear(v<30?2000+v.toInt():1900+v.toInt());break;case'Y':d.setFullYear(v);break;case'm':case'n':d.setMonth(v-1);break;case'M':v=this.options.months.filter(function(item,index){return item.substring(0,this.options.monthShort)==v}.bind(this))[0];case'F':d.setMonth(this.options.months.indexOf(v));break;case'd':case'j':d.setDate(v);break;case'G':case'H':d.setHours(v);break;case'g':case'h':if(a['a']=='pm'||a['A']=='PM'){d.setHours(v==12?0:v.toInt()+12);}else{d.setHours(v);}break;case'i':d.setMinutes(v);break;case's':d.setSeconds(v);break;case'U':d=new Date(v.toInt()*1000);}};return d;}});