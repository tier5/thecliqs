en4.ynfilesharing={foldersPermissions:[],parentType:null,parentId:null,_getURI:function(action){var uri=null;url='';if(action=='delete'){url=en4.core.baseUrl+'filesharing/index/delete/parent_type/{parent_type}/parent_id/{parent_id}';}else if(action=='move'){url=en4.core.baseUrl+'filesharing/index/move/parent_type/{parent_type}/parent_id/{parent_id}';}
if(url.length>0){url=url.substitute({'parent_type':this.parentType,'parent_id':this.parentId});uri=new URI(url);}
return uri;},_handleDeleteAndMove:function(event,action){event.stop();var listFilesAndFolders=[];Array.each($$('.ynfs_browse li.ynfs_item input[type="checkbox"]'),function(item,index){if(item.checked){listFilesAndFolders.push(item);}});if(listFilesAndFolders.length>1)
{var folderIds=[];var fileIds=[];for(var i=0;i<listFilesAndFolders.length;i++){var item=listFilesAndFolders[i];if(item.get('name')=='folderIds[]'){var ck=true;var folderId=item.get('value');var folderPermissions=en4.ynfilesharing.getPermissionOfFolder(folderId);if(action=='move'){var parent=en4.ynfilesharing.getParentItem(folderId,'folder');if(!(parent.parentType==this.parentType&&parent.parentId==this.parentId)){ck=false;}}else{if(!en4.ynfilesharing.getPermissionOfFolder(folderId).contains(action)){ck=false;}}
if(ck==false){alert(en4.core.language.translate('You do not permission to %s the folder %s',action,en4.ynfilesharing.getItemName(folderId,'folder')));return;}
folderIds.push(folderId);}else{var fileId=item.get('value');if(action=='move'){var parent=en4.ynfilesharing.getParentItem(fileId,'file');if(!(parent.parentType==this.parentType&&parent.parentId==this.parentId)){alert(en4.core.language.translate('You do not permission to %s the file %s',action,en4.ynfilesharing.getItemName(fileId,'file')));return;}}
fileIds.push(fileId);}}
var uri=this._getURI(action);if(folderIds.length>0){uri.setData('folderIds',folderIds);}
if(fileIds.length>0){uri.setData('fileIds',fileIds);}
Smoothbox.open(uri.toString());}
else
{Smoothbox.open(event.target);}},_deleteFoldersAndFiles:function(event){en4.ynfilesharing._handleDeleteAndMove(event,'delete');},_moveFoldersAndFiles:function(event){en4.ynfilesharing._handleDeleteAndMove(event,'move');},setOptions:function(options){for(opt in options){if(this.hasOwnProperty(opt)){this[opt]=options[opt];}}},setFoldersPermissions:function(folderPerms){en4.ynfilesharing.foldersPermissions=folderPerms;},getPermissionOfFolder:function(folderId){return this.foldersPermissions[folderId];},getItemName:function(itemId,type){var name='';var ele;var items=$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item');for(var i=0;i<items.length;i++){if(type=='folder'){if(items[i].getProperty('folderId')==itemId){ele=items[i];}}else{if(type=='file'){if(items[i].getProperty('fileId')==itemId){ele=items[i];}}}}
var nameEle=ele.getFirst('.ynfs_name_column  > a');if(nameEle){return nameEle.get('text').trim();}},getParentItem:function(itemId,type){var items=$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item');var ele=null;for(var i=0;i<items.length;i++){if(type=='folder'){if(items[i].getProperty('folderId')==itemId){ele=items[i];break;}}else{if(items[i].getProperty('fileId')==itemId){ele=items[i];break;}}}
if(ele){return{'parentType':ele.getProperty('parentType'),'parentId':ele.getProperty('parentId')};}},showControlForFolder:function(folderId,controlColumn,parentType,parentId){var permissions=en4.ynfilesharing.getPermissionOfFolder(folderId);var editElement=null;var deleteElement=null;var moveElement=null;var shareElement=null;if(permissions==null||permissions.contains('edit')){editElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/folder/edit/'+folderId,'html':en4.core.language.translate('Edit'),'class':'buttonlink ynfs_control_edit'});if(parentType==this.parentType&&parentId==this.parentId){var moveUrl='filesharing/index/move/folder_id/{folder_id}/parent_type/{parent_type}/parent_id/{parent_id}/format/smoothbox';moveElement=new Element('a',{'href':en4.core.baseUrl+moveUrl.substitute({'parent_type':this.parentType,'parent_id':this.parentId,'folder_id':folderId}),'html':en4.core.language.translate('Move'),'class':'buttonlink ynfs_control_move'});moveElement.addEvent('click',this._moveFoldersAndFiles);}}
if(permissions==null||permissions.contains('delete')){deleteElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/folder/delete/'+folderId,'html':en4.core.language.translate('Delete'),'class':'buttonlink ynfs_control_delete'});deleteElement.addEvent('click',this._deleteFoldersAndFiles);}
if(parentType==this.parentType&&parentId==this.parentId){shareElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/index/share/folder_id/'+folderId+'/format/smoothbox','html':en4.core.language.translate('Share'),'class':'buttonlink ynfs_control_share'});shareElement.addEvent('click',function(event){event.stop();Smoothbox.open(shareElement);});}
if(shareElement!=null){shareElement.inject(controlColumn);}
if(editElement!=null){editElement.inject(controlColumn);}
if(deleteElement!=null){deleteElement.inject(controlColumn);}
if(moveElement!=null){moveElement.inject(controlColumn);}
fileSizeElement=$("ynfilesharing_filesize");if(fileSizeElement!=null)
fileSizeElement.destroy();},showControlForFile:function(currentFolderId,fileId,controlColumn,parentType,parentId){var permissions=en4.ynfilesharing.getPermissionOfFolder(currentFolderId);var editElement=null;var deleteElement=null;var moveElement=null;var fileSizeElement=null;var shareElement=null;if(permissions!=null&&permissions.contains('edit')){editElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/file/edit/'+fileId,'html':en4.core.language.translate('Edit'),'class':'buttonlink ynfs_control_edit'});editElement.addEvent('click',function(event){event.stop();Smoothbox.open(editElement);});if(parentType==this.parentType&&parentId==this.parentId){var moveUrl='filesharing/index/move/file_id/{file_id}/parent_type/{parent_type}/parent_id/{parent_id}';moveElement=new Element('a',{'href':en4.core.baseUrl+moveUrl.substitute({'parent_type':this.parentType,'parent_id':this.parentId,'file_id':fileId}),'html':en4.core.language.translate('Move'),'class':'buttonlink ynfs_control_move'});}
if(moveElement){moveElement.addEvent('click',this._moveFoldersAndFiles);}}
if(permissions!=null&&permissions.contains('delete')){deleteElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/file/delete/'+fileId,'html':en4.core.language.translate('Delete'),'class':'buttonlink ynfs_control_delete'});deleteElement.addEvent('click',en4.ynfilesharing._deleteFoldersAndFiles);}
if(parentType==this.parentType&&parentId==this.parentId){shareElement=new Element('a',{'href':en4.core.baseUrl+'filesharing/index/share/file_id/'+fileId+'/format/smoothbox','html':en4.core.language.translate('Share'),'class':'buttonlink ynfs_control_share'});shareElement.addEvent('click',function(event){event.stop();Smoothbox.open(shareElement);});}
fileSizeElement=$("ynfilesharing_filesize");if(fileSizeElement!=null)
fileSizeElement.destroy();fileSizeElement=document.createElement('span');fileSizeElement.setAttribute('id','ynfilesharing_filesize');fileSizeElement.innerHTML=en4.ynfilesharing.formatFileSize($$("li[fileid="+fileId+"]").get('size'));if(shareElement!=null){shareElement.inject(controlColumn);}
if(editElement!=null){editElement.inject(controlColumn);}
if(deleteElement!=null){deleteElement.inject(controlColumn);}
if(moveElement!=null){moveElement.inject(controlColumn);}
if(fileSizeElement!=null){$(fileSizeElement).inject(controlColumn);}},roundNumber:function(number,digits){var multiple=Math.pow(10,digits);var rndedNum=Math.round(number*multiple)/multiple;return rndedNum;},formatFileSize:function(size){fileSize=parseInt(size);sizeKB=1024;sizeMB=1024*1024;if(fileSize>sizeKB&&fileSize<sizeMB)
return en4.ynfilesharing.roundNumber(fileSize/sizeKB,2)+en4.core.language.translate(" KB");else if(fileSize>sizeMB)
return en4.ynfilesharing.roundNumber(fileSize/sizeMB,2)+en4.core.language.translate(" MB");else
return String(fileSize)+en4.core.language.translate(" Bytes");},cancelUploadFile:function(){if(upload.inputFiles){upload.inputFiles._files.length=0;$$(".ynfs_uploadList").set('html','');$("file").value
$('uploadForm').hide();}
else
{window.location=window.location;}},showControls:function(element){element.addClass('ynfs_item_selected').removeClass('ynfs_item_hover');var controlsElement=element.getSiblings('.ynfs_browse_control')[0];controlsElement.getElements('a').destroy();controlsElement.set('styles',{'display':'block'});var titleElement=element.getSiblings('.ynfs_browse_title')[0];titleElement.set('styles',{'display':'none'});var controlColumn=controlsElement.getElement('.ynfs_control_column');var folderId=element.getProperty('folderId');if(folderId)
{var parentType=element.getProperty('parentType');var parentId=element.getProperty('parentId');en4.ynfilesharing.showControlForFolder(folderId,controlColumn,parentType,parentId);}
else
{currentFolderId=element.getProperty('currentFolerId');fileId=element.getProperty('fileId');var parentType=element.getProperty('parentType');var parentId=element.getProperty('parentId');en4.ynfilesharing.showControlForFile(currentFolderId,fileId,controlColumn,parentType,parentId);}},showHeader:function(){$(document.body).getElements('li.ynfs_browse_title').set('styles',{'display':'block'});$(document.body).getElements('li.ynfs_browse_control').set('styles',{'display':'none'});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item_selected').removeClass('ynfs_item_selected');}}
en4.core.runonce.add(function(){$(document.body).addEvent('click',function(e){var parent=e.target.getParent();if(parent&&parent.contains($('ynfs_control_browse'))){en4.ynfilesharing.showHeader();}});$$('.ynfs_checkall').addEvent('click',function(e){var checked=e.target.checked;Array.each($$('.ynfs_browse li input[type="checkbox"]'),function(item,index){item.checked=checked;var eleLi=item.getParent('li.ynfs_item');if(eleLi){if(checked){eleLi.addClass('ynfs_item_selected');}else{eleLi.removeClass('ynfs_item_selected');}}});if(checked){var selectedItems=$$('.ynfs_browse .ynfs_item.ynfs_item_selected');if(selectedItems.length>0){en4.ynfilesharing.showControls(selectedItems[0]);}}else{en4.ynfilesharing.showHeader();}});$$('.ynfs_browse li.ynfs_item input[type="checkbox"]').removeEvent('click').addEvent('click',function(e){var checked=e.target.checked;if(!checked){Array.each($$('.ynfs_checkall'),function(item,index){item.checked=false;});}else{var checkAll=true;var ckboxes=$$('.ynfs_browse li.ynfs_item input[type="checkbox"]');for(var i=0;i<ckboxes.length;i++){if(!ckboxes[i].checked){checkAll=false;break;}}
if(checkAll){Array.each($$('.ynfs_checkall'),function(item,index){item.checked=true;});}}
var eleLi=e.target.getParent('li.ynfs_item');if(!checked){eleLi.removeClass('ynfs_item_selected');var ckboxes=$$('.ynfs_browse li.ynfs_item input[type="checkbox"]');var notCheckAll=true;for(var i=0;i<ckboxes.length;i++){if(ckboxes[i].checked){notCheckAll=false;break;}}
if(notCheckAll){en4.ynfilesharing.showHeader();}}else{eleLi.addClass('ynfs_item_selected');en4.ynfilesharing.showControls(eleLi);}});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item').removeEvent('mouseenter').addEvent('mouseenter',function(event){var element=event.target;if(!element.hasClass('ynfs_item_selected')){element.addClass('ynfs_item_hover');}});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item').removeEvent('mouseleave').addEvent('mouseleave',function(event){var element=event.target;element.removeClass('ynfs_item_hover');});$$('.ynfs_browse.ynfs_control > ul > li.ynfs_item').removeEvent('click').addEvent('click',function(event){var element=event.target;if(element.get('tag')!='input'){if(element.get('tag')!='li'){element=element.getParent('li');}
Array.each(element.getSiblings(),function(item,index){if(item.getFirst('.ynfs_check_column').getFirst().checked==false){item.removeClass('ynfs_item_selected');}});en4.ynfilesharing.showControls(element);}});});;var Picker=new Class({Implements:[Options,Events],options:{pickerClass:'datepicker',inject:null,animationDuration:400,useFadeInOut:true,positionOffset:{x:0,y:0},pickerPosition:'bottom',draggable:true,showOnInit:true,columns:1,footer:false},initialize:function(options){this.setOptions(options);this.constructPicker();if(this.options.showOnInit)this.show();},constructPicker:function(){var options=this.options;var picker=this.picker=new Element('div',{'class':options.pickerClass,styles:{left:0,top:0,display:'none',opacity:0}}).inject(options.inject||document.body);picker.addClass('column_'+options.columns);if(options.useFadeInOut){picker.set('tween',{duration:options.animationDuration,link:'cancel'});}
var header=this.header=new Element('div.header').inject(picker);var title=this.title=new Element('div.title').inject(header);var titleID=this.titleID='pickertitle-'+String.uniqueID();this.titleText=new Element('div',{'role':'heading','class':'titleText','id':titleID,'aria-live':'assertive','aria-atomic':'true'}).inject(title);this.closeButton=new Element('div.closeButton[text=x][role=button]').addEvent('click',this.close.pass(false,this)).inject(header);var body=this.body=new Element('div.body').inject(picker);if(options.footer){this.footer=new Element('div.footer').inject(picker);picker.addClass('footer');}
var slider=this.slider=new Element('div.slider',{styles:{position:'absolute',top:0,left:0}}).set('tween',{duration:options.animationDuration,transition:Fx.Transitions.Quad.easeInOut}).inject(body);this.newContents=new Element('div',{styles:{position:'absolute',top:0,left:0}}).inject(slider);this.oldContents=new Element('div',{styles:{position:'absolute',top:0}}).inject(slider);this.originalColumns=options.columns;this.setColumns(options.columns);var shim=this.shim=window['IframeShim']?new IframeShim(picker):null;if(options.draggable&&typeOf(picker.makeDraggable)=='function'){this.dragger=picker.makeDraggable(shim?{onDrag:shim.position.bind(shim)}:null);picker.setStyle('cursor','move');}},open:function(noFx){if(this.opened==true)return this;this.opened=true;var picker=this.picker.setStyle('display','block').set('aria-hidden','false')
if(this.shim)this.shim.show();this.fireEvent('open');if(this.options.useFadeInOut&&!noFx){picker.fade('in').get('tween').chain(this.fireEvent.pass('show',this));}else{picker.setStyle('opacity',1);this.fireEvent('show');}
return this;},show:function(){return this.open(true);},close:function(noFx){if(this.opened==false)return this;this.opened=false;this.fireEvent('close');var self=this,picker=this.picker,hide=function(){picker.setStyle('display','none').set('aria-hidden','true');if(self.shim)self.shim.hide();self.fireEvent('hide');};if(this.options.useFadeInOut&&!noFx){picker.fade('out').get('tween').chain(hide);}else{picker.setStyle('opacity',0);hide();}
return this;},hide:function(){return this.close(true);},toggle:function(){return this[this.opened==true?'close':'open']();},destroy:function(){this.picker.destroy();if(this.shim)this.shim.destroy();},position:function(x,y){var offset=this.options.positionOffset,scroll=document.getScroll(),size=document.getSize(),pickersize=this.picker.getSize();if(typeOf(x)=='element'){var element=x,where=y||this.options.pickerPosition;var elementCoords=element.getCoordinates();x=(where=='left')?elementCoords.left-pickersize.x:(where=='bottom'||where=='top')?elementCoords.left:elementCoords.right
y=(where=='bottom')?elementCoords.bottom:(where=='top')?elementCoords.top-pickersize.y:elementCoords.top;}
x+=offset.x*((where&&where=='left')?-1:1);y+=offset.y*((where&&where=='top')?-1:1);if((x+pickersize.x)>(size.x+scroll.x))x=(size.x+scroll.x)-pickersize.x;if((y+pickersize.y)>(size.y+scroll.y))y=(size.y+scroll.y)-pickersize.y;if(x<0)x=0;if(y<0)y=0;x=x-124;this.picker.setStyles({left:x,top:y});if(this.shim)this.shim.position();return this;},setBodySize:function(){var bodysize=this.bodysize=this.body.getSize();this.slider.setStyles({width:2*bodysize.x,height:bodysize.y});this.oldContents.setStyles({left:bodysize.x,width:bodysize.x,height:bodysize.y});this.newContents.setStyles({width:bodysize.x,height:bodysize.y});},setColumnContent:function(column,content){var columnElement=this.columns[column];if(!columnElement)return this;var type=typeOf(content);if(['string','number'].contains(type))columnElement.set('text',content);else columnElement.empty().adopt(content);return this;},setColumnsContent:function(content,fx){var old=this.columns;this.columns=this.newColumns;this.newColumns=old;content.forEach(function(_content,i){this.setColumnContent(i,_content);},this);return this.setContent(null,fx);},setColumns:function(columns){var _columns=this.columns=new Elements,_newColumns=this.newColumns=new Elements;for(var i=columns;i--;){_columns.push(new Element('div.column').addClass('column_'+(columns-i)));_newColumns.push(new Element('div.column').addClass('column_'+(columns-i)));}
var oldClass='column_'+this.options.columns,newClass='column_'+columns;this.picker.removeClass(oldClass).addClass(newClass);this.options.columns=columns;return this;},setContent:function(content,fx){if(content)return this.setColumnsContent([content],fx);var old=this.oldContents;this.oldContents=this.newContents;this.newContents=old;this.newContents.empty();this.newContents.adopt(this.columns);this.setBodySize();if(fx){this.fx(fx);}else{this.slider.setStyle('left',0);this.oldContents.setStyles({left:0,opacity:0});this.newContents.setStyles({left:0,opacity:1});}
return this;},fx:function(fx){var oldContents=this.oldContents,newContents=this.newContents,slider=this.slider,bodysize=this.bodysize;if(fx=='right'){oldContents.setStyles({left:0,opacity:1});newContents.setStyles({left:bodysize.x,opacity:1});slider.setStyle('left',0).tween('left',0,-bodysize.x);}else if(fx=='left'){oldContents.setStyles({left:bodysize.x,opacity:1});newContents.setStyles({left:0,opacity:1});slider.setStyle('left',-bodysize.x).tween('left',-bodysize.x,0);}else if(fx=='fade'){slider.setStyle('left',0);oldContents.setStyle('left',0).set('tween',{duration:this.options.animationDuration/2}).tween('opacity',1,0).get('tween').chain(function(){oldContents.setStyle('left',bodysize.x);});newContents.setStyles({opacity:0,left:0}).set('tween',{duration:this.options.animationDuration}).tween('opacity',0,1);}},toElement:function(){return this.picker;},setTitle:function(content,fn){if(!fn)fn=Function.from;this.titleText.empty().adopt(Array.from(content).map(function(item,i){return typeOf(item)=='element'?item:new Element('div.column',{text:fn(item,this.options)}).addClass('column_'+(i+1));},this));return this;},setTitleEvent:function(fn){this.titleText.removeEvents('click');if(fn)this.titleText.addEvent('click',fn);this.titleText.setStyle('cursor',fn?'pointer':'');return this;}});Picker.Attach=new Class({Extends:Picker,options:{togglesOnly:true,showOnInit:false,blockKeydown:true},initialize:function(attachTo,options){this.parent(options);this.attachedEvents=[];this.attachedElements=[];this.toggles=[];this.inputs=[];var documentEvent=function(event){if(this.attachedElements.contains(event.target))return;this.close();}.bind(this);var document=this.picker.getDocument().addEvent('click',documentEvent);var preventPickerClick=function(event){event.stopPropagation();return false;};this.picker.addEvent('click',preventPickerClick);if(this.options.toggleElements)this.options.toggle=document.getElements(this.options.toggleElements);this.attach(attachTo,this.options.toggle);},attach:function(attachTo,toggle){if(typeOf(attachTo)=='string')attachTo=document.id(attachTo);if(typeOf(toggle)=='string')toggle=document.id(toggle);var elements=Array.from(attachTo),toggles=Array.from(toggle),allElements=[].append(elements).combine(toggles),self=this;var closeEvent=function(event){var stopInput=self.options.blockKeydown&&event.type=='keydown'&&!(['tab','esc'].contains(event.key)),isCloseKey=event.type=='keydown'&&(['tab','esc'].contains(event.key)),isA=event.target.get('tag')=='a';if(stopInput||isA)event.preventDefault();if(isCloseKey||isA)self.close();};var getOpenEvent=function(element){return function(event){var tag=event.target.get('tag');if(tag=='input'&&event.type=='click'&&!element.match(':focus')||(self.opened&&self.input==element))return;if(tag=='a')event.stop();self.position(element);self.open();self.fireEvent('attached',[event,element]);};};var getToggleEvent=function(open,close){return function(event){if(self.opened)close(event);else open(event);};};allElements.each(function(element){if(self.attachedElements.contains(element))return;var events={},tag=element.get('tag'),openEvent=getOpenEvent(element),toggleEvent=getToggleEvent(openEvent,closeEvent);if(tag=='input'){if(!self.options.togglesOnly||!toggles.length){events={focus:openEvent,click:openEvent,keydown:closeEvent};}
self.inputs.push(element);}else{if(toggles.contains(element)){self.toggles.push(element);events.click=toggleEvent}else{events.click=openEvent;}}
element.addEvents(events);self.attachedElements.push(element);self.attachedEvents.push(events);});return this;},detach:function(attachTo,toggle){if(typeOf(attachTo)=='string')attachTo=document.id(attachTo);if(typeOf(toggle)=='string')toggle=document.id(toggle);var elements=Array.from(attachTo),toggles=Array.from(toggle),allElements=[].append(elements).combine(toggles),self=this;if(!allElements.length)allElements=self.attachedElements;allElements.each(function(element){var i=self.attachedElements.indexOf(element);if(i<0)return;var events=self.attachedEvents[i];element.removeEvents(events);delete self.attachedEvents[i];delete self.attachedElements[i];var toggleIndex=self.toggles.indexOf(element);if(toggleIndex!=-1)delete self.toggles[toggleIndex];var inputIndex=self.inputs.indexOf(element);if(toggleIndex!=-1)delete self.inputs[inputIndex];});return this;},destroy:function(){this.detach();return this.parent();}});String.prototype.leftpad=function(padString,length){var str=this;while(str.length<length)
str=padString+str;return str;}
function getShortDateString(d){return d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate();}
(function(){this.DatePicker=Picker.Date=new Class({Extends:Picker.Attach,options:{format:'%m-%d-%Y',timePicker:false,timePickerOnly:false,timeWheelStep:1,yearPicker:true,yearsPerPage:20,fnAfterRender:false,startDay:0,rtl:(en4.orientation=='rtl'),startView:'days',openLastView:false,pickOnly:false,canAlwaysGoUp:['months','days'],updateAll:false,weeknumbers:false,months_abbr:null,days_abbr:null,years_title:function(date,options){var year=date.get('year');return year+'-'+(year+options.yearsPerPage-1);},months_title:function(date,options){return date.get('year');},days_title:function(date,options){return date.format('%b %Y');},time_title:function(date,options){return(options.pickOnly=='time')?en4.core.language.translate('select a time'):date.format('%d %B, %Y');}},initialize:function(attachTo,options){this.parent(attachTo,options);this.setOptions(options);options=this.options;this.options.days_abbr=[en4.core.language.translate('Sun'),en4.core.language.translate('Mon'),en4.core.language.translate('Tue'),en4.core.language.translate('Wed'),en4.core.language.translate('Thu'),en4.core.language.translate('Fri'),en4.core.language.translate('Sat')];['year','month','day','time'].some(function(what){if(options[what+'PickerOnly']){options.pickOnly=what;return true;}
return false;});if(options.pickOnly){options[options.pickOnly+'Picker']=true;options.startView=options.pickOnly;}
var newViews=['days','months','years'];['month','year','decades'].some(function(what,i){return(options.startView==what)&&(options.startView=newViews[i]);});options.canAlwaysGoUp=options.canAlwaysGoUp?Array.from(options.canAlwaysGoUp):[];if(options.minDate){if(!(options.minDate instanceof Date))options.minDate=Date.parse(options.minDate);options.minDate.clearTime();}
if(options.maxDate){if(!(options.maxDate instanceof Date))options.maxDate=Date.parse(options.maxDate);options.maxDate.clearTime();}
if(!options.format){options.format=(options.pickOnly!='time')?Locale.get('Date.shortDate'):'';if(options.timePicker)options.format=(options.format)+(options.format?' ':'')+Locale.get('Date.shortTime');}
this.addEvent('attached',function(event,element){if(!this.currentView||!options.openLastView)this.currentView=options.startView;this.date=limitDate(new Date(),options.minDate,options.maxDate);var tag=element.get('tag'),input;if(tag=='input')input=element;else{var index=this.toggles.indexOf(element);if(this.inputs[index])input=this.inputs[index];}
this.getInputDate(input);this.input=input;this.setColumns(this.originalColumns);}.bind(this),true);},getInputDate:function(input){this.date=new Date();if(!input)return;var date=Date.parse(input.get('value'));if(date==null||!date.isValid()){var storeDate=input.retrieve('datepicker:value');if(storeDate)date=Date.parse(storeDate);}
if(date!=null&&date.isValid())this.date=date;},constructPicker:function(){this.parent();if(!this.options.rtl){this.previous=new Element('div.previous[html=&#171;]').inject(this.header);this.next=new Element('div.next[html=&#187;]').inject(this.header);}else{this.next=new Element('div.previous[html=&#171;]').inject(this.header);this.previous=new Element('div.next[html=&#187;]').inject(this.header);}},hidePrevious:function(_next,_show){this[_next?'next':'previous'].setStyle('display',_show?'block':'none');return this;},showPrevious:function(_next){return this.hidePrevious(_next,true);},setPreviousEvent:function(fn,_next){this[_next?'next':'previous'].removeEvents('click');if(fn)this[_next?'next':'previous'].addEvent('click',fn);return this;},hideNext:function(){return this.hidePrevious(true);},showNext:function(){return this.showPrevious(true);},setNextEvent:function(fn){return this.setPreviousEvent(fn,true);},setColumns:function(columns,view,date,viewFx){var ret=this.parent(columns),method;if((view||this.currentView)&&(method='render'+(view||this.currentView).capitalize())&&this[method])this[method](date||this.date.clone(),viewFx);return ret;},renderYears:function(date,fx){var options=this.options,pages=options.columns,perPage=options.yearsPerPage,_columns=[],_dates=[];this.dateElements=[];date=date.clone().decrement('year',date.get('year')%perPage);var iterateDate=date.clone().decrement('year',Math.floor((pages-1)/2)*perPage);for(var i=pages;i--;){var _date=iterateDate.clone();_dates.push(_date);_columns.push(renderers.years(timesSelectors.years(options,_date.clone()),options,this.date.clone(),this.dateElements,function(date){if(options.pickOnly=='years')this.select(date);else this.renderMonths(date,'fade');this.date=date;}.bind(this)));iterateDate.increment('year',perPage);}
this.setColumnsContent(_columns,fx);this.setTitle(_dates,options.years_title);var limitLeft=(options.minDate&&date.get('year')<=options.minDate.get('year')),limitRight=(options.maxDate&&(date.get('year')+options.yearsPerPage)>=options.maxDate.get('year'));this[(limitLeft?'hide':'show')+'Previous']();this[(limitRight?'hide':'show')+'Next']();this.setPreviousEvent(function(){this.renderYears(date.decrement('year',perPage),'left');}.bind(this));this.setNextEvent(function(){this.renderYears(date.increment('year',perPage),'right');}.bind(this));this.setTitleEvent(null);this.currentView='years';},renderMonths:function(date,fx){var options=this.options,years=options.columns,_columns=[],_dates=[],iterateDate=date.clone().decrement('year',Math.floor((years-1)/2));this.dateElements=[];for(var i=years;i--;){var _date=iterateDate.clone();_dates.push(_date);_columns.push(renderers.months(timesSelectors.months(options,_date.clone()),options,this.date.clone(),this.dateElements,function(date){if(options.pickOnly=='months')this.select(date);else this.renderDays(date,'fade');this.date=date;}.bind(this)));iterateDate.increment('year',1);}
this.setColumnsContent(_columns,fx);this.setTitle(_dates,options.months_title);var year=date.get('year'),limitLeft=(options.minDate&&year<=options.minDate.get('year')),limitRight=(options.maxDate&&year>=options.maxDate.get('year'));this[(limitLeft?'hide':'show')+'Previous']();this[(limitRight?'hide':'show')+'Next']();this.setPreviousEvent(function(){this.renderMonths(date.decrement('year',years),'left');}.bind(this));this.setNextEvent(function(){this.renderMonths(date.increment('year',years),'right');}.bind(this));var canGoUp=options.yearPicker&&(options.pickOnly!='months'||options.canAlwaysGoUp.contains('months'));var titleEvent=(canGoUp)?function(){this.renderYears(date,'fade');}.bind(this):null;this.setTitleEvent(titleEvent);this.currentView='months';},renderDays:function(date,fx){var options=this.options,months=options.columns,_columns=[],_dates=[],iterateDate=date.clone().decrement('month',Math.floor((months-1)/2));this.dateElements=[];for(var i=months;i--;){_date=iterateDate.clone();_dates.push(_date);_columns.push(renderers.days(timesSelectors.days(options,_date.clone()),options,this.date.clone(),this.dateElements,function(date){if(options.pickOnly=='days'||!options.timePicker)this.select(date)
else this.renderTime(date,'fade');this.date=date;}.bind(this)));iterateDate.increment('month',1);}
this.setColumnsContent(_columns,fx);this.setTitle(_dates,options.days_title);var yearmonth=date.format('%Y%m').toInt(),limitLeft=(options.minDate&&yearmonth<=options.minDate.format('%Y%m')),limitRight=(options.maxDate&&yearmonth>=options.maxDate.format('%Y%m'));this[(limitLeft?'hide':'show')+'Previous']();this[(limitRight?'hide':'show')+'Next']();this.setPreviousEvent(function(){this.renderDays(date.decrement('month',months),'left');}.bind(this));this.setNextEvent(function(){this.renderDays(date.increment('month',months),'right');}.bind(this));var canGoUp=options.pickOnly!='days'||options.canAlwaysGoUp.contains('days');var titleEvent=(canGoUp)?function(){this.renderMonths(date,'fade');}.bind(this):null;this.setTitleEvent(titleEvent);this.currentView='days';if(this.options.fnAfterRender){this.options.fnAfterRender(date);}},renderTime:function(date,fx){var options=this.options;this.setTitle(date,options.time_title);var originalColumns=this.originalColumns=options.columns;this.currentView=null;if(originalColumns!=1)this.setColumns(1);this.setContent(renderers.time(options,date.clone(),function(date){this.select(date);}.bind(this)),fx);this.hidePrevious().hideNext().setPreviousEvent(null).setNextEvent(null);var canGoUp=options.pickOnly!='time'||options.canAlwaysGoUp.contains('time');var titleEvent=(canGoUp)?function(){this.setColumns(originalColumns,'days',date,'fade');}.bind(this):null;this.setTitleEvent(titleEvent);this.currentView='time';},select:function(date,all){this.date=date;var formatted=date.format(this.options.format),time=date.strftime(),inputs=(!this.options.updateAll&&!all&&this.input)?[this.input]:this.inputs;inputs.each(function(input){input.set('value',formatted).store('datepicker:value',time).fireEvent('change');},this);this.fireEvent('select',[date].concat(inputs));this.close();return this;}});var timesSelectors={years:function(options,date){var times=[];for(var i=0;i<options.yearsPerPage;i++){times.push(+date);date.increment('year',1);}
return times;},months:function(options,date){var times=[];date.set('month',0);for(var i=0;i<=11;i++){times.push(+date);date.increment('month',1);}
return times;},days:function(options,date){var times=[];date.set('date',1);while(date.get('day')!=options.startDay)date.set('date',date.get('date')-1);for(var i=0;i<42;i++){times.push(+date);date.increment('day',1);}
return times;}};var renderers={years:function(years,options,currentDate,dateElements,fn){var container=new Element('div.years'),today=new Date(),element,classes;years.each(function(_year,i){var date=new Date(_year),year=date.get('year');classes='.year.year'+i;if(year==today.get('year'))classes+='.today';if(year==currentDate.get('year'))classes+='.selected';element=new Element('div'+classes,{text:year}).inject(container);dateElements.push({element:element,time:_year});if(isUnavailable('year',date,options))element.addClass('unavailable');else element.addEvent('click',fn.pass(date));});return container;},months:function(months,options,currentDate,dateElements,fn){var today=new Date(),month=today.get('month'),thisyear=today.get('year'),selectedyear=currentDate.get('year'),container=new Element('div.months'),monthsAbbr=options.months_abbr||Locale.get('Date.months_abbr'),element,classes;months.each(function(_month,i){var date=new Date(_month),year=date.get('year');classes='.month.month'+(i+1);if(i==month&&year==thisyear)classes+='.today';if(i==currentDate.get('month')&&year==selectedyear)classes+='.selected';element=new Element('div'+classes,{text:monthsAbbr[i]}).inject(container);dateElements.push({element:element,time:_month});if(isUnavailable('month',date,options))element.addClass('unavailable');else element.addEvent('click',fn.pass(date));});return container;},days:function(days,options,currentDate,dateElements,fn){var month=new Date(days[14]).get('month'),todayString=new Date().toDateString(),currentString=currentDate.toDateString(),weeknumbers=options.weeknumbers,container=new Element('table.days'+(weeknumbers?'.weeknumbers':''),{role:'grid','aria-labelledby':this.titleID}),header=new Element('thead').inject(container),body=new Element('tbody').inject(container),titles=new Element('tr.titles').inject(header),localeDaysShort=options.days_abbr,day,classes,element,weekcontainer,dateString,where=options.rtl?'top':'bottom';if(weeknumbers)new Element('th.title.day.weeknumber',{text:Locale.get('DatePicker.week')}).inject(titles);for(day=options.startDay;day<(options.startDay+7);day++){new Element('th.title.day.day'+(day%7),{text:localeDaysShort[(day%7)],role:'columnheader'}).inject(titles,where);}
days.each(function(_date,i){var date=new Date(_date);if(i%7==0){weekcontainer=new Element('tr.week.week'+(Math.floor(i/7))).set('role','row').inject(body);if(weeknumbers)new Element('th.day.weeknumber',{text:date.get('week'),scope:'row',role:'rowheader'}).inject(weekcontainer);}
dateString=date.toDateString();classes='.day.ynevent-cal-day.day'+date.get('day');if(dateString==todayString)classes+='.today';if(date.get('month')!=month)classes+='.otherMonth';element=new Element('td'+classes,{text:date.getDate(),role:'gridcell'}).inject(weekcontainer,where);if(dateString==currentString)element.addClass('selected').set('aria-selected','true');else element.set('aria-selected','false');element.set('id','yndc-'+getShortDateString(date));dateElements.push({element:element,time:_date});if(isUnavailable('date',date,options))element.addClass('unavailable');else element.addEvent('click',fn.pass(date.clone()));});return container;},time:function(options,date,fn){var container=new Element('div.time'),initMinutes=(date.get('minutes')/options.timeWheelStep).round()*options.timeWheelStep
if(initMinutes>=60)initMinutes=0;date.set('minutes',initMinutes);var hoursInput=new Element('input.hour[type=text]',{title:Locale.get('DatePicker.use_mouse_wheel'),value:date.format('%H'),events:{click:function(event){event.target.focus();event.stop();},mousewheel:function(event){event.stop();hoursInput.focus();var value=hoursInput.get('value').toInt();value=(event.wheel>0)?((value<23)?value+1:0):((value>0)?value-1:23)
date.set('hours',value);hoursInput.set('value',date.format('%H'));}.bind(this)},maxlength:2}).inject(container);var minutesInput=new Element('input.minutes[type=text]',{title:Locale.get('DatePicker.use_mouse_wheel'),value:date.format('%M'),events:{click:function(event){event.target.focus();event.stop();},mousewheel:function(event){event.stop();minutesInput.focus();var value=minutesInput.get('value').toInt();value=(event.wheel>0)?((value<59)?(value+options.timeWheelStep):0):((value>0)?(value-options.timeWheelStep):(60-options.timeWheelStep));if(value>=60)value=0;date.set('minutes',value);minutesInput.set('value',date.format('%M'));}.bind(this)},maxlength:2}).inject(container);new Element('div.separator[text=:]').inject(container);new Element('input.ok[type=submit]',{value:Locale.get('DatePicker.time_confirm_button'),events:{click:function(event){event.stop();date.set({hours:hoursInput.get('value').toInt(),minutes:minutesInput.get('value').toInt()});fn(date.clone());}}}).inject(container);return container;}};Picker.Date.defineRenderer=function(name,fn){renderers[name]=fn;return this;};var limitDate=function(date,min,max){if(min&&date<min)return min;if(max&&date>max)return max;return date;};var isUnavailable=function(type,date,options){var minDate=options.minDate,maxDate=options.maxDate,availableDates=options.availableDates,year,month,day,ms;if(!minDate&&!maxDate&&!availableDates)return false;date.clearTime();if(type=='year'){year=date.get('year');return((minDate&&year<minDate.get('year'))||(maxDate&&year>maxDate.get('year'))||((availableDates!=null&&!options.invertAvailable)&&(availableDates[year]==null||Object.getLength(availableDates[year])==0||Object.getLength(Object.filter(availableDates[year],function(days){return(days.length>0);}))==0)));}
if(type=='month'){year=date.get('year');month=date.get('month')+1;ms=date.format('%Y%m').toInt();return((minDate&&ms<minDate.format('%Y%m').toInt())||(maxDate&&ms>maxDate.format('%Y%m').toInt())||((availableDates!=null&&!options.invertAvailable)&&(availableDates[year]==null||availableDates[year][month]==null||availableDates[year][month].length==0)));}
year=date.get('year');month=date.get('month')+1;day=date.get('date');var dateAllow=(minDate&&date<minDate)||(minDate&&date>maxDate);if(availableDates!=null){dateAllow=dateAllow||availableDates[year]==null||availableDates[year][month]==null||!availableDates[year][month].contains(day);if(options.invertAvailable)dateAllow=!dateAllow;}
return dateAllow;};})();;function ynvideochannelAddNewPlaylist(ele,guid,url){var nextEle=ele.getNext();if(nextEle.hasClass("ynvideochannel_active_add_playlist")){nextEle.removeClass("ynvideochannel_active_add_playlist");nextEle.setStyle("display","none");}else{nextEle.addClass("ynvideochannel_active_add_playlist");nextEle.setStyle("display","block");}
$$('.play_list_span').each(function(el){if(el===nextEle){}else{el.empty();el.setStyle("display","none");el.removeClass("ynvideochannel_active_add_playlist");}});var data=guid;var request=new Request.HTML({url:url,data:{subject:data,},onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){var spanEle=nextEle;spanEle.innerHTML=responseHTML;eval(responseJavaScript);var popup=spanEle.getParent('.ynvideochannel-action-pop-up');var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getHeight();if(p_height-y_position<(c_height+65)){layout_parent.addClass('popup-padding-bottom');var margin_bottom=parseInt(layout_parent.getStyle('padding-bottom').replace(/\D+/g,''));layout_parent.setStyle('padding-bottom',(margin_bottom+c_height+65+y_position-p_height)+'px');}}});request.send();}
function ynvideochannelAddToPlaylist(ele,playlistId,guild,url){var checked=ele.get('checked');var data=guild;var request=new Request.JSON({url:url,data:{subject:data,playlist_id:playlistId,checked:checked,},onSuccess:function(responseJSON){if(!responseJSON.status){ele.set('checked',!checked);}
var div=ele.getParent('.ynvideochannel-action-pop-up');var notices=div.getElement('.add-to-playlist-notices');var notice=new Element('div',{'class':'add-to-playlist-notice',text:responseJSON.message});notices.adopt(notice);notice.fade('in');(function(){notice.fade('out').get('tween').chain(function(){notice.destroy();});}).delay(2000,notice);}});request.send();}
function ynvideochannelAddToFavorite(ele,video_id,url,favtext,unfavtext){var popup=ele.getParent('.ynvideochannel-action-pop-up');var favorite=popup.getElement('.favorite-loading');if(favorite){favorite.show();}
var favorite_link=popup.getElement('.favorite_link');if(favorite_link){favorite_link.hide();}
var request=new Request.JSON({url:url,data:{id:video_id},onSuccess:function(responseJSON){if(favorite){favorite.hide();}
if(favorite_link){favorite_link.show();}
if(responseJSON.result){if(responseJSON.added==1){var html='<i class="fa fa-star"></i>'+' '+unfavtext;ele.innerHTML=html;}else{var html='<i class="fa fa-star-o"></i>'+' '+favtext;ele.innerHTML=html;}}
var notices=popup.getElement('.add-to-playlist-notices');var notice=new Element('div',{'class':'add-to-playlist-notice',text:responseJSON.message});notices.adopt(notice);notice.fade('in');(function(){notice.fade('out').get('tween').chain(function(){notice.destroy();});}).delay(2000,notice);}});request.send();}
window.addEvent('domready',function(){ynvideochannelAddToOptions();});(function($,$$){var events;var check=function(e){var target=$(e.target);var parents=target.getParents();events.each(function(item){var element=item.element;if(element!=target&&!parents.contains(element))
item.fn.call(element,e);});};Element.Events.outerClick={onAdd:function(fn){if(!events){document.addEvent('click',check);events=[];}
events.push({element:this,fn:fn});},onRemove:function(fn){events=events.filter(function(item){return item.element!=this||item.fn!=fn;},this);if(!events.length){document.removeEvent('click',check);events=null;}}};})(document.id,$$);function ynvideochannelAddToOptions(){$$('a.ynvideochannel-action-link.show-hide-btn').removeEvents('click').addEvent('click',function(){var parent=this.getParent('.action-container');var popup=parent.getElement('.ynvideochannel-action-pop-up');var parent_active=$$('.ynvideochannel_video-channel-playlist_options').length;$$('.action-container').each(function(el){el.removeClass("ynvideochannel-action-shown");});if(parent_active){this.getParents('.ynvideochannel_video-channel-playlist_options').toggleClass('ynvideochannel-addtoplaylist-active');}
var pageParent=popup.getParent('#global_content');var otherPopup=pageParent.getElement('.ynvideochannel_button_more_explain');if(otherPopup!=null){otherPopup.hide();}
$$('.ynvideochannel-action-pop-up').each(function(el){if(el!=popup)el.hide();});if(!popup.isDisplayed()){parent.addClass("ynvideochannel-action-shown");var loading=popup.getElement('.add-to-playlist-loading');if(loading){var url=loading.get('rel');loading.show();var checkbox=popup.getElement('.box-checkbox');checkbox.hide();var request=new Request.HTML({url:url,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){elements=Elements.from(responseHTML);if(elements.length>0){checkbox.empty();checkbox.adopt(elements);eval(responseJavaScript);loading.hide();checkbox.show();var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getHeight();if(p_height-y_position<(c_height+65)){layout_parent.addClass('popup-padding-bottom');var margin_bottom=parseInt(layout_parent.getStyle('padding-bottom').replace(/\D+/g,''));layout_parent.setStyle('padding-bottom',(margin_bottom+c_height+65+y_position-p_height)+'px');}}}});request.send();}
var favorite=popup.getElement('.favorite-loading');if(favorite){var url=favorite.get('rel');favorite.show();var favorite_link=popup.getElement('.favorite_link');favorite_link.hide();var request=new Request.HTML({url:url,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){elements=Elements.from(responseHTML);if(elements.length>0){favorite_link.empty();favorite_link.adopt(elements);eval(responseJavaScript);favorite.hide();favorite_link.show();}}});request.send();}}else{parent.removeClass("ynvideochannel-action-shown");}
popup.toggle();var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}
var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getHeight();if(popup.isDisplayed()){if(p_height-y_position<(c_height+1)){layout_parent.addClass('popup-padding-bottom');layout_parent.setStyle('padding-bottom',(c_height+1+y_position-p_height)+'px');}
else if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}}
else{if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}}});$$('.ynvideochannel-action-add-playlist').addEvent('outerClick',function(){var popup=this.getElement('.ynvideochannel-action-pop-up');var display_popup=popup.getStyle('display');var parent_popup_active=this.getParents('.ynvideochannel_video-channel-playlist_options');if(display_popup='block'){popup.setStyle('display','none');};if(this.hasClass('ynvideochannel-action-shown')){this.removeClass('ynvideochannel-action-shown');}
if(parent_popup_active.hasClass('ynvideochannel-addtoplaylist-active')){parent_popup_active.removeClass('ynvideochannel-addtoplaylist-active');}});$$('a.ynvideochannel-action-link.cancel').removeEvents('click').addEvent('click',function(){var parent=this.getParent('.ynvideochannel-action-pop-up');if(parent){parent.hide();var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');if(layout_parent.hasClass('popup-padding-bottom')){layout_parent.setStyle('padding-bottom','0');}}});}
function ynvideochannelVideoOptions(){var parent_active=$$('.ynvideochannel_video-channel-playlist_options').length;$$('.ynvideochannel_video_options-btn').removeEvents('click').addEvent('click',function(){this.getParent('.ynvideochannel_video_options').toggleClass('explained');if(parent_active){this.getParents('.ynvideochannel_video-channel-playlist_options').toggleClass('ynvideochannel-options-active');}});$$('.ynvideochannel_video_options-btn').addEvent('outerClick',function(){var popup=this.getParent('.ynvideochannel_video_options');var parent_popup=this.getParents('.ynvideochannel_video-channel-playlist_options');if(popup.hasClass('explained')){popup.removeClass('explained');}
if(parent_popup.hasClass('ynvideochannel-options-active')){parent_popup.removeClass('ynvideochannel-options-active');}});}
function ynvideochannelChannelOptions(){$$('.ynvideochannel_channel_options-btn').removeEvents('click').addEvent('click',function(){var popup=this.getParent('.ynvideochannel_channel_options');popup.toggleClass('explained');var layout_parent=popup.getParent('.layout_middle');if(!layout_parent)layout_parent=popup.getParent('#global_content');var y_position=popup.getPosition(layout_parent).y;var p_height=layout_parent.getHeight();var c_height=popup.getElement('.ynvideochannel_channel_options-block').getHeight();if(p_height-y_position<(c_height+60)){layout_parent.addClass('popup-padding-bottom');var margin_bottom=parseInt(layout_parent.getStyle('padding-bottom').replace(/\D+/g,''));layout_parent.setStyle('padding-bottom',(margin_bottom+c_height+80+y_position-p_height)+'px');}});$$('.ynvideochannel_channel_options').addEvent('outerClick',function(){var popup=this;if(popup.hasClass('explained')){popup.removeClass('explained');$$('.owl-next').setStyle('display','block');}})}
function ynvideochannelPlaylistOptions(){var parent_active=$$('.ynvideochannel_video-channel-playlist_options').length;$$('.ynvideochannel_video_options-btn').removeEvents('click').addEvent('click',function(){this.getParent('.ynvideochannel_video_options').toggleClass('explained');if(parent_active){this.getParents('.ynvideochannel_video-channel-playlist_options').toggleClass('ynvideochannel-options-active');}});$$('.ynvideochannel_video_options-btn').addEvent('outerClick',function(){var popup=this.getParent('.ynvideochannel_video_options');var parent_popup=this.getParents('.ynvideochannel_video-channel-playlist_options');if(popup.hasClass('explained')){popup.removeClass('explained');}
if(parent_popup.hasClass('ynvideochannel-options-active')){parent_popup.removeClass('ynvideochannel-options-active');}})};(function(){var $='id'in document?document.id:window.$;if(!('en4'in window)){en4={};}
if(!('music'in en4)){en4.music={};}
en4.core.runonce.add(function(){new Element('div',{'id':'pause_preloader','class':'music_player_button_pause','style':'position: absolute; top: -9999px; left: -9999px;'}).inject(document.body).destroy();$$('a.music_add_to_playlist').addEvent('click',function(){$('song_id').value=this.id.substring(5);Smoothbox.open($('music_add_to_playlist'),{mode:'Inline'});var pl=$$('#TB_ajaxContent > div')[0];pl.show();});$$('a.music_set_profile_playlist').addEvent('click',function(){var url_part=this.href.split('/');var playlist_id=0;$each(url_part,function(val,i){if(val=='playlist_id')
playlist_id=url_part[i+1];});new Request.JSON({method:'post',url:this.href,noCache:true,data:{'playlist_id':playlist_id,'format':'json'},onSuccess:function(json){var link=$$('#music_playlist_item_'+json.playlist_id+' a.music_set_profile_playlist')[0];if(json&&json.success){$$('a.music_set_profile_playlist').set('text',en4.core.language.translate('Play on my Profile')).addClass('icon_music_playonprofile').removeClass('icon_music_disableonprofile');if(json.enabled&&link){link.set('text',en4.core.language.translate('Disable Profile Playlist')).addClass('icon_music_disableonprofile').removeClass('icon_music_playonprofile');}}}}).send();return false;});en4.music.player.enablePlayers();});en4.music.player={playlists:[],mute:(Cookie.read('en4_music_mute')==1?true:false),volume:(Cookie.read('en4_music_volume')?Cookie.read('en4_music_volume'):85),getSoundManager:function(){if(!('soundManager'in en4.music)&&'soundManager'in window){en4.music.soundManager=soundManager;}
return en4.music.soundManager;},getPlaylists:function(){return this.playlists;},getVolume:function(){if(this.mute){return 0;}else{return this.volume;}},setVolume:function(volume){if(0==volume){this.mute=true;}else{this.mute=false;this.volume=volume;}
this._writeCookies();this._updatePlaylists();},toggleMute:function(flag){if($type(flag)){this.mute=(true==flag);}else{this.mute=!this.mute;}
this._writeCookies();this._updatePlaylists();},enablePlayers:function(){var players=$$('.music_player_wrapper');en4.music.player.getSoundManager();players.each(function(el){var matches=el.get('id').match(/music_player_([\w\d]+)/i);if(matches&&matches.length>=2&&!el.hasClass('music_player_active')){el.addClass('music_player_active');en4.music.player.createPlayer(matches[1]);}});},createPlayer:function(id){var par=$('music_player_'+id);var el=par.getElement('div.music_player');en4.music.player.getSoundManager().onready(function(){if(!par.getElement('div.playlist_short_player')){if(!el.hasClass('playlist_player_loaded')){var playlist=new en4.music.playlistAbstract(el);en4.music.player.playlists.push(playlist);el.addClass('playlist_player_loaded');}}else{par.getElement('div.music_player:not(div.playlist_short_player)').hide();par.getElement('div.playlist_short_player').addEvent('click',function(){var par=$('music_player_'+id);var el=par.getElement('div.music_player');el.show();par.getElement('div.playlist_short_player').hide();if(!el.hasClass('playlist_player_loaded')){var playlist=new en4.music.playlistAbstract(el);en4.music.player.playlists.push(playlist);playlist.play();el.addClass('playlist_player_loaded');}});}});return this;},_writeCookies:function(){var tmpUri=new URI($$('head base[href]')[0]);Cookie.write('en4_music_volume',this.volume,{duration:7,path:tmpUri.get('directory'),domain:tmpUri.get('domain')});Cookie.write('en4_music_mute',(this.mute?1:0),{duration:7,path:tmpUri.get('directory'),domain:tmpUri.get('domain')});},_updatePlaylists:function(){this.playlists.each(function(playlist){playlist._updateScrub();playlist._updateVolume();});}};en4.music.playlistAbstract=new Class({Implements:[Options,Events],options:{mode:'linear',repeat:false,sliderWidth:385,containerWidth:115},container:false,songs:[],tallied:{},slider:null,sound:null,selected:0,container:null,slider_volume:null,slider_w_Volume:100,_isAttached:false,initialize:function(el,options){this.setOptions(options);this.container=$(el);this.container.getElement('div.music_player_scrub_downloaded').hide();this.songs=this.container.getElements('a.music_player_tracks_url');this._attachEvents();this._attachScrub();this._attachScrubVolume();this._isAttached=true;this._updateVolume();if(this.songs.length){if(this.songs[0]){this.setTitle(this.songs[0].getParent().get('title'));}}},getSoundManager:function(){return en4.music.player.getSoundManager();},play:function(index){if(!$type(index)){index=this.selected;}
if(index>=this.songs.length||index<0||!$type(this.songs[index])){index=0;}
var soundId=this._getSoundId(index);if(this.sound&&this.sound.sID==soundId&&this.sound.playState){this.sound.togglePause();return this;}
this.getSoundManager().stopAll();this.selected=index;this.setTitle(this.songs[index].getParent().get('title'));this.sound=this.create(index);if(this.sound){this.sound.setPosition(0);this.sound.play();}
return this;},create:function(index){if(index>=this.songs.length||index<0||!$type(this.songs[index])){return false;}
var soundId=this._getSoundId(index);if(this.getSoundManager().getSoundById(soundId)){return this.getSoundManager().getSoundById(soundId);}
var url_song="";if(unescape(this.songs[index].id)=="")
url_song=this.songs[index].href;else
url_song=unescape(this.songs[index].id);var soundOptions={id:soundId,url:url_song,autoload:true,useVideo:false,volume:en4.music.player.getVolume(),onload:function(){this.fireEvent('soundmanager_onload');}.bind(this),whileloading:function(){this.fireEvent('soundmanager_whileloading');}.bind(this),whileplaying:function(){this.fireEvent('soundmanager_whileplaying');}.bind(this),onplay:function(){this.fireEvent('soundmanager_onplay');}.bind(this),onresume:function(){this.fireEvent('soundmanager_onresume');}.bind(this),onpause:function(){this.fireEvent('soundmanager_onpause');}.bind(this),onstop:function(){this.fireEvent('soundmanager_onstop');}.bind(this),onfinish:function(){this.fireEvent('soundmanager_onfinish');}.bind(this),onbeforefinish:function(index){this.fireEvent('soundmanager_onbeforefinish',[index]);}.bind(this)};if(soundId.replace(/\?[^?]+?$/,'').match(/\.(mp3)$/)){this.getSoundManager().createSound(soundOptions);}else{this.getSoundManager().createSound(soundOptions);}
this._updateVolume();return this.getSoundManager().getSoundById(soundId);},logPlay:function(){var song_id=this.songs[this.selected].rel;var playlist_id=this.container.getElement('ul.music_player_tracks').className.split('_');playlist_id=playlist_id[playlist_id.length-1];this.songs.each(function(song,index){if(index==this.selected){song.getParent('li').addClass('song_playing');}else{song.getParent('li').removeClass('song_playing');}}.bind(this));if(!this.tallied[song_id]){this.tallied[song_id]=true;new Request.JSON({url:en4.core.baseUrl+'mp3music/album/song-play-tally',noCache:true,data:{format:'json',song_id:song_id,playlist_id:playlist_id},onSuccess:function(responseJSON){if(responseJSON&&$type(responseJSON)=='object'&&'song'in responseJSON&&'play_count'in responseJSON.song){this.songs[this.selected].getParent('li').getElement('.music_player_tracks_plays span').set('text',responseJSON.play_count);}}.bind(this)}).send();}},seekTo:function(pos){if(!this.sound){return;}
var ms_total=this.sound.durationEstimate;var ms_dest=Math.round(ms_total*(pos/this.options.sliderWidth));var diff=Math.abs(ms_dest-this.sound.position);if(this.slider.element.hasClass('mousedown')||diff>2000){this.sound.setPosition(ms_dest);}},playNext:function(){if(this.songs[this.selected+1]){this.play(this.selected+1);}else if(this.options.repeat){this.play(0);}else{this.slider.set(0);}},playPrev:function(){if(this.songs.length==1){this.seekTo(0);}else if(this.selected==0&&this.options.repeat){this.play(this.songs.length-1);}else if(this.selected==0){this.seekTo(0);}else if(this.selected>0){this.play(this.selected-1);}},launch:function(){var href=this.container.getElement('a.music_player_button_launch').href;window.open(href,'player','status=0,'+'toolbar=0,'+'location=0,'+'menubar=0,'+'directories=0,'+'scrollbars=0,'+'resizable=0,'+'height=500,'+'width=600');},setVolume:function(volume){en4.music.player.setVolume(volume);this._updateVolume();},toggleMute:function(flag){en4.music.player.toggleMute(flag);this._updateVolume();},getDuration:function(){this.container.getElement('div.music_player_time_total').get('text');},getElapsed:function(){this.container.getElement('div.music_player_time_elapsed').get('text');},getTitle:function(){this.container.getElement('div.music_player_trackname').get('text');},setTitle:function(sText){this.container.getElement('div.music_player_trackname').set('text',sText);},setDownloaded:function(pl){var self=pl;if(self.sound){var percent=100;if(self.sound.isBuffering)
percent=(self.sound.position/self.sound.durationEstimate)*100;self.getElement('div.music_player_scrub_downloaded').setStyle('width',percent);}},_getSoundId:function(index){if(!$type(this.songs[index])){return false;}
var url_song="";if(unescape(this.songs[index].id)=="")
url_song=this.songs[index].href;else
url_song=unescape(this.songs[index].id);return'_song_'+
this.container.getParent('.music_player_wrapper').id+'_'+
url_song;},_attachEvents:function(){if(this._isAttached){return;}
this.container.getElement('.music_player_button_play').addEvent('click',function(event){this.play();event.stop();return false;}.bind(this));this.container.getElement('.music_player_button_prev').addEvent('click',function(event){this.playPrev();event.stop();return false;}.bind(this));this.container.getElement('.music_player_button_next').addEvent('click',function(event){this.playNext();event.stop();return false;}.bind(this));this.container.getElement('.music_player_controls_volume_toggle').addEvent('click',function(event){en4.music.player.toggleMute();this._updateVolume();event.stop();return false;}.bind(this));this.container.getElements('ul.music_player_tracks li').addEvent('click',function(event){var el;if(!event||!('target'in event)||!(el=$(event.target))||el.hasClass('smoothbox')){return true;}
if(el.get('tag').toLowerCase()!='li'){el=el.getParent('li');}
if(this.getSoundManager().supported()){this.play(el.getAllPrevious().length);if($type(event)){event.stop();}
return false;}else{return true;}}.bind(this));this.addEvents({soundmanager_onload:this._updateDuration.bind(this),soundmanager_whileloading:this._updateDuration.bind(this),soundmanager_whileplaying:this._updateScrub.bind(this),soundmanager_onplay:function(){this.container.getElement('.music_player_button_play').addClass('music_player_button_pause');this.logPlay(this);}.bind(this),soundmanager_onresume:function(){this.container.getElement('.music_player_button_play').addClass('music_player_button_pause');}.bind(this),soundmanager_onpause:function(){this.container.getElement('.music_player_button_play').removeClass('music_player_button_pause');}.bind(this),soundmanager_onstop:function(){this.container.getElement('.music_player_button_play').removeClass('music_player_button_pause');this.slider.set(0);if(this.sound){this.container.getElement('div.music_player_time_elapsed').set('text','0:00');}}.bind(this),soundmanager_onfinish:function(){this.container.getElement('.music_player_button_play').removeClass('music_player_button_pause');this.playNext();}.bind(this),soundmanager_onbeforefinish:function(song_id){var nextsong=this.create(song_id+1);nextsong.load();}.bind(this)});},_attachScrubVolume:function(){var scrubBarVolume=this.container.getElement('div.music_player_scrub_volume');if(scrubBarVolume)
{scrubBarVolume.setStyle('width',this.slider_w_Volume);scrubBarVolume.addEvent('mousedown',function(){this.addClass('mousedown');});scrubBarVolume.addEvent('mouseup',function(){this.removeClass('mousedown');});this.slider_volume=new Slider(this.container.getElement('div.music_player_scrub_volume'),this.container.getElement('div.music_player_scrub_cursor_volume'),{snap:false,offset:0,range:[0,this.slider_w_Volume],wheel:true,steps:this.slider_w_Volume,initialStep:this.slider_w_Volume,onComplete:function(step){en4.music.player.setVolume(step);this._updateVolume;}});}},_attachScrub:function(){if(this._isAttached){return;}
var scrubBar=this.container.getElement('div.music_player_scrub');var chrome=this.container.getElement('.music_player_top').measure(function(){return this.getDimensions();});var img=this.container.getElement('.music_player_art').measure(function(){return this.getDimensions();});if(this.container.getElement('.music_player_art').isDisplayed()){this.options.sliderWidth=chrome.width-img.width;}else{this.options.sliderWidth=chrome.width;}
scrubBar.setStyle('width',this.options.sliderWidth+'px');scrubBar.addEvent('mousedown',function(){this.addClass('mousedown');});scrubBar.addEvent('mouseup',function(){this.removeClass('mousedown');});this.slider=new Slider(this.container.getElement('div.music_player_scrub'),this.container.getElement('div.music_player_scrub_cursor'),{snap:false,offset:0,range:[0,this.options.sliderWidth],wheel:true,steps:this.options.sliderWidth,initialStep:0,onComplete:this.seekTo.bind(this)});},_updateDuration:function(){if(!this.sound){return;}
var ms=this.sound.durationEstimate;var d=new Date(ms);var hms=d.getMinutes().toString()+':'+(d.getSeconds().toString().length==1?'0':'')+d.getSeconds().toString();this.container.getElement('div.music_player_time_total').set('text',hms);},_updateScrub:function(){if(!this.sound){return;}
var ms=this.sound.position;var d=new Date(ms);var hms=d.getMinutes().toString()+':'+(d.getSeconds().toString().length==1?'0':'')+d.getSeconds().toString();this.container.getElement('div.music_player_time_elapsed').set('text',hms);if(!this.slider.element.hasClass('mousedown')){var percent=(this.sound.position/this.sound.durationEstimate)*100;var steps=Math.round(percent*(this.options.sliderWidth/100));this.slider.set(steps);}},_updateVolume:function(){var mute=en4.music.player.mute;var volume=en4.music.player.getVolume();var muteButton=this.container.getElement('.music_player_controls_volume_toggle');var volumeElements=this.container.getElements('.music_player_controls_volume_bar');if(mute){if(this.sound){this.sound.mute();}
muteButton.addClass('music_player_controls_volume_toggle_mute');volumeElements.each(function(el){el.hide();});}
else{if(this.sound){this.sound.unmute();this.sound.setVolume(volume);}
muteButton.removeClass('music_player_controls_volume_toggle_mute');volumeElements.each(function(el){el.show();var bar=el.getChildren()[0];var level=bar.get('class').split('_');level=level[level.length-1];if((level*20)<=volume){el.addClass('music_player_controls_volume_enabled');}else{el.removeClass('music_player_controls_volume_enabled');}});}}});})();
;// Minified by http://closure-compiler.appspot.com/home
var PhotoViewer={is_setup:!1,c:null,is_viewer:!1,last_scroll_top:0,timeout:null,total_count:0,photos:{},album_title:"",album_href:"",owner_title:"",owner_href:"",slideshow_is_stop:!0,slideshow_is_pause:!1,scale:1,move:{top:0,left:0},comments:{},options:{album_id:0,photo_id:0,isPage:0,slideshow_time:3E3,min_scale:1,max_scale:3,scale_step:10},open:function(a){var b=this;this.options.album_id=a.album_id;this.options.photo_id=a.photo_id;this.options.isPage=a.isPage;this.setup();b.last_scroll_top=j(window).scrollTop(); this.viewer();this.reset();b.viewer().addClass("active");setTimeout(function(){j(window).scrollTop(0);j("html").addClass("hideScroll");b.resize();b.loadPhoto()},10);this.old_comments_block=j(".layout_core_comments");this.setIdPrefix(this.old_comments_block)},hide:function(){this.viewer().hasClass("fullmode")?this.fullHide():(this.viewer().removeClass("active"),j("html").removeClass("hideScroll"),j(window).scrollTop(this.last_scroll_top),this.removeIdPrefix(this.old_comments_block))},resize:function(){var a= j(window).width(),b=j(window).height();this.viewer().hasClass("fullmode")?(j("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b),j("#wpPhotoViewer").find(".wpPhoto").css("width",a),j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right",0)):(a-=50,b-=50,j("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b-70),j("#wpPhotoViewer").find(".wpPhoto").css("width",a-400),j("#wpPhotoViewer").find(".wpComments").css("width",400),j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right", 390));j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("line-height",b+"px");0<this.viewer().find(".photos").width()-100*this.total_count?this.viewer().find(".wpPhotoList").addClass("one_col"):this.viewer().find(".wpPhotoList").removeClass("one_col");this.hideOptions()},loadPhoto:function(){var a=this;j.ajax({url:en4.core.baseUrl+"photoviewer",data:{format:"json",photo_id:this.options.photo_id,isPage:this.options.isPage},success:function(b){if(b&&b.photos){a.total_count=b.count;a.album_title=b.album_title; a.album_href=b.album_href;a.owner_title=b.owner_title;a.owner_href=b.owner_href;a.photos={};var d=0,c="";j(b.photos).each(function(b,f){c+='<a href="javascript:void(0);" class="wpPhotoItem" onclick="PhotoViewer.view('+f.photo_id+');" id="wp_'+f.photo_id+'"><img id="fullphoto_'+f.photo_id+'" src="'+f.thumb+'" alt=""/></a>';a.photos[f.photo_id]=f;0==b&&(d=f.photo_id);f.active&&(d=f.photo_id)});a.viewer().find(".wpPhotoList").find(".photos").html(c);a.viewer().find(".wpPhotoList").find(".photos").find("img").load(function(){j(this).addClass("loaded")}); a.viewer().find(".wpPhotoList").find(".count").html(a.total_count);1<a.total_count&&a.viewer().find(".allPhotos").show();a.viewer().find(".goSlideshow").show();a.view(d);a._checkPagination();a.resize()}}})},view:function(a){if(this.photos[a]){var b=this.photos[a];this.viewer().find(".wpPhotoItem").removeClass("active");this.viewer().find("#wp_"+a).addClass("active");var d=this.viewer().find("#wp_"+a).prevAll().length+1,c=this.viewer().find(".wpPhotoContent");c.find(".active").removeClass("active").removeClass("fade"); var e=c.find("#thephoto_"+a);e.length?(e.addClass("active"),setTimeout(function(){e.addClass("fade")},10)):(c.append(j('<div class="thephoto" id="thephoto_'+a+'"><div class="moveElement"><div id="imgPlace_'+a+'"><img src="'+b.src+'" alt=""/></div><span class="photo_options"><a href="javascript:void(0);" class="openfull icon-resize-full" onclick="PhotoViewer.fullOpen();"></a><a href="javascript:void(0);" class="hidefull icon-resize-small" onclick="PhotoViewer.fullHide();"></a></span></div></div>')), e=j("#thephoto_"+a),clearTimeout(this.photo),this.photo=setTimeout(function(){e.addClass("active");setTimeout(function(){e.addClass("fade")},10)},10));this.resize();this.viewer().find(".wpPhotoOptions").find(".info").show();b=this.viewer().find(".wpPhotoOptions").find(".album_info");b.find(".album_title").html('<a href="'+this.album_href+'">'+this.album_title+"</a>");b.find(".album_owner").html(' - <a href="'+this.owner_href+'">'+this.owner_title+"</a>");this.viewer().find(".wpPhotoOptions").find(".count").find(".total").html(this.total_count); this.viewer().find(".wpPhotoOptions").find(".count").find(".current").html(d);this.loadComments(a);this._checkPagination()}},_checkPagination:function(){var a=this.viewer().find(".wpNext"),b=this.viewer().find(".wpPrev");if(2>this.total_count)a.hide(),b.hide();else{var d=this.viewer().find(".wpPhotoItem.active");d.prev().length?b.show():b.hide();d.next().length?a.show():a.hide()}},next:function(a){var b=this.viewer().find(".wpPhotoItem.active");b.next().length?b.next().click():a?a():this.showList(); this._checkPagination()},prev:function(){var a=this.viewer().find(".wpPhotoItem.active");a.prev().length?a.prev().click():this.showList();this._checkPagination()},toggleList:function(){this.viewer().find(".wpPhotoList").hasClass("active")?this.hideList():this.showList()},showList:function(){!(2>this.total_count)&&!this.viewer().hasClass("fullmode")&&(this.viewer().find(".photos").jScrollPane(),this.viewer().find(".wpPhotoList").addClass("active"),this.showOver())},isListActive:function(){return this.viewer().find(".wpPhotoList").hasClass("active")}, hideList:function(){this.viewer().find(".wpPhotoList").removeClass("active");this.hideOver()},loadComments:function(a){var b=this;j("#photo_comment_"+a).length?(b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide()),b.removeIdPrefix(j("#photo_comment_"+a).show())):(this.comment_request&&this.comment_request.abort(),b.showLoading(),this.comment_request=j.ajax({url:en4.core.baseUrl+"photoviewer/index/comments",data:{format:"html",photo_id:a,isPage:this.options.isPage},success:function(d){b.hideLoading(); b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide());var c=j("<div />").attr({id:"photo_comment_"+a,"class":"photo_comment"});c.html(d);b.viewer().find(".wpCommentsContent").append(c);en4.core.runonce.trigger();Smoothbox.bind($("photo_comment_"+a))}}))},setIdPrefix:function(a){a.find("*[id]").not(".iswphprefix").each(function(a,d){j(d).attr("id","wphPrefix"+(1E3*Math.random()).toInt()+"wphEnd"+j(d).attr("id"));j(d).addClass("iswphprefix")})},removeIdPrefix:function(a){a.find(".iswphprefix").each(function(a, d){var c=j(d).attr("id"),e=c.indexOf("wphEnd");-1!==e&&(c=c.substr(e+6),j(d).attr("id",c),j(d).removeClass("iswphprefix"))})},onError:function(a){alert(a)},setup:function(){var a=this;if(!this.is_setup){this.is_setup=!0;j(window).resize(function(){a.resize()});var b="keypress";if(Browser.Engine.trident||Browser.Engine.webkit)b="keydown";j(document).bind(b,function(b){var c=j(b.target).prop("tagName").toLowerCase();"textarea"==c||"input"==c||"select"==c||a.isListActive()||(37==b.keyCode?a.prev():39== b.keyCode?a.next():0!=b.keyCode&&(27==b.keyCode?a.viewer().hasClass("fullmode")?a.fullHide():a.hide():109==b.keyCode||38==b.keyCode?a.zoom(2):(107==b.keyCode||40==b.keyCode)&&a.zoom(-2)))});this.viewer().find(".wpPhoto").mousewheel(function(b){if(!a.viewer().hasClass("tagging_process")){b=b.originalEvent;var c=0;b.wheelDelta&&(c=b.wheelDelta/120);b.detail&&(c=-b.detail/3);a.zoom(c)}});this.viewer().click(function(b){!j(b.target).closest(".external-options").length&&(!j(b.target).hasClass("actions")&& !j(b.target).parent().hasClass("actions"))&&a.hideOptions()});document.addEventListener&&(document.addEventListener("fullscreenchange",function(){},!1),document.addEventListener("mozfullscreenchange",function(){a.fullToggle(document.mozFullScreen)},!1),document.addEventListener("webkitfullscreenchange",function(){a.fullToggle(document.webkitIsFullScreen)},!1))}},fullToggle:function(a){a?this.fullOpen():this.fullHide()},zoom:function(a){if(!this.isListActive())if(a/=this.options.scale_step,this.scale+= a,this.scale<this.options.min_scale)this.viewer().removeClass("zooming"),this.scale-=a;else if(this.scale>this.options.max_scale)this.scale-=a;else if(this.viewer().addClass("zooming"),j("#wpPhotoViewer").find(".wpPhoto").find(".active").css("-moz-transform","scale("+this.scale+")").css("-webkit-transform","scale("+this.scale+")").css("transform","scale("+this.scale+")"),a=this.getInternetExplorerVersion(),7==a||8==a)a=j("#wpPhotoViewer").find(".wpPhoto").find(".active").find("img"),a.data("original-width")|| (a.data("original-width",a.width()),a.data("original-height",a.height())),a.css("width",a.data("original-width")*this.scale).css("height",a.data("original-height")*this.scale)},getInternetExplorerVersion:function(){var a=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1));return a},noZoom:function(a){a?this.viewer().addClass("nozoom"):this.viewer().removeClass("nozoom")},fullOpen:function(){var a=this.viewer(); a.addClass("fullmode");this.resize();a=a[0];a.requestFullScreen&&a.requestFullScreen();a.webkitRequestFullScreen&&a.webkitRequestFullScreen();a.mozRequestFullScreen&&a.mozRequestFullScreen();a.requestFullscreen&&a.requestFullscreen()},fullHide:function(){this.viewer().removeClass("fullmode");this.resize();this.stopSlideshow();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide();document.cancelFullScreen&&document.cancelFullScreen();document.webkitCancelFullScreen&& document.webkitCancelFullScreen();document.mozCancelFullScreen&&document.mozCancelFullScreen();document.exitFullscreen&&document.exitFullscreen()},viewer:function(){var a=this;if(this.is_viewer)return this.c;this.is_viewer=!0;var b=j("<div />");b.attr({id:"wpPhotoViewer","class":"wpPhotoViewer"});b.html(this.getHtmlContent());b.appendTo(j("body"));var d=this.getInternetExplorerVersion();-1!==d&&(b.addClass("wpIe"),b.addClass("wpIe"+d));clearTimeout(a.mouseTimer);b.mouseover(function(){clearTimeout(a.mouseTimer); a.mouseTimer=setTimeout(function(){a.viewer().addClass("mouseActive");clearTimeout(a.mouseTimerOut);a.mouseTimerOut=setTimeout(function(){a.viewer().removeClass("mouseActive")},2E3)},10)});var c=b.find(".wpPhotoContent");c.unbind("mousemove").mousemove(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed&&(clearInterval(a.moving_timer),a.moving_timer=setTimeout(function(){var c=a.move.startClientX-b.clientX,d=a.move.startClientY-b.clientY;a.move.startClientX=b.clientX;a.move.startClientY= b.clientY;a.photoMove(c,d)},1)),!1});c.unbind("mousedown").mousedown(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!0,a.move.startClientX=b.clientX,a.move.startClientY=b.clientY,c.addClass("moving"),!1});c.unbind("mouseup").mouseup(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!1,c.removeClass("moving"),!1});c.unbind("mouseout").mouseout(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!1,c.removeClass("moving"), !1});return this.c=b},photoMove:function(a,b){var d=j("#thephoto_"+this.getActiveId());this.move.top+=1.5*-b;this.move.left+=1.5*-a;d.css("margin-top",this.move.top);d.css("margin-left",this.move.left)},showOver:function(){var a=this;this.viewer().find(".wpOver").show();clearTimeout(this.timeout);this.timeout=setTimeout(function(){a.viewer().find(".wpOver").addClass("active")},100)},hideOver:function(){var a=this;a.viewer().find(".wpOver").removeClass("active");clearTimeout(this.timeout);this.timeout= setTimeout(function(){a.viewer().find(".wpOver").hide()},500)},slideshow:function(){this.fullOpen();this.startSlideshow()},slideshowClose:function(){this.stopSlideshow();this.fullHide();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide()},startSlideshow:function(){var a=this;this.stopSlideshow();this.slideshow_is_pause=this.slideshow_is_stop=!1;this.viewer().addClass("slideshow_process");this.slideshow_timer=setInterval(function(){a.slideshow_is_pause||a.next(function(){a.stopSlideshow()})}, this.options.slideshow_time);this._checkStatusSlideShow()},stopSlideshow:function(){clearInterval(this.slideshow_timer);this.slideshow_is_stop=!0;this._checkStatusSlideShow()},repeatSlideshow:function(){this.viewer().find(".photos").find("a:first").click();this.startSlideshow();this._checkStatusSlideShow()},_checkStatusSlideShow:function(){this.slideshow_is_pause?(this.viewer().find(".wpSlidStart").show(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").hide()):this.slideshow_is_stop? (this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").show()):(this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").show(),this.viewer().find(".wpSlidRepeat").hide())},pauseSlideshow:function(){this.slideshow_is_pause=!0;this._checkStatusSlideShow()},hideOptions:function(){j("#photo_comment_"+this.getActiveId()).find(".external-options").hide()},toggleOptions:function(){var a=j("#photo_comment_"+this.getActiveId()).find(".external-options"); a.toggle();var b=this.viewer().find(".actions").offset();a.css("top",32).css("left",b.left)},getActiveId:function(){var a=this.viewer().find(".photos").find(".active");if(a.length)return a.attr("id").substr(3)},getActive:function(){return this.photos[this.getActiveId()]},getHtmlContent:function(){return'<div class="wpContainer"><a href="javascript:void(0);" class="wpPrev icon-angle-left" onclick="PhotoViewer.prev();" style="display: none;"></a><a href="javascript:void(0);" class="wpNext icon-angle-right" onclick="PhotoViewer.next();" style="display: none;"></a><a href="javascript:void(0);" class="wpClose icon-remove" onclick="PhotoViewer.hide();"></a><div class="wpPhoto"><table width="100%" class="wpPhotoContentTable"><tr><td align="center" valign="center" class="wpPhotoContent"></td></tr></table></div><div class="wpComments"><div class="wpCommentsContent"><div class="photo_comment loadingComments"><div class="layout_page_photoviewer_index_comments"><div class="generic_layout_container layout_main"><span class="loading">'+ en4.core.language.translate("PHOTOVIEWER_loading")+'</span></div></div></div></div></div><div class="wpBar"><div class="wpPhotoList"><div class="title">'+en4.core.language.translate("PHOTOVIEWER_All photos")+'&nbsp;(<span class="count">0</span>)<a href="javascript:void(0);" onclick="PhotoViewer.hideList();" class="wpListClose"><i class="icon-remove"></i></a></div><div class="photos"></div></div><div class="wpPhotoOptions"><div class="leftside"><a href="javascript:void(0);" class="wpbtn wpbtn-inverse allPhotos" onclick="PhotoViewer.toggleList();" style="display: none;">'+ en4.core.language.translate("PHOTOVIEWER_All photos")+'<i class="right icon-caret-up"></i></a><a href="javascript:void(0);" class="wpbtn wpbtn-inverse goSlideshow" onclick="PhotoViewer.slideshow();" style="display: none;">'+en4.core.language.translate("PHOTOVIEWER_Slideshow")+'</a><div class="info" style="display: none;"><div class="album_info"><span class="album_title"></span><span class="album_owner"></span></div><div class="count"><span class="current"></span>&nbsp;'+en4.core.language.translate("PHOTOVIEWER_from")+ '&nbsp;<span class="total"></span></div></div></div></div></div></div><div class="wpSlideshow" style="display: none;"><a href="javascript:void(0);" onclick="PhotoViewer.startSlideshow();" style="display: none;" class="wpSlidStart wpbtn wpbtn-inverse">'+en4.core.language.translate("PHOTOVIEWER_Play")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.pauseSlideshow();" style="display: none;" class="wpSlidPause wpbtn wpbtn-inverse">'+en4.core.language.translate("PHOTOVIEWER_Pause")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.repeatSlideshow();" style="display: none;" class="wpSlidRepeat wpbtn wpbtn-inverse">'+ en4.core.language.translate("PHOTOVIEWER_Repeat")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.slideshowClose();" class="wpSlidClose wpbtn wpbtn-inverse"><i class="icon-remove"></i></a></div><div class="wpOver" onclick="PhotoViewer.hideList();" style="display: none;"></div>'},reset:function(){this.viewer().find(".photos").jScrollPane().data("jsp").destroy();this.viewer().find(".wpOver, .wpNext, .wpPrev, .info, .allPhotos, .goSlideshow, .wpSlideshow, .wpSlidStart, .wpSlidPause, .wpSlidRepeat").hide(); this.viewer().find(".wpPhotoContent, .photos").empty();this.viewer().find(".wpCommentsContent").children().hide();this.viewer().removeClass("fullmode").removeClass("zooming").removeClass("slideshow_process").removeClass("mouseActive");this.viewer().find(".wpPhotoList").removeClass(".one_col");this.viewer().find(".wpCommentsContent").children(".loadingComments").show();return this.viewer()},showLoading:function(){this.viewer().find(".wpCommentsContent").children().hide();this.viewer().find(".wpCommentsContent").children(".loadingComments").show()}, hideLoading:function(){this.viewer().find(".wpCommentsContent").children(".loadingComments").hide()},bindPhotoViewer:function(){j&&j("#global_content").find("a").not(".wp_init").addClass("wp_init").each(function(a,b){var d=j(b).attr("href");if(d&&"javascript:void(0)"!=d){var c=0,e=d.match(/album_id\/([0-9]{0,})\/*\/photo_id\/([0-9]{0,})/i);e||(e=d.match(/content\/pagealbumphoto\/album_id\/([0-9]{0,})\/content_id\/([0-9]{0,})/i),c=1);if(e&&e[0]&&e[1]&&e[2]){d=e[1];e=e[2];$(b).removeEvents();var f= $(b).getElement("img");f&&f.removeEvents("click");j(b).attr("onclick","").data("album_id",d).data("photo_id",e).data("isPage",c).click(function(a){a.stopPropagation();a.preventDefault();PhotoViewer.open({album_id:j(this).data("album_id"),photo_id:j(this).data("photo_id"),isPage:j(this).data("isPage")})})}}})}};