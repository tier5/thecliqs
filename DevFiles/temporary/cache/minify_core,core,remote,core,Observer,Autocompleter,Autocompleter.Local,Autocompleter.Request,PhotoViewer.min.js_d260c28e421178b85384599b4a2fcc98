(function(){var $='id'in document?document.id:window.$;en4.activity={load:function(next_id,subject_guid){if(en4.core.request.isRequestActive())return;$('feed_viewmore').style.display='none';$('feed_loading').style.display='';en4.core.request.send(new Request.HTML({url:en4.core.baseUrl+'activity/widget/feed',data:{'maxid':next_id,'feedOnly':true,'nolayout':true,'subject':subject_guid}}),{'element':$('activity-feed'),'updateHtmlMode':'append'});},like:function(action_id,comment_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/index/like',data:{format:'json',action_id:action_id,comment_id:comment_id,subject:en4.core.subject.guid}}),{'element':$('comment-likes-activity-item-'+action_id),'updateHtmlMode':'comments2'});},unlike:function(action_id,comment_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/index/unlike',data:{format:'json',action_id:action_id,comment_id:comment_id,subject:en4.core.subject.guid}}),{'element':$('comment-likes-activity-item-'+action_id),'updateHtmlMode':'comments2'});},comment:function(action_id,body){if(body.trim()=='')
{return;}
en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/index/comment',data:{format:'json',action_id:action_id,body:body,subject:en4.core.subject.guid}}),{'element':$('comment-likes-activity-item-'+action_id),'updateHtmlMode':'comments2'});},attachComment:function(formElement){var bind=this;formElement.addEvent('submit',function(event){event.stop();bind.comment(formElement.action_id.value,formElement.body.value);});},viewComments:function(action_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/index/viewComment',data:{format:'json',action_id:action_id,nolist:true}}),{'element':$('activity-item-'+action_id),'updateHtmlMode':'comments'});},viewLikes:function(action_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/index/viewLike',data:{format:'json',action_id:action_id,nolist:true}}),{'element':$('activity-item-'+action_id),'updateHtmlMode':'comments'});},hideNotifications:function(reset_text){en4.core.request.send(new Request.JSON({'url':en4.core.baseUrl+'activity/notifications/hide'}));$('updates_toggle').set('html',reset_text).removeClass('new_updates');if($('notifications_main')){var notification_children=$('notifications_main').getChildren('li');notification_children.each(function(el){el.setAttribute('class','');});}
if($('notifications_menu')){var notification_children=$('notifications_menu').getChildren('li');notification_children.each(function(el){el.setAttribute('class','');});}},updateNotifications:function(){if(en4.core.request.isRequestActive())return;en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/notifications/update',data:{format:'json'},onSuccess:this.showNotifications.bind(this)}));},showNotifications:function(responseJSON){if(responseJSON.notificationCount>0){$('updates_toggle').set('html',responseJSON.text).addClass('new_updates');}},markRead:function(action_id){en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/notifications/test',data:{format:'json','actionid':action_id}}));},cometNotify:function(responseObject){$('core_menu_mini_menu_updates').style.display='';$('core_menu_mini_menu_updates_count').innerHTML=responseObject.text;}};NotificationUpdateHandler=new Class({Implements:[Events,Options],options:{debug:false,baseUrl:'/',identity:false,delay:5000,minDelay:5000,maxDelay:600000,delayFactor:1.5,admin:false,idleTimeout:600000,last_id:0,subject_guid:null},state:true,activestate:1,fresh:true,lastEventTime:false,title:document.title,initialize:function(options){this.setOptions(options);this.options.minDelay=this.options.delay;},start:function(){this.state=true;this.idleWatcher=new IdleWatcher(this,{timeout:this.options.idleTimeout});this.idleWatcher.register();this.addEvents({'onStateActive':function(){this.activestate=1;this.state=true;}.bind(this),'onStateIdle':function(){this.activestate=0;this.state=false;}.bind(this)});this.loop();},stop:function(){this.state=false;},updateNotifications:function(){if(en4.core.request.isRequestActive())return;en4.core.request.send(new Request.JSON({url:en4.core.baseUrl+'activity/notifications/update',data:{format:'json'},onSuccess:this.showNotifications.bind(this)}));},showNotifications:function(responseJSON){if(responseJSON.notificationCount>0){this.options.delay=this.options.minDelay;$('updates_toggle').set('html',responseJSON.text).addClass('new_updates');}else{this.options.delay=Math.min(this.options.maxDelay,this.options.delayFactor*this.options.delay);}},loop:function(){if(!this.state){this.loop.delay(this.options.delay,this);return;}
try{this.updateNotifications().addEvent('complete',function(){this.loop.delay(this.options.delay,this);}.bind(this));}catch(e){this.loop.delay(this.options.delay,this);this._log(e);}},_log:function(object){if(!this.options.debug){return;}
try{if(typeof(console)&&$type(console)){console.log(object);}}catch(e){}}});en4.activity.compose={composers:{},register:function(object){name=object.getName();this.composers[name]=object;},deactivate:function(){for(var x in this.composers){this.composers[x].deactivate();}
return this;}};en4.activity.compose.icompose=new Class({Implements:[Events,Options],name:false,element:false,options:{},initialize:function(element,options){this.element=$(element);this.setOptions(options);},getName:function(){return this.name;},activate:function(){en4.activity.compose.deactivate();},deactivate:function(){}});ActivityUpdateHandler=new Class({Implements:[Events,Options],options:{debug:true,baseUrl:'/',identity:false,delay:5000,admin:false,idleTimeout:600000,last_id:0,next_id:null,subject_guid:null,showImmediately:false},state:true,activestate:1,fresh:true,lastEventTime:false,title:document.title,initialize:function(options){this.setOptions(options);},start:function(){this.state=true;this.idleWatcher=new IdleWatcher(this,{timeout:this.options.idleTimeout});this.idleWatcher.register();this.addEvents({'onStateActive':function(){this._log('activity loop onStateActive');this.activestate=1;this.state=true;}.bind(this),'onStateIdle':function(){this._log('activity loop onStateIdle');this.activestate=0;this.state=false;}.bind(this)});this.loop();},stop:function(){this.state=false;},checkFeedUpdate:function(action_id,subject_guid){if(en4.core.request.isRequestActive())return;function getAllElementsWithAttribute(attribute){var matchingElements=[];var values=[];var allElements=document.getElementsByTagName('*');for(var i=0;i<allElements.length;i++){if(allElements[i].getAttribute(attribute)){matchingElements.push(allElements[i]);values.push(allElements[i].getAttribute(attribute));}}
return values;}
var list=getAllElementsWithAttribute('data-activity-feed-item');this.options.last_id=Math.max.apply(Math,list);min_id=this.options.last_id+1;var req=new Request.HTML({url:en4.core.baseUrl+'widget/index/name/activity.feed',data:{'format':'html','minid':min_id,'feedOnly':true,'nolayout':true,'subject':this.options.subject_guid,'getUpdate':true}});en4.core.request.send(req,{'element':$('activity-feed'),'updateHtmlMode':'prepend'});req.addEvent('complete',function(){(function(){if(this.options.showImmediately&&$('feed-update').getChildren().length>0){$('feed-update').setStyle('display','none');$('feed-update').empty();this.getFeedUpdate(this.options.next_id);}}).delay(50,this);}.bind(this));if(localStorage){var pageTitle=document.title;var feed=document.getElementById('activity-feed');var items=feed.getElementsByTagName("li");var itemObject={};var c=0;for(var i=0;i<items.length;++i){if(items[i].getAttribute('data-activity-feed-item')!=null){var itemId=items[i].getAttribute('data-activity-feed-item');itemObject[c]={id:itemId,content:document.getElementById('activity-item-'+itemId).innerHTML};c++;}}
var activityFeedJSON=JSON.stringify(itemObject);localStorage.setItem(pageTitle+'-activity-feed-widget',activityFeedJSON);}
if(localStorage.getItem(pageTitle+'-activity-feed-widget')){var storedFeedJSON=localStorage.getItem(pageTitle+'-activity-feed-widget');var storedObj=eval("("+storedFeedJSON+")");}
return req;},getFeedUpdate:function(last_id){if(en4.core.request.isRequestActive())return;var min_id=this.options.last_id+1;this.options.last_id=last_id;document.title=this.title;var req=new Request.HTML({url:en4.core.baseUrl+'widget/index/name/activity.feed',data:{'format':'html','minid':min_id,'feedOnly':true,'nolayout':true,'getUpdate':true,'subject':this.options.subject_guid}});en4.core.request.send(req,{'element':$('activity-feed'),'updateHtmlMode':'prepend'});return req;},loop:function(){this._log('activity update loop start');if(!this.state){this.loop.delay(this.options.delay,this);return;}
try{this.checkFeedUpdate().addEvent('complete',function(){try{this._log('activity loop req complete');this.loop.delay(this.options.delay,this);}catch(e){this.loop.delay(this.options.delay,this);this._log(e);}}.bind(this));}catch(e){this.loop.delay(this.options.delay,this);this._log(e);}
this._log('activity update loop stop');},_log:function(object){if(!this.options.debug){return;}
try{if('console'in window&&typeof(console)&&'log'in console){console.log(object);}}catch(e){}}});})();;var my_location={my_lat:'',my_lon:'',my_request:'',my_map:'',my_url:'',my_marker:'',my_location_page_num:1,my_location_address:'',init:function(myurl){var self=this;self.my_url=myurl;self.my_map=new google.maps.Map(document.getElementById("my_map_canvas"),{mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:false,center:new google.maps.LatLng(37.0902400,-95.7128910),zoom:3});self.my_marker=new google.maps.Marker({map:self.my_map,animation:google.maps.Animation.BOUNCE,html:'My Location!',title:'My Location!'});},show_pages:function(markers,bounds){var self=this;var marker;if(markers.length==0){return false;}
var infoWindow=new google.maps.InfoWindow({content:''});for(var i=0;i<markers.length;i++)
{marker=markers[i];var point=new google.maps.LatLng(marker.lat,marker.lng);var marker_obj=new google.maps.Marker({position:point,map:self.my_map});marker_obj.html='<table width="500px"><tr valign="top"><td width="110px"><img src="'+marker.pages_photo+'" width="100"></td><td width="400px"><h3 style="margin-top:0; margin-bottom:6px;"><a href="'+marker.url+'">'+marker.title+'</a></h3>'+marker.desc+'</td></tr></table>';if(!marker.desc){marker.desc='';}
google.maps.event.addListener(marker_obj,'click',function(){infoWindow.setContent(this.html);infoWindow.open(self.my_map,this);});}
self.my_map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));self.my_map.setZoom(4);if(bounds&&bounds.min_lat&&bounds.max_lng&&bounds.min_lat&&bounds.max_lng){var bds=new google.maps.LatLngBounds(new google.maps.LatLng(bounds.min_lat,bounds.min_lng),new google.maps.LatLng(bounds.max_lat,bounds.max_lng));}
if(bounds&&bounds.map_center_lat&&bounds.map_center_lng){self.my_map.setCenter(new google.maps.LatLng(bounds.map_center_lat,bounds.map_center_lng));self.my_map.setZoom(4);}else{self.my_map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));self.my_map.setZoom(this.zoom);}
if(bds){self.my_map.fitBounds(bds);}},set_my_marker:function(latitude,longitude){var self=this;self.my_lat=latitude;self.my_lon=longitude;var point=new google.maps.LatLng(self.my_lat,self.my_lon);self.my_marker.setPosition(point);self.my_map.setCenter(point);var infoWindow=new google.maps.InfoWindow({content:''});google.maps.event.addListener(self.my_marker,'click',function(){infoWindow.setContent(this.html);infoWindow.open(self.my_map,this);});},get_geolocation:function(){var self=this;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){self.set_my_marker(position.coords.latitude,position.coords.longitude);self.get_pages();});}
else{alert('Your browser does not support geolocation api');}},set_my_location_page:function(page_num){this.my_location_page_num=page_num;this.get_pages();},set_my_location_address:function(address)
{this.my_location_address=address;this.my_location_page_num=1;this.get_pages();},get_pages:function()
{var self=this;$('my_location_loading').removeClass('hidden');my_request=new Request.HTML({url:self.my_url,data:{my_latitude:self.my_lat,my_longitude:self.my_lon,my_address:self.my_location_address,my_page_num:self.my_location_page_num},onComplete:function(responseTree,responseElements,responseHTML,responseJavaScript){var el=$$('.layout_page_my_location');var tElement=new Element('div',{'html':responseHTML});$('my_location_pages').innerHTML=tElement.getElement('.layout_page_my_location').innerHTML;if($('my_location_pagination_select'))
$('my_location_pagination_select').value=self.my_location_page_num;}}).post();}};var donations_map={pages_array:{},markers_array:{},map_bounds:{},current_data:{},zoom:4,constructed:false,canvas_id:'map_canvas',construct:function(pages_array,markers_array,zoom,map_bounds,edit_mode){this.pages_array=pages_array;this.markers_array=markers_array;this.map_bounds=map_bounds;this.zoom=zoom;this.init();if(edit_mode==undefined&&!edit_mode){this.show_map();}else{this.show_edit_map();}
this.constructed=true;},init:function(){window.map=new google.maps.Map(document.getElementById('map_canvas'),{mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:false});},show_map:function(){if(this.markers_array.length==0){return false;}
var infoWindow=new google.maps.InfoWindow({content:''});for(var i=0;i<this.markers_array.length;i++)
{marker=this.markers_array[i];point=new google.maps.LatLng(marker.lat,marker.lng);marker_obj=new google.maps.Marker({position:point,map:window.map});marker_obj.html='<table width="500px"><tr valign="top"><td width="110px"><img src="'+marker.pages_photo+'" width="100"></td><td width="400px"><h3 style="margin-top:0; margin-bottom:6px;"><a href="'+marker.url+'">'+marker.title+'</a></h3>'+marker.desc+'</td></tr></table>';if(!marker.desc){marker.desc='';}
google.maps.event.addListener(marker_obj,'click',function(){infoWindow.setContent(this.html);infoWindow.open(window.map,this);});}
window.map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));window.map.setZoom(4);if(this.map_bounds&&this.map_bounds.min_lat&&this.map_bounds.max_lng&&this.map_bounds.min_lat&&this.map_bounds.max_lng){var bds=new google.maps.LatLngBounds(new google.maps.LatLng(this.map_bounds.min_lat,this.map_bounds.min_lng),new google.maps.LatLng(this.map_bounds.max_lat,this.map_bounds.max_lng));}
if(this.map_bounds&&this.map_bounds.map_center_lat&&this.map_bounds.map_center_lng){window.map.setCenter(new google.maps.LatLng(this.map_bounds.map_center_lat,this.map_bounds.map_center_lng));window.map.setZoom(4);}else{window.map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));window.map.setZoom(this.zoom);}
if(bds){window.map.fitBounds(bds);}},show_edit_map:function(){if(this.markers_array.length==0){return false;}
var self=this;var infoWindow=new google.maps.InfoWindow({content:''});for(var i=0;i<this.markers_array.length;i++)
{marker=this.markers_array[i];point=new google.maps.LatLng(marker.lat,marker.lng);marker_obj=new google.maps.Marker({position:point,map:window.map,draggable:true});marker_obj.html='<table width="500"><tr valign="top"><td width="110"><img src="'+marker.pages_photo+'" width="100"></td><td width="400"><h3 style="margin-top:0; margin-bottom:6px;"><a href="'+marker.url+'">'+marker.title+'</a></h3>'+marker.desc+'</td></tr></table>';if(!marker.desc){marker.desc='';}
google.maps.event.addListener(marker_obj,'click',function(){infoWindow.setContent(this.html);infoWindow.open(window.map,this);});}
window.map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));window.map.setZoom(4);if(this.map_bounds&&this.map_bounds.min_lat&&this.map_bounds.max_lng&&this.map_bounds.min_lat&&this.map_bounds.max_lng){var bds=new google.maps.LatLngBounds(new google.maps.LatLng(this.map_bounds.min_lat,this.map_bounds.min_lng),new google.maps.LatLng(this.map_bounds.max_lat,this.map_bounds.max_lng));}
if(this.map_bounds&&this.map_bounds.map_center_lat&&this.map_bounds.map_center_lng){window.map.setCenter(new google.maps.LatLng(this.map_bounds.map_center_lat,this.map_bounds.map_center_lng));window.map.setZoom(4);}else{window.map.setCenter(new google.maps.LatLng(marker.lat,marker.lng));window.map.setZoom(this.zoom);}
if(bds){window.map.fitBounds(bds);}
google.maps.event.addListener(marker_obj,"dragend",function(){self.trackChanges(marker_obj);});},showEditMap:function(pages_array,markers_array,zoom,map_bounds,edit_mode){$$('.page_edit_form_map_show').addClass('display_none');$$('.page_edit_form_map_hide').removeClass('display_none');$('map_canvas').removeClass('display_none');if(!this.constructed){this.construct(pages_array,markers_array,zoom,map_bounds,edit_mode);}},hideEditMap:function(){$$('.page_edit_form_map_show').removeClass('display_none');$$('.page_edit_form_map_hide').addClass('display_none');$('map_canvas').addClass('display_none');},trackChanges:function(marker){var coords=marker.getPosition();$('coordinates').value=coords.lat()+';'+coords.lng();geocoder=new google.maps.Geocoder();geocoder.geocode({'latLng':marker.getPosition()},function(results,status){if(status==google.maps.GeocoderStatus.OK){if(results[0]){var address=csvToArray(results[0].formatted_address,',');var index=address.length-1;if(index>=0){$('country').value=address[index].trim();index--;}
if(index>=0){var len=results[0].address_components.length,i;for(i=len-1;i>0;i--){if(results[0].address_components[i].types[0]=='country'){i--;$('state').value=results[0].address_components[i].long_name;break;}}
index--;}
if(index>=0){$('city').value=address[index].trim();index--;}
if(index>=0){$('street').value=address[index].trim();index--;}}}});}};var Donate={chooseAmount:'.donation_select > ul > li',checkAnonymous:'anon',fullName:'name',fieldsAnonymous:'.for_guests .fields_anonymous',selected_id:null,init:function(user_id){this.initSelectors();if(!user_id){var $name=$(this.fullName);$name.addEvent('focus',function(){if(this.value==en4.core.language.translate('DONATION_Anonym')){this.value='';}});$name.addEvent('blur',function(){if(this.value==''){this.value=en4.core.language.translate('DONATION_Anonym');}});}},initSelectors:function(){var self=this;var $selectors=$$(this.chooseAmount);if($selectors){$selectors.addEvent('click',function(){$selectors.removeClass('active');this.addClass('active');self.selected_id=this.id;});}}};;var like_api={likes:null,viewer:null,like_url:'',unlike_url:'',viewer_url:'',urls:{},like_img:'',unlike_img:'',like_count:0,block:false,login_url:'',unlike_class:'unlike',like_class:'like',likes_container_id:'like_button_likes',subject_guid:'',$link:null,method:'post',format:'json',like_button_container:'like_button_wrapper',$like_button_container:{},like:function(){var self=this;if(this.block){return;}
if(!this.viewer_url){this.login();return;}
this.block=true;self.show_loader();new Request.JSON({method:self.method,url:self.like_url,data:{format:self.format},onSuccess:function(response){self.hide_loader();if(response.error==3){self.login();return false;}else if(response.error>0){return false;}
self.toggle();self.viewer_url=response.viewer_url;self.viewer=response.viewer;self.add_like(response.viewer);self.like_count++;self.build();self.block=false;return true;}}).send();},unlike:function(){var self=this;if(this.block){return;}
this.block=true;this.show_loader();new Request.JSON({method:self.method,url:self.unlike_url,data:{format:self.format},onSuccess:function(response){self.hide_loader();if(response.error==3){self.login();return false;}else if(response.error>0){return false;}
self.toggle();self.remove_like(response.viewer.user_id);self.like_count--;self.build();self.block=false;return true;}}).send();},show_loader:function(){this.$like_button_container.setStyle('display','none');},hide_loader:function(){this.$like_button_container.setStyle('display','block');},remove_like:function(user_id){var likes=this.likes;if(!likes.length||!likes){return;}
for(var i=0;i<likes.length;i++){var like=likes[i];if(like.user_id==user_id){likes=likes.slice(0,i).concat(likes.slice(i+1));break;}}
this.urls[user_id]='';this.likes=likes;},add_like:function(like){if(!this.likes){this.likes=[];}
this.likes.push(like);this.urls[like.user_id]=this.viewer_url;},build:function(){var likes=this.likes;var html='';var urls=this.urls;var like={};var out='';var like_count=this.like_count;var other_count=like_count-likes.length;if(!other_count&&!likes.length){$(this.likes_container_id).innerHTML=langs.l_noResult;return;}
if(likes[likes.length-1]){like=likes[likes.length-1];if(like.user_id==this.viewer.user_id){html+='<a href="'+urls[like.user_id]+'" style="font-weight: bold; text-decoration: none;" target="_blank">'+langs.l_you+'</a>';likes=likes.slice(0,likes.length-1).concat(likes.slice(likes.length));if((other_count>0&&likes.length>0)||(!other_count&&likes.length>1)){html+=', ';}else if(!other_count&&!likes.length){html+='';}else{html+=' '+langs.l_and+' ';}}}
for(var i=0;i<likes.length;i++){like=likes[i];out='<a href="'+urls[like.user_id]+'" style="font-weight: bold; text-decoration: none;" target="_blank">'+like.displayname+'</a>';if(i!=(likes.length-1)){out+=', '}
html+=out;}
if(likes.length>0){html+=' '+langs.l_and+' ';}
if(other_count>1){html+=other_count+' '+langs.l_people+' ';}else if(other_count==1){html+=other_count+' '+langs.l_person+' ';}
html+=' '+langs.l_like_it;$(this.likes_container_id).innerHTML=html;},login:function(){return window.open(this.login_url,'popup','width=450,height=240,scrollbars=no,resizable=no,toolbar=no,directories=no,location=no,menubar=no,status=yes,left=0,top=0');},toggle:function(){var $link=$(this.$link);if($link.hasClass(this.unlike_class)){this.set_like();}else{this.set_unlike();}},set_like:function(){var $link=$(this.$link);var self=this;$link.removeEvents('click');$link.children[0].className='like_button';$link.children[0].innerHTML=langs.l_Like;$link.children[0].style.backgroundImage='url('+this.like_img+')';$link.removeClass(this.unlike_class);$link.addClass(this.like_class);$link.addEvent('click',function(){self.like();});return $link;},set_unlike:function(){var $link=$(this.$link);var self=this;$link.removeEvents('click');$link.children[0].className='unlike_button';$link.children[0].innerHTML=langs.l_Unlike;$link.children[0].style.backgroundImage='url('+this.unlike_img+')';$link.removeClass(this.like_class);$link.addClass(this.unlike_class);$link.addEvent('click',function(){self.unlike();});return $link;},init:function(){this.$link=$('_'+this.subject_guid);this.$like_button_container=$(this.like_button_container);this.init_link();},init_link:function(){var self=this;this.$link.removeEvents('click');if(this.$link.hasClass(this.unlike_class)){this.$link.addEvent('click',function(){self.unlike();});}else{this.$link.addEvent('click',function(){self.like();});}}}
function showLikesList($node,type){$node=$($node);var $box=$node.getParents('.he_like_cont');if(!$box||!$box[0]){return;}
$box=$box[0];$box.getElements('ul.like_list_switcher li a').removeClass('active');$node.addClass('active');$cur_list=$box.getElement('.likes_'+type);$old_list=$box.getElement('div.active_list');if($cur_list.hasClass('active_list')){$node.blur();return;}
var cur_tween=new Fx.Morph($cur_list,{duration:300,opacity:0});var old_tween=new Fx.Morph($old_list,{duration:300,opacity:1});old_tween.start({opacity:0}).chain(function(){$old_list.removeClass('active_list');$cur_list.addClass('active_list');cur_tween.start({opacity:1}).chain(function(){$node.blur();});});}
function print_arr(object,flag){var type=typeof(object);var output='';var property=null;switch(type){case'object':{for(property in object){output+=property+': '+print_arr(object[property],true)+'; ';}}
break;case'array':{for(var i=0;i<object.length;i++){output+=i+': '+print_arr(object[i],true)+'; ';}}
break;case'string':{output='"'+object+'"';}
break;case'number':default:{output=object;}}
if(flag){return output;}
if(window.console!==undefined){window.console.log(output);}else{alert(output);}};var LikeButton=new Class({Implements:[Options],options:{object_type:'',object_id:0,likeBtn:'',loader:'',menuHtml:'',menuId:'',suggestBtn:'',likeUrl:en4.core.baseUrl+'like/like',unlikeUrl:en4.core.baseUrl+'like/unlike',switcher:''},unlike_class:'unlike',like_class:'like',block:false,menuContainer:null,initialize:function(options){this.setOptions(options);this.options.likeBtn=$(this.options.likeBtn);this.options.loader=$(this.options.loader);this.options.switcher=$(this.options.switcher);if(this.options.likeBtn){if(this.options.likeBtn.hasClass(this.unlike_class)){this.setUnlike();}else{this.setLike();}}
this.init_menu();},init_menu:function(){var $div=new Element('div',{'html':this.options.menuHtml,'style':'position:absolute;','id':this.options.menuId});this.menuContainer=$div=$div.getElements('.like_container_menu_wrapper')[0];$$('body')[0].appendChild($div);this.initPosition();this.options.suggestBtn=$$(this.options.suggestBtn)[0];this.init_suggest_link();if(this.options.switcher){var self=this;this.options.switcher.addEvent('click',function(){self.toggle_menu();});}
if(Smoothbox&&Smoothbox.init){Smoothbox.init();}},initPosition:function(){var $switcher=$(this.options.likeBtn).getNext();var position=$switcher.getPosition();if(this.menuContainer!=undefined){if(en4.orientation=='rtl'){this.menuContainer.setStyle('left',position.x-this.menuContainer.getSize().x);}
else
{this.menuContainer.setStyle('left',position.x+20);}
this.menuContainer.setStyle('top',position.y);}},init_suggest_link:function(){var self=this;if(!this.options.suggestBtn){return;}
this.options.suggestBtn.addEvent('click',function(e){e.stop();like.url.suggest=this.href;he_contacts.box('like','getFriends','like.suggest',en4.core.language.translate('like_Suggest to Friends'),{'object':self.options.object_type,'object_id':self.options.object_id},0);});},like:function(){var self=this;if(this.block){return;}
this.showLoader();this.block=true;new Request.JSON({method:'post',url:self.options.likeUrl,data:{format:'json'},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);return;}
self.hideLoader();self.toggle();return true;}}).send();},unlike:function(){var self=this;if(this.block){return;}
self.showLoader();this.block=true;new Request.JSON({method:'post',url:self.options.unlikeUrl,data:{format:'json'},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);return;}
self.hideLoader();self.toggle();return true;}}).send();},toggle:function(){var $link=$(this.options.likeBtn);if($link.hasClass(this.unlike_class)){this.setLike();}else{this.setUnlike();}
this.initPosition();},toggle_menu:function(){var menu=this.menuContainer
var link=this.options.switcher;if(menu.hasClass('hidden')){menu.removeClass('hidden');link.getElements('span')[0].set('class','hide_options');link.set('title',en4.core.language.translate('like_Hide'));this.initPosition();}else{menu.addClass('hidden');link.getElements('span')[0].set('class','show_options');link.set('title',en4.core.language.translate('like_Show Like'));}},setLike:function(){var $link=$(this.options.likeBtn);var self=this;$link.getElements('span')[0].set('class','like_button');$link.getElements('span')[0].set('text',en4.core.language.translate('like_Like'));$link.set('class','like_button_link '+self.like_class);$link.removeEvents('click');$link.addEvent('click',function(){self.like();});return this;},setUnlike:function(){var $link=$(this.options.likeBtn);var self=this;$link.removeEvents('click');$link.getElements('span')[0].set('class','unlike_button');$link.getElements('span')[0].set('text',en4.core.language.translate('like_Unlike'));$link.set('class','like_button_link '+self.unlike_class);$link.addEvent('click',function(){self.unlike();});return this;},showLoader:function(){this.options.likeBtn.addClass('hidden');if(this.options.switcher){this.options.switcher.addClass('hidden');}
this.options.loader.removeClass('hidden');},hideLoader:function(){this.options.likeBtn.removeClass('hidden');if(this.options.switcher){this.options.switcher.removeClass('hidden');}
this.options.loader.addClass('hidden');}});var like={block:false,sender:{},url:{ajax:'',suggest:'',remove:''},clubs:{pages:{count:0,items:[]},users:{count:0,items:[]}},loader_id:'he_contacts_loading',disabled_div:'he_disabled_div',$link:{},method:'post',format:'json',unlike_class:'unlike',like_class:'like',like_url:'',unlike_url:'',menu_html:'',init:function(){var self=this;$$('.disable_like_club, .enable_like_club').addEvent('click',function(e){e.stop();self.url.ajax=this.href;self.sender=this;self.send();});if($$('a.like_display_none')){$$('a.like_display_none').each(function($item){$item.getParent().setStyle('display','none');});}
var guid=en4.core.subject.guid;if($('_'+guid)){this.$link=$('_'+guid);if(this.$link.hasClass(this.unlike_class)){this.set_unlike();}else{this.set_like();}}
this.init_menu();},init_menu:function(){var $div=new Element('div',{'html':this.menu_html,'style':'position:absolute;'});$div=$div.getElements('.like_container_menu_wrapper')[0];$$('body')[0].appendChild($div);var $switcher=$(this.$link).getNext();var position=$switcher.getPosition();$div.setStyle('left',position.x+20);$div.setStyle('top',position.y);this.init_suggest_link();Smoothbox.init();},init_suggest_link:function(){var self=this;if(!$$('.like_suggest')){return;}
$$('.like_suggest').addEvent('click',function(e){e.stop();self.url.suggest=this.href;he_contacts.box('like','getFriends','like.suggest',en4.core.language.translate('like_Suggest to Friends'),{'object':window.en4.core.subject.type,'object_id':window.en4.core.subject.id},0);});},set_menu_pos:function(){var $div=$$('.like_container_menu_wrapper')[0];var $switcher=$(this.$link).getNext();var position=$switcher.getPosition();$div.setStyle('left',position.x+20);$div.setStyle('top',position.y);},like:function(){var self=this;if(this.block){return;}
self.show_like_loader();this.block=true;new Request.JSON({method:self.method,url:self.like_url,data:{format:self.format},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);return;}
self.hide_like_loader();self.toggle();return true;}}).send();},unlike:function(){var self=this;if(this.block){return;}
self.show_like_loader();this.block=true;new Request.JSON({method:self.method,url:self.unlike_url,data:{format:self.format},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);return;}
self.hide_like_loader();self.toggle();return true;}}).send();},toggle:function(){var $link=$(this.$link);if($link.hasClass(this.unlike_class)){this.set_like();}else{this.set_unlike();}},set_like:function(){var $link=$(this.$link);var self=this;$link.getElements('span')[0].set('class','like_button');$link.getElements('span')[0].set('text',en4.core.language.translate('like_Like'));$link.set('class','like_button_link '+self.like_class);$link.removeEvents('click');$link.addEvent('click',function(){self.like();});this.$link=$($link);return this.$link;},set_unlike:function(){var $link=$(this.$link);var self=this;$link.removeEvents('click');$link.getElements('span')[0].set('class','unlike_button');$link.getElements('span')[0].set('text',en4.core.language.translate('like_Unlike'));$link.set('class','like_button_link '+self.unlike_class);$link.addEvent('click',function(){self.unlike();});this.$link=$($link);return $link;},show_like_loader:function(){$(this.$link).addClass('hidden');if($$('.like_menu_switcher')[0]){$$('.like_menu_switcher')[0].addClass('hidden');}
$$('.like_button_loader')[0].removeClass('hidden');},hide_like_loader:function(){$(this.$link).removeClass('hidden');if($$('.like_menu_switcher')[0]){$$('.like_menu_switcher')[0].removeClass('hidden');}
$$('.like_button_loader')[0].addClass('hidden');},init_counts:function(){var self=this;if($('like_users_count')){$('like_users_count').innerHTML="("+this.clubs.users.count+")";}
if($('like_pages_count')){$('like_pages_count').innerHTML="("+this.clubs.pages.count+")";}
if($$('.like_profile_pages')[0]){$$('.like_profile_pages')[0].addEvent('click',function(){self.make_active(this);});}
if($$('.like_profile_users')[0]){$$('.like_profile_users')[0].addEvent('click',function(){self.make_active(this);});this.make_active($$('.like_profile_users')[0]);}
if($$('.menu_like_profile')){$$('.menu_like_profile').addEvent('focus',function(){this.blur();});}
if(!this.clubs.users.count){if($$('.no_result_users'))$$('.no_result_users').removeClass('hidden');}
if(!this.clubs.pages.count){if($$('.no_result_pages'))$$('.no_result_pages').removeClass('hidden');}},make_active:function($link){if($$('ul.like_navigation li.active'))$$('ul.like_navigation li.active').removeClass('active');$link.getParent().addClass('active');},list:function(type,$link){var id="likes_"+type;$$('.like_navigation_item').removeClass('active');$($link).getParent().addClass('active');if(!$(id).hasClass('hidden')){return;}
$$('.like_club_container').addClass('hidden');$(id).removeClass('hidden');},suggest:function(user_ids){var self=this;new Request.JSON({'url':self.url.suggest,'method':'post','data':{'user_ids':user_ids,'format':'json'}}).send();},send:function(){if(this.block||!this.url.ajax){return;}
this.block=true;var self=this;new Request.JSON({'url':self.url.ajax,'method':'post','data':{'format':'json'},onSuccess:function(response){self.sender.getParent().innerHTML=response.html;self.init();self.block=false;switch(response.link){case'disable':if($$('.like_promote')[0])$$('.like_promote')[0].getParent().setStyle('display','block');if($$('.like_send_update')[0])$$('.like_send_update')[0].getParent().setStyle('display','block');if($$('.like_suggest')[0])$$('.like_suggest')[0].getParent().setStyle('display','block');if($$('.like_button_container')[0])$$('.like_button_container')[0].setStyle('display','block');break;case'enable':if($$('.like_promote')[0])$$('.like_promote')[0].getParent().setStyle('display','none');if($$('.like_send_update')[0])$$('.like_send_update')[0].getParent().setStyle('display','none');if($$('.like_suggest')[0])$$('.like_suggest')[0].getParent().setStyle('display','none');if($$('.like_button_container')[0])$$('.like_button_container')[0].setStyle('display','none');break;}}}).send();},see_all:function(object,object_id,period_type){he_list.box('like','getLikes','Likes',{'object':object,'object_id':object_id,'period_type':period_type});},see_all_liked:function(user_id,period_type){var $el=new Element('a',{'href':'like/see-liked/user_id/'+user_id+'/period_type/'+period_type,'class':'smoothbox'});Smoothbox.open($el);},list_like:function(object,object_id,$element,callback){var self=this;$element=$($element);if(this.block){return false;}
this.block=true;new Request.JSON({'url':'like/like/object/'+object+'/object_id/'+object_id,'method':'post','data':{'format':'json'},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);callback(false);return;}
$('unlike_'+object+'_'+object_id).getParent().setStyle('display','block');$('like_'+object+'_'+object_id).getParent().setStyle('display','none');if(typeof(callback)=='function'){callback(true);}}}).send();},list_unlike:function(object,object_id,$element,callback){var self=this;$element=$($element);if(this.block){return false;}
this.block=true;new Request.JSON({'url':'like/unlike/object/'+object+'/object_id/'+object_id,'method':'post','data':{'format':'json'},onSuccess:function(response){self.block=false;if(response.error){he_show_message(response.html,'error',3000);callback(true);return;}
$('unlike_'+object+'_'+object_id).getParent().setStyle('display','none');$('like_'+object+'_'+object_id).getParent().setStyle('display','block');if(typeof(callback)=='function'){callback(false);}}}).send();},init_buttons:function(){var self=this;if($$('div.like_button_container a.unlike')){var $btns=$$('.like_button_container a.unlike');$btns.removeEvents('click');$btns.each(function($item){if($item.hasClass('unlike')){$item.addEvent('click',function(){var id=this.id;var guid=id.substr(7);var info=guid.split('_');self.list_unlike(info[0],info[1],$item);});}});}
if($$('div.like_button_container a.like')){var $btns=$$('.like_button_container a.like');$btns.removeEvents('click');$btns.each(function($item){if($item.hasClass('like')){$item.addEvent('click',function(){var id=this.id;var guid=id.substr(5);var info=guid.split('_');self.list_like(info[0],info[1],$item);});}});}},init_like_buttons:function(){var self=this;if($$('.page_browser_likebox a.unlike')){var $btns=$$('.page_browser_likebox a.unlike');$btns.removeEvents('click');$btns.each(function($item){if($item.hasClass('unlike')){$item.addEvent('click',function(){var id=this.id;var guid=id.substr(7);var info=guid.split('_');if(info.length==3){self.show_page_loader(info[2]);self.list_unlike(info[0]+'_'+info[1],info[2],$item,function(liked){self.hide_page_loader(info[2],liked);});}else{self.show_page_loader(info[1]);self.list_unlike(info[0],info[1],$item,function(liked){self.hide_page_loader(info[1],liked);});}});}});}
if($$('.page_browser_likebox a.like')){var $btns=$$('.page_browser_likebox a.like');$btns.removeEvents('click');$btns.each(function($item){if($item.hasClass('like')){$item.addEvent('click',function(){var id=this.id;var guid=id.substr(5);var info=guid.split('_');if(info.length==3){self.show_page_loader(info[2]);self.list_like(info[0]+'_'+info[1],info[2],$item,function(liked){self.hide_page_loader(info[2],liked);});}else{self.show_page_loader(info[1]);self.list_like(info[0],info[1],$item,function(liked){self.hide_page_loader(info[1],liked);});}});}});}},show_page_loader:function(id){$('page_status_'+id).addClass('hidden');$('page_loader_like_'+id).removeClass('hidden');},hide_page_loader:function(id,liked){$('page_status_'+id).removeClass('hidden');$('page_loader_like_'+id).addClass('hidden');var $item=$('page_status_'+id).getParent('.item');if(liked){$item.addClass('liked_item');}else{$item.removeClass('liked_item');}},select_list:function(list,user_id,$link){var self=this;self.show_loader();new Request.JSON({'url':'like/see-liked/list/'+list+'/user_id/'+user_id,'method':'post','data':{'format':'json'},onSuccess:function(response){$('he_list').innerHTML=response.html;if($$('.select_btns .active')){$$('.select_btns .active').each(function($element){$($element).removeClass('active');});}
$($link).addClass('active');self.hide_loader();self.init_buttons();}}).send();},do_remove:function(object,object_id){var self=this;var $item=$('like_'+object+'_'+object_id);$item.dispose();new Request.JSON({'url':self.url.remove,'method':'post','data':{'object':object,'object_id':object_id,'format':'json'},onSuccess:function(response){if(response.error){he_show_message(response.html,'error',3000);return;}
self.counting(object+'s',-1);}}).send();},remove:function(object,object_id){var self=this;var callback=function(){self.do_remove(object,object_id)};he_show_confirm(en4.core.language.translate("like_Unlike"),en4.core.language.translate("like_Are you sure you want to unlike this?"),callback);},counting:function(type,count){var prev=$('like_'+type+'_count').innerHTML.substr(1).toInt();var next=prev+count;$('like_'+type+'_count').innerHTML="("+next+")";if(!next){$$('.no_result_'+type).removeClass('hidden');}},show_loader:function(){$(this.loader_id).removeClass('hidden');$(this.disabled_div).removeClass('hidden');},hide_loader:function(){$(this.loader_id).addClass('hidden');},toggle_menu:function($link){$link=$($link);if($$('.like_container_menu_wrapper')[0].hasClass('hidden')){$$('.like_container_menu_wrapper')[0].removeClass('hidden');$link.getElements('span')[0].set('class','hide_options');$link.set('title',en4.core.language.translate('like_Hide'));this.set_menu_pos();}else{$$('.like_container_menu_wrapper')[0].addClass('hidden');$link.getElements('span')[0].set('class','show_options');$link.set('title',en4.core.language.translate('like_Show Like'));}},get_mutual_friends:function(user_id){he_list.box('like','getMutualFriends',en4.core.language.translate('Friends'),{'user_id':user_id,'list_type':'mutual'});},get_friends:function(user_id){he_list.box('like','getFriends',en4.core.language.translate('Friends'),{'user_id':user_id,'list_type':'all'});}}
var LikeTips=new Class({Implements:[Options],type:'',id:0,guid:'',options:{container:'comments',html:'',url:{like:'',unlike:'',hint:'',showLikes:'',postComment:''}},likeBtn:null,unlikeBtn:null,commentBtn:null,commentForm:null,commentViewAllBtns:[],container:null,likeContainer:null,likeCountBtn:null,viewAllLikes:false,cache:{},tipBlock:{},blockHints:false,timeout:null,tips:null,initialize:function(type,id,options){this.type=type;this.id=id;this.guid=type+'_'+id;this.setOptions(options);this.tipBlock=this.createTipBlock();this.container=$(this.options.container);this.replace();this.init();this.bind();return this;},createTipBlock:function(){if($('like_tip_'+this.guid)){return $('like_tip_'+this.guid);}
var $container=new Element('div',{'class':'like_tool_tip hidden','id':'like_tip_'+this.guid,'style':'position:absolute;'});var $header=new Element('div',{'class':'like-tip-title'});var $content=new Element('div',{'class':'like-tip'});var $footer=new Element('div',{'class':'like-tip-footer'});var $clr=new Element('div',{'class':'clr'});$container.appendChild($header);$container.appendChild($content);$container.appendChild($footer);$container.appendChild($clr);$$('body')[0].appendChild($container);return $container;},init:function(){this.likeContainer=$('comments_likes_list_'+this.guid);this.likeCountBtn=$('show_likes_'+this.guid);this.likeBtn=$('comments_like_'+this.guid);this.unlikeBtn=$('comments_unlike_'+this.guid);this.commentBtn=$('post_comment_'+this.guid);this.commentViewAllBtns=$$('.comments_view_all_'+this.guid);this.commentForm=$('comment-form_'+this.guid);if(this.likeCountBtn){this.bindLikeCountBtn();}
if(this.likeBtn){this.bindLikeBtn();}
if(this.unlikeBtn){this.bindUnlikeBtn();}
if(this.commentBtn){this.bindCommentBtn();}
if(this.commentViewAllBtns){this.bindCommentViewAllBtns();}
if(this.commentForm){this.bindCommentForm();}
return this;},replace:function(html){if(!html){html=this.options.html;}
if(this.container){this.container.set('html',html);}
return this;},runScripts:function(){$$(this.container.getElements('script')).each(function($script){var script=$script.innerHTML;eval(script);});return this;},bind:function(){var self=this;if(!$(this.likeContainer)){return;}
var $likes=$$($(this.likeContainer).getElements('a'));if($likes.length){$likes.each(function($item){self.bindItem($item);});}},bindItem:function($item){var self=this;if(!$item){return;}
if($item.href.indexOf('javascript')>=0){return;}
$($item).addEvents({'mouseover':function(){var username=this.href.split('/').pop();var x=$(this).getPosition().x;var y=$(this).getPosition().y;self.timeout=window.setTimeout(function(){self.hint(username,x,y);},500);},'mouseout':function(){window.clearTimeout(self.timeout);self.timeout=window.setTimeout(function(){self.hideTip();},500);}});},hint:function(username,x,y){var self=this;if(this.blockHints){return;}
if(this.cache[username]){this.showTip(this.cache[username],x,y);this.blockHints=false;return;}
this.blockHints=true;new Request.JSON({'method':'post','url':self.options.url.hint,'data':{'username':username,'format':'json'},onSuccess:function(response){self.cache[username]=response.html;self.showTip(response.html,x,y);self.blockHints=false;}}).send();},showTip:function(html,x,y){var self=this;$(this.tipBlock).getElements('.like-tip')[0].set('html',html);$(this.tipBlock).setStyle('left',x);$(this.tipBlock).setStyle('top',(y-175));$(this.tipBlock).removeClass('hidden');Smoothbox.bind();var miniTipsOptions={'htmlElement':'.like_hint_text','delay':100,'className':'he-tip-mini','id':'he-mini-tool-tip-id','ajax':false,'visibleOnHover':false};var internalTips=new HETips($$('.like_hint_tip_links'),miniTipsOptions);this.tipBlock.removeEvents('mouseover').removeEvents('mouseout').addEvents({'mouseover':function(){if(self.options.visibleOnHover){window.clearTimeout(self.timeout);}},'mouseout':function(){self.timeout=window.setTimeout(function(){self.hideTip();},500);}});},hideTip:function(){this.tipBlock.addClass('hidden');},bindLikeCountBtn:function(){var self=this;this.resetLikeCountBtn();var $btn=this.likeCountBtn;$btn.removeEvents('click').addEvent('click',function(){self.viewAllLikes=true;new Request.JSON({'method':'post','url':self.options.url.showLikes,'data':{'format':'json','type':self.type,'id':self.id,'viewAllLikes':self.viewAllLikes},onSuccess:function(response){self.replace(response.body);self.init();self.bind();}}).send();});return this;},bindLikeBtn:function(){var self=this;this.resetLikeBtn();var $btn=this.likeBtn;$btn.removeEvents('click').addEvent('click',function(){new Request.JSON({'method':'post','url':self.options.url.like,'data':{'format':'json','type':self.type,'id':self.id,'viewAllLikes':self.viewAllLikes},onSuccess:function(response){self.replace(response.body);self.init();self.bind();}}).send();});return this;},bindUnlikeBtn:function(){var self=this;this.resetUnlikeBtn();var $btn=this.unlikeBtn;$btn.removeEvents('click').addEvent('click',function(){new Request.JSON({'method':'post','url':self.options.url.unlike,'data':{'format':'json','type':self.type,'id':self.id,'viewAllLikes':self.viewAllLikes},onSuccess:function(response){self.replace(response.body);self.init();self.bind();}}).send();});return this;},bindCommentBtn:function(){var self=this;this.resetCommentBtn();var $btn=this.commentBtn;$btn.removeEvents('click').addEvent('click',function(){if(self.commentForm){self.commentForm.style.display='';self.commentForm.body.focus();}});return this;},bindCommentForm:function(){var self=this;this.resetCommentForm();var $form=$(this.commentForm);$($form.body).autogrow();$form.removeEvents('submit').addEvent('submit',function(e){e.stop();var body=this.body.value;new Request.JSON({'method':'post','url':self.options.url.postComment,'data':{'format':'json','type':self.type,'id':self.id,'body':body,'viewAllLikes':self.viewAllLikes},onSuccess:function(response){self.replace(response.body);self.init();self.bind();$form.style.display='none';}}).send();});return this;},bindCommentViewAllBtns:function(){var self=this;this.resetCommentViewAllBtns();var $btns=this.commentViewAllBtns;$btns.removeEvents('click').addEvent('click',function(){var page=this.id.split('_').pop();new Request.JSON({'method':'post','url':self.options.url.showLikes,'data':{'format':'json','type':self.type,'id':self.id,'page':page},onSuccess:function(response){self.replace(response.body);self.init();self.bind();}}).send();});return this;},resetLikeCountBtn:function(){this.likeCountBtn.set('onclick','');return this;},resetLikeBtn:function(){this.likeBtn.set('onclick','');return this;},resetUnlikeBtn:function(){this.unlikeBtn.set('onclick','');return this;},resetCommentBtn:function(){this.commentBtn.set('onclick','');return this;},resetCommentForm:function(){$(this.commentForm).set('onsubmit','');return this;},resetCommentViewAllBtns:function(){this.commentViewAllBtns.set('onclick','');}});var likeInterest={data:{},interests:{},html:null,id:0,button:"save_changes",$button:null,url:{add:'',remove:'',suggest:''},defaultText:{},defaultTextClass:'default_text',autoCompleters:{},interestItemClass:'.select',interestSelectedClass:'selected',linkIdPrefix:'select_',inputIdPrefix:'interest_',selectedInterestWrapperIdPrefix:'selected_interest_',linkListIdPrefix:'interests_list_',addedInterests:null,addedInterestsFake:null,isChanged:null,addedFiedlId:'added',privacyOptions:'.like_interests_privacy .options .option',privacyValue:'',init:function(id){this.id=id;this.initButton();this.initInputs();this.initInterests();this.initPrivacy();},input:function(type){return $(this.data[type].input);},initButton:function(){var self=this;this.$button=$(this.button);this.$button.addEvent('click',function(){var $form=self.createForm();$$('body')[0].appendChild($form);$form.submit();});},initPrivacy:function(){var self=this;var $buttons=$$(this.privacyOptions);$buttons.addEvent('click',function(){$buttons.removeClass('active');this.addClass('active');self.privacyValue=this.id;});},createForm:function(){var $form=new Element('form',{'action':this.url.submit,'method':'post','class':'hidden'});for(var type in this.addedInterests){var ids=this.addedInterests[type];var $input=new Element('input',{'type':'hidden','name':'data['+type+']','value':ids});$form.appendChild($input);}
for(var type in this.addedInterestsFake){var ids=this.addedInterestsFake[type];var $input=new Element('input',{'type':'hidden','name':'fake_data['+type+']','value':ids});$form.appendChild($input);}
var $input=new Element('input',{'type':'hidden','name':'view_interest','value':this.privacyValue});$form.appendChild($input);return $form;},initInterests:function(){var self=this;this.interests=$$(this.interestItemClass);this.interests.removeEvents('click').addEvents({'click':function(){self.initLink(this);},'focus':function(){this.blur();}});},initLink:function($link){this.interests.removeClass(this.interestSelectedClass);$link.addClass(this.interestSelectedClass);var guid=$link.id.substr(this.linkIdPrefix.length);var data=guid.split('_');var type=data[0];if(data.length>2){for(var i=1;i<(data.length-1);i++){type+='_'+data[i];}}
var id=data[data.length-1];this.showInterest(type,id);},showInterest:function(type,id){var previewType=this.convertType(type);$(this.selectedInterestWrapperIdPrefix+previewType).set('html',this.html[type+'_'+id]);},showInterestGuid:function(guid){var data=guid.split('_');var type=data[0];if(data.length>2){for(var i=1;i<(data.length-1);i++){type+='_'+data[i];}}
var id=data[data.length-1];this.showInterest(type,id);},initInputs:function(){var self=this;var data={id:self.id};if(this.data&&this.data.length<1){return;}
for(var type in this.data){data.type=type;data.except=self.addedInterests[type];data.fake_except=self.addedInterestsFake[type];switch(type)
{case'event':data.page_except=self.addedInterests['pageevent'];break;case'blog':data.page_except=self.addedInterests['pageblog'];break;case'music_playlist':data.page_except=self.addedInterests['playlist'];break;case'album':data.page_except=self.addedInterests['pagevideo'];default:break;}
this.autoCompleters[type]=new Autocompleter.Request.JSON(this.data[type].input,this.url.suggest,{'postVar':'text','postData':data,'customChoices':true,'minLength':1,'selectMode':'selection','autocompleteType':'interest','className':'interest-autosuggest','filterSubset':true,'multiple':false,'maxChoices':5,'cache':false,'injectChoice':function(token){var choice=new Element('li',{'class':'interest-choice','value':token.label,'id':token.id});var photo=new Element('div',{'html':'','class':'interest-choice-photo'});var a=new Element('a',{'html':'','class':'hidden href_holder','href':token.href});var img=new Element('img',{'src':token.img,'class':'thumb_icon item_photo_interest_suggest'});var title=new Element('div',{'html':this.markQueryValue(token.label),'class':'interest-choice-title'});var clr=new Element('div',{'html':'','class':'clr'});photo.appendChild(img);choice.appendChild(photo);choice.appendChild(title);choice.appendChild(a);choice.appendChild(clr);choice.inputValue=token;this.addChoiceEvents(choice).inject(this.choices);choice.store('autocompleteChoice',token);},onChoiceSelect:function(selected){var guid=selected.id;var data=guid.split('_');var type=data[0];if(data.length>2){for(var i=1;i<(data.length-1);i++){type+='_'+data[i];}}
var id=data[data.length-1];var interest={};var label=$(selected).getElement('.interest-choice-title').get('text');interest.title=label;interest.img=$(selected).getElement('img').src;interest.href=$(selected).getElement('a.href_holder').href;self.newInterest(type,id,interest);self.newInterestLink(type,id,label);switch(type){case'pageevent':var previewType='event';break;case'pageblog':var previewType='blog';break;case'pagevideo':var previewType='video';break;case'playlist':var previewType='music_playlist';break;default:var previewType=type;break;}
$(self.data[previewType].input).value='';},onBlur:function(input){var type=input.id.substr(self.inputIdPrefix.length);if(input.value.trim()==''){input.value=self.defaultText[type];$(input).addClass(self.defaultTextClass);}},onFocus:function(input){var type=input.id.substr(self.inputIdPrefix.length);if(input.value==self.defaultText[type]){input.value='';$(input).removeClass(self.defaultTextClass);}}});}},newInterestLink:function(type,id,title){var previewType=this.convertType(type);var self=this;var $item=new Element('div',{'class':'item'});var $a=new Element('a',{'href':'javascript:void(0)','html':title,'class':self.interestItemClass.substr(1),'id':self.linkIdPrefix+type+'_'+id});$item.appendChild($a);$item.setStyle('opacity',0);$item.set('tween',{duration:300});var $list=$(this.linkListIdPrefix+previewType).grab($item,'top');window.setTimeout(function(){$item.tween('opacity',1);},300);this.initInterests();$($a).fireEvent('click');},newInterest:function(type,id,interest){var $container=new Element('div');var $photo=new Element('div',{'class':'pic'});var $a=new Element('a',{'href':interest.href});var $img=new Element('img',{'src':interest.img,'class':'thumb_icon item_photo_'+type});if(parseInt(id))
{$a.appendChild($img);$photo.appendChild($a);}
else
{$photo.appendChild($img);}
$container.appendChild($photo);var $wrapper=new Element('div',{'class':'wrapper'});var $link=new Element('div',{'class':'link'});if(parseInt(id))
{var $a=new Element('a',{'href':interest.href,'html':interest.title});}
else
{var $a=new Element('label',{'text':interest.title});}
$link.appendChild($a);var $delete=new Element('div',{'class':'delete'});if(parseInt(id))
{var $a=new Element('a',{'href':'javascript:likeInterest.doRemove("'+type+'", '+id+')','html':'Remove'});}
else
{var $a=new Element('a',{'href':'javascript:likeInterest.doRemove("'+type+'", "'+id+'")','html':'Remove'});}
$delete.appendChild($a);$wrapper.appendChild($link);$wrapper.appendChild($delete);$container.appendChild($wrapper);var html=$container.innerHTML;if(this.addedInterests[type]===undefined)
{this.addedInterests[type]=[];}
if(parseInt(id))
{this.addedInterests[type].push(parseInt(id));this.refreshPostData(type);}
else
{this.addedInterestsFake[type].push(id);this.refreshPostData(type,true);}
this.newInterestHTML(type,id,html);this.showInterest(type,id);},newInterestHTML:function(type,id,html){this.html[type+'_'+id]=html;},remove:function(type,id){var self=this;he_show_confirm(en4.core.language.translate('like_Delete Interest'),en4.core.language.translate('like_If you delete it, you will unlike this item. Are you sure you want to delete it?'),function(){self.doRemove(type,id);});},doRemove:function(type,id){this.removeInterest(type,id);this.removeInterestLink(type,id);},removeInterest:function(type,id){var previewType=this.convertType(type);var $wrapper=$(this.selectedInterestWrapperIdPrefix+previewType);var guid=type+'_'+id;delete this.html[guid];var last=0;if(parseInt(id))
{this.addedInterests[type].erase(id);this.refreshPostData(type);}
else
{this.addedInterestsFake[type].erase(id);this.refreshPostData(type,true);if(this.addedInterestsFake[type].length)
{last=this.addedInterestsFake[type][this.addedInterestsFake[type].length-1];}
if(last)
{$(this.linkIdPrefix+type+'_'+last).fireEvent('click');return;}}
if(this.addedInterests[type].length){last=this.addedInterests[type][this.addedInterests[type].length-1];}
if(last){$(this.linkIdPrefix+type+'_'+last).fireEvent('click');}
else{if(this.isPageType(type))
{var new_type=this.convertType(type);}
else
{var new_type=this.convertToPageType(type);}
if(this.addedInterests[new_type]===undefined)
{this.addedInterests[new_type]=[];}
if(this.addedInterests[new_type].length)
{last=this.addedInterests[new_type][this.addedInterests[new_type].length-1];}
if(last)
{$(this.linkIdPrefix+new_type+'_'+last).fireEvent('click');}
else
{new_type=this.convertType(type);if(this.addedInterestsFake[new_type].length)
{last=this.addedInterestsFake[new_type][this.addedInterestsFake[new_type].length-1];}
if(last)
{$(this.linkIdPrefix+new_type+'_'+last).fireEvent('click');}
else
{$wrapper.set('html',' &nbsp; ');}}}},removeInterestLink:function(type,id){var $link=$(this.linkIdPrefix+type+'_'+id);$link.dispose();},refreshPostData:function(type,fake){if(fake)
{this.autoCompleters[type].options.postData.fake_except=this.addedInterestsFake[type];return;}
switch(type)
{case'pageevent':this.autoCompleters['event'].options.postData.page_except=this.addedInterests[type];break;case'pageblog':this.autoCompleters['blog'].options.postData.page_except=this.addedInterests[type];break;case'pagevideo':this.autoCompleters['video'].options.postData.page_except=this.addedInterests[type];break;case'playlist':this.autoCompleters['music_playlist'].options.postData.page_except=this.addedInterests[type];break;default:this.autoCompleters[type].options.postData.except=this.addedInterests[type];break;}},convertType:function(type){switch(type){case'pageevent':var previewType='event';break;case'pageblog':var previewType='blog';break;case'pagevideo':var previewType='video';break;case'playlist':var previewType='music_playlist';break;default:var previewType=type;break;}
return previewType;},convertToPageType:function(type)
{switch(type)
{case'event':var pageType='pageevent';break;case'blog':var pageType='pageblog';break;case'video':var pageType='pagevideo';break;case'music_playlist':var pageType='playlist';break;default:var pageType=type;break;}
return pageType;},isPageType:function(type)
{if(type=='playlist')
return 1;else
return type.indexOf('page')+1;}};var LikeAction=new Class({Implements:[Options],options:{userIds:[],likecount:0},nodeId:'',$node:null,viewerId:0,viewerLiked:false,initialize:function(nodeId,options){this.nodeId=nodeId;this.$node=$(nodeId);this.viewerId=en4.user.viewer.id;this.setOptions(options);this.viewerLiked=this.options.userIds.indexOf(this.viewerId)<0?false:true;this.render();},render:function(){var out='like_';var likeCount=this.options.likeCount;if(this.viewerLiked){out+='You ';likeCount--;if(likeCount){out+='and ';}}
if(likeCount>1){out+='%s other people ';}else if(likeCount==1){out+='%s other person ';}else if(!this.viewerLiked){out+='No one ';}
out+='like it.'
this.$node.set('html',en4.core.language.translate(out,likeCount));return out;}});;var Observer=new Class({Implements:[Options,Events],options:{periodical:false,delay:1000},initialize:function(el,onFired,options){this.element=$(el)||$$(el);this.addEvent('onFired',onFired);this.setOptions(options);this.bound=this.changed.bind(this);this.resume();},changed:function(){var value=this.element.get('value');if($equals(this.value,value))return;this.clear();this.value=value;this.timeout=this.onFired.delay(this.options.delay,this);},setValue:function(value){this.value=value;this.element.set('value',value);return this.clear();},onFired:function(){this.fireEvent('onFired',[this.value,this.element]);},clear:function(){$clear(this.timeout||null);return this;},pause:function(){if(this.timer)$clear(this.timer);else this.element.removeEvent('keyup',this.bound);return this.clear();},resume:function(){this.value=this.element.get('value');if(this.options.periodical)this.timer=this.changed.periodical(this.options.periodical,this);else this.element.addEvent('keyup',this.bound);return this;}});var $equals=function(obj1,obj2){return(obj1==obj2||JSON.encode(obj1)==JSON.encode(obj2));};;var Autocompleter=new Class({Implements:[Options,Events],options:{minLength:1,markQuery:true,width:'inherit',maxChoices:10,injectChoice:null,customChoices:null,emptyChoices:null,visibleChoices:true,className:'autocompleter-choices',zIndex:42,delay:1,observerOptions:{},fxOptions:{},autoSubmit:false,overflow:false,overflowMargin:25,selectFirst:true,filter:null,filterCase:false,filterSubset:false,forceSelect:false,selectMode:true,choicesMatch:null,multiple:false,separator:', ',separatorSplit:/\s*[,;]\s*/,autoTrim:false,allowDupes:false,cache:true,relative:true,tokenFormat:'object',tokenIdKey:'id',tokenValueKey:'label',prefetchOnInit:false,alwaysOpen:false,ignoreKeys:false,ignoreOverlayFix:false},initialize:function(element,options){this.element=$(element);this.setOptions(options);this.build();this.observer=new Observer(this.element,this.prefetch.bind(this),$merge({'delay':this.options.delay},this.options.observerOptions));this.queryValue=null;if(this.options.filter)this.filter=this.options.filter.bind(this);var mode=this.options.selectMode;this.typeAhead=(mode=='type-ahead');this.selectMode=(mode===true)?'selection':mode;this.cached=[];if(this.options.prefetchOnInit)this.prefetch.delay(this.options.delay+50,this);},build:function(){if($(this.options.customChoices)){this.choices=this.options.customChoices;}else{this.choices=new Element('ul',{'class':this.options.className,'styles':{'zIndex':this.options.zIndex}}).inject(document.body);this.relative=false;if(this.options.relative){this.choices.inject(this.element,'after');this.relative=this.element.getOffsetParent();}
if(!this.options.ignoreOverlayFix)this.fix=new OverlayFix(this.choices);}
if(!this.options.separator.test(this.options.separatorSplit)){this.options.separatorSplit=this.options.separator;}
if(!this.options.alwaysOpen){this.fx=(!this.options.fxOptions)?null:new Fx.Tween(this.choices,$merge({'property':'opacity','link':'cancel','duration':200},this.options.fxOptions)).addEvent('onStart',Chain.prototype.clearChain).set(0);}
this.element.setProperty('autocomplete','off').addEvent((Browser.Engine.trident||Browser.Engine.webkit)?'keydown':'keypress',this.onCommand.bind(this)).addEvent('click',this.onCommand.bind(this,[false]));if(!this.options.alwaysOpen){this.element.addEvent('focus',this.toggleFocus.create({bind:this,arguments:true,delay:100})).addEvent('blur',this.toggleFocus.create({bind:this,arguments:false,delay:100}));}},destroy:function(){if(this.fix)this.fix.destroy();this.choices=this.selected=this.choices.destroy();},toggleFocus:function(state){this.focussed=state;if(!state)this.hideChoices(true);this.fireEvent((state)?'onFocus':'onBlur',[this.element]);},onCommand:function(e){if(!e&&this.focussed)return this.prefetch();if(e&&e.key&&!e.shift&&!this.options.ignoreKeys){switch(e.key){case'enter':e.stop();if(!this.selected){if(!this.options.customChoices){this.element.value='';}
return true;}
if(this.selected&&this.visible){this.choiceSelect(this.selected);return!!(this.options.autoSubmit);}
break;case'up':case'down':var value=this.element.value;if(!this.prefetch()&&this.queryValue!==null){var up=(e.key=='up');this.choiceOver((this.selected||this.choices)[(this.selected)?((up)?'getPrevious':'getNext'):((up)?'getLast':'getFirst')](this.options.choicesMatch),true);this.element.value=value;}
return false;case'esc':this.hideChoices(true);if(!this.options.customChoices)this.element.value='';break;case'tab':if(this.selected&&this.visible){this.choiceSelect(this.selected);return!!(this.options.autoSubmit);}else{this.hideChoices(true);if(!this.options.customChoices)this.element.value='';break;}}}
this.fireEvent('onCommand',e);return true;},setSelection:function(finish){var tokenInfo=this.selected.retrieve('autocompleteChoice');var input=(this.options.tokenFormat=='object'?tokenInfo[this.options.tokenValueKey]:tokenInfo);var value=input;var start=this.queryValue.length,end=input.length;if((input.substr(0,start)||'').toLowerCase()!=(this.queryValue||'').toLowerCase())start=0;if(this.options.multiple){var split=this.options.separatorSplit;value=this.element.value;start+=this.queryIndex;end+=this.queryIndex;var old=value.substr(this.queryIndex).split(split,1)[0];value=value.substr(0,this.queryIndex)+input+value.substr(this.queryIndex+old.length);if(finish){var tokens=value.split(this.options.separatorSplit).filter(function(entry){return this.test(entry);},/[^\s,]+/);if(!this.options.allowDupes)tokens=[].combine(tokens);var sep=this.options.separator;value=tokens.join(sep)+sep;end=value.length;}}
if(this.options.autocompleteType=='tag')this.observer.setValue(value);this.opted=value;if(finish||this.selectMode=='pick')start=end;$try(function(){this.element.selectRange(start,end)}.bind(this));this.fireEvent('onSelection',[this.element,this.selected,value,input]);},showChoices:function(){var match=this.options.choicesMatch,first=this.choices.getFirst(match);this.selected=this.selectedValue=null;if(this.fix){var pos=this.element.getCoordinates(this.relative),width=this.options.width||'auto';this.choices.setStyles({'width':(width===true||width=='inherit')?pos.width:width});}
if(!first)return;if(!this.visible){this.visible=true;this.choices.setStyle('display','');if(this.fx)this.fx.start(1);this.fireEvent('onShow',[this.element,this.choices]);}
if(this.options.selectFirst||this.typeAhead||first.inputValue==this.queryValue)this.choiceOver(first,this.typeAhead);var items=this.choices.getChildren(match),max=this.options.maxChoices;var styles={'overflowY':'hidden','height':''};this.overflown=false;if(items.length>max){var item=items[max-1];styles.overflowY='scroll';styles.height=item.getCoordinates(this.choices).bottom;this.overflown=true;};this.choices.setStyles(styles);if(this.fix)this.fix.show();if(this.options.visibleChoices){var scroll=document.getScroll(),size=document.getSize(),coords=this.choices.getCoordinates();if(coords.right>scroll.x+size.x)scroll.x=coords.right-size.x;if(coords.bottom>scroll.y+size.y)scroll.y=coords.bottom-size.y;window.scrollTo(Math.min(scroll.x,coords.left),Math.min(scroll.y,coords.top));}},hideChoices:function(clear){if(clear){var value=this.element.value;if(this.options.forceSelect)value=this.opted;if(this.options.autoTrim){value=value.split(this.options.separatorSplit).filter($arguments(0)).join(this.options.separator);}
this.observer.setValue(value);}
if(!this.visible)return;this.visible=false;if(this.selected)this.selected.removeClass('autocompleter-selected');this.observer.clear();var hide=function(){this.choices.setStyle('display','none');if(this.fix)this.fix.hide();}.bind(this);if(this.fx)this.fx.start(0).chain(hide);else hide();this.fireEvent('onHide',[this.element,this.choices]);},prefetch:function(){var value=this.element.value,query=value;if(this.options.multiple){var split=this.options.separatorSplit;var values=value.split(split);var index=this.element.getSelectedRange().start;var toIndex=value.substr(0,index).split(split);var last=toIndex.length-1;index-=toIndex[last].length;query=values[last];}
if(query.length<this.options.minLength){this.hideChoices();}else{if(query===this.queryValue||(this.visible&&query==this.selectedValue)){if(this.visible)return false;this.showChoices();}else{this.queryValue=query;this.queryIndex=index;if(!this.fetchCached())this.query();}}
return true;},fetchCached:function(){switch(true){case(!this.options.cache):case(!this.cachedQueryValue||this.queryValue.length<this.cachedQueryValue.length):case(this.queryValue.indexOf(this.cachedQueryValue)==-1):return false;break;}
if(this.cached.length<this.options.maxChoices)
{this.update(this.filter(this.cached));return true;}
var newChoices=this.filter(this.cached,this.queryValue);if(newChoices.length>=this.cached.length)
{this.update(this.filter(this.cached));return true;}
return false;},update:function(tokens){$(this.choices).empty();this.cached=tokens;this.cachedQueryValue=this.queryValue;var type=tokens&&$type(tokens);if(!type||(type=='array'&&!tokens.length)||(type=='hash'&&!tokens.getLength())){(this.options.emptyChoices||this.hideChoices).call(this);}else{if(this.options.maxChoices<tokens.length&&!this.options.overflow)tokens.length=this.options.maxChoices;tokens.each(this.options.injectChoice||function(token){tokenValue=(this.options.tokenFormat=='object'?token[this.options.tokenValueKey]:token);var choice=new Element('li',{'html':this.markQueryValue(tokenValue)});this.addChoiceEvents(choice).inject(this.choices);choice.store('autocompleteChoice',token);},this);this.showChoices();}},choiceOver:function(choice,selection){if(!choice||choice==this.selected)return;if(this.selected)this.selected.removeClass('autocompleter-selected');this.selected=choice.addClass('autocompleter-selected');this.fireEvent('onSelect',[this.element,this.selected,selection]);if(!this.selectMode)this.opted=this.element.value;if(!selection)return;this.selectedValue=this.selected.retrieve('autocompleteChoice');if(this.overflown){var coords=this.selected.getCoordinates(this.choices),margin=this.options.overflowMargin,top=this.choices.scrollTop,height=this.choices.offsetHeight,bottom=top+height;if(coords.top-margin<top&&top)this.choices.scrollTop=Math.max(coords.top-margin,0);else if(coords.bottom+margin>bottom)this.choices.scrollTop=Math.min(coords.bottom-height+margin,bottom);}
if(this.selectMode)this.setSelection();},choiceSelect:function(choice){if(choice)this.choiceOver(choice);this.setSelection(true);this.queryValue=false;if(!this.options.alwaysOpen){this.hideChoices();}else{this.observer.setValue('');this.prefetch.delay(this.options.delay,this);}
this.fireEvent('onChoiceSelect',choice);if(this.options.autocompleteType=='message'){this.element.value='';var token=choice.retrieve('autocompleteChoice');if(token.friends){var friend_ids="";for(var id in token.friends){if(friend_ids=="")friend_ids=id;else friend_ids=friend_ids+","+id;}
this.doAddValueToHidden(token.label,friend_ids,'toValues',true,' tag_friend');}
else this.doAddValueToHidden(choice.id,token.id,'toValues',true);}},doAddValueToHidden:function(name,toID,hideLoc,newItem,list){var hiddenInputField=document.getElementById(hideLoc);var previousToValues=hiddenInputField.value;if(this.checkSpanExists(name,toID)){if(previousToValues==''){document.getElementById(hideLoc).value=toID;}
else{document.getElementById(hideLoc).value=previousToValues+","+toID;}
this.doPushSpan(name,toID,newItem,hideLoc,list);}},doPushSpan:function(name,toID,newItem,hideLoc,list){var myElement=new Element("span");if(newItem){myElement.id="tospan_"+name+"_"+toID;myElement.innerHTML=name+" <a href='javascript:void(0);' onclick='this.parentNode.destroy();removeFromToValue(\""+toID+"\", \""+hideLoc+"\");'>x</a>";}
else{myElement.id="tospan_"+name+"_"+toID;myElement.innerHTML=name+" <a href='javascript:void(0);' onclick='this.parentNode.destroy();removeFromToValue(\""+toID+"\", \""+hideLoc+"\");'>x</a>";}
$('toValues-wrapper').setStyle('height','auto');if(list==null)list="";myElement.addClass("tag"+list);document.getElementById('toValues-element').appendChild(myElement);this.fireEvent('push');},checkToValue:function(toID,toValues){var checkValue=true;var checkMulti=toID.search(/,/);var x;var toValueArray=toValues.split(",");if(checkMulti!=-1){var recipientsArray=toID.split(",");var multiBool=false;for(var i=0;i<recipientsArray.length;i++){var tempBool=true;for(var x=0;x<toValueArray.length;x++){if(toValueArray[x]==recipientsArray[i]){tempBool=false;}}
multiBool=multiBool||tempBool;}
checkValue=multiBool;}
else{for(x in toValueArray)
{if(toValueArray[x]==toID){checkValue=false;}}}
return checkValue;},checkSpanExists:function(name,toID){var span_id="tospan_"+name+"_"+toID;if($(span_id)){return false;}
else return true;},filter:function(tokens,queryValue){queryValue=queryValue||this.queryValue;tokens=tokens||this.tokens;var regex=new RegExp(((this.options.filterSubset)?'':'^')+queryValue.escapeRegExp(),(this.options.filterCase)?'':'i');if(this.options.tokenFormat=='object'){var key=this.options.tokenValueKey;return tokens.filter(function(token){return regex.test(token[key]);});}else{return tokens.filter(function(token){return regex.test(token);});}
return tokens;},markQueryValue:function(str){return(!this.options.markQuery||!this.queryValue)?str:str.replace(new RegExp('('+((this.options.filterSubset)?'':'^')+this.queryValue.escapeRegExp()+')',(this.options.filterCase)?'':'i'),'<span class="autocompleter-queried">$1</span>');},addChoiceEvents:function(el){return el.addEvents({'mouseover':this.choiceOver.bind(this,el),'click':this.choiceSelect.bind(this,el)});}});var OverlayFix=new Class({initialize:function(el){if(Browser.Engine.trident){this.element=$(el);this.relative=this.element.getOffsetParent();this.fix=new Element('iframe',{'frameborder':'0','scrolling':'no','src':'javascript:false;','styles':{'position':'absolute','border':'none','display':'none','filter':'progid:DXImageTransform.Microsoft.Alpha(opacity=0)'}}).inject(this.element,'after');}},show:function(){if(this.fix){var coords=this.element.getCoordinates(this.relative);delete coords.right;delete coords.bottom;this.fix.setStyles($extend(coords,{'display':'','zIndex':(this.element.getStyle('zIndex')||1)-1}));}
return this;},hide:function(){if(this.fix)this.fix.setStyle('display','none');return this;},destroy:function(){if(this.fix)this.fix=this.fix.destroy();}});Element.implement({getSelectedRange:function(){if(!Browser.Engine.trident)return{start:this.selectionStart,end:this.selectionEnd};var pos={start:0,end:0};var range=this.getDocument().selection.createRange();if(!range||range.parentElement()!=this)return pos;var dup=range.duplicate();if(this.type=='text'){pos.start=0-dup.moveStart('character',-100000);pos.end=pos.start+range.text.length;}else{var value=this.value;var offset=value.length-value.match(/[\n\r]*$/)[0].length;dup.moveToElementText(this);dup.setEndPoint('StartToEnd',range);pos.end=offset-dup.text.length;dup.setEndPoint('StartToStart',range);pos.start=offset-dup.text.length;}
return pos;},selectRange:function(start,end){if(Browser.Engine.trident){var diff=this.value.substr(start,end-start).replace(/\r/g,'').length;start=this.value.substr(0,start).replace(/\r/g,'').length;var range=this.createTextRange();range.collapse(true);range.moveEnd('character',start+diff);range.moveStart('character',start);range.select();}else{this.focus();this.setSelectionRange(start,end);}
return this;}});Autocompleter.Base=Autocompleter;;Autocompleter.Local=new Class({Extends:Autocompleter,options:{minLength:0,delay:200},initialize:function(element,tokens,options){this.parent(element,options);this.tokens=tokens;},query:function(){this.update(this.filter());}});;Autocompleter.Request=new Class({Extends:Autocompleter,options:{postData:{},ajaxOptions:{},postVar:'value',delay:250},query:function(){var data=$unlink(this.options.postData)||{};data[this.options.postVar]=this.queryValue;var indicator=$(this.options.indicator);if(indicator)indicator.setStyle('display','');var cls=this.options.indicatorClass;if(cls)this.element.addClass(cls);this.fireEvent('onRequest',[this.element,this.request,data,this.queryValue]);this.request.send({'data':data});},queryResponse:function(){var indicator=$(this.options.indicator);if(indicator)indicator.setStyle('display','none');var cls=this.options.indicatorClass;if(cls)this.element.removeClass(cls);return this.fireEvent('onComplete',[this.element,this.request]);}});Autocompleter.Request.JSON=new Class({Extends:Autocompleter.Request,initialize:function(el,url,options){this.parent(el,options);this.request=new Request.JSON($merge({'url':url,'link':'cancel'},this.options.ajaxOptions)).addEvent('onComplete',this.queryResponse.bind(this));},queryResponse:function(response){this.parent();this.update(response);}});Autocompleter.Request.HTML=new Class({Extends:Autocompleter.Request,initialize:function(el,url,options){this.parent(el,options);this.request=new Request.HTML($merge({'url':url,'link':'cancel','update':this.choices},this.options.ajaxOptions)).addEvent('onComplete',this.queryResponse.bind(this));},queryResponse:function(tree,elements){this.parent();if(!elements||!elements.length){this.hideChoices();}else{this.choices.getChildren(this.options.choicesMatch).each(this.options.injectChoice||function(choice){var value=choice.innerHTML;choice.inputValue=value;this.addChoiceEvents(choice.set('html',this.markQueryValue(value)));},this);this.showChoices();}}});Autocompleter.Ajax={Base:Autocompleter.Request,Json:Autocompleter.Request.JSON,Xhtml:Autocompleter.Request.HTML};
;// Minified by http://closure-compiler.appspot.com/home
var PhotoViewer={is_setup:!1,c:null,is_viewer:!1,last_scroll_top:0,timeout:null,total_count:0,photos:{},album_title:"",album_href:"",owner_title:"",owner_href:"",slideshow_is_stop:!0,slideshow_is_pause:!1,scale:1,move:{top:0,left:0},comments:{},options:{album_id:0,photo_id:0,isPage:0,slideshow_time:3E3,min_scale:1,max_scale:3,scale_step:10},open:function(a){var b=this;this.options.album_id=a.album_id;this.options.photo_id=a.photo_id;this.options.isPage=a.isPage;this.setup();b.last_scroll_top=j(window).scrollTop(); this.viewer();this.reset();b.viewer().addClass("active");setTimeout(function(){j(window).scrollTop(0);j("html").addClass("hideScroll");b.resize();b.loadPhoto()},10);this.old_comments_block=j(".layout_core_comments");this.setIdPrefix(this.old_comments_block)},hide:function(){this.viewer().hasClass("fullmode")?this.fullHide():(this.viewer().removeClass("active"),j("html").removeClass("hideScroll"),j(window).scrollTop(this.last_scroll_top),this.removeIdPrefix(this.old_comments_block))},resize:function(){var a= j(window).width(),b=j(window).height();this.viewer().hasClass("fullmode")?(j("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b),j("#wpPhotoViewer").find(".wpPhoto").css("width",a),j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right",0)):(a-=50,b-=50,j("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b-70),j("#wpPhotoViewer").find(".wpPhoto").css("width",a-400),j("#wpPhotoViewer").find(".wpComments").css("width",400),j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right", 390));j("#wpPhotoViewer").find(".wpNext, .wpPrev").css("line-height",b+"px");0<this.viewer().find(".photos").width()-100*this.total_count?this.viewer().find(".wpPhotoList").addClass("one_col"):this.viewer().find(".wpPhotoList").removeClass("one_col");this.hideOptions()},loadPhoto:function(){var a=this;j.ajax({url:en4.core.baseUrl+"photoviewer",data:{format:"json",photo_id:this.options.photo_id,isPage:this.options.isPage},success:function(b){if(b&&b.photos){a.total_count=b.count;a.album_title=b.album_title; a.album_href=b.album_href;a.owner_title=b.owner_title;a.owner_href=b.owner_href;a.photos={};var d=0,c="";j(b.photos).each(function(b,f){c+='<a href="javascript:void(0);" class="wpPhotoItem" onclick="PhotoViewer.view('+f.photo_id+');" id="wp_'+f.photo_id+'"><img id="fullphoto_'+f.photo_id+'" src="'+f.thumb+'" alt=""/></a>';a.photos[f.photo_id]=f;0==b&&(d=f.photo_id);f.active&&(d=f.photo_id)});a.viewer().find(".wpPhotoList").find(".photos").html(c);a.viewer().find(".wpPhotoList").find(".photos").find("img").load(function(){j(this).addClass("loaded")}); a.viewer().find(".wpPhotoList").find(".count").html(a.total_count);1<a.total_count&&a.viewer().find(".allPhotos").show();a.viewer().find(".goSlideshow").show();a.view(d);a._checkPagination();a.resize()}}})},view:function(a){if(this.photos[a]){var b=this.photos[a];this.viewer().find(".wpPhotoItem").removeClass("active");this.viewer().find("#wp_"+a).addClass("active");var d=this.viewer().find("#wp_"+a).prevAll().length+1,c=this.viewer().find(".wpPhotoContent");c.find(".active").removeClass("active").removeClass("fade"); var e=c.find("#thephoto_"+a);e.length?(e.addClass("active"),setTimeout(function(){e.addClass("fade")},10)):(c.append(j('<div class="thephoto" id="thephoto_'+a+'"><div class="moveElement"><div id="imgPlace_'+a+'"><img src="'+b.src+'" alt=""/></div><span class="photo_options"><a href="javascript:void(0);" class="openfull icon-resize-full" onclick="PhotoViewer.fullOpen();"></a><a href="javascript:void(0);" class="hidefull icon-resize-small" onclick="PhotoViewer.fullHide();"></a></span></div></div>')), e=j("#thephoto_"+a),clearTimeout(this.photo),this.photo=setTimeout(function(){e.addClass("active");setTimeout(function(){e.addClass("fade")},10)},10));this.resize();this.viewer().find(".wpPhotoOptions").find(".info").show();b=this.viewer().find(".wpPhotoOptions").find(".album_info");b.find(".album_title").html('<a href="'+this.album_href+'">'+this.album_title+"</a>");b.find(".album_owner").html(' - <a href="'+this.owner_href+'">'+this.owner_title+"</a>");this.viewer().find(".wpPhotoOptions").find(".count").find(".total").html(this.total_count); this.viewer().find(".wpPhotoOptions").find(".count").find(".current").html(d);this.loadComments(a);this._checkPagination()}},_checkPagination:function(){var a=this.viewer().find(".wpNext"),b=this.viewer().find(".wpPrev");if(2>this.total_count)a.hide(),b.hide();else{var d=this.viewer().find(".wpPhotoItem.active");d.prev().length?b.show():b.hide();d.next().length?a.show():a.hide()}},next:function(a){var b=this.viewer().find(".wpPhotoItem.active");b.next().length?b.next().click():a?a():this.showList(); this._checkPagination()},prev:function(){var a=this.viewer().find(".wpPhotoItem.active");a.prev().length?a.prev().click():this.showList();this._checkPagination()},toggleList:function(){this.viewer().find(".wpPhotoList").hasClass("active")?this.hideList():this.showList()},showList:function(){!(2>this.total_count)&&!this.viewer().hasClass("fullmode")&&(this.viewer().find(".photos").jScrollPane(),this.viewer().find(".wpPhotoList").addClass("active"),this.showOver())},isListActive:function(){return this.viewer().find(".wpPhotoList").hasClass("active")}, hideList:function(){this.viewer().find(".wpPhotoList").removeClass("active");this.hideOver()},loadComments:function(a){var b=this;j("#photo_comment_"+a).length?(b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide()),b.removeIdPrefix(j("#photo_comment_"+a).show())):(this.comment_request&&this.comment_request.abort(),b.showLoading(),this.comment_request=j.ajax({url:en4.core.baseUrl+"photoviewer/index/comments",data:{format:"html",photo_id:a,isPage:this.options.isPage},success:function(d){b.hideLoading(); b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide());var c=j("<div />").attr({id:"photo_comment_"+a,"class":"photo_comment"});c.html(d);b.viewer().find(".wpCommentsContent").append(c);en4.core.runonce.trigger();Smoothbox.bind($("photo_comment_"+a))}}))},setIdPrefix:function(a){a.find("*[id]").not(".iswphprefix").each(function(a,d){j(d).attr("id","wphPrefix"+(1E3*Math.random()).toInt()+"wphEnd"+j(d).attr("id"));j(d).addClass("iswphprefix")})},removeIdPrefix:function(a){a.find(".iswphprefix").each(function(a, d){var c=j(d).attr("id"),e=c.indexOf("wphEnd");-1!==e&&(c=c.substr(e+6),j(d).attr("id",c),j(d).removeClass("iswphprefix"))})},onError:function(a){alert(a)},setup:function(){var a=this;if(!this.is_setup){this.is_setup=!0;j(window).resize(function(){a.resize()});var b="keypress";if(Browser.Engine.trident||Browser.Engine.webkit)b="keydown";j(document).bind(b,function(b){var c=j(b.target).prop("tagName").toLowerCase();"textarea"==c||"input"==c||"select"==c||a.isListActive()||(37==b.keyCode?a.prev():39== b.keyCode?a.next():0!=b.keyCode&&(27==b.keyCode?a.viewer().hasClass("fullmode")?a.fullHide():a.hide():109==b.keyCode||38==b.keyCode?a.zoom(2):(107==b.keyCode||40==b.keyCode)&&a.zoom(-2)))});this.viewer().find(".wpPhoto").mousewheel(function(b){if(!a.viewer().hasClass("tagging_process")){b=b.originalEvent;var c=0;b.wheelDelta&&(c=b.wheelDelta/120);b.detail&&(c=-b.detail/3);a.zoom(c)}});this.viewer().click(function(b){!j(b.target).closest(".external-options").length&&(!j(b.target).hasClass("actions")&& !j(b.target).parent().hasClass("actions"))&&a.hideOptions()});document.addEventListener&&(document.addEventListener("fullscreenchange",function(){},!1),document.addEventListener("mozfullscreenchange",function(){a.fullToggle(document.mozFullScreen)},!1),document.addEventListener("webkitfullscreenchange",function(){a.fullToggle(document.webkitIsFullScreen)},!1))}},fullToggle:function(a){a?this.fullOpen():this.fullHide()},zoom:function(a){if(!this.isListActive())if(a/=this.options.scale_step,this.scale+= a,this.scale<this.options.min_scale)this.viewer().removeClass("zooming"),this.scale-=a;else if(this.scale>this.options.max_scale)this.scale-=a;else if(this.viewer().addClass("zooming"),j("#wpPhotoViewer").find(".wpPhoto").find(".active").css("-moz-transform","scale("+this.scale+")").css("-webkit-transform","scale("+this.scale+")").css("transform","scale("+this.scale+")"),a=this.getInternetExplorerVersion(),7==a||8==a)a=j("#wpPhotoViewer").find(".wpPhoto").find(".active").find("img"),a.data("original-width")|| (a.data("original-width",a.width()),a.data("original-height",a.height())),a.css("width",a.data("original-width")*this.scale).css("height",a.data("original-height")*this.scale)},getInternetExplorerVersion:function(){var a=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1));return a},noZoom:function(a){a?this.viewer().addClass("nozoom"):this.viewer().removeClass("nozoom")},fullOpen:function(){var a=this.viewer(); a.addClass("fullmode");this.resize();a=a[0];a.requestFullScreen&&a.requestFullScreen();a.webkitRequestFullScreen&&a.webkitRequestFullScreen();a.mozRequestFullScreen&&a.mozRequestFullScreen();a.requestFullscreen&&a.requestFullscreen()},fullHide:function(){this.viewer().removeClass("fullmode");this.resize();this.stopSlideshow();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide();document.cancelFullScreen&&document.cancelFullScreen();document.webkitCancelFullScreen&& document.webkitCancelFullScreen();document.mozCancelFullScreen&&document.mozCancelFullScreen();document.exitFullscreen&&document.exitFullscreen()},viewer:function(){var a=this;if(this.is_viewer)return this.c;this.is_viewer=!0;var b=j("<div />");b.attr({id:"wpPhotoViewer","class":"wpPhotoViewer"});b.html(this.getHtmlContent());b.appendTo(j("body"));var d=this.getInternetExplorerVersion();-1!==d&&(b.addClass("wpIe"),b.addClass("wpIe"+d));clearTimeout(a.mouseTimer);b.mouseover(function(){clearTimeout(a.mouseTimer); a.mouseTimer=setTimeout(function(){a.viewer().addClass("mouseActive");clearTimeout(a.mouseTimerOut);a.mouseTimerOut=setTimeout(function(){a.viewer().removeClass("mouseActive")},2E3)},10)});var c=b.find(".wpPhotoContent");c.unbind("mousemove").mousemove(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed&&(clearInterval(a.moving_timer),a.moving_timer=setTimeout(function(){var c=a.move.startClientX-b.clientX,d=a.move.startClientY-b.clientY;a.move.startClientX=b.clientX;a.move.startClientY= b.clientY;a.photoMove(c,d)},1)),!1});c.unbind("mousedown").mousedown(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!0,a.move.startClientX=b.clientX,a.move.startClientY=b.clientY,c.addClass("moving"),!1});c.unbind("mouseup").mouseup(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!1,c.removeClass("moving"),!1});c.unbind("mouseout").mouseout(function(b){if(!j(b.target).closest("#lassoMask").length)return a.is_pressed=!1,c.removeClass("moving"), !1});return this.c=b},photoMove:function(a,b){var d=j("#thephoto_"+this.getActiveId());this.move.top+=1.5*-b;this.move.left+=1.5*-a;d.css("margin-top",this.move.top);d.css("margin-left",this.move.left)},showOver:function(){var a=this;this.viewer().find(".wpOver").show();clearTimeout(this.timeout);this.timeout=setTimeout(function(){a.viewer().find(".wpOver").addClass("active")},100)},hideOver:function(){var a=this;a.viewer().find(".wpOver").removeClass("active");clearTimeout(this.timeout);this.timeout= setTimeout(function(){a.viewer().find(".wpOver").hide()},500)},slideshow:function(){this.fullOpen();this.startSlideshow()},slideshowClose:function(){this.stopSlideshow();this.fullHide();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide()},startSlideshow:function(){var a=this;this.stopSlideshow();this.slideshow_is_pause=this.slideshow_is_stop=!1;this.viewer().addClass("slideshow_process");this.slideshow_timer=setInterval(function(){a.slideshow_is_pause||a.next(function(){a.stopSlideshow()})}, this.options.slideshow_time);this._checkStatusSlideShow()},stopSlideshow:function(){clearInterval(this.slideshow_timer);this.slideshow_is_stop=!0;this._checkStatusSlideShow()},repeatSlideshow:function(){this.viewer().find(".photos").find("a:first").click();this.startSlideshow();this._checkStatusSlideShow()},_checkStatusSlideShow:function(){this.slideshow_is_pause?(this.viewer().find(".wpSlidStart").show(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").hide()):this.slideshow_is_stop? (this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").show()):(this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").show(),this.viewer().find(".wpSlidRepeat").hide())},pauseSlideshow:function(){this.slideshow_is_pause=!0;this._checkStatusSlideShow()},hideOptions:function(){j("#photo_comment_"+this.getActiveId()).find(".external-options").hide()},toggleOptions:function(){var a=j("#photo_comment_"+this.getActiveId()).find(".external-options"); a.toggle();var b=this.viewer().find(".actions").offset();a.css("top",32).css("left",b.left)},getActiveId:function(){var a=this.viewer().find(".photos").find(".active");if(a.length)return a.attr("id").substr(3)},getActive:function(){return this.photos[this.getActiveId()]},getHtmlContent:function(){return'<div class="wpContainer"><a href="javascript:void(0);" class="wpPrev icon-angle-left" onclick="PhotoViewer.prev();" style="display: none;"></a><a href="javascript:void(0);" class="wpNext icon-angle-right" onclick="PhotoViewer.next();" style="display: none;"></a><a href="javascript:void(0);" class="wpClose icon-remove" onclick="PhotoViewer.hide();"></a><div class="wpPhoto"><table width="100%" class="wpPhotoContentTable"><tr><td align="center" valign="center" class="wpPhotoContent"></td></tr></table></div><div class="wpComments"><div class="wpCommentsContent"><div class="photo_comment loadingComments"><div class="layout_page_photoviewer_index_comments"><div class="generic_layout_container layout_main"><span class="loading">'+ en4.core.language.translate("PHOTOVIEWER_loading")+'</span></div></div></div></div></div><div class="wpBar"><div class="wpPhotoList"><div class="title">'+en4.core.language.translate("PHOTOVIEWER_All photos")+'&nbsp;(<span class="count">0</span>)<a href="javascript:void(0);" onclick="PhotoViewer.hideList();" class="wpListClose"><i class="icon-remove"></i></a></div><div class="photos"></div></div><div class="wpPhotoOptions"><div class="leftside"><a href="javascript:void(0);" class="wpbtn wpbtn-inverse allPhotos" onclick="PhotoViewer.toggleList();" style="display: none;">'+ en4.core.language.translate("PHOTOVIEWER_All photos")+'<i class="right icon-caret-up"></i></a><a href="javascript:void(0);" class="wpbtn wpbtn-inverse goSlideshow" onclick="PhotoViewer.slideshow();" style="display: none;">'+en4.core.language.translate("PHOTOVIEWER_Slideshow")+'</a><div class="info" style="display: none;"><div class="album_info"><span class="album_title"></span><span class="album_owner"></span></div><div class="count"><span class="current"></span>&nbsp;'+en4.core.language.translate("PHOTOVIEWER_from")+ '&nbsp;<span class="total"></span></div></div></div></div></div></div><div class="wpSlideshow" style="display: none;"><a href="javascript:void(0);" onclick="PhotoViewer.startSlideshow();" style="display: none;" class="wpSlidStart wpbtn wpbtn-inverse">'+en4.core.language.translate("PHOTOVIEWER_Play")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.pauseSlideshow();" style="display: none;" class="wpSlidPause wpbtn wpbtn-inverse">'+en4.core.language.translate("PHOTOVIEWER_Pause")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.repeatSlideshow();" style="display: none;" class="wpSlidRepeat wpbtn wpbtn-inverse">'+ en4.core.language.translate("PHOTOVIEWER_Repeat")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.slideshowClose();" class="wpSlidClose wpbtn wpbtn-inverse"><i class="icon-remove"></i></a></div><div class="wpOver" onclick="PhotoViewer.hideList();" style="display: none;"></div>'},reset:function(){this.viewer().find(".photos").jScrollPane().data("jsp").destroy();this.viewer().find(".wpOver, .wpNext, .wpPrev, .info, .allPhotos, .goSlideshow, .wpSlideshow, .wpSlidStart, .wpSlidPause, .wpSlidRepeat").hide(); this.viewer().find(".wpPhotoContent, .photos").empty();this.viewer().find(".wpCommentsContent").children().hide();this.viewer().removeClass("fullmode").removeClass("zooming").removeClass("slideshow_process").removeClass("mouseActive");this.viewer().find(".wpPhotoList").removeClass(".one_col");this.viewer().find(".wpCommentsContent").children(".loadingComments").show();return this.viewer()},showLoading:function(){this.viewer().find(".wpCommentsContent").children().hide();this.viewer().find(".wpCommentsContent").children(".loadingComments").show()}, hideLoading:function(){this.viewer().find(".wpCommentsContent").children(".loadingComments").hide()},bindPhotoViewer:function(){j&&j("#global_content").find("a").not(".wp_init").addClass("wp_init").each(function(a,b){var d=j(b).attr("href");if(d&&"javascript:void(0)"!=d){var c=0,e=d.match(/album_id\/([0-9]{0,})\/*\/photo_id\/([0-9]{0,})/i);e||(e=d.match(/content\/pagealbumphoto\/album_id\/([0-9]{0,})\/content_id\/([0-9]{0,})/i),c=1);if(e&&e[0]&&e[1]&&e[2]){d=e[1];e=e[2];$(b).removeEvents();var f= $(b).getElement("img");f&&f.removeEvents("click");j(b).attr("onclick","").data("album_id",d).data("photo_id",e).data("isPage",c).click(function(a){a.stopPropagation();a.preventDefault();PhotoViewer.open({album_id:j(this).data("album_id"),photo_id:j(this).data("photo_id"),isPage:j(this).data("isPage")})})}}})}};